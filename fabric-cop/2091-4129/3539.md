<strong>Project</strong>: fabric-cop<br><strong>Branch</strong>: master<br><strong>ID</strong>: 3539<br><strong>Subject</strong>: Adding TCert Option 2 Library API<br><strong>Status</strong>: ABANDONED<br><strong>Owner</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 12/27/2016, 5:37:32 PM<br><strong>LastUpdated</strong>: 1/19/2017, 7:38:58 AM<br><strong>CommitMessage</strong>:<br><pre>Adding TCert Option 2 Library API

This implements FAB 1479
API for HSM Friendly TCert Generation
https://jira.hyperledger.org/browse/FAB-1479

This implements FAB 1477 also
Crypto support for HSM Friedly TCert generation
https://jira.hyperledger.org/browse/FAB-1477
This has BCCSP integration

One major change in this patch set is :
Client needs to specify which block was
signed and provide data in byte format and
put that in block with Public Key and Signature.
Client is expected to sign GetPrivateSignerRequest

Changed BCCSP element of TCertManager to be exportable
so that I can use it from CoP Server.

Added Method BatchRequestToPubkeyBuff in lib/tcert/util.go
to support TCert CoP server integration.

TCert integration to CoP Client and Server follows

Change-Id: I23af79fe84e30ad193516c1e6a6bc4b094613c5e
Signed-off-by: ASHUTOSH KUMAR <ashutosh_kumar@hotmail.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>Reviewed</strong>: 12/27/2016, 5:37:32 PM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/27/2016, 5:38:39 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-cop-verify-x86_64/217/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/27/2016, 5:43:20 PM<br><strong>Message</strong>: <pre>Patch Set 1: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-cop-verify-x86_64/217/ : SUCCESS</pre><strong>Reviewer</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>Reviewed</strong>: 12/29/2016, 7:32:01 PM<br><strong>Message</strong>: <pre>Patch Set 1: Code-Review-1

(11 comments)

Hi Ash, please see inline...</pre><strong>Reviewer</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>Reviewed</strong>: 12/29/2016, 7:59:11 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(11 comments)

Jonathan , please look at my comments. I have one question. If you can answer that , it'll be great.</pre><strong>Reviewer</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>Reviewed</strong>: 12/30/2016, 9:52:00 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(5 comments)

Good morning Ash, please see below (have tried to state my suggestions more explicitly - so that it's easier to get these in). Thanks.</pre><strong>Reviewer</strong>: Keith Smith - keithsmithlfid@gmail.com<br><strong>Reviewed</strong>: 1/3/2017, 11:45:21 AM<br><strong>Message</strong>: <pre>Patch Set 1: Code-Review-1

(4 comments)</pre><strong>Reviewer</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>Reviewed</strong>: 1/5/2017, 11:58:44 AM<br><strong>Message</strong>: <pre>Uploaded patch set 2.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/5/2017, 12:00:27 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-cop-verify-x86_64/252/</pre><strong>Reviewer</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>Reviewed</strong>: 1/5/2017, 12:00:33 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(14 comments)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/5/2017, 12:09:40 PM<br><strong>Message</strong>: <pre>Patch Set 2: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-cop-verify-x86_64/252/ : SUCCESS</pre><strong>Reviewer</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>Reviewed</strong>: 1/5/2017, 3:03:07 PM<br><strong>Message</strong>: <pre>Patch Set 2:

TCert Option 2 design can be found here : https://jira.hyperledger.org/secure/attachment/10360/mserv-TCertOptions-v3(1).md. Look for section : Approach 2. Use of TCert keys that are not associated to ECert keys in the document above.

Option 2 implementation details can be found at https://jira.hyperledger.org/browse/FAB-1372</pre><strong>Reviewer</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>Reviewed</strong>: 1/5/2017, 3:31:41 PM<br><strong>Message</strong>: <pre>Patch Set 2: Code-Review-1

(14 comments)

Please see inline.</pre><strong>Reviewer</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>Reviewed</strong>: 1/5/2017, 4:19:58 PM<br><strong>Message</strong>: <pre>Patch Set 2:

(12 comments)

Jonathan , thanks for your comments. I need your input on changing package for test codes.</pre><strong>Reviewer</strong>: Keith Smith - keithsmithlfid@gmail.com<br><strong>Reviewed</strong>: 1/5/2017, 4:37:41 PM<br><strong>Message</strong>: <pre>Patch Set 2: Code-Review-1

(13 comments)</pre><strong>Reviewer</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>Reviewed</strong>: 1/5/2017, 4:59:39 PM<br><strong>Message</strong>: <pre>Patch Set 2:

(3 comments)</pre><strong>Reviewer</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>Reviewed</strong>: 1/5/2017, 5:50:06 PM<br><strong>Message</strong>: <pre>Patch Set 2:

(13 comments)

Jonathan , please talk to Keith or Gari on separate package for test code as the same pattern should be applied across whole of CoP.I do not have problem in doing that.</pre><strong>Reviewer</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>Reviewed</strong>: 1/6/2017, 9:27:32 AM<br><strong>Message</strong>: <pre>Patch Set 2: Code-Review-2

(6 comments)

Good morning Ash, please see inline and let me/us know how/if we can assist... thanks.</pre><strong>Reviewer</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>Reviewed</strong>: 1/6/2017, 9:41:19 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Thanks Jonathan for your comment on test package. Done in the comment is for my bookkeeping purposes as I was marking them done in Gerritt after fixing it. So , you'll see those in next patch set. 
I am working through Keith's comment now.</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 1/6/2017, 9:43:35 AM<br><strong>Message</strong>: <pre>Patch Set 2:

(1 comment)</pre><strong>Reviewer</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>Reviewed</strong>: 1/6/2017, 9:48:49 AM<br><strong>Message</strong>: <pre>Patch Set 2:

(2 comments)</pre><strong>Reviewer</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>Reviewed</strong>: 1/6/2017, 1:36:06 PM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>Reviewed</strong>: 1/6/2017, 1:36:29 PM<br><strong>Message</strong>: <pre>Patch Set 3:

(9 comments)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/6/2017, 1:37:13 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-cop-verify-x86_64/263/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/6/2017, 1:46:21 PM<br><strong>Message</strong>: <pre>Patch Set 3: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-cop-verify-x86_64/263/ : SUCCESS</pre><strong>Reviewer</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>Reviewed</strong>: 1/6/2017, 5:06:23 PM<br><strong>Message</strong>: <pre>Uploaded patch set 4.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/6/2017, 5:08:03 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-cop-verify-x86_64/265/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/6/2017, 5:18:44 PM<br><strong>Message</strong>: <pre>Patch Set 4: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-cop-verify-x86_64/265/ : SUCCESS</pre><strong>Reviewer</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>Reviewed</strong>: 1/6/2017, 5:43:39 PM<br><strong>Message</strong>: <pre>Uploaded patch set 5.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/6/2017, 5:45:02 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-cop-verify-x86_64/266/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/6/2017, 5:55:31 PM<br><strong>Message</strong>: <pre>Patch Set 5: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-cop-verify-x86_64/266/ : SUCCESS</pre><strong>Reviewer</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>Reviewed</strong>: 1/9/2017, 11:26:26 AM<br><strong>Message</strong>: <pre>Uploaded patch set 6.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/9/2017, 11:27:58 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-cop-verify-x86_64/278/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/9/2017, 11:38:11 AM<br><strong>Message</strong>: <pre>Patch Set 6: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-cop-verify-x86_64/278/ : SUCCESS</pre><strong>Reviewer</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>Reviewed</strong>: 1/10/2017, 10:38:02 AM<br><strong>Message</strong>: <pre>Uploaded patch set 7.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/10/2017, 10:39:10 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-cop-verify-x86_64/293/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/10/2017, 10:48:37 AM<br><strong>Message</strong>: <pre>Patch Set 7: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-cop-verify-x86_64/293/ : SUCCESS</pre><strong>Reviewer</strong>: Keith Smith - keithsmithlfid@gmail.com<br><strong>Reviewed</strong>: 1/12/2017, 9:47:42 AM<br><strong>Message</strong>: <pre>Patch Set 7: Code-Review-1

Ash, can you pls rebase this on the API simplification change set.  You should be able to do this with the following command, assuming you are on the branch corresponding to this change set locally.
  git rebase db8246ecd95f680b308bd2710c59e1bb4fa83301</pre><strong>Reviewer</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>Reviewed</strong>: 1/12/2017, 10:00:45 AM<br><strong>Message</strong>: <pre>Patch Set 7:

(3 comments)

I will make update after https://gerrit.hyperledger.org/r/#/c/3781/ has been merged to master. Making corresponding changes will be couple of hours worth of work.</pre><strong>Reviewer</strong>: Volodymyr Paprotski - vpaprots@ca.ibm.com<br><strong>Reviewed</strong>: 1/17/2017, 2:09:19 AM<br><strong>Message</strong>: <pre>Patch Set 2:

(4 comments)</pre><strong>Reviewer</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>Reviewed</strong>: 1/17/2017, 12:31:20 PM<br><strong>Message</strong>: <pre>Patch Set 7:

(2 comments)

Vlad , your suggestions seem appropriate. I'll make these changes. I need to prioritize.</pre><strong>Reviewer</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>Reviewed</strong>: 1/19/2017, 7:38:58 AM<br><strong>Message</strong>: <pre>Abandoned</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>Uploader</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>Created</strong>: 12/27/2016, 5:37:32 PM<br><strong>UnmergedRevision</strong>: [99f33c5c6cc0290655349867b7e008f8674023e2](https://github.com/hyperledger-gerrit-archive/fabric-cop/commit/99f33c5c6cc0290655349867b7e008f8674023e2)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/27/2016, 5:43:20 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>Approved</strong>: 12/29/2016, 7:32:01 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Keith Smith - keithsmithlfid@gmail.com<br><strong>Approved</strong>: 1/3/2017, 11:45:21 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [lib/tcert/api.go#L66](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/99f33c5c6cc0290655349867b7e008f8674023e2/lib/tcert/api.go#L66)<br><strong>Comment</strong>: <pre>"contains TCert request where public key is being provided by caller" 
-->
"GetBatchGenKeyRequest encapsulates a (TCert) BatchRequest with corresponding PublicKeys "</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/api.go#L66](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/99f33c5c6cc0290655349867b7e008f8674023e2/lib/tcert/api.go#L66)<br><strong>Comment</strong>: <pre>Will make change.</pre><strong>Commenter</strong>: Keith Smith - keithsmithlfid@gmail.com<br><strong>CommentLine</strong>: [lib/tcert/api.go#L66](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/99f33c5c6cc0290655349867b7e008f8674023e2/lib/tcert/api.go#L66)<br><strong>Comment</strong>: <pre>I think the name "GetBatchGenKeyRequest" is a bit confusing since it sounds like it will generate keys which is actually what option 1 does, but it is instead using already generated keys.  I suggest naming it "GetBatchForKeysRequest".</pre><strong>Commenter</strong>: Keith Smith - keithsmithlfid@gmail.com<br><strong>CommentLine</strong>: [lib/tcert/api.go#L66](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/99f33c5c6cc0290655349867b7e008f8674023e2/lib/tcert/api.go#L66)<br><strong>Comment</strong>: <pre>Add a comment similar to:
"Return a TCert for each public key in the PublicKeys array.  The BatchRequest.Count field is ignored."</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/api.go#L66](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/99f33c5c6cc0290655349867b7e008f8674023e2/lib/tcert/api.go#L66)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/api.go#L66](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/99f33c5c6cc0290655349867b7e008f8674023e2/lib/tcert/api.go#L66)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [lib/tcert/tcert.go#L160](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/99f33c5c6cc0290655349867b7e008f8674023e2/lib/tcert/tcert.go#L160)<br><strong>Comment</strong>: <pre>"TCert Generation Failed with error "
--->
"Failed to generate a Transaction Certificate (TCert)"</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert.go#L160](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/99f33c5c6cc0290655349867b7e008f8674023e2/lib/tcert/tcert.go#L160)<br><strong>Comment</strong>: <pre>You are telling to suppress the error and give just an error statement ? Please let me know.</pre><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [lib/tcert/tcert.go#L160](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/99f33c5c6cc0290655349867b7e008f8674023e2/lib/tcert/tcert.go#L160)<br><strong>Comment</strong>: <pre>No, not at all. I suggest to correct the preceding text:

Please change the selected/quoted/highlighted text with the proposed text only. Leave the rest as is, thanks.

log.Errorf("Failed to generate a Transaction Certificate (TCert) [%v]", certError)</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert.go#L160](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/99f33c5c6cc0290655349867b7e008f8674023e2/lib/tcert/tcert.go#L160)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [lib/tcert/tcert.go#L161](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/99f33c5c6cc0290655349867b7e008f8674023e2/lib/tcert/tcert.go#L161)<br><strong>Comment</strong>: <pre>You can reuse the same string/error message, by calling sprint(), once.</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert.go#L161](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/99f33c5c6cc0290655349867b7e008f8674023e2/lib/tcert/tcert.go#L161)<br><strong>Comment</strong>: <pre>Will do.</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert.go#L161](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/99f33c5c6cc0290655349867b7e008f8674023e2/lib/tcert/tcert.go#L161)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [lib/tcert/tcert.go#L196](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/99f33c5c6cc0290655349867b7e008f8674023e2/lib/tcert/tcert.go#L196)<br><strong>Comment</strong>: <pre>Please remove.</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert.go#L196](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/99f33c5c6cc0290655349867b7e008f8674023e2/lib/tcert/tcert.go#L196)<br><strong>Comment</strong>: <pre>Will do.</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert.go#L196](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/99f33c5c6cc0290655349867b7e008f8674023e2/lib/tcert/tcert.go#L196)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [lib/tcert/tcert.go#L262](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/99f33c5c6cc0290655349867b7e008f8674023e2/lib/tcert/tcert.go#L262)<br><strong>Comment</strong>: <pre>You don't need to declare this outside of the if clause/block.
"enrollmentIDerr" is used in lines 272-273. You can instead create a temporary these.</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert.go#L262](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/99f33c5c6cc0290655349867b7e008f8674023e2/lib/tcert/tcert.go#L262)<br><strong>Comment</strong>: <pre>You are right. Will fix.</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert.go#L262](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/99f33c5c6cc0290655349867b7e008f8674023e2/lib/tcert/tcert.go#L262)<br><strong>Comment</strong>: <pre>Looking at code more closely , I came to conclusion that I cannot change the code. Error is being later in the code.encEnrollmentID is being used in line 322 , which is outside of the block.Also , I need to get error from the call CBCPKCS7Encrypt at line 270. If I have to declare one variable , encEnrollmentID outside the block , I need to declare second one also outside of the block.</pre><strong>Commenter</strong>: Keith Smith - keithsmithlfid@gmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert.go#L266](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/99f33c5c6cc0290655349867b7e008f8674023e2/lib/tcert/tcert.go#L266)<br><strong>Comment</strong>: <pre>Use constant here</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert.go#L266](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/99f33c5c6cc0290655349867b7e008f8674023e2/lib/tcert/tcert.go#L266)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [lib/tcert/tcert.go#L274](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/99f33c5c6cc0290655349867b7e008f8674023e2/lib/tcert/tcert.go#L274)<br><strong>Comment</strong>: <pre>You are returning an unused/uninitialized variable "err" here...
1. I believe you meant/should return "enrollmentIDerr" here?
2. Please remove the declaration of "err" from line 260.</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert.go#L274](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/99f33c5c6cc0290655349867b7e008f8674023e2/lib/tcert/tcert.go#L274)<br><strong>Comment</strong>: <pre>will do.</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert.go#L274](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/99f33c5c6cc0290655349867b7e008f8674023e2/lib/tcert/tcert.go#L274)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Keith Smith - keithsmithlfid@gmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert.go#L278](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/99f33c5c6cc0290655349867b7e008f8674023e2/lib/tcert/tcert.go#L278)<br><strong>Comment</strong>: <pre>Use constant here.
Is this the constant that a user will need to use in order to get the enrollment ID from a tcert?
We should have a test case which decrypts the enrollment ID.</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert.go#L278](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/99f33c5c6cc0290655349867b7e008f8674023e2/lib/tcert/tcert.go#L278)<br><strong>Comment</strong>: <pre>Done. Test case has been added.</pre><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [lib/tcert/tcert.go#L323](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/99f33c5c6cc0290655349867b7e008f8674023e2/lib/tcert/tcert.go#L323)<br><strong>Comment</strong>: <pre>Do we cover this in tests? Otherwise, can we add a test that covered these two flows?

That is, one with the "current" logic, of not checking if enrollmentCert is nil, and one with enrollmentCert that is not nil here?</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert.go#L323](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/99f33c5c6cc0290655349867b7e008f8674023e2/lib/tcert/tcert.go#L323)<br><strong>Comment</strong>: <pre>We have test to cover both flows and I tested those out before check-in. For TCert option 1 , we are using enrollment cert and TCert option 2 , we are not using enrollment cert.</pre><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [lib/tcert/tcert.go#L323](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/99f33c5c6cc0290655349867b7e008f8674023e2/lib/tcert/tcert.go#L323)<br><strong>Comment</strong>: <pre>I don't understand what is "TCert option 1" and what is "TCert option 2".

Can we put in JIRA what happens or should happen if one is asking for a batch of TCerts or the developer is calling generateExtensions() without providing an ECert?</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert.go#L323](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/99f33c5c6cc0290655349867b7e008f8674023e2/lib/tcert/tcert.go#L323)<br><strong>Comment</strong>: <pre>TCert option 1 is what has been done on Fabric 0.6. The API name in GetBatch. Hardware HSM does not support this mechanism and hence Zuric Research team came up with another mechanism where key derivation is not required. I have updated FAB 1372 with implementation details for TCert option2, link of which is : https://jira.hyperledger.org/browse/FAB-1372. The link has some background on TCert option #1 as well.</pre><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [lib/tcert/tcert_test.go#L115](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/99f33c5c6cc0290655349867b7e008f8674023e2/lib/tcert/tcert_test.go#L115)<br><strong>Comment</strong>: <pre>generating ...?

(a typo?)</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert_test.go#L115](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/99f33c5c6cc0290655349867b7e008f8674023e2/lib/tcert/tcert_test.go#L115)<br><strong>Comment</strong>: <pre>Will fix it.</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert_test.go#L115](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/99f33c5c6cc0290655349867b7e008f8674023e2/lib/tcert/tcert_test.go#L115)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [lib/tcert/tcert_test.go#L138](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/99f33c5c6cc0290655349867b7e008f8674023e2/lib/tcert/tcert_test.go#L138)<br><strong>Comment</strong>: <pre>Is there not a lint error here (function name mismatch?)</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert_test.go#L138](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/99f33c5c6cc0290655349867b7e008f8674023e2/lib/tcert/tcert_test.go#L138)<br><strong>Comment</strong>: <pre>Lint does not care for Test files and hence no error was thrown.</pre><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [lib/tcert/tcert_test.go#L138](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/99f33c5c6cc0290655349867b7e008f8674023e2/lib/tcert/tcert_test.go#L138)<br><strong>Comment</strong>: <pre>OK, thanks. Please let's correct it.</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert_test.go#L138](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/99f33c5c6cc0290655349867b7e008f8674023e2/lib/tcert/tcert_test.go#L138)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [lib/tcert/util.go#L319](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/99f33c5c6cc0290655349867b7e008f8674023e2/lib/tcert/util.go#L319)<br><strong>Comment</strong>: <pre>Do you want to use the same error message for logging and in the returned values.... ?</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/util.go#L319](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/99f33c5c6cc0290655349867b7e008f8674023e2/lib/tcert/util.go#L319)<br><strong>Comment</strong>: <pre>That is what I was thinking. I am open for suggestion/improvements.</pre><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [lib/tcert/util.go#L319](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/99f33c5c6cc0290655349867b7e008f8674023e2/lib/tcert/util.go#L319)<br><strong>Comment</strong>: <pre>Apologies for phrasing this in a semi-convoluted way. When I wrote:
"Do you want to use the same error message for logging and in the returned values.... ?"

I meant to say: "Please change these two lines, so that the same error message is used for logging and and as the returned value from the function." Currently they are not the same: 

		log.Errorf("Certificate Creation failed with error [%v]", err)
		return nil, fmt.Errorf("Failed in TCert x509.CreateCertificate: %s", err)

Thanks.</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/util.go#L319](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/99f33c5c6cc0290655349867b7e008f8674023e2/lib/tcert/util.go#L319)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [lib/tcert/util.go#L327](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/99f33c5c6cc0290655349867b7e008f8674023e2/lib/tcert/util.go#L327)<br><strong>Comment</strong>: <pre>Not sure if this is clear...</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/util.go#L327](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/99f33c5c6cc0290655349867b7e008f8674023e2/lib/tcert/util.go#L327)<br><strong>Comment</strong>: <pre>Will change it to : GetPublicKey returns ecdsa or RSA public key for the public key buffer.</pre><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [lib/tcert/util.go#L327](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/99f33c5c6cc0290655349867b7e008f8674023e2/lib/tcert/util.go#L327)<br><strong>Comment</strong>: <pre>1. Probably a better name for the function would be:: Bytes2PublicKey() or BytesToPublicKey()

2. "Byte2PublicKey parses a DER encoded public key (or a PEM block), returning an x509 PublicKey interface"</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/util.go#L327](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/99f33c5c6cc0290655349867b7e008f8674023e2/lib/tcert/util.go#L327)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>Uploader</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>Created</strong>: 1/5/2017, 11:58:44 AM<br><strong>UnmergedRevision</strong>: [1f550ec25606e64c78429bfd230a16688dd58cf0](https://github.com/hyperledger-gerrit-archive/fabric-cop/commit/1f550ec25606e64c78429bfd230a16688dd58cf0)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/5/2017, 12:09:40 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>Approved</strong>: 1/6/2017, 9:27:32 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Keith Smith - keithsmithlfid@gmail.com<br><strong>Approved</strong>: 1/5/2017, 4:37:41 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Keith Smith - keithsmithlfid@gmail.com<br><strong>CommentLine</strong>: [idp/idp.go#L227](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/idp/idp.go#L227)<br><strong>Comment</strong>: <pre>We don't need this.  We can just add another optional field to the "GetPrivateSignersRequest" struct above similar to:

    KeySigPairs []KeySigPair `json:"key_sig_pairs,omitempty"

This allows us to use the existing endpoint as I don't see any reason to have to add a new endpoint.</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [idp/idp.go#L227](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/idp/idp.go#L227)<br><strong>Comment</strong>: <pre>OK. Good point.I'll make the change. So , the struc</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [idp/idp.go#L227](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/idp/idp.go#L227)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Keith Smith - keithsmithlfid@gmail.com<br><strong>CommentLine</strong>: [idp/idp.go#L235](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/idp/idp.go#L235)<br><strong>Comment</strong>: <pre>I suggest renaming to "KeySigPair"</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [idp/idp.go#L235](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/idp/idp.go#L235)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Keith Smith - keithsmithlfid@gmail.com<br><strong>CommentLine</strong>: [idp/idp.go#L246](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/idp/idp.go#L246)<br><strong>Comment</strong>: <pre>We really want a union here, but since go doesn't have one, I guess this is OK.  Some validation is required to make sure exactly one of these is set.</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [idp/idp.go#L246](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/idp/idp.go#L246)<br><strong>Comment</strong>: <pre>Right now , I am checking for ECSignature.</pre><strong>Commenter</strong>: Keith Smith - keithsmithlfid@gmail.com<br><strong>CommentLine</strong>: [idp/idp.go#L252](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/idp/idp.go#L252)<br><strong>Comment</strong>: <pre>Should be "s"</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [idp/idp.go#L252](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/idp/idp.go#L252)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Keith Smith - keithsmithlfid@gmail.com<br><strong>CommentLine</strong>: [lib/tcert/api.go#L68](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/api.go#L68)<br><strong>Comment</strong>: <pre>Here also, I think you should just add an additional optional field to GetBatchRequest</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/api.go#L68](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/api.go#L68)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Keith Smith - keithsmithlfid@gmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert.go#L53](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert.go#L53)<br><strong>Comment</strong>: <pre>I suggest defining one constant named "enrollmentIDKey" and using it for both the encryption key and map key.  Is there any reason they need to be different?</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert.go#L53](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert.go#L53)<br><strong>Comment</strong>: <pre>enrollmentID is being used to create encryption key for enrollment Id and enrollmentIDMapKey is key for map. enrollmentIDMapKey is going to be made public , but we do not want enrollmentID to be be exposed. Hence there are two different constants/variables.</pre><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [lib/tcert/tcert.go#L58](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert.go#L58)<br><strong>Comment</strong>: <pre>s/names/name/

But since you describe in detail the parameters below., let's just change to:
// LoadMgr constructs a TCert manager given files containing a signing key and a CA cert</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert.go#L58](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert.go#L58)<br><strong>Comment</strong>: <pre>This was inherited from merge conflict resolution. Will make change.</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert.go#L58](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert.go#L58)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [lib/tcert/tcert.go#L184](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert.go#L184)<br><strong>Comment</strong>: <pre>Why don't you just print the errorMessage that you have constructed in the previous line (with Sprint()) ? That is, please remove line 184.</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert.go#L184](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert.go#L184)<br><strong>Comment</strong>: <pre>Good point. I just overlooked it. Will make change.</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert.go#L184](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert.go#L184)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [lib/tcert/tcert.go#L186](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert.go#L186)<br><strong>Comment</strong>: <pre>You don't need Errorf() as you have already used Sprintf()</pre><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [lib/tcert/tcert.go#L186](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert.go#L186)<br><strong>Comment</strong>: <pre>return nil, errors.New( errorMessage ) 

will work.</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert.go#L186](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert.go#L186)<br><strong>Comment</strong>: <pre>OK.Will do.</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert.go#L186](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert.go#L186)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [lib/tcert/tcert.go#L204](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert.go#L204)<br><strong>Comment</strong>: <pre>Let's use the same name "GetBatchForKeysRequest" or whatever it is that you'd end up calling it...</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert.go#L204](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert.go#L204)<br><strong>Comment</strong>: <pre>Will do.</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert.go#L204](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert.go#L204)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [lib/tcert/tcert.go#L249](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert.go#L249)<br><strong>Comment</strong>: <pre>Please change here too, to errors.New(errorMessage)</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert.go#L249](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert.go#L249)<br><strong>Comment</strong>: <pre>OK. Will do.</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert.go#L249](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert.go#L249)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [lib/tcert/tcert_test.go#L17](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert_test.go#L17)<br><strong>Comment</strong>: <pre>Please rename this to cert_testing (or something that's different than the package you are testing.</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert_test.go#L17](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert_test.go#L17)<br><strong>Comment</strong>: <pre>I am following the pattern that is prevalent all across fabric-cop. In fabric-cop , test code and main code are in same package. What is the rational behind this proposal ? Please let me know.</pre><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [lib/tcert/tcert_test.go#L17](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert_test.go#L17)<br><strong>Comment</strong>: <pre>Sorry, "tcert_test" preferably - so that it will be compiled as a separate package, and then linked and run with the main test binary. It's good practice, to test using a separate package.</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert_test.go#L17](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert_test.go#L17)<br><strong>Comment</strong>: <pre>I will not mind doing it if it is prevalent across whole of CoP. Like I said before , in cop , test code and functional code is in the same package. Keith or Gari has to chime in here as it has widespread CoP repercussions.</pre><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [lib/tcert/tcert_test.go#L17](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert_test.go#L17)<br><strong>Comment</strong>: <pre>I see. That's a great point. I guess one can only imagine the "widespread COP repercussions", the consequences, and the  ramifications  of, G-d forbid, separating the code testing a module, from the module that is being tested.

It's OK, leave it.

Please could you kindly focus on addressing the other, much less risky, pending items in this review? Thanks</pre><strong>Commenter</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert_test.go#L17](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert_test.go#L17)<br><strong>Comment</strong>: <pre>there's no repercussions only goodness as "blackbox" testing (i.e. tests are in a different package) are the recommended way to test packages which will be consumed by other packages</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert_test.go#L17](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert_test.go#L17)<br><strong>Comment</strong>: <pre>Thanks Gari for your input. Let me incorporate other comments in next patch set and will come back to this later. Does this make sense ? I am fine either way.</pre><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [lib/tcert/tcert_test.go#L80](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert_test.go#L80)<br><strong>Comment</strong>: <pre>found -> received</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert_test.go#L80](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert_test.go#L80)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Keith Smith - keithsmithlfid@gmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert_test.go#L90](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert_test.go#L90)<br><strong>Comment</strong>: <pre>Let's be consistent with "TCert" rather than "Tcert" in these names.</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert_test.go#L90](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert_test.go#L90)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [lib/tcert/tcert_test.go#L92](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert_test.go#L92)<br><strong>Comment</strong>: <pre>Please change this:
"Enrollment ID cannot be retrieved with error" 

To:
"EnrollmentID could not be retrieved. Error returned: [%v]"</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert_test.go#L92](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert_test.go#L92)<br><strong>Comment</strong>: <pre>Will do.</pre><strong>Commenter</strong>: Keith Smith - keithsmithlfid@gmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert_test.go#L92](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert_test.go#L92)<br><strong>Comment</strong>: <pre>I had actually been asking that we use the following form for consistency ... at least that is what we've doing elsewhere.

t.Errorf("Error retrieving enrollment ID: %s", err)

I think we may need to make a pass thru everything to make the format of all errors consistent.  Perhaps we should just open a Jira item for that, but I agree that all new errors should be consistent to minimize clean up.</pre><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [lib/tcert/tcert_test.go#L92](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert_test.go#L92)<br><strong>Comment</strong>: <pre>Oh, sure.

"Enrollment ID cannot be retrieved with error [%v]" sounds like/conveyed a different message (to me) - as if the attempt was "to retrieve the EID with an error" in the first place ;-)

Yes, the below works as well, sure:
   t.Errorf("Error retrieving enrollment ID: %s", err)</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert_test.go#L92](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert_test.go#L92)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert_test.go#L92](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert_test.go#L92)<br><strong>Comment</strong>: <pre>I implemented Keith's suggestion.</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert_test.go#L92](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert_test.go#L92)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [lib/tcert/tcert_test.go#L95](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert_test.go#L95)<br><strong>Comment</strong>: <pre>Let's be consistent. ( Enrollment ID + Enrollment Id ) --> EnrollmentID</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert_test.go#L95](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert_test.go#L95)<br><strong>Comment</strong>: <pre>Will do.</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert_test.go#L95](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert_test.go#L95)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [lib/tcert/tcert_test.go#L95](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert_test.go#L95)<br><strong>Comment</strong>: <pre>Done where?</pre><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [lib/tcert/tcert_test.go#L100](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert_test.go#L100)<br><strong>Comment</strong>: <pre>Let's be consistent. ( Enrollment ID + Enrollment Id ) --> EnrollmentID</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert_test.go#L100](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert_test.go#L100)<br><strong>Comment</strong>: <pre>Will do.</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert_test.go#L100](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert_test.go#L100)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [lib/tcert/tcert_test.go#L100](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert_test.go#L100)<br><strong>Comment</strong>: <pre>Done, as in...?</pre><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [lib/tcert/tcert_test.go#L113](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert_test.go#L113)<br><strong>Comment</strong>: <pre>EnrollmentID</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert_test.go#L113](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert_test.go#L113)<br><strong>Comment</strong>: <pre>Will do.</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert_test.go#L113](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert_test.go#L113)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [lib/tcert/tcert_test.go#L113](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert_test.go#L113)<br><strong>Comment</strong>: <pre>Can't see the change. Also, "is not set up right" is probably not as informative as one would have hoped...

E.g. what are the possible returned values from GetEnrollmentIDFromCert() ?</pre><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [lib/tcert/tcert_test.go#L184](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert_test.go#L184)<br><strong>Comment</strong>: <pre>Why is this hard-coded everywhere (lines 174, 183, 184, ....) ?</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert_test.go#L184](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert_test.go#L184)<br><strong>Comment</strong>: <pre>The count of TCert is hard coded in the test data , hence I had to match up in error message. This is test code anyways. I am open for suggestions. What do you recommend ?</pre><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [lib/tcert/tcert_test.go#L297](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert_test.go#L297)<br><strong>Comment</strong>: <pre>Why did we "decapitilize" this? ;-)</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert_test.go#L297](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert_test.go#L297)<br><strong>Comment</strong>: <pre>I inherited this from merge conflict resolution. Will Capitalize per your suggestion.</pre><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [lib/tcert/tcert_test.go#L297](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert_test.go#L297)<br><strong>Comment</strong>: <pre>Thanks.</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert_test.go#L297](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert_test.go#L297)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [lib/tcert/tcert_test.go#L297](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/tcert_test.go#L297)<br><strong>Comment</strong>: <pre>Sorry, I don't see the corrected version.</pre><strong>Commenter</strong>: Keith Smith - keithsmithlfid@gmail.com<br><strong>CommentLine</strong>: [lib/tcert/util.go#L339](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/util.go#L339)<br><strong>Comment</strong>: <pre>Is this an old comment?  Delete?</pre><strong>Commenter</strong>: Keith Smith - keithsmithlfid@gmail.com<br><strong>CommentLine</strong>: [lib/tcert/util.go#L346](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/util.go#L346)<br><strong>Comment</strong>: <pre>I really don't think we should be logging errors AND returning the same error message in an error.  The error response will be logged or consumed in another error that will be logged, so it just ends up with duplicate info in the logs.</pre><strong>Commenter</strong>: Keith Smith - keithsmithlfid@gmail.com<br><strong>CommentLine</strong>: [lib/tcert/util.go#L366](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/util.go#L366)<br><strong>Comment</strong>: <pre>You know that you can reuse the "err" variable, right?  I think it makes for cleaner reading code (i.e. not as verbose) than declaring variables for each error.  That is the pattern I see in go code.</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/util.go#L366](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/util.go#L366)<br><strong>Comment</strong>: <pre>I do not see any problem with this implementation.</pre><strong>Commenter</strong>: Keith Smith - keithsmithlfid@gmail.com<br><strong>CommentLine</strong>: [lib/tcert/util.go#L501](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/util.go#L501)<br><strong>Comment</strong>: <pre>Please grep for "Tcert" and change to "TCert"</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/util.go#L501](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/util.go#L501)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Keith Smith - keithsmithlfid@gmail.com<br><strong>CommentLine</strong>: [lib/tcert/util.go#L515](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/util.go#L515)<br><strong>Comment</strong>: <pre>The client should sign the exact bytes that are the body of the POST request flowing over the wire.  Sprintf is not necessarily going to return the same bytes.  You should pass the body of the POST request received by the server to this method to use in signature verification.</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/util.go#L515](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/util.go#L515)<br><strong>Comment</strong>: <pre>Done. I changed implementation.</pre><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [lib/tcert/util_test.go#L17](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/util_test.go#L17)<br><strong>Comment</strong>: <pre>Let's use a different name for this package please.
Maybe "tcert_testing" ?</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/util_test.go#L17](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/1f550ec25606e64c78429bfd230a16688dd58cf0/lib/tcert/util_test.go#L17)<br><strong>Comment</strong>: <pre>Same comment as in tcert_test.go. Also , We cannot have 2 packages in one directory in go.</pre></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>Uploader</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>Created</strong>: 1/6/2017, 1:36:06 PM<br><strong>UnmergedRevision</strong>: [ceafb78b61de9b337286f1f98e87903c94a9b130](https://github.com/hyperledger-gerrit-archive/fabric-cop/commit/ceafb78b61de9b337286f1f98e87903c94a9b130)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/6/2017, 1:46:21 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>Approved</strong>: 1/6/2017, 9:27:32 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>Uploader</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>Created</strong>: 1/6/2017, 5:06:23 PM<br><strong>UnmergedRevision</strong>: [adec6198f63e51f14de6e792410dd14db3136f96](https://github.com/hyperledger-gerrit-archive/fabric-cop/commit/adec6198f63e51f14de6e792410dd14db3136f96)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/6/2017, 5:18:44 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>Approved</strong>: 1/6/2017, 9:27:32 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 5</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>Uploader</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>Created</strong>: 1/6/2017, 5:43:39 PM<br><strong>UnmergedRevision</strong>: [7c1686d45dd49f54734d17523f62f597fa3c1629](https://github.com/hyperledger-gerrit-archive/fabric-cop/commit/7c1686d45dd49f54734d17523f62f597fa3c1629)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/6/2017, 5:55:31 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>Approved</strong>: 1/6/2017, 9:27:32 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 6</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>Uploader</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>Created</strong>: 1/9/2017, 11:26:26 AM<br><strong>UnmergedRevision</strong>: [2b2262c8d01c86da83a1f7c4e9a7b610257cae0b](https://github.com/hyperledger-gerrit-archive/fabric-cop/commit/2b2262c8d01c86da83a1f7c4e9a7b610257cae0b)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/9/2017, 11:38:11 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>Approved</strong>: 1/6/2017, 9:27:32 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 7</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>Uploader</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>Created</strong>: 1/10/2017, 10:38:02 AM<br><strong>UnmergedRevision</strong>: [c0accdd2eb51117d84a89e7322499ae4fd888f4a](https://github.com/hyperledger-gerrit-archive/fabric-cop/commit/c0accdd2eb51117d84a89e7322499ae4fd888f4a)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/10/2017, 10:48:37 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>Approved</strong>: 1/6/2017, 9:27:32 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Keith Smith - keithsmithlfid@gmail.com<br><strong>Approved</strong>: 1/12/2017, 9:47:42 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Volodymyr Paprotski - vpaprots@ca.ibm.com<br><strong>CommentLine</strong>: [lib/tcert/tcert.go#L62](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/c0accdd2eb51117d84a89e7322499ae4fd888f4a/lib/tcert/tcert.go#L62)<br><strong>Comment</strong>: <pre>This conflict with BCCSP change when the caKeyFile is an SKI file. https://gerrit.hyperledger.org/r/#/c/3735/</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/tcert.go#L62](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/c0accdd2eb51117d84a89e7322499ae4fd888f4a/lib/tcert/tcert.go#L62)<br><strong>Comment</strong>: <pre>I agree. Will be leveraging BCCSP SKI.</pre><strong>Commenter</strong>: Volodymyr Paprotski - vpaprots@ca.ibm.com<br><strong>CommentLine</strong>: [lib/tcert/tcert.go#L151](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/c0accdd2eb51117d84a89e7322499ae4fd888f4a/lib/tcert/tcert.go#L151)<br><strong>Comment</strong>: <pre>This is the same operation as in my comment bellow, candidate for BCCSP.. probably item for another workitem, since this is "option 1". It will also need https://gerrit.hyperledger.org/r/#/c/4049/1 to be merged to be fully BCCSP-converted</pre><strong>Commenter</strong>: Volodymyr Paprotski - vpaprots@ca.ibm.com<br><strong>CommentLine</strong>: [lib/tcert/tcert.go#L284](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/c0accdd2eb51117d84a89e7322499ae4fd888f4a/lib/tcert/tcert.go#L284)<br><strong>Comment</strong>: <pre>I think this might be bccsp HMAC key derivation from here https://github.com/hyperledger/fabric/blob/master/bccsp/sw/impl.go#L303

Example use: https://github.com/hyperledger/fabric/blob/master/bccsp/sw/impl_test.go#L1085

Further down in that test, there is also an example on CBCPKCS7Encrypt()</pre><strong>Commenter</strong>: Volodymyr Paprotski - vpaprots@ca.ibm.com<br><strong>CommentLine</strong>: [lib/tcert/util.go#L367](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/c0accdd2eb51117d84a89e7322499ae4fd888f4a/lib/tcert/util.go#L367)<br><strong>Comment</strong>: <pre>This looks like a useful switch-statement.. perhaps should had been offered by BCCSP.. Still, split it out to a separate function for now?

i.e case "SHA2_256": return &bccsp.SHA256Opts{}
     case "SHA2_384": return &bccsp.SHA384Opts{}
     ... and so on..

That way your code is much slimmer:

     digest, digestError = tm.bccsp.Hash(message, getHashOptsFromName(hashAlgo))

Havent found such a helper function in bccsp implementation.. would had been a good idea. if you move it out, will propose to Angelo.</pre><strong>Commenter</strong>: Ashutosh Kumar - ashutosh_kumar@hotmail.com<br><strong>CommentLine</strong>: [lib/tcert/util.go#L367](https://github.com/hyperledger-gerrit-archive/fabric-cop/blob/c0accdd2eb51117d84a89e7322499ae4fd888f4a/lib/tcert/util.go#L367)<br><strong>Comment</strong>: <pre>sounds good to me. I can move it out.</pre></blockquote>