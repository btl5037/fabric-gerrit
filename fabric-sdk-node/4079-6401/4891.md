<strong>Project</strong>: fabric-sdk-node<br><strong>Branch</strong>: master<br><strong>ID</strong>: 4891<br><strong>Subject</strong>: [FAB-1877] NodeSDK - Enhance chain with simple events<br><strong>Status</strong>: ABANDONED<br><strong>Owner</strong>: Bret Harrison - beharrison@nc.rr.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 1/26/2017, 6:11:08 PM<br><strong>LastUpdated</strong>: 5/28/2019, 1:03:15 PM<br><strong>CommitMessage</strong>:<br><pre>[FAB-1877] NodeSDK - Enhance chain with simple events

Add single method to Chain object to setup the creator
filtered transaction events. Enhance the EventHub to
handle this new block based event. Update end-to-end
test to allow both complex and user defined transaction
id filtered events and the single callback creator filtered
events to run together.

Change-Id: I7ae036273c007ab218dacb40a3bc10e8b5b76c6e
Signed-off-by: Bret Harrison <beharrison@nc.rr.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Bret Harrison - beharrison@nc.rr.com<br><strong>Reviewed</strong>: 1/26/2017, 6:11:08 PM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/26/2017, 6:12:02 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-sdk-node-verify-x86_64/343/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/26/2017, 6:15:05 PM<br><strong>Message</strong>: <pre>Patch Set 1: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-sdk-node-verify-x86_64/343/ : SUCCESS</pre><strong>Reviewer</strong>: Jim Zhang - jim_the_matrix@hotmail.com<br><strong>Reviewed</strong>: 1/26/2017, 11:16:14 PM<br><strong>Message</strong>: <pre>Patch Set 1: Code-Review-1

(11 comments)</pre><strong>Reviewer</strong>: Bret Harrison - beharrison@nc.rr.com<br><strong>Reviewed</strong>: 1/27/2017, 3:32:57 PM<br><strong>Message</strong>: <pre>Abandoned

Using 4721 to add in the EventHub to Chain</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Bret Harrison - beharrison@nc.rr.com<br><strong>Uploader</strong>: Bret Harrison - beharrison@nc.rr.com<br><strong>Created</strong>: 1/26/2017, 6:11:08 PM<br><strong>UnmergedRevision</strong>: [13500597fa0094c9428ff4481088afd051114dda](https://github.com/hyperledger-gerrit-archive/fabric-sdk-node/commit/13500597fa0094c9428ff4481088afd051114dda)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/26/2017, 6:15:05 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Jim Zhang - jim_the_matrix@hotmail.com<br><strong>Approved</strong>: 1/26/2017, 11:16:14 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Jim Zhang - jim_the_matrix@hotmail.com<br><strong>CommentLine</strong>: [hfc/lib/Chain.js#L1218](https://github.com/hyperledger-gerrit-archive/fabric-sdk-node/blob/13500597fa0094c9428ff4481088afd051114dda/hfc/lib/Chain.js#L1218)<br><strong>Comment</strong>: <pre>"Disconnect from all event source peers so no further events will be received. This method must be called if the application wants to gracefully exit. If not called then the underlying GRPC stream connections to the event sources will keep the node.js program from exiting".</pre><strong>Commenter</strong>: Jim Zhang - jim_the_matrix@hotmail.com<br><strong>CommentLine</strong>: [hfc/lib/Chain.js#L1225](https://github.com/hyperledger-gerrit-archive/fabric-sdk-node/blob/13500597fa0094c9428ff4481088afd051114dda/hfc/lib/Chain.js#L1225)<br><strong>Comment</strong>: <pre>shouldn't this disconnect all instances in this._event_hubs?</pre><strong>Commenter</strong>: Jim Zhang - jim_the_matrix@hotmail.com<br><strong>CommentLine</strong>: [hfc/lib/Chain.js#L1240](https://github.com/hyperledger-gerrit-archive/fabric-sdk-node/blob/13500597fa0094c9428ff4481088afd051114dda/hfc/lib/Chain.js#L1240)<br><strong>Comment</strong>: <pre>"This registers a transaction listener callback for all transactions that are submitted from this chain instance"</pre><strong>Commenter</strong>: Jim Zhang - jim_the_matrix@hotmail.com<br><strong>CommentLine</strong>: [hfc/lib/Chain.js#L1251](https://github.com/hyperledger-gerrit-archive/fabric-sdk-node/blob/13500597fa0094c9428ff4481088afd051114dda/hfc/lib/Chain.js#L1251)<br><strong>Comment</strong>: <pre>as we discussed it's better if the event hub instance is not made an instance property of the peer, but instead are kept separate from the peer instance. so here we should create a new instance of EventHub based on peers[i].getEventSourceUrl() and other data discovered on the peer (tls pem, etc).</pre><strong>Commenter</strong>: Jim Zhang - jim_the_matrix@hotmail.com<br><strong>CommentLine</strong>: [hfc/lib/EventHub.js#L100](https://github.com/hyperledger-gerrit-archive/fabric-sdk-node/blob/13500597fa0094c9428ff4481088afd051114dda/hfc/lib/EventHub.js#L100)<br><strong>Comment</strong>: <pre>this method is not necessary since the constructor already collects the required information to establish a connection with the event source</pre><strong>Commenter</strong>: Jim Zhang - jim_the_matrix@hotmail.com<br><strong>CommentLine</strong>: [hfc/lib/EventHub.js#L106](https://github.com/hyperledger-gerrit-archive/fabric-sdk-node/blob/13500597fa0094c9428ff4481088afd051114dda/hfc/lib/EventHub.js#L106)<br><strong>Comment</strong>: <pre>method naming convention is camel case, so it should be "isConnected()"</pre><strong>Commenter</strong>: Jim Zhang - jim_the_matrix@hotmail.com<br><strong>CommentLine</strong>: [hfc/lib/EventHub.js#L373](https://github.com/hyperledger-gerrit-archive/fabric-sdk-node/blob/13500597fa0094c9428ff4481088afd051114dda/hfc/lib/EventHub.js#L373)<br><strong>Comment</strong>: <pre>for internal methods, change to using only one * so this method doesn't appear in the generated API doc</pre><strong>Commenter</strong>: Jim Zhang - jim_the_matrix@hotmail.com<br><strong>CommentLine</strong>: [hfc/lib/EventHub.js#L395](https://github.com/hyperledger-gerrit-archive/fabric-sdk-node/blob/13500597fa0094c9428ff4481088afd051114dda/hfc/lib/EventHub.js#L395)<br><strong>Comment</strong>: <pre>for internal methods, change to using only one * so this method doesn't appear in the generated API doc</pre><strong>Commenter</strong>: Jim Zhang - jim_the_matrix@hotmail.com<br><strong>CommentLine</strong>: [hfc/lib/EventHub.js#L424](https://github.com/hyperledger-gerrit-archive/fabric-sdk-node/blob/13500597fa0094c9428ff4481088afd051114dda/hfc/lib/EventHub.js#L424)<br><strong>Comment</strong>: <pre>why this is needed for the callback parameter?</pre><strong>Commenter</strong>: Jim Zhang - jim_the_matrix@hotmail.com<br><strong>CommentLine</strong>: [hfc/lib/Peer.js#L61](https://github.com/hyperledger-gerrit-archive/fabric-sdk-node/blob/13500597fa0094c9428ff4481088afd051114dda/hfc/lib/Peer.js#L61)<br><strong>Comment</strong>: <pre>as far as events are concerned, peer should just be a place to capture metadata (event source url). don't see why we need the event hub instance of be instantiated here.</pre><strong>Commenter</strong>: Jim Zhang - jim_the_matrix@hotmail.com<br><strong>CommentLine</strong>: [hfc/lib/Peer.js#L146](https://github.com/hyperledger-gerrit-archive/fabric-sdk-node/blob/13500597fa0094c9428ff4481088afd051114dda/hfc/lib/Peer.js#L146)<br><strong>Comment</strong>: <pre>see comment above</pre></blockquote>