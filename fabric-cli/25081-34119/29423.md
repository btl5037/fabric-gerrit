<strong>Project</strong>: fabric-cli<br><strong>Branch</strong>: master<br><strong>ID</strong>: 29423<br><strong>Subject</strong>: [FAB-13945] Create profile management commands<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Brian Buchanan - bpbuch@gmail.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 2/20/2019, 3:07:36 PM<br><strong>LastUpdated</strong>: 2/26/2019, 11:56:22 AM<br><strong>CommitMessage</strong>:<br><pre>[FAB-13945] Create profile management commands

Implement profile management commands using a config yaml file in
the home directory.

Unit tests need to be refactored to match the patterns found in the
Fabric project in a future CR.

Change-Id: I6a849968b470165251dfc81bed37582650e880da
Signed-off-by: Brian Buchanan <bpbuch@gmail.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Brian Buchanan - bpbuch@gmail.com<br><strong>Reviewed</strong>: 2/20/2019, 3:07:36 PM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Brian Buchanan - bpbuch@gmail.com<br><strong>Reviewed</strong>: 2/20/2019, 3:18:20 PM<br><strong>Message</strong>: <pre>Uploaded patch set 2: Commit message was updated.</pre><strong>Reviewer</strong>: Arnaud J Le Hors - lehors@us.ibm.com<br><strong>Reviewed</strong>: 2/22/2019, 9:00:41 AM<br><strong>Message</strong>: <pre>Patch Set 2: Code-Review-1

(16 comments)

This is going in the right direction but the change in the way the env and defaults are handled leads to a plugin execution failure unless FABRIC_HOME is set in the user's env:
$ ./bin/fabric home
Error: fork/exec /plugins/home/bin/home: no such file or directory

$ FABRIC_HOME=~/.fabric ./bin/fabric home
/Users/lehors/.fabric</pre><strong>Reviewer</strong>: Brian Buchanan - bpbuch@gmail.com<br><strong>Reviewed</strong>: 2/22/2019, 1:50:38 PM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Brian Buchanan - bpbuch@gmail.com<br><strong>Reviewed</strong>: 2/22/2019, 1:51:58 PM<br><strong>Message</strong>: <pre>Patch Set 3:

> This is going in the right direction but the change in the way the
 > env and defaults are handled leads to a plugin execution failure
 > unless FABRIC_HOME is set in the user's env:
 > $ ./bin/fabric home
 > Error: fork/exec /plugins/home/bin/home: no such file or directory
 > 
 > $ FABRIC_HOME=~/.fabric ./bin/fabric home
 > /Users/lehors/.fabric

Nice catch. This was an oversight on my part.</pre><strong>Reviewer</strong>: Brian Buchanan - bpbuch@gmail.com<br><strong>Reviewed</strong>: 2/25/2019, 3:08:14 PM<br><strong>Message</strong>: <pre>Uploaded patch set 4.</pre><strong>Reviewer</strong>: Arnaud J Le Hors - lehors@us.ibm.com<br><strong>Reviewed</strong>: 2/25/2019, 8:24:56 PM<br><strong>Message</strong>: <pre>Patch Set 4:

(3 comments)

Almost there. :-)</pre><strong>Reviewer</strong>: Brian Buchanan - bpbuch@gmail.com<br><strong>Reviewed</strong>: 2/25/2019, 9:08:52 PM<br><strong>Message</strong>: <pre>Uploaded patch set 5.</pre><strong>Reviewer</strong>: Arnaud J Le Hors - lehors@us.ibm.com<br><strong>Reviewed</strong>: 2/26/2019, 9:58:57 AM<br><strong>Message</strong>: <pre>Patch Set 5: Code-Review+2

Thanks!</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 2/26/2019, 11:27:39 AM<br><strong>Message</strong>: <pre>Patch Set 5: Code-Review+2

(1 comment)

A suggestion about mocks for future, Brian... looks good otherwise.</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 2/26/2019, 11:28:29 AM<br><strong>Message</strong>: <pre>Patch Set 5: Verified+1</pre><strong>Reviewer</strong>: Arnaud J Le Hors - lehors@us.ibm.com<br><strong>Reviewed</strong>: 2/26/2019, 11:56:22 AM<br><strong>Message</strong>: <pre>Change has been successfully merged by Arnaud J Le Hors</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Brian Buchanan - bpbuch@gmail.com<br><strong>Uploader</strong>: Brian Buchanan - bpbuch@gmail.com<br><strong>Created</strong>: 2/20/2019, 3:07:36 PM<br><strong>UnmergedRevision</strong>: [bfdc04bec7deb6b401fe7ffa9d60cf01a04e5df8](https://github.com/hyperledger-gerrit-archive/fabric-cli/commit/bfdc04bec7deb6b401fe7ffa9d60cf01a04e5df8)<br><br></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: NO_CODE_CHANGE<br><strong>Author</strong>: Brian Buchanan - bpbuch@gmail.com<br><strong>Uploader</strong>: Brian Buchanan - bpbuch@gmail.com<br><strong>Created</strong>: 2/20/2019, 3:18:20 PM<br><strong>UnmergedRevision</strong>: [576fb57ce1fc4963e7d8b66873dba51ad3855ca3](https://github.com/hyperledger-gerrit-archive/fabric-cli/commit/576fb57ce1fc4963e7d8b66873dba51ad3855ca3)<br><br><strong>Approver</strong>: Arnaud J Le Hors - lehors@us.ibm.com<br><strong>Approved</strong>: 2/22/2019, 9:00:41 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Arnaud J Le Hors - lehors@us.ibm.com<br><strong>CommentLine</strong>: [cmd/commands/commands.go#L23](https://github.com/hyperledger-gerrit-archive/fabric-cli/blob/576fb57ce1fc4963e7d8b66873dba51ad3855ca3/cmd/commands/commands.go#L23)<br><strong>Comment</strong>: <pre>this is not the right comment</pre><strong>Commenter</strong>: Arnaud J Le Hors - lehors@us.ibm.com<br><strong>CommentLine</strong>: [cmd/commands/profile/create.go#L27](https://github.com/hyperledger-gerrit-archive/fabric-cli/blob/576fb57ce1fc4963e7d8b66873dba51ad3855ca3/cmd/commands/profile/create.go#L27)<br><strong>Comment</strong>: <pre>add: <profilename></pre><strong>Commenter</strong>: Arnaud J Le Hors - lehors@us.ibm.com<br><strong>CommentLine</strong>: [cmd/commands/profile/create.go#L80](https://github.com/hyperledger-gerrit-archive/fabric-cli/blob/576fb57ce1fc4963e7d8b66873dba51ad3855ca3/cmd/commands/profile/create.go#L80)<br><strong>Comment</strong>: <pre>I think it'd make sense to make the new profile active if there is no active profile, as it's the case with the first profile.</pre><strong>Commenter</strong>: Arnaud J Le Hors - lehors@us.ibm.com<br><strong>CommentLine</strong>: [cmd/commands/profile/profile.go#L25](https://github.com/hyperledger-gerrit-archive/fabric-cli/blob/576fb57ce1fc4963e7d8b66873dba51ad3855ca3/cmd/commands/profile/profile.go#L25)<br><strong>Comment</strong>: <pre>If the intent is for the profile to actually be deleted through this command I think it would be better to call it that: Delete.
Remove makes it sound like it is merely removed from the config but can still live elsewhere and possibly added back.</pre><strong>Commenter</strong>: Arnaud J Le Hors - lehors@us.ibm.com<br><strong>CommentLine</strong>: [cmd/commands/profile/profile.go#L26](https://github.com/hyperledger-gerrit-archive/fabric-cli/blob/576fb57ce1fc4963e7d8b66873dba51ad3855ca3/cmd/commands/profile/profile.go#L26)<br><strong>Comment</strong>: <pre>It would be good to have a list command as well.</pre><strong>Commenter</strong>: Arnaud J Le Hors - lehors@us.ibm.com<br><strong>CommentLine</strong>: [cmd/commands/profile/remove.go#L27](https://github.com/hyperledger-gerrit-archive/fabric-cli/blob/576fb57ce1fc4963e7d8b66873dba51ad3855ca3/cmd/commands/profile/remove.go#L27)<br><strong>Comment</strong>: <pre>add <profilename></pre><strong>Commenter</strong>: Arnaud J Le Hors - lehors@us.ibm.com<br><strong>CommentLine</strong>: [cmd/commands/profile/remove.go#L68](https://github.com/hyperledger-gerrit-archive/fabric-cli/blob/576fb57ce1fc4963e7d8b66873dba51ad3855ca3/cmd/commands/profile/remove.go#L68)<br><strong>Comment</strong>: <pre>Is there a strong reason for this? It does seem like a nice safeguard to have but then we would have to have a -f/--force option and I'm not sure this is really worth it.</pre><strong>Commenter</strong>: Arnaud J Le Hors - lehors@us.ibm.com<br><strong>CommentLine</strong>: [cmd/commands/profile/show.go#L28](https://github.com/hyperledger-gerrit-archive/fabric-cli/blob/576fb57ce1fc4963e7d8b66873dba51ad3855ca3/cmd/commands/profile/show.go#L28)<br><strong>Comment</strong>: <pre>I think it'd make sense to show the active profile by default but allow specifying a profile name to show as well.</pre><strong>Commenter</strong>: Arnaud J Le Hors - lehors@us.ibm.com<br><strong>CommentLine</strong>: [cmd/commands/profile/show.go#L45](https://github.com/hyperledger-gerrit-archive/fabric-cli/blob/576fb57ce1fc4963e7d8b66873dba51ad3855ca3/cmd/commands/profile/show.go#L45)<br><strong>Comment</strong>: <pre>As things stand I think this should rather read something like "no profile currently active"</pre><strong>Commenter</strong>: Arnaud J Le Hors - lehors@us.ibm.com<br><strong>CommentLine</strong>: [cmd/commands/profile/use.go#L26](https://github.com/hyperledger-gerrit-archive/fabric-cli/blob/576fb57ce1fc4963e7d8b66873dba51ad3855ca3/cmd/commands/profile/use.go#L26)<br><strong>Comment</strong>: <pre>add: <profilename></pre><strong>Commenter</strong>: Arnaud J Le Hors - lehors@us.ibm.com<br><strong>CommentLine</strong>: [cmd/fabric.go#L76](https://github.com/hyperledger-gerrit-archive/fabric-cli/blob/576fb57ce1fc4963e7d8b66873dba51ad3855ca3/cmd/fabric.go#L76)<br><strong>Comment</strong>: <pre>This relies on FABRIC_HOME having been set in the environment.</pre><strong>Commenter</strong>: Arnaud J Le Hors - lehors@us.ibm.com<br><strong>CommentLine</strong>: [pkg/environment/config.go#L26](https://github.com/hyperledger-gerrit-archive/fabric-cli/blob/576fb57ce1fc4963e7d8b66873dba51ad3855ca3/pkg/environment/config.go#L26)<br><strong>Comment</strong>: <pre>comment is incomplete</pre><strong>Commenter</strong>: Arnaud J Le Hors - lehors@us.ibm.com<br><strong>CommentLine</strong>: [pkg/environment/config_test.go#L17](https://github.com/hyperledger-gerrit-archive/fabric-cli/blob/576fb57ce1fc4963e7d8b66873dba51ad3855ca3/pkg/environment/config_test.go#L17)<br><strong>Comment</strong>: <pre>Please, can we use os.TempDir() or ioutil.TempDir() instead?</pre><strong>Commenter</strong>: Arnaud J Le Hors - lehors@us.ibm.com<br><strong>CommentLine</strong>: [pkg/environment/config_test.go#L40](https://github.com/hyperledger-gerrit-archive/fabric-cli/blob/576fb57ce1fc4963e7d8b66873dba51ad3855ca3/pkg/environment/config_test.go#L40)<br><strong>Comment</strong>: <pre>to be changed accordingly</pre><strong>Commenter</strong>: Arnaud J Le Hors - lehors@us.ibm.com<br><strong>CommentLine</strong>: [pkg/environment/environment.go#L43](https://github.com/hyperledger-gerrit-archive/fabric-cli/blob/576fb57ce1fc4963e7d8b66873dba51ad3855ca3/pkg/environment/environment.go#L43)<br><strong>Comment</strong>: <pre>From what I understand this is still required because the execution of a plugin command depends on it to set the correct command path. See related comment in fabric.go</pre><strong>Commenter</strong>: Arnaud J Le Hors - lehors@us.ibm.com<br><strong>CommentLine</strong>: [pkg/environment/mocks/config.go#L21](https://github.com/hyperledger-gerrit-archive/fabric-cli/blob/576fb57ce1fc4963e7d8b66873dba51ad3855ca3/pkg/environment/mocks/config.go#L21)<br><strong>Comment</strong>: <pre>returns</pre></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Brian Buchanan - bpbuch@gmail.com<br><strong>Uploader</strong>: Brian Buchanan - bpbuch@gmail.com<br><strong>Created</strong>: 2/22/2019, 1:50:38 PM<br><strong>UnmergedRevision</strong>: [c58ff6d75433a9c8e2395be8f6ee2eccf11752f7](https://github.com/hyperledger-gerrit-archive/fabric-cli/commit/c58ff6d75433a9c8e2395be8f6ee2eccf11752f7)<br><br></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Brian Buchanan - bpbuch@gmail.com<br><strong>Uploader</strong>: Brian Buchanan - bpbuch@gmail.com<br><strong>Created</strong>: 2/25/2019, 3:08:14 PM<br><strong>UnmergedRevision</strong>: [0ec7a1a16753389915e6030f32ae81d14ee96929](https://github.com/hyperledger-gerrit-archive/fabric-cli/commit/0ec7a1a16753389915e6030f32ae81d14ee96929)<br><br></blockquote><h3>PatchSet Number: 5</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Brian Buchanan - bpbuch@gmail.com<br><strong>Uploader</strong>: Brian Buchanan - bpbuch@gmail.com<br><strong>Created</strong>: 2/25/2019, 9:08:52 PM<br><strong>GitHubMergedRevision</strong>: [5138233a17de6df6b18bfd71baf0aa150de316f3](https://github.com/hyperledger-gerrit-archive/fabric-cli/commit/5138233a17de6df6b18bfd71baf0aa150de316f3)<br><br><strong>Approver</strong>: Arnaud J Le Hors - lehors@us.ibm.com<br><strong>Approved</strong>: 2/26/2019, 9:58:57 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Arnaud J Le Hors<br><strong>Merged</strong>: 2/26/2019, 11:56:22 AM<br><br><strong>Approver</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Approved</strong>: 2/26/2019, 11:27:39 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Approved</strong>: 2/26/2019, 11:28:29 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>CommentLine</strong>: [pkg/environment/mocks/config.go#L8](https://github.com/hyperledger-gerrit-archive/fabric-cli/blob/5138233a17de6df6b18bfd71baf0aa150de316f3/pkg/environment/mocks/config.go#L8)<br><strong>Comment</strong>: <pre>Perhaps consider using "counterfeiter" instead of handcoding mocks (the UT revision you mentioned in Description feels a perfect time for the consideration)</pre></blockquote>