<strong>Project</strong>: fabric-sdk-java<br><strong>Branch</strong>: master<br><strong>ID</strong>: 5743<br><strong>Subject</strong>: FAB-1403 V1.0 Support protobuf asyc sending<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Nikita Gorbachevski - choojoyq@gmail.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 2/8/2017, 3:43:39 PM<br><strong>LastUpdated</strong>: 2/13/2017, 8:14:26 PM<br><strong>CommitMessage</strong>:<br><pre>FAB-1403 V1.0 Support protobuf asyc sending

Added async method for sending proposal to EndorserClient
and Peer.

Sending proposal request to all peers(endorsers) in parallel with
given time out.

Change-Id: Ieec0e54ff2f07a9ffb300163c10b2444cb9d7844
Signed-off-by: choojoyq <choojoyq@gmail.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Nikita Gorbachevski - choojoyq@gmail.com<br><strong>Reviewed</strong>: 2/8/2017, 3:43:39 PM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/8/2017, 3:44:42 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-sdk-java-verify-x86_64/76/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/8/2017, 3:46:10 PM<br><strong>Message</strong>: <pre>Patch Set 1: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-sdk-java-verify-x86_64/76/ : SUCCESS</pre><strong>Reviewer</strong>: Nikita Gorbachevski - choojoyq@gmail.com<br><strong>Reviewed</strong>: 2/8/2017, 5:27:42 PM<br><strong>Message</strong>: <pre>Uploaded patch set 2.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/8/2017, 5:28:44 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-sdk-java-verify-x86_64/77/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/8/2017, 5:30:23 PM<br><strong>Message</strong>: <pre>Patch Set 2: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-sdk-java-verify-x86_64/77/ : SUCCESS</pre><strong>Reviewer</strong>: Muhammad Altaf - muhammada@fast.au.fujitsu.com<br><strong>Reviewed</strong>: 2/8/2017, 10:29:34 PM<br><strong>Message</strong>: <pre>Patch Set 2:

(5 comments)</pre><strong>Reviewer</strong>: Rick Rine - cr22rc@gmail.com<br><strong>Reviewed</strong>: 2/9/2017, 8:21:43 AM<br><strong>Message</strong>: <pre>Patch Set 2: Code-Review-1

From just reading this looks to be a fail fast. 
I want to the end user to see all the results Let the user decide if they have sufficient endorsements which they want to proceed even if some where outright communication failures (endorser  not running. )</pre><strong>Reviewer</strong>: Rick Rine - cr22rc@gmail.com<br><strong>Reviewed</strong>: 2/9/2017, 9:08:46 AM<br><strong>Message</strong>: <pre>Patch Set 2:

(7 comments)</pre><strong>Reviewer</strong>: Nikita Gorbachevski - choojoyq@gmail.com<br><strong>Reviewed</strong>: 2/9/2017, 10:21:48 AM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/9/2017, 10:22:37 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-sdk-java-verify-x86_64/78/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/9/2017, 10:24:11 AM<br><strong>Message</strong>: <pre>Patch Set 3: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-sdk-java-verify-x86_64/78/ : SUCCESS</pre><strong>Reviewer</strong>: Nikita Gorbachevski - choojoyq@gmail.com<br><strong>Reviewed</strong>: 2/9/2017, 10:27:00 AM<br><strong>Message</strong>: <pre>Uploaded patch set 4.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/9/2017, 10:27:55 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-sdk-java-verify-x86_64/79/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/9/2017, 10:29:27 AM<br><strong>Message</strong>: <pre>Patch Set 4: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-sdk-java-verify-x86_64/79/ : SUCCESS</pre><strong>Reviewer</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>Reviewed</strong>: 2/9/2017, 4:23:23 PM<br><strong>Message</strong>: <pre>Patch Set 4: Code-Review-1

(7 comments)</pre><strong>Reviewer</strong>: Rick Rine - cr22rc@gmail.com<br><strong>Reviewed</strong>: 2/9/2017, 5:09:04 PM<br><strong>Message</strong>: <pre>Patch Set 4: Code-Review-1

(4 comments)</pre><strong>Reviewer</strong>: Muhammad Altaf - muhammada@fast.au.fujitsu.com<br><strong>Reviewed</strong>: 2/9/2017, 7:17:05 PM<br><strong>Message</strong>: <pre>Patch Set 4: Code-Review-1

(3 comments)</pre><strong>Reviewer</strong>: Nikita Gorbachevski - choojoyq@gmail.com<br><strong>Reviewed</strong>: 2/10/2017, 7:53:31 AM<br><strong>Message</strong>: <pre>Uploaded patch set 5.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/10/2017, 7:54:42 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-sdk-java-verify-x86_64/80/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/10/2017, 7:56:29 AM<br><strong>Message</strong>: <pre>Patch Set 5: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-sdk-java-verify-x86_64/80/ : SUCCESS</pre><strong>Reviewer</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>Reviewed</strong>: 2/10/2017, 8:45:48 AM<br><strong>Message</strong>: <pre>Patch Set 5: Code-Review+1

(1 comment)

Could you create a JIRA issue for https://gerrit.hyperledger.org/r/#/c/5743/4/src/main/java/org/hyperledger/fabric/sdk/Chain.java@599  ?

Otherwise LGTM</pre><strong>Reviewer</strong>: Nikita Gorbachevski - choojoyq@gmail.com<br><strong>Reviewed</strong>: 2/10/2017, 9:11:03 AM<br><strong>Message</strong>: <pre>Uploaded patch set 6.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/10/2017, 9:12:03 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-sdk-java-verify-x86_64/81/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/10/2017, 9:13:34 AM<br><strong>Message</strong>: <pre>Patch Set 6: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-sdk-java-verify-x86_64/81/ : SUCCESS</pre><strong>Reviewer</strong>: Rick Rine - cr22rc@gmail.com<br><strong>Reviewed</strong>: 2/10/2017, 9:19:14 AM<br><strong>Message</strong>: <pre>Patch Set 6: Code-Review-2

(2 comments)</pre><strong>Reviewer</strong>: Rick Rine - cr22rc@gmail.com<br><strong>Reviewed</strong>: 2/10/2017, 10:10:45 AM<br><strong>Message</strong>: <pre>Patch Set 4:

(1 comment)</pre><strong>Reviewer</strong>: Nikita Gorbachevski - choojoyq@gmail.com<br><strong>Reviewed</strong>: 2/10/2017, 10:18:29 AM<br><strong>Message</strong>: <pre>Uploaded patch set 7.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/10/2017, 10:19:25 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-sdk-java-verify-x86_64/82/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/10/2017, 10:20:51 AM<br><strong>Message</strong>: <pre>Patch Set 7: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-sdk-java-verify-x86_64/82/ : SUCCESS</pre><strong>Reviewer</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>Reviewed</strong>: 2/10/2017, 11:54:10 AM<br><strong>Message</strong>: <pre>Patch Set 7: Code-Review+1</pre><strong>Reviewer</strong>: Rick Rine - cr22rc@gmail.com<br><strong>Reviewed</strong>: 2/13/2017, 11:01:03 AM<br><strong>Message</strong>: <pre>Patch Set 4:

(1 comment)</pre><strong>Reviewer</strong>: Nikita Gorbachevski - choojoyq@gmail.com<br><strong>Reviewed</strong>: 2/13/2017, 12:22:32 PM<br><strong>Message</strong>: <pre>Uploaded patch set 8.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/13/2017, 12:23:41 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-sdk-java-verify-x86_64/85/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/13/2017, 12:25:32 PM<br><strong>Message</strong>: <pre>Patch Set 8: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-sdk-java-verify-x86_64/85/ : SUCCESS</pre><strong>Reviewer</strong>: Muhammad Altaf - muhammada@fast.au.fujitsu.com<br><strong>Reviewed</strong>: 2/13/2017, 6:39:49 PM<br><strong>Message</strong>: <pre>Patch Set 8:

(1 comment)</pre><strong>Reviewer</strong>: Rick Rine - cr22rc@gmail.com<br><strong>Reviewed</strong>: 2/13/2017, 8:14:23 PM<br><strong>Message</strong>: <pre>Patch Set 8: Code-Review+2</pre><strong>Reviewer</strong>: Gerrit Code Review - gerrit@hyperledger.org<br><strong>Reviewed</strong>: 2/13/2017, 8:14:26 PM<br><strong>Message</strong>: <pre>Change has been successfully merged by Rick Rine</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Nikita Gorbachevski - choojoyq@gmail.com<br><strong>Uploader</strong>: Nikita Gorbachevski - choojoyq@gmail.com<br><strong>Created</strong>: 2/8/2017, 3:43:39 PM<br><strong>UnmergedRevision</strong>: [3868709c9ab7b16fd0c16cd31aa1004104344c0e](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/commit/3868709c9ab7b16fd0c16cd31aa1004104344c0e)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/8/2017, 3:46:10 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Nikita Gorbachevski - choojoyq@gmail.com<br><strong>Uploader</strong>: Nikita Gorbachevski - choojoyq@gmail.com<br><strong>Created</strong>: 2/8/2017, 5:27:42 PM<br><strong>UnmergedRevision</strong>: [26c0a5ae1409f7ad939de8b504b1d2e834d0ca28](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/commit/26c0a5ae1409f7ad939de8b504b1d2e834d0ca28)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/8/2017, 5:30:23 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Rick Rine - cr22rc@gmail.com<br><strong>Approved</strong>: 2/9/2017, 8:21:43 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Muhammad Altaf - muhammada@fast.au.fujitsu.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/Chain.java#L129](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/26c0a5ae1409f7ad939de8b504b1d2e834d0ca28/src/main/java/org/hyperledger/fabric/sdk/Chain.java#L129)<br><strong>Comment</strong>: <pre>Can we simplify it to something like proposalWaitTime?</pre><strong>Commenter</strong>: Rick Rine - cr22rc@gmail.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/Chain.java#L129](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/26c0a5ae1409f7ad939de8b504b1d2e834d0ca28/src/main/java/org/hyperledger/fabric/sdk/Chain.java#L129)<br><strong>Comment</strong>: <pre>Add to TransactionRequest a method for waitTime I'd prefer this to be milliseconds.  Use Config to set the default</pre><strong>Commenter</strong>: Muhammad Altaf - muhammada@fast.au.fujitsu.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/Chain.java#L384](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/26c0a5ae1409f7ad939de8b504b1d2e834d0ca28/src/main/java/org/hyperledger/fabric/sdk/Chain.java#L384)<br><strong>Comment</strong>: <pre>Can we simplify it to something like getProposalWaitTime?</pre><strong>Commenter</strong>: Muhammad Altaf - muhammada@fast.au.fujitsu.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/Chain.java#L388](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/26c0a5ae1409f7ad939de8b504b1d2e834d0ca28/src/main/java/org/hyperledger/fabric/sdk/Chain.java#L388)<br><strong>Comment</strong>: <pre>Can we simplify it to something like setProposalWaitTime?</pre><strong>Commenter</strong>: Muhammad Altaf - muhammada@fast.au.fujitsu.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/Chain.java#L718](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/26c0a5ae1409f7ad939de8b504b1d2e834d0ca28/src/main/java/org/hyperledger/fabric/sdk/Chain.java#L718)<br><strong>Comment</strong>: <pre>Chain already has list of peers accessible from this method, why do we need the peers in arguments to this function?</pre><strong>Commenter</strong>: Rick Rine - cr22rc@gmail.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/Chain.java#L718](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/26c0a5ae1409f7ad939de8b504b1d2e834d0ca28/src/main/java/org/hyperledger/fabric/sdk/Chain.java#L718)<br><strong>Comment</strong>: <pre>I don't think we can say the user ALWAYS wants to send the proposal to ALL peers in the chain. They may know they don't want the endorsement of a particular organization for this proposal. They should have this option.</pre><strong>Commenter</strong>: Rick Rine - cr22rc@gmail.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/Chain.java#L723](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/26c0a5ae1409f7ad939de8b504b1d2e834d0ca28/src/main/java/org/hyperledger/fabric/sdk/Chain.java#L723)<br><strong>Comment</strong>: <pre>future var not needed just put in add(peer.send..)</pre><strong>Commenter</strong>: Rick Rine - cr22rc@gmail.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/Chain.java#L734](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/26c0a5ae1409f7ad939de8b504b1d2e834d0ca28/src/main/java/org/hyperledger/fabric/sdk/Chain.java#L734)<br><strong>Comment</strong>: <pre>Include the time that was set to wait to give some feedback</pre><strong>Commenter</strong>: Rick Rine - cr22rc@gmail.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/Peer.java#L131](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/26c0a5ae1409f7ad939de8b504b1d2e834d0ca28/src/main/java/org/hyperledger/fabric/sdk/Peer.java#L131)<br><strong>Comment</strong>: <pre>minor could be static</pre><strong>Commenter</strong>: Rick Rine - cr22rc@gmail.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/helper/ConcurrencyUtil.java#L11](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/26c0a5ae1409f7ad939de8b504b1d2e834d0ca28/src/main/java/org/hyperledger/fabric/sdk/helper/ConcurrencyUtil.java#L11)<br><strong>Comment</strong>: <pre>I'm not sure we're going to need this anywhere else but in Chain.java I'm leaning with preferring this to be a static class in Chain.java if that's the only use place. Move it out if and when we need it elsewhere</pre><strong>Commenter</strong>: Rick Rine - cr22rc@gmail.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/helper/ConcurrencyUtil.java#L20](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/26c0a5ae1409f7ad939de8b504b1d2e834d0ca28/src/main/java/org/hyperledger/fabric/sdk/helper/ConcurrencyUtil.java#L20)<br><strong>Comment</strong>: <pre>I don't think we want fail fast</pre><strong>Commenter</strong>: Muhammad Altaf - muhammada@fast.au.fujitsu.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/helper/ConcurrencyUtil.java#L43](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/26c0a5ae1409f7ad939de8b504b1d2e834d0ca28/src/main/java/org/hyperledger/fabric/sdk/helper/ConcurrencyUtil.java#L43)<br><strong>Comment</strong>: <pre>What happens when the timeOutInNanos becomes 0 or negative? Do we have test case for that?</pre></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Nikita Gorbachevski - choojoyq@gmail.com<br><strong>Uploader</strong>: Nikita Gorbachevski - choojoyq@gmail.com<br><strong>Created</strong>: 2/9/2017, 10:21:48 AM<br><strong>UnmergedRevision</strong>: [615b297ebf5bf0e3ee89bf3f72fd8e844264562f](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/commit/615b297ebf5bf0e3ee89bf3f72fd8e844264562f)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/9/2017, 10:24:11 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Nikita Gorbachevski - choojoyq@gmail.com<br><strong>Uploader</strong>: Nikita Gorbachevski - choojoyq@gmail.com<br><strong>Created</strong>: 2/9/2017, 10:27:00 AM<br><strong>UnmergedRevision</strong>: [4165d83036dfe20d59f6371063471365a33511dd](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/commit/4165d83036dfe20d59f6371063471365a33511dd)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/9/2017, 10:29:27 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>Approved</strong>: 2/9/2017, 4:23:23 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Muhammad Altaf - muhammada@fast.au.fujitsu.com<br><strong>Approved</strong>: 2/9/2017, 7:17:05 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Rick Rine - cr22rc@gmail.com<br><strong>Approved</strong>: 2/9/2017, 5:09:04 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>CommentLine</strong>: [config.properties#L9](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/4165d83036dfe20d59f6371063471365a33511dd/config.properties#L9)<br><strong>Comment</strong>: <pre>need to document unit of measure.

Other fabric components do this by putting the description in a comment right before the property in the config file.</pre><strong>Commenter</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/Chain.java#L599](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/4165d83036dfe20d59f6371063471365a33511dd/src/main/java/org/hyperledger/fabric/sdk/Chain.java#L599)<br><strong>Comment</strong>: <pre>Could you verify that the chain's list of peers is always the same as the chain's list of endorsers ?</pre><strong>Commenter</strong>: Rick Rine - cr22rc@gmail.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/Chain.java#L599](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/4165d83036dfe20d59f6371063471365a33511dd/src/main/java/org/hyperledger/fabric/sdk/Chain.java#L599)<br><strong>Comment</strong>: <pre>No the user should be able to select a subset of endorers</pre><strong>Commenter</strong>: Muhammad Altaf - muhammada@fast.au.fujitsu.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/Chain.java#L599](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/4165d83036dfe20d59f6371063471365a33511dd/src/main/java/org/hyperledger/fabric/sdk/Chain.java#L599)<br><strong>Comment</strong>: <pre>Since we didn't add this parameter in this change, I am happy for this patch to go with it. However, I would like to revisit this design at some point when this patch has been merged. My take is that, the list of peers user adds to the chain object in SDK does not have to be all the peers in the chain. They can only add two peers and send them the proposal. Otherwise, what is the point of addPeer() method other than if user wants to initialize a new chain, in which case we can parameterize that method as well by sending a list of peers to the initialize.</pre><strong>Commenter</strong>: Rick Rine - cr22rc@gmail.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/Chain.java#L599](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/4165d83036dfe20d59f6371063471365a33511dd/src/main/java/org/hyperledger/fabric/sdk/Chain.java#L599)<br><strong>Comment</strong>: <pre>We may want all the Peers in the Chain to be the default. But we need to allow them the option to override. There are other changes coming and this is not part of the work item for this change set.</pre><strong>Commenter</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/Chain.java#L610](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/4165d83036dfe20d59f6371063471365a33511dd/src/main/java/org/hyperledger/fabric/sdk/Chain.java#L610)<br><strong>Comment</strong>: <pre>is this the only use of the Collection<Peer> input argument ? Not sure why we need to pass this in if the Chain already has the list</pre><strong>Commenter</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/Chain.java#L720](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/4165d83036dfe20d59f6371063471365a33511dd/src/main/java/org/hyperledger/fabric/sdk/Chain.java#L720)<br><strong>Comment</strong>: <pre>is transactioRequest passed in so that we can get the wait timeout value ? If so,  it would be less confusing to just pass in the value itself</pre><strong>Commenter</strong>: Rick Rine - cr22rc@gmail.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/Chain.java#L720](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/4165d83036dfe20d59f6371063471365a33511dd/src/main/java/org/hyperledger/fabric/sdk/Chain.java#L720)<br><strong>Comment</strong>: <pre>Remove putting in TransactionRequest put the timeout in the TransactionContext</pre><strong>Commenter</strong>: Muhammad Altaf - muhammada@fast.au.fujitsu.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/Chain.java#L765](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/4165d83036dfe20d59f6371063471365a33511dd/src/main/java/org/hyperledger/fabric/sdk/Chain.java#L765)<br><strong>Comment</strong>: <pre>1. is this a random peer? Why we need it? If we do, probably we should have all peers in proposalResponses

2. peersIterator is defined in the beginning of the function, and not used until this point. Please move the definition close to the block where we are using it

3. Please make sure to check hasNext() before calling next()

3. If you just need one peer, why do you need an iterator? Why can't we simply pick the first peer from the list?</pre><strong>Commenter</strong>: Rick Rine - cr22rc@gmail.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/Chain.java#L765](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/4165d83036dfe20d59f6371063471365a33511dd/src/main/java/org/hyperledger/fabric/sdk/Chain.java#L765)<br><strong>Comment</strong>: <pre>Please comment to this.  I think it's ok because the furtures are in an arraylist that match with peers so it's iterating in the same order.  Maybe a safer what would have had futures be an arrayList of futures and peers object.  Then iterate over it. 


private Collection<ProposalResponse> sendProposalToPeers(Collection<Peer> peers,
                                                             FabricProposal.SignedProposal signedProposal,
                                                             TransactionContext transactionContext) throws Exception {

        class Pair{
            Peer peer;
            Future<FabricProposalResponse.ProposalResponse> future;


            public Pair(Peer peer, Future<FabricProposalResponse.ProposalResponse> future) {
                this.peer = peer;
                this.future = future;
            }
        }
        List<Pair> futuresPairs = new ArrayList<>();
        for (Peer peer : peers) {
            futuresPairs.add(new Pair (peer, peer.sendProposalAsync(signedProposal)));
        }


        Collection<ProposalResponse> proposalResponses = new ArrayList<>();
      //  Iterator<Peer> peersIterator = peers.iterator();
        for (Pair pair : futuresPairs) {
            FabricProposalResponse.ProposalResponse fabricResponse = null;
            String message;
            int status;
            try {
                fabricResponse = pair.future.get(transactionContext.getProposalWaitTime(), TimeUnit.MILLISECONDS);
                message = fabricResponse.getResponse().getMessage();
                status = fabricResponse.getResponse().getStatus();
            } catch (InterruptedException e) {
                message = "Sending proposal to peer failed because of interruption";
                status = 500;
                logger.error(message, e);
            } catch (TimeoutException e) {
                message = String.format("Sending proposal to peer failed because of timeout(%d milliseconds) expiration",
                        transactionContext.getProposalWaitTime());
                status = 500;
                logger.error(message, e);
            } catch (ExecutionException e) {
                Throwable cause = e.getCause();
                if (cause instanceof Error) {
                    throw (Error) cause;
                } else {
                    if (cause instanceof StatusRuntimeException) {
                        message = String.format("Sending proposal to peer failed because of gRPC failure=%s",
                                ((StatusRuntimeException) cause).getStatus());
                    } else {
                        message = String.format("Sending proposal to peer failed because of %s", cause.getMessage());
                    }
                    status = 500;
                    logger.error(message, cause);
                }
            }

            ProposalResponse proposalResponse = new ProposalResponse(transactionContext.getTxID(),
                    transactionContext.getChainID(), status, message);
            proposalResponse.setProposalResponse(fabricResponse);
            proposalResponse.setProposal(signedProposal);
            proposalResponse.setPeer(pair.peer);

            if (fabricResponse != null) {
                proposalResponse.verify(cryptoPrimitives);
            }

            proposalResponses.add(proposalResponse);
        }

        return proposalResponses;
    }</pre><strong>Commenter</strong>: Muhammad Altaf - muhammada@fast.au.fujitsu.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/Chain.java#L765](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/4165d83036dfe20d59f6371063471365a33511dd/src/main/java/org/hyperledger/fabric/sdk/Chain.java#L765)<br><strong>Comment</strong>: <pre>Hi Rick,
 My comment is not related to which peer you should use, it is more like how should you get it. The iterator.next() should never be used without checking hasNext() even if in current scenario you know it has not been moved yet. If someone adds another call to next() at some point, the next call will fail if there was only one peer in the collection.
Secondly, since the only use of this iterator seems to be to get the first peer, I don't see a reason strong enough to create an iterator; you can simply get the first item from the collection.

Also it is better to use List or Map when required instead of general Collection, because then you know exactly what methods are available on the collection.</pre><strong>Commenter</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/Chain.java#L769](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/4165d83036dfe20d59f6371063471365a33511dd/src/main/java/org/hyperledger/fabric/sdk/Chain.java#L769)<br><strong>Comment</strong>: <pre>Should the creation and verification of ProposalResponse be done in Peer.sendProposal() rather than here ?</pre><strong>Commenter</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/Peer.java#L113](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/4165d83036dfe20d59f6371063471365a33511dd/src/main/java/org/hyperledger/fabric/sdk/Peer.java#L113)<br><strong>Comment</strong>: <pre>I think ProposalRequest is a synchronous operation to the endorser ?

The concurrency should be at the chain level where you're sending to each endorser on a separate thread</pre><strong>Commenter</strong>: Rick Rine - cr22rc@gmail.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/Peer.java#L113](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/4165d83036dfe20d59f6371063471365a33511dd/src/main/java/org/hyperledger/fabric/sdk/Peer.java#L113)<br><strong>Comment</strong>: <pre>Send async on with protobufs</pre><strong>Commenter</strong>: Muhammad Altaf - muhammada@fast.au.fujitsu.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/ProposalResponse.java#L102](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/4165d83036dfe20d59f6371063471365a33511dd/src/main/java/org/hyperledger/fabric/sdk/ProposalResponse.java#L102)<br><strong>Comment</strong>: <pre>if we have proposalResponse that contains endorsements and we are storing the response, why we need to store endorsements separately? use proposalResponse.getEndorsement() whenever needed instead of this.endorsement</pre><strong>Commenter</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/TransactionRequest.java#L47](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/4165d83036dfe20d59f6371063471365a33511dd/src/main/java/org/hyperledger/fabric/sdk/TransactionRequest.java#L47)<br><strong>Comment</strong>: <pre>I think it's too granular to set timeout per transaction. Might be better to set it per chain</pre><strong>Commenter</strong>: Rick Rine - cr22rc@gmail.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/TransactionRequest.java#L47](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/4165d83036dfe20d59f6371063471365a33511dd/src/main/java/org/hyperledger/fabric/sdk/TransactionRequest.java#L47)<br><strong>Comment</strong>: <pre>You can with  setProposalWaitTime</pre></blockquote><h3>PatchSet Number: 5</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Nikita Gorbachevski - choojoyq@gmail.com<br><strong>Uploader</strong>: Nikita Gorbachevski - choojoyq@gmail.com<br><strong>Created</strong>: 2/10/2017, 7:53:31 AM<br><strong>UnmergedRevision</strong>: [1a63c3c975df702f1d0d79944f8d5a21a969d689](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/commit/1a63c3c975df702f1d0d79944f8d5a21a969d689)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/10/2017, 7:56:29 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>Approved</strong>: 2/10/2017, 8:45:48 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/ProposalResponse.java#L57](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/1a63c3c975df702f1d0d79944f8d5a21a969d689/src/main/java/org/hyperledger/fabric/sdk/ProposalResponse.java#L57)<br><strong>Comment</strong>: <pre>TODO no longer needed. Chain of trust checked in CryptoPrimitives.verify()</pre></blockquote><h3>PatchSet Number: 6</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Nikita Gorbachevski - choojoyq@gmail.com<br><strong>Uploader</strong>: Nikita Gorbachevski - choojoyq@gmail.com<br><strong>Created</strong>: 2/10/2017, 9:11:03 AM<br><strong>UnmergedRevision</strong>: [49da6e4caf551f44c897966cccaca1b4d8cfb98f](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/commit/49da6e4caf551f44c897966cccaca1b4d8cfb98f)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/10/2017, 9:13:34 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Rick Rine - cr22rc@gmail.com<br><strong>Approved</strong>: 2/10/2017, 9:19:14 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Rick Rine - cr22rc@gmail.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/Chain.java#L419](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/49da6e4caf551f44c897966cccaca1b4d8cfb98f/src/main/java/org/hyperledger/fabric/sdk/Chain.java#L419)<br><strong>Comment</strong>: <pre>Allow users to override on transaction basis.  Chain has nothing to do with time it would take handle a transaction.</pre><strong>Commenter</strong>: Rick Rine - cr22rc@gmail.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/Chain.java#L622](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/49da6e4caf551f44c897966cccaca1b4d8cfb98f/src/main/java/org/hyperledger/fabric/sdk/Chain.java#L622)<br><strong>Comment</strong>: <pre>Set back to this previous behavior.</pre></blockquote><h3>PatchSet Number: 7</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Nikita Gorbachevski - choojoyq@gmail.com<br><strong>Uploader</strong>: Nikita Gorbachevski - choojoyq@gmail.com<br><strong>Created</strong>: 2/10/2017, 10:18:29 AM<br><strong>UnmergedRevision</strong>: [15826cfae41be597d662e5fbaa292eedbd93d897](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/commit/15826cfae41be597d662e5fbaa292eedbd93d897)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/10/2017, 10:20:51 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>Approved</strong>: 2/10/2017, 11:54:10 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Rick Rine - cr22rc@gmail.com<br><strong>Approved</strong>: 2/10/2017, 9:19:14 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 8</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Nikita Gorbachevski - choojoyq@gmail.com<br><strong>Uploader</strong>: Nikita Gorbachevski - choojoyq@gmail.com<br><strong>Created</strong>: 2/13/2017, 12:22:32 PM<br><strong>GitHubMergedRevision</strong>: [ab467c7ba00216d04dca025a7be37f415655a17f](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/commit/ab467c7ba00216d04dca025a7be37f415655a17f)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/13/2017, 12:25:32 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Rick Rine - cr22rc@gmail.com<br><strong>Approved</strong>: 2/13/2017, 8:14:23 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Rick Rine<br><strong>Merged</strong>: 2/13/2017, 8:14:26 PM<br><br></blockquote>