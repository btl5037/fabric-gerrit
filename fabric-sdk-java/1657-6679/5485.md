<strong>Project</strong>: fabric-sdk-java<br><strong>Branch</strong>: master<br><strong>ID</strong>: 5485<br><strong>Subject</strong>: [FAB-1826]  Verify peer cert chain of trust<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 2/2/2017, 2:57:03 PM<br><strong>LastUpdated</strong>: 2/7/2017, 11:05:39 PM<br><strong>CommitMessage</strong>:<br><pre>[FAB-1826]  Verify peer cert chain of trust

We get the peer cert when checking a ProposalResponse.
Validate the peer cert chain of trust by checking
against the SDK's trust store.

For now, we copy the peer's CA cert and add
it to the SDK trust store under the covers.

This will be cleaned up once the MSP work is
complete and the SDK trust store is populated
from the chain's genesis block.

As a side effect, I have turned on the
config properties code so that I can pass in the
path of the temporary peer cert.

Feb 7, 2017 rebase on master

Change-Id: Ia148bfc4677bd9abf88aec7222a0e7d57d42615d
Signed-off-by: tuand27613 <tdang@us.ibm.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>Reviewed</strong>: 2/2/2017, 2:57:03 PM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/2/2017, 2:58:05 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-sdk-java-verify-x86_64/66/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/2/2017, 2:59:36 PM<br><strong>Message</strong>: <pre>Patch Set 1: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-sdk-java-verify-x86_64/66/ : SUCCESS</pre><strong>Reviewer</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>Reviewed</strong>: 2/2/2017, 2:59:39 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Rebased changeset to master branch.

I will abandon the original changeset https://gerrit.hyperledger.org/r/#/c/5097/</pre><strong>Reviewer</strong>: Rick Rine - cr22rc@gmail.com<br><strong>Reviewed</strong>: 2/2/2017, 3:33:55 PM<br><strong>Message</strong>: <pre>Patch Set 1: Code-Review-1

(1 comment)

We are going to need a store for other artifacts like the chain info.  I'm not sure having certificates stored in one store and other meta data stored elsewhere.  I'd like to discuss this direction first before we merge it.</pre><strong>Reviewer</strong>: Muhammad Altaf - muhammada@fast.au.fujitsu.com<br><strong>Reviewed</strong>: 2/2/2017, 3:42:15 PM<br><strong>Message</strong>: <pre>Patch Set 1: Code-Review-1

(17 comments)</pre><strong>Reviewer</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>Reviewed</strong>: 2/2/2017, 5:33:39 PM<br><strong>Message</strong>: <pre>Uploaded patch set 2.</pre><strong>Reviewer</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>Reviewed</strong>: 2/2/2017, 5:33:54 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(11 comments)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/2/2017, 5:34:27 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-sdk-java-verify-x86_64/68/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/2/2017, 5:35:58 PM<br><strong>Message</strong>: <pre>Patch Set 2: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-sdk-java-verify-x86_64/68/ : SUCCESS</pre><strong>Reviewer</strong>: Jim Zhang - jim_the_matrix@hotmail.com<br><strong>Reviewed</strong>: 2/2/2017, 11:33:48 PM<br><strong>Message</strong>: <pre>Patch Set 2:

i think in general the current Config.java and CryptoPrimitives.java both assume that there will be one instance of it per application (per JVM), because many of the critical properties are defined as static. That's not going to work because the application has to deal with multiple chains/channels and each may have its own crypto algo, key length, turst store, etc. Both classes need to be re-designed to accommodate that.</pre><strong>Reviewer</strong>: Jim Zhang - jim_the_matrix@hotmail.com<br><strong>Reviewed</strong>: 2/2/2017, 11:33:58 PM<br><strong>Message</strong>: <pre>Patch Set 2: Code-Review-1</pre><strong>Reviewer</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>Reviewed</strong>: 2/3/2017, 3:01:14 PM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/3/2017, 3:02:08 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-sdk-java-verify-x86_64/69/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/3/2017, 3:03:40 PM<br><strong>Message</strong>: <pre>Patch Set 3: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-sdk-java-verify-x86_64/69/ : SUCCESS</pre><strong>Reviewer</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>Reviewed</strong>: 2/3/2017, 3:04:44 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Changed the CryptoPrimitives methods and trust store from static to local.

@Jim Zhang,  agree with you that config & crypto will likely be on a per chain basis. I would though like to do that refactor in a separate changeset once we're clear what coming from MSP and genesis block</pre><strong>Reviewer</strong>: Muhammad Altaf - muhammada@fast.au.fujitsu.com<br><strong>Reviewed</strong>: 2/5/2017, 11:23:10 PM<br><strong>Message</strong>: <pre>Patch Set 3: Code-Review-1

Hi Tuan,
 We don't need to wait for genesis block information to address these issues. Anything that is not related to chain, goes away from chain instead of becoming static. Please convert these static methods to non-static. 
Also I see that not all the comments have been addressed, like the reference to src directory which won't be available in the jar.
Please address those comments and resubmit the patch. Current state is in conflict anyway, so it is better that we address these issues before merge.</pre><strong>Reviewer</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>Reviewed</strong>: 2/6/2017, 10:49:16 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(6 comments)

Hi @Muhammad Altaf,  I think I've fixed all oustanding comments now.</pre><strong>Reviewer</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>Reviewed</strong>: 2/6/2017, 10:50:04 AM<br><strong>Message</strong>: <pre>Uploaded patch set 4.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/6/2017, 10:50:54 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-sdk-java-verify-x86_64/71/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/6/2017, 10:52:23 AM<br><strong>Message</strong>: <pre>Patch Set 4: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-sdk-java-verify-x86_64/71/ : SUCCESS</pre><strong>Reviewer</strong>: Muhammad Altaf - muhammada@fast.au.fujitsu.com<br><strong>Reviewed</strong>: 2/6/2017, 6:31:03 PM<br><strong>Message</strong>: <pre>Patch Set 4: Code-Review-1

Hi Tuan,
 Thanks for addressing the issues. I can still see a lot of white-space changes in many of these files. For example, see Chain.java

The problem is, there might be actually few changes, but because of these white-space changes, reviewer has to go through each and every line to see if it has been changed.

Also, currently there is a merge conflict which prevents us from merging. Can you please address both of these issues?

Thanks,
Altaf</pre><strong>Reviewer</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>Reviewed</strong>: 2/7/2017, 10:40:10 AM<br><strong>Message</strong>: <pre>Uploaded patch set 5.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/7/2017, 10:41:09 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-sdk-java-verify-x86_64/72/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/7/2017, 10:42:35 AM<br><strong>Message</strong>: <pre>Patch Set 5: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-sdk-java-verify-x86_64/72/ : FAILURE</pre><strong>Reviewer</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>Reviewed</strong>: 2/7/2017, 11:04:17 AM<br><strong>Message</strong>: <pre>Uploaded patch set 6.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/7/2017, 11:05:05 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-sdk-java-verify-x86_64/73/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/7/2017, 11:06:32 AM<br><strong>Message</strong>: <pre>Patch Set 6: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-sdk-java-verify-x86_64/73/ : SUCCESS</pre><strong>Reviewer</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>Reviewed</strong>: 2/7/2017, 11:09:42 AM<br><strong>Message</strong>: <pre>Patch Set 6:

I've rebased off the latest master so there should be no more merge conflicts

I've changed tabs->spaces so the whitespace diffs are *mostly* gone. Can you try setting gerrit diff to ignore leading,end spaces ?
We'll continue having problems as folks will contribute code using different IDEs.  I'll see if I can add a linter to our build step.</pre><strong>Reviewer</strong>: Jim Zhang - jim_the_matrix@hotmail.com<br><strong>Reviewed</strong>: 2/7/2017, 12:09:23 PM<br><strong>Message</strong>: <pre>Patch Set 6:

(1 comment)</pre><strong>Reviewer</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>Reviewed</strong>: 2/7/2017, 5:08:04 PM<br><strong>Message</strong>: <pre>Uploaded patch set 7.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/7/2017, 5:09:01 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-sdk-java-verify-x86_64/74/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/7/2017, 5:10:30 PM<br><strong>Message</strong>: <pre>Patch Set 7: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-sdk-java-verify-x86_64/74/ : SUCCESS</pre><strong>Reviewer</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>Reviewed</strong>: 2/7/2017, 5:14:24 PM<br><strong>Message</strong>: <pre>Uploaded patch set 8.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/7/2017, 5:15:13 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-sdk-java-verify-x86_64/75/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/7/2017, 5:16:39 PM<br><strong>Message</strong>: <pre>Patch Set 8: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-sdk-java-verify-x86_64/75/ : SUCCESS</pre><strong>Reviewer</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>Reviewed</strong>: 2/7/2017, 5:19:47 PM<br><strong>Message</strong>: <pre>Patch Set 6:

(1 comment)</pre><strong>Reviewer</strong>: Jim Zhang - jim_the_matrix@hotmail.com<br><strong>Reviewed</strong>: 2/7/2017, 10:04:38 PM<br><strong>Message</strong>: <pre>Patch Set 8: Code-Review+2</pre><strong>Reviewer</strong>: Gerrit Code Review - gerrit@hyperledger.org<br><strong>Reviewed</strong>: 2/7/2017, 11:05:39 PM<br><strong>Message</strong>: <pre>Change has been successfully merged by Muhammad Altaf</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: tuand27613 - tdang@us.ibm.com<br><strong>Uploader</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>Created</strong>: 2/2/2017, 2:57:03 PM<br><strong>UnmergedRevision</strong>: [6392ba529ae2cbfb6fa74d33879c0c1d8b5e8000](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/commit/6392ba529ae2cbfb6fa74d33879c0c1d8b5e8000)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/2/2017, 2:59:36 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Muhammad Altaf - muhammada@fast.au.fujitsu.com<br><strong>Approved</strong>: 2/2/2017, 3:42:15 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Rick Rine - cr22rc@gmail.com<br><strong>Approved</strong>: 2/2/2017, 3:33:55 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Muhammad Altaf - muhammada@fast.au.fujitsu.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/helper/Config.java#L22](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/6392ba529ae2cbfb6fa74d33879c0c1d8b5e8000/src/main/java/org/hyperledger/fabric/sdk/helper/Config.java#L22)<br><strong>Comment</strong>: <pre>Please revert all whitespace changes</pre><strong>Commenter</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/helper/Config.java#L22](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/6392ba529ae2cbfb6fa74d33879c0c1d8b5e8000/src/main/java/org/hyperledger/fabric/sdk/helper/Config.java#L22)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Muhammad Altaf - muhammada@fast.au.fujitsu.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/helper/Config.java#L36](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/6392ba529ae2cbfb6fa74d33879c0c1d8b5e8000/src/main/java/org/hyperledger/fabric/sdk/helper/Config.java#L36)<br><strong>Comment</strong>: <pre>Why would you change the name of the file when implementing validation of certs? please submit separate patch for refactoring</pre><strong>Commenter</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/helper/Config.java#L36](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/6392ba529ae2cbfb6fa74d33879c0c1d8b5e8000/src/main/java/org/hyperledger/fabric/sdk/helper/Config.java#L36)<br><strong>Comment</strong>: <pre>reverted</pre><strong>Commenter</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/helper/Config.java#L36](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/6392ba529ae2cbfb6fa74d33879c0c1d8b5e8000/src/main/java/org/hyperledger/fabric/sdk/helper/Config.java#L36)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Muhammad Altaf - muhammada@fast.au.fujitsu.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/helper/Config.java#L64](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/6392ba529ae2cbfb6fa74d33879c0c1d8b5e8000/src/main/java/org/hyperledger/fabric/sdk/helper/Config.java#L64)<br><strong>Comment</strong>: <pre>src is not going to be included in jar file, please use classpath for loading the contents of pem file</pre><strong>Commenter</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/helper/Config.java#L64](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/6392ba529ae2cbfb6fa74d33879c0c1d8b5e8000/src/main/java/org/hyperledger/fabric/sdk/helper/Config.java#L64)<br><strong>Comment</strong>: <pre>I have moved the peer cert to test/fixture so that we can run with the current peer code.

This is temporary and will be removed once we implement the create/join channel path and we get the peer certs the correct way, i.e. via the chain's genesis block.</pre><strong>Commenter</strong>: Muhammad Altaf - muhammada@fast.au.fujitsu.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L128](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/6392ba529ae2cbfb6fa74d33879c0c1d8b5e8000/src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L128)<br><strong>Comment</strong>: <pre>Please remove whitespace characters
What happens when isVerified is false? if Exception is thrown, it will go in catch clause so no use of isVerified variable. If not, we need to handle that case</pre><strong>Commenter</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L128](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/6392ba529ae2cbfb6fa74d33879c0c1d8b5e8000/src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L128)<br><strong>Comment</strong>: <pre>if isVerified is false, we fall through to the return at line 147.

Basically, we treat fail to check chain of trust and fail to check signature the same.</pre><strong>Commenter</strong>: Muhammad Altaf - muhammada@fast.au.fujitsu.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L138](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/6392ba529ae2cbfb6fa74d33879c0c1d8b5e8000/src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L138)<br><strong>Comment</strong>: <pre>return false directly instead of saving the value to a variable first</pre><strong>Commenter</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L138](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/6392ba529ae2cbfb6fa74d33879c0c1d8b5e8000/src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L138)<br><strong>Comment</strong>: <pre>I wanted to log different data depending on the exception. Given all the possible exceptions, I thought it would be less confusing to have only one return statement</pre><strong>Commenter</strong>: Muhammad Altaf - muhammada@fast.au.fujitsu.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L141](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/6392ba529ae2cbfb6fa74d33879c0c1d8b5e8000/src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L141)<br><strong>Comment</strong>: <pre>return false directly instead of saving the value to a variable first</pre><strong>Commenter</strong>: Muhammad Altaf - muhammada@fast.au.fujitsu.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L144](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/6392ba529ae2cbfb6fa74d33879c0c1d8b5e8000/src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L144)<br><strong>Comment</strong>: <pre>return false directly instead of saving the value to a variable first</pre><strong>Commenter</strong>: Muhammad Altaf - muhammada@fast.au.fujitsu.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L145](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/6392ba529ae2cbfb6fa74d33879c0c1d8b5e8000/src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L145)<br><strong>Comment</strong>: <pre>Since we are not doing anything special in catch blocks that is specific to the type of exception, should be used only one catch block</pre><strong>Commenter</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L145](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/6392ba529ae2cbfb6fa74d33879c0c1d8b5e8000/src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L145)<br><strong>Comment</strong>: <pre>I wanted to log different data depending on the exception.

Will minimize the number of catch blocks</pre><strong>Commenter</strong>: Muhammad Altaf - muhammada@fast.au.fujitsu.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L153](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/6392ba529ae2cbfb6fa74d33879c0c1d8b5e8000/src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L153)<br><strong>Comment</strong>: <pre>Please change all static methods with local methods</pre><strong>Commenter</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L153](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/6392ba529ae2cbfb6fa74d33879c0c1d8b5e8000/src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L153)<br><strong>Comment</strong>: <pre>My next TODO is to refactor all the crypto methods to match how the fabric MSP / BCCSP classes do things as we will need to get configurations from the genesis block.

Propose that we do the static to local change as a following change set</pre><strong>Commenter</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L153](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/6392ba529ae2cbfb6fa74d33879c0c1d8b5e8000/src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L153)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Muhammad Altaf - muhammada@fast.au.fujitsu.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L160](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/6392ba529ae2cbfb6fa74d33879c0c1d8b5e8000/src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L160)<br><strong>Comment</strong>: <pre>Does caller of the function know that the call failed?</pre><strong>Commenter</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L160](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/6392ba529ae2cbfb6fa74d33879c0c1d8b5e8000/src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L160)<br><strong>Comment</strong>: <pre>the way the code is now, validate chain of trust will always fail if we don't have a trust store</pre><strong>Commenter</strong>: Muhammad Altaf - muhammada@fast.au.fujitsu.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L168](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/6392ba529ae2cbfb6fa74d33879c0c1d8b5e8000/src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L168)<br><strong>Comment</strong>: <pre>Please replace static methods to non-static</pre><strong>Commenter</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L168](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/6392ba529ae2cbfb6fa74d33879c0c1d8b5e8000/src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L168)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Muhammad Altaf - muhammada@fast.au.fujitsu.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L179](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/6392ba529ae2cbfb6fa74d33879c0c1d8b5e8000/src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L179)<br><strong>Comment</strong>: <pre>Please prevent using printStackTrace, instead use logger to log error messages, this should be done for all printStackTraces</pre><strong>Commenter</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L179](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/6392ba529ae2cbfb6fa74d33879c0c1d8b5e8000/src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L179)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Muhammad Altaf - muhammada@fast.au.fujitsu.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L180](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/6392ba529ae2cbfb6fa74d33879c0c1d8b5e8000/src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L180)<br><strong>Comment</strong>: <pre>cf is already null as the exception occurd, no need to set it to null again</pre><strong>Commenter</strong>: Muhammad Altaf - muhammada@fast.au.fujitsu.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L196](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/6392ba529ae2cbfb6fa74d33879c0c1d8b5e8000/src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L196)<br><strong>Comment</strong>: <pre>this block is just gona throw exception because cf is null. Why not just return in first exception block?
Also let the caller know that the operation failed</pre><strong>Commenter</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L196](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/6392ba529ae2cbfb6fa74d33879c0c1d8b5e8000/src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L196)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Muhammad Altaf - muhammada@fast.au.fujitsu.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L206](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/6392ba529ae2cbfb6fa74d33879c0c1d8b5e8000/src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L206)<br><strong>Comment</strong>: <pre>getTrustStore should not instantiate trustStore unless you want to lazily instantiate that which should be only done when it is rarely needed, but I guess our main logic relies on that</pre><strong>Commenter</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L206](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/6392ba529ae2cbfb6fa74d33879c0c1d8b5e8000/src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L206)<br><strong>Comment</strong>: <pre>I do this here mainly for convenience given that we just need to set up a fixed trust store with a fixed peer CA cert.

As part of the TODO, I expect the handling of trust stores will change when we do the MSP and configuration from genesis block work.</pre><strong>Commenter</strong>: Muhammad Altaf - muhammada@fast.au.fujitsu.com<br><strong>CommentLine</strong>: [src/test/java/org/hyperledger/fabric/sdk/helper/ConfigTest.java#L27](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/6392ba529ae2cbfb6fa74d33879c0c1d8b5e8000/src/test/java/org/hyperledger/fabric/sdk/helper/ConfigTest.java#L27)<br><strong>Comment</strong>: <pre>src is not a best location for storing pem</pre><strong>Commenter</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>CommentLine</strong>: [src/test/java/org/hyperledger/fabric/sdk/helper/ConfigTest.java#L27](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/6392ba529ae2cbfb6fa74d33879c0c1d8b5e8000/src/test/java/org/hyperledger/fabric/sdk/helper/ConfigTest.java#L27)<br><strong>Comment</strong>: <pre>I needed to carry along the default peer cacert so that the end to end flows with the current fabric and fabric-ca builds.

Once the fabric MSP and bootstrap configurations are done, this will be deleted and sdk will receive the certs from the chain genesis block</pre><strong>Commenter</strong>: Rick Rine - cr22rc@gmail.com<br><strong>CommentLine</strong>: [src/test/java/org/hyperledger/fabric/sdk/helper/ConfigTest.java#L28](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/6392ba529ae2cbfb6fa74d33879c0c1d8b5e8000/src/test/java/org/hyperledger/fabric/sdk/helper/ConfigTest.java#L28)<br><strong>Comment</strong>: <pre>Can we add one more test here where it does a System.setProperty(...) to something else and then test that it overrides the value.  Just to make sure that stays working.</pre><strong>Commenter</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>CommentLine</strong>: [src/test/java/org/hyperledger/fabric/sdk/helper/ConfigTest.java#L28](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/6392ba529ae2cbfb6fa74d33879c0c1d8b5e8000/src/test/java/org/hyperledger/fabric/sdk/helper/ConfigTest.java#L28)<br><strong>Comment</strong>: <pre>hard to add another test as config is a singleton and won't reload.
I made the check as part of the original test</pre><strong>Commenter</strong>: Muhammad Altaf - muhammada@fast.au.fujitsu.com<br><strong>CommentLine</strong>: [src/test/java/org/hyperledger/fabric/sdk/security/CryptoPrimitivesTest.java#L45](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/6392ba529ae2cbfb6fa74d33879c0c1d8b5e8000/src/test/java/org/hyperledger/fabric/sdk/security/CryptoPrimitivesTest.java#L45)<br><strong>Comment</strong>: <pre>Please remove whitespace changes</pre><strong>Commenter</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>CommentLine</strong>: [src/test/java/org/hyperledger/fabric/sdk/security/CryptoPrimitivesTest.java#L45](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/6392ba529ae2cbfb6fa74d33879c0c1d8b5e8000/src/test/java/org/hyperledger/fabric/sdk/security/CryptoPrimitivesTest.java#L45)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: tuand27613 - tdang@us.ibm.com<br><strong>Uploader</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>Created</strong>: 2/2/2017, 5:33:39 PM<br><strong>UnmergedRevision</strong>: [f6cea86512a53bf7857e53cde944950cfdbf4dca](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/commit/f6cea86512a53bf7857e53cde944950cfdbf4dca)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/2/2017, 5:35:58 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Jim Zhang - jim_the_matrix@hotmail.com<br><strong>Approved</strong>: 2/2/2017, 11:33:58 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: tuand27613 - tdang@us.ibm.com<br><strong>Uploader</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>Created</strong>: 2/3/2017, 3:01:14 PM<br><strong>UnmergedRevision</strong>: [5bdea42379a43f7ec2a11a3c2047a6fe6dc3e7af](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/commit/5bdea42379a43f7ec2a11a3c2047a6fe6dc3e7af)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/3/2017, 3:03:40 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Muhammad Altaf - muhammada@fast.au.fujitsu.com<br><strong>Approved</strong>: 2/5/2017, 11:23:10 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: tuand27613 - tdang@us.ibm.com<br><strong>Uploader</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>Created</strong>: 2/6/2017, 10:50:04 AM<br><strong>UnmergedRevision</strong>: [203ba752a9ffa01f4e139a68f1e5a5165302eb28](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/commit/203ba752a9ffa01f4e139a68f1e5a5165302eb28)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/6/2017, 10:52:23 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Muhammad Altaf - muhammada@fast.au.fujitsu.com<br><strong>Approved</strong>: 2/6/2017, 6:31:03 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 5</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: tuand27613 - tdang@us.ibm.com<br><strong>Uploader</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>Created</strong>: 2/7/2017, 10:40:10 AM<br><strong>UnmergedRevision</strong>: [6c1aeb576f2759ad7f26c64f986b4a7038503367](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/commit/6c1aeb576f2759ad7f26c64f986b4a7038503367)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/7/2017, 10:42:35 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 6</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: tuand27613 - tdang@us.ibm.com<br><strong>Uploader</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>Created</strong>: 2/7/2017, 11:04:17 AM<br><strong>UnmergedRevision</strong>: [56baa7ff3c62276ad47029ce576c73adac72ff7d](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/commit/56baa7ff3c62276ad47029ce576c73adac72ff7d)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/7/2017, 11:06:32 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Jim Zhang - jim_the_matrix@hotmail.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L122](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/56baa7ff3c62276ad47029ce576c73adac72ff7d/src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L122)<br><strong>Comment</strong>: <pre>this one can be confusing when considering that the hash algo is set on the "hashAlgorithm" property. I think a better way is to make this an instance variable and be calculated from the key algo plus the hash algo.</pre><strong>Commenter</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>CommentLine</strong>: [src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L122](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/blob/56baa7ff3c62276ad47029ce576c73adac72ff7d/src/main/java/org/hyperledger/fabric/sdk/security/CryptoPrimitives.java#L122)<br><strong>Comment</strong>: <pre>i meant for SIGNATURE_ALGORITHM to be used for verifying incoming messages only, not for signing.

fabric and fabric-ca are still discussing how to configure this.  

For now, I've added get/setSignatureAlgorithm() methods, defaulting to what fabric and fabric-ca are hardcoding to (SHA256withECDSA). Also, when verifying, I try both  the algorithm set in the certificate ( as recommended by fabric-ca and fabric ) and the default one.</pre></blockquote><h3>PatchSet Number: 7</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: tuand27613 - tdang@us.ibm.com<br><strong>Uploader</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>Created</strong>: 2/7/2017, 5:08:04 PM<br><strong>UnmergedRevision</strong>: [46236f567d8cd5d1e4baa40c98b4f51e3b7b18eb](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/commit/46236f567d8cd5d1e4baa40c98b4f51e3b7b18eb)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/7/2017, 5:10:30 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 8</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: tuand27613 - tdang@us.ibm.com<br><strong>Uploader</strong>: Tuan Dang - tuan.dang.27613@gmail.com<br><strong>Created</strong>: 2/7/2017, 5:14:24 PM<br><strong>GitHubMergedRevision</strong>: [a28b0db055ae4d64b5aea7df9cd75ce494d89536](https://github.com/hyperledger-gerrit-archive/fabric-sdk-java/commit/a28b0db055ae4d64b5aea7df9cd75ce494d89536)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/7/2017, 5:16:39 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Muhammad Altaf<br><strong>Merged</strong>: 2/7/2017, 11:05:39 PM<br><br><strong>Approver</strong>: Jim Zhang - jim_the_matrix@hotmail.com<br><strong>Approved</strong>: 2/7/2017, 10:04:38 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br></blockquote>