<strong>Project</strong>: fabric<br><strong>Branch</strong>: master<br><strong>ID</strong>: 29972<br><strong>Subject</strong>: [FAB-14559] namespace ID from context<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Assignee</strong>:<br><strong>Created</strong>: 3/9/2019, 10:05:37 AM<br><strong>LastUpdated</strong>: 3/15/2019, 6:40:23 AM<br><strong>CommitMessage</strong>:<br><pre>[FAB-14559] namespace ID from context

In the current code, whenever a chaincode requests an operation (e.g.
GetState, PutState...), the identifier of the ledger namespace is derived
from the internal package ID of the chaincode. This works because currently
the internal package ID of the chaincode must also be identical to the ledger
namespace. To overcome this limitation, this change set derives the identifier
of the ledger namespace from the invocation context. This way, we are now free
to derive the internal package ID independently from the identifier of the
ledger namespace.

Change-Id: I3c0fa2f884c10a593b4577021f7711ca0f14ece8
Signed-off-by: Alessandro Sorniotti <ale.linux@sopit.net>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 3/9/2019, 10:05:37 AM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/9/2019, 10:07:47 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/11511/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/9/2019, 10:08:17 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/9/2019, 10:15:46 AM<br><strong>Message</strong>: <pre>Patch Set 1: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/9/2019, 10:16:46 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/11511/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/11511</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/9/2019, 10:17:29 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/10257/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/9/2019, 10:17:57 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/9/2019, 10:18:02 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/6975/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/9/2019, 10:18:36 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/9/2019, 10:43:50 AM<br><strong>Message</strong>: <pre>Patch Set 1: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/9/2019, 11:00:40 AM<br><strong>Message</strong>: <pre>Patch Set 1: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/9/2019, 11:01:27 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/10257/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/10257

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/6975/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/6975</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 3/11/2019, 2:15:08 PM<br><strong>Message</strong>: <pre>Patch Set 1: Code-Review+2</pre><strong>Reviewer</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Reviewed</strong>: 3/11/2019, 4:40:27 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(7 comments)

This has left behind some dead code that needs to be cleaned up.

I'm also concerned about the semantic switch from "chaincode name" to "namespace ID" without updating variable names or, where appropriate, messages.</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 3/12/2019, 10:16:08 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(7 comments)

Thanks Matt, all done in https://gerrit.hyperledger.org/r/30031</pre><strong>Reviewer</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Reviewed</strong>: 3/12/2019, 1:35:07 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(1 comment)</pre><strong>Reviewer</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Reviewed</strong>: 3/12/2019, 3:08:19 PM<br><strong>Message</strong>: <pre>Patch Set 1: Code-Review+2

let's move the actions from this to FAB-14602</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 3/13/2019, 8:19:57 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(1 comment)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 3/15/2019, 4:08:18 AM<br><strong>Message</strong>: <pre>Patch Set 2: Patch Set 1 was rebased</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 3/15/2019, 6:06:42 AM<br><strong>Message</strong>: <pre>Change has been successfully merged by Alessandro Sorniotti</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/15/2019, 6:08:45 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-x86_64/6063/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/15/2019, 6:09:30 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/4749/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/15/2019, 6:40:23 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/4749/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-end-2-end-x86_64/4749

https://jenkins.hyperledger.org/job/fabric-merge-x86_64/6063/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-x86_64/6063</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 3/9/2019, 10:05:37 AM<br><strong>UnmergedRevision</strong>: [2ef8f3e0d45c1571808296ca52e9d28ffd643398](https://github.com/hyperledger-gerrit-archive/fabric/commit/2ef8f3e0d45c1571808296ca52e9d28ffd643398)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 3/9/2019, 10:15:46 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 3/9/2019, 10:15:46 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 3/9/2019, 11:00:40 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 3/9/2019, 10:43:50 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Approved</strong>: 3/11/2019, 2:15:08 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Approved</strong>: 3/12/2019, 3:08:19 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/handler.go#L162](https://github.com/hyperledger-gerrit-archive/fabric/blob/2ef8f3e0d45c1571808296ca52e9d28ffd643398/core/chaincode/handler.go#L162)<br><strong>Comment</strong>: <pre>dead?

And if this is dead, there are dead tests.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/handler.go#L162](https://github.com/hyperledger-gerrit-archive/fabric/blob/2ef8f3e0d45c1571808296ca52e9d28ffd643398/core/chaincode/handler.go#L162)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/handler.go#L322](https://github.com/hyperledger-gerrit-archive/fabric/blob/2ef8f3e0d45c1571808296ca52e9d28ffd643398/core/chaincode/handler.go#L322)<br><strong>Comment</strong>: <pre>dead now?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/handler.go#L322](https://github.com/hyperledger-gerrit-archive/fabric/blob/2ef8f3e0d45c1571808296ca52e9d28ffd643398/core/chaincode/handler.go#L322)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/handler.go#L514](https://github.com/hyperledger-gerrit-archive/fabric/blob/2ef8f3e0d45c1571808296ca52e9d28ffd643398/core/chaincode/handler.go#L514)<br><strong>Comment</strong>: <pre>dead now? the only thing that's left that uses it doesn't seem to be called...</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/handler.go#L514](https://github.com/hyperledger-gerrit-archive/fabric/blob/2ef8f3e0d45c1571808296ca52e9d28ffd643398/core/chaincode/handler.go#L514)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/handler.go#L637](https://github.com/hyperledger-gerrit-archive/fabric/blob/2ef8f3e0d45c1571808296ca52e9d28ffd643398/core/chaincode/handler.go#L637)<br><strong>Comment</strong>: <pre>this is no longer the chaincodeName but a namespaceID.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/handler.go#L637](https://github.com/hyperledger-gerrit-archive/fabric/blob/2ef8f3e0d45c1571808296ca52e9d28ffd643398/core/chaincode/handler.go#L637)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/handler.go#L671](https://github.com/hyperledger-gerrit-archive/fabric/blob/2ef8f3e0d45c1571808296ca52e9d28ffd643398/core/chaincode/handler.go#L671)<br><strong>Comment</strong>: <pre>and here</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/handler.go#L671](https://github.com/hyperledger-gerrit-archive/fabric/blob/2ef8f3e0d45c1571808296ca52e9d28ffd643398/core/chaincode/handler.go#L671)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/handler.go#L701](https://github.com/hyperledger-gerrit-archive/fabric/blob/2ef8f3e0d45c1571808296ca52e9d28ffd643398/core/chaincode/handler.go#L701)<br><strong>Comment</strong>: <pre>and here</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/handler.go#L701](https://github.com/hyperledger-gerrit-archive/fabric/blob/2ef8f3e0d45c1571808296ca52e9d28ffd643398/core/chaincode/handler.go#L701)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/handler_test.go#L72](https://github.com/hyperledger-gerrit-archive/fabric/blob/2ef8f3e0d45c1571808296ca52e9d28ffd643398/core/chaincode/handler_test.go#L72)<br><strong>Comment</strong>: <pre>I realize you probably didn't want to change the literal everywhere, but, this should now be "namespace-id".</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/handler_test.go#L72](https://github.com/hyperledger-gerrit-archive/fabric/blob/2ef8f3e0d45c1571808296ca52e9d28ffd643398/core/chaincode/handler_test.go#L72)<br><strong>Comment</strong>: <pre>That's actually correct - the name of the namespace is the name of the chaincode instance; this is true because this string is decided at approve/commit time when we specify the chaincode name.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/handler_test.go#L72](https://github.com/hyperledger-gerrit-archive/fabric/blob/2ef8f3e0d45c1571808296ca52e9d28ffd643398/core/chaincode/handler_test.go#L72)<br><strong>Comment</strong>: <pre>I'm not sure I agree but I think this goes to the source of some of my confusion.

The namespace scopes the data layer managed by chaincode while chaincode name (in legacy chaincode) is the end user provided name for chaincode. The values may be the same but the concepts are different.

In these tests, "cc-instance-name" was populated to simulate the result of chaincode registration. In the real world, it should be determined by extracting it from the chaincodeID provided registration but here, the strings ("test-handler-name" and "cc-instance-name") are explicitly different to ensure that the code is using the expected source of data.

Given the above, I'd still expect to see "cc-instance-name" get changed to "tx-namespace-id" to reflect the source.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/handler_test.go#L72](https://github.com/hyperledger-gerrit-archive/fabric/blob/2ef8f3e0d45c1571808296ca52e9d28ffd643398/core/chaincode/handler_test.go#L72)<br><strong>Comment</strong>: <pre>Well there are 2 different identifiers: the package identifier and the chaincode identifier. With the old lifecycle they had to be identical and so there was a lot of confusion since - like in the case of this CR - a component part of the package ID was used to determine the namespace to be written. Now these 2 identifiers no longer have to be identical, and the chaincode name (that is, what we specify on approve/commit) is used to determine the ledger namespace, so from this perspective, it is correct to say that the namespace ID is set from the name of some cc instance. It would be wrong to say that it is set from the package ID however. DOes that make sense?</pre></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 3/15/2019, 4:08:18 AM<br><strong>GitHubMergedRevision</strong>: [8917d1a5360a16c2196e2f5b76c8b72db736093f](https://github.com/hyperledger-gerrit-archive/fabric/commit/8917d1a5360a16c2196e2f5b76c8b72db736093f)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 3/9/2019, 10:15:46 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 3/9/2019, 10:15:46 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 3/9/2019, 11:00:40 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 3/9/2019, 10:43:50 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Approved</strong>: 3/11/2019, 2:15:08 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Alessandro Sorniotti<br><strong>Merged</strong>: 3/15/2019, 6:06:42 AM<br><br><strong>Approver</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Approved</strong>: 3/12/2019, 3:08:19 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br></blockquote>