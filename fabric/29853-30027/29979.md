<strong>Project</strong>: fabric<br><strong>Branch</strong>: master<br><strong>ID</strong>: 29979<br><strong>Subject</strong>: [FAB-14569] Package ID is returned by lifecycle<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Assignee</strong>:<br><strong>Created</strong>: 3/10/2019, 5:28:37 AM<br><strong>LastUpdated</strong>: 3/15/2019, 10:24:18 AM<br><strong>CommitMessage</strong>:<br><pre>[FAB-14569] Package ID is returned by lifecycle

This CR ensures that the package ID is constructed by the cc lifecycle
component and returned to the endorser, rather than having the endorser
construct it manually. The legacy lifecycle constructs it as ccname + ":" +
ccversion whereas the new lifecycle constructs it as label + ":" hash.

Change-Id: I8d7213606d0275c7b315862b79b5f252dc519902
Signed-off-by: Alessandro Sorniotti <ale.linux@sopit.net>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 3/10/2019, 5:28:37 AM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/10/2019, 5:30:48 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/11517/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/10/2019, 5:31:31 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/10/2019, 5:37:52 AM<br><strong>Message</strong>: <pre>Patch Set 1: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/10/2019, 5:38:45 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/11517/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/11517</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/10/2019, 5:39:33 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/10263/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/10/2019, 5:40:01 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/10/2019, 5:40:43 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/6980/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/10/2019, 5:41:13 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/10/2019, 6:05:12 AM<br><strong>Message</strong>: <pre>Patch Set 1: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/10/2019, 6:31:32 AM<br><strong>Message</strong>: <pre>Patch Set 1: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/10/2019, 6:32:15 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/10263/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/10263

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/6980/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/6980</pre><strong>Reviewer</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Reviewed</strong>: 3/11/2019, 5:57:33 PM<br><strong>Message</strong>: <pre>Patch Set 1: Code-Review-1

(5 comments)

between the hard coded label and change of a production method to ForTest, this feels like a wip that needs to be squashed with something else.</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 3/13/2019, 11:31:38 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(5 comments)</pre><strong>Reviewer</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Reviewed</strong>: 3/14/2019, 10:36:09 AM<br><strong>Message</strong>: <pre>Removed Code-Review-1 by Matthew Sykes <sykesmat@us.ibm.com>
</pre><strong>Reviewer</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Reviewed</strong>: 3/14/2019, 4:21:28 PM<br><strong>Message</strong>: <pre>Patch Set 1: Code-Review+2

Let's see where this lands...</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 3/15/2019, 4:14:34 AM<br><strong>Message</strong>: <pre>Patch Set 2: Patch Set 1 was rebased</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 3/15/2019, 9:52:08 AM<br><strong>Message</strong>: <pre>Patch Set 3: Patch Set 2 was rebased</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 3/15/2019, 9:52:20 AM<br><strong>Message</strong>: <pre>Patch Set 3: Code-Review+2</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 3/15/2019, 9:52:22 AM<br><strong>Message</strong>: <pre>Change has been successfully merged by Gari Singh</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/15/2019, 9:54:37 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-x86_64/6079/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/15/2019, 9:56:44 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/4765/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/15/2019, 10:24:18 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/4765/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-end-2-end-x86_64/4765

https://jenkins.hyperledger.org/job/fabric-merge-x86_64/6079/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-x86_64/6079</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 3/10/2019, 5:28:37 AM<br><strong>UnmergedRevision</strong>: [42ebeb14518320c1739b602efda1f5cdabb896ab](https://github.com/hyperledger-gerrit-archive/fabric/commit/42ebeb14518320c1739b602efda1f5cdabb896ab)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 3/10/2019, 5:37:52 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 3/10/2019, 5:37:52 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 3/10/2019, 6:31:32 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 3/10/2019, 6:05:12 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Approved</strong>: 3/14/2019, 4:21:28 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/chaincode_support.go#L222](https://github.com/hyperledger-gerrit-archive/fabric/blob/42ebeb14518320c1739b602efda1f5cdabb896ab/core/chaincode/chaincode_support.go#L222)<br><strong>Comment</strong>: <pre>this is the 6th or 7th CR in the chain and I haven't seen any FIXME's disappear.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/chaincode_support.go#L222](https://github.com/hyperledger-gerrit-archive/fabric/blob/42ebeb14518320c1739b602efda1f5cdabb896ab/core/chaincode/chaincode_support.go#L222)<br><strong>Comment</strong>: <pre>In fact, most of them have disappeared. There were a few left which I either removed (since they were done) or added a fab to track - done in FAB-14629</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/chaincode_support_test.go#L965](https://github.com/hyperledger-gerrit-archive/fabric/blob/42ebeb14518320c1739b602efda1f5cdabb896ab/core/chaincode/chaincode_support_test.go#L965)<br><strong>Comment</strong>: <pre>oooh boy. I'd better buckle up.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/chaincode_support_test.go#L965](https://github.com/hyperledger-gerrit-archive/fabric/blob/42ebeb14518320c1739b602efda1f5cdabb896ab/core/chaincode/chaincode_support_test.go#L965)<br><strong>Comment</strong>: <pre>:) Gone with FAB-14625</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/container_runtime.go#L146](https://github.com/hyperledger-gerrit-archive/fabric/blob/42ebeb14518320c1739b602efda1f5cdabb896ab/core/chaincode/container_runtime.go#L146)<br><strong>Comment</strong>: <pre>I'll continue on my naming commentary - why is this a package ID?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/container_runtime.go#L146](https://github.com/hyperledger-gerrit-archive/fabric/blob/42ebeb14518320c1739b602efda1f5cdabb896ab/core/chaincode/container_runtime.go#L146)<br><strong>Comment</strong>: <pre>I think I need your help to find a better name. I know it's definitely not a chaincode name - chaincode name has a specific meaning in the lifecycle to reflect i) an *instance* of a chaincode on a channel, ii) a ledger namespace, iii) a unique identifier that can be used as lookup key to retrieve things like endorsement policies, collection definitions etc. from lifecycle.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/container_runtime.go#L154](https://github.com/hyperledger-gerrit-archive/fabric/blob/42ebeb14518320c1739b602efda1f5cdabb896ab/core/chaincode/container_runtime.go#L154)<br><strong>Comment</strong>: <pre>This isn't a FIXME - it's a note saying why it's here. Also, it's not "broken" it's "legacy" with all that implies.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/container_runtime.go#L154](https://github.com/hyperledger-gerrit-archive/fabric/blob/42ebeb14518320c1739b602efda1f5cdabb896ab/core/chaincode/container_runtime.go#L154)<br><strong>Comment</strong>: <pre>In FAB-14629 a fab for this fixme has been created: the legacy chaincode lifecycle will eventually be discontinued and so as soon as that's done we can rename env variables more appropriately without fear of breaking things.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/common/ccprovider/ccprovider.go#L394](https://github.com/hyperledger-gerrit-archive/fabric/blob/42ebeb14518320c1739b602efda1f5cdabb896ab/core/common/ccprovider/ccprovider.go#L394)<br><strong>Comment</strong>: <pre>boo.  This really wasn't necessary for this CR. This feels like a WIP cr.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/common/ccprovider/ccprovider.go#L394](https://github.com/hyperledger-gerrit-archive/fabric/blob/42ebeb14518320c1739b602efda1f5cdabb896ab/core/common/ccprovider/ccprovider.go#L394)<br><strong>Comment</strong>: <pre>Wrong feeling - but understandable because I was too lazy to get rid of the function. I renamed it so that it would be clear it's no longer used in production. Done in FAB-14625 where I fully remove it</pre></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 3/15/2019, 4:14:34 AM<br><strong>UnmergedRevision</strong>: [94d6d71ce3221017d5cd32e3547ac838a43b2605](https://github.com/hyperledger-gerrit-archive/fabric/commit/94d6d71ce3221017d5cd32e3547ac838a43b2605)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 3/10/2019, 5:37:52 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 3/10/2019, 5:37:52 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 3/10/2019, 6:31:32 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 3/10/2019, 6:05:12 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Approved</strong>: 3/14/2019, 4:21:28 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Created</strong>: 3/15/2019, 9:52:08 AM<br><strong>GitHubMergedRevision</strong>: [c2282e29218ba1ffb7d9759665328f68946595c7](https://github.com/hyperledger-gerrit-archive/fabric/commit/c2282e29218ba1ffb7d9759665328f68946595c7)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 3/10/2019, 5:37:52 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 3/10/2019, 5:37:52 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 3/10/2019, 6:31:32 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 3/10/2019, 6:05:12 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Approved</strong>: 3/15/2019, 9:52:20 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Gari Singh<br><strong>Merged</strong>: 3/15/2019, 9:52:22 AM<br><br><strong>Approver</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Approved</strong>: 3/14/2019, 4:21:28 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br></blockquote>