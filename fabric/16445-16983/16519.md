<strong>Project</strong>: fabric<br><strong>Branch</strong>: master<br><strong>ID</strong>: 16519<br><strong>Subject</strong>: [FAB-6938] Cannot create CouchDB database for channel<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 1/2/2018, 8:20:22 AM<br><strong>LastUpdated</strong>: 2/5/2018, 4:42:56 PM<br><strong>CommitMessage</strong>:<br><pre>[FAB-6938] Cannot create CouchDB database for channel

In rocket.chat there was a post about an error:
when i am running join peer request some times it's giving
Error:file_exists, Status Code:412, Reason:The database could
not be created, the file already exists

I believe this can happen if peer is retrying a create database
request against CouchDB.  A prior attempt to create database came
back as a timeout failure to peer, but in the meantime the database
got created in CouchDB.  The next retry would get the error above.
This scenario should be handled in peer code.

Change-Id: I01ecd3a5fde8a9042f6a18181376dec267d0cc15
Signed-off-by: Chris Elder <chris.elder@us.ibm.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Reviewed</strong>: 1/2/2018, 8:20:22 AM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/2/2018, 8:20:33 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-s390x/1114/ (1/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/2/2018, 8:21:53 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/14031/ (2/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/2/2018, 8:22:51 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/19940/ (4/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/2/2018, 8:22:51 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/11646/ (3/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/2/2018, 8:22:58 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/422/ (5/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/2/2018, 9:09:32 AM<br><strong>Message</strong>: <pre>Patch Set 1: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-s390x/1114/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-s390x/1114/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-s390x/1114

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/19940/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/19940/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/19940

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/14031/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-behave-x86_64/14031

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/11646/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/11646

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/422/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/422</pre><strong>Reviewer</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Reviewed</strong>: 1/2/2018, 1:09:01 PM<br><strong>Message</strong>: <pre>Uploaded patch set 2.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/2/2018, 1:09:11 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-s390x/1124/ (1/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/2/2018, 1:11:25 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/14039/ (2/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/2/2018, 1:11:25 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/11655/ (3/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/2/2018, 1:12:12 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/19949/ (4/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/2/2018, 1:12:21 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/430/ (5/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/2/2018, 2:20:32 PM<br><strong>Message</strong>: <pre>Patch Set 2: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-s390x/1124/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-s390x/1124

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/14039/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-behave-x86_64/14039

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/11655/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/11655

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/19949/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/19949

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/430/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/430</pre><strong>Reviewer</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Reviewed</strong>: 1/20/2018, 12:12:12 PM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/20/2018, 12:13:45 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12117/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/20/2018, 12:14:11 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20402/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/20/2018, 12:15:35 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/845/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/20/2018, 12:39:46 PM<br><strong>Message</strong>: <pre>Patch Set 3: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12117/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/12117

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20402/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/20402

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/845/ : Build SMOKE

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/845</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 1/30/2018, 9:48:49 PM<br><strong>Message</strong>: <pre>Patch Set 3: Code-Review-1

(3 comments)</pre><strong>Reviewer</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Reviewed</strong>: 1/31/2018, 9:16:39 AM<br><strong>Message</strong>: <pre>Patch Set 3:

(3 comments)</pre><strong>Reviewer</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Reviewed</strong>: 1/31/2018, 9:20:06 AM<br><strong>Message</strong>: <pre>Uploaded patch set 4.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/31/2018, 9:22:25 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20577/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/31/2018, 9:22:44 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12281/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/31/2018, 9:23:27 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/999/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/31/2018, 9:34:05 AM<br><strong>Message</strong>: <pre>Patch Set 4: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20577/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20577/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/20577

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12281/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12281/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/12281

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/999/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/999</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 1/31/2018, 10:34:46 AM<br><strong>Message</strong>: <pre>Patch Set 4:

(4 comments)

I like the overall approach of patch4. Just some minor comments...</pre><strong>Reviewer</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Reviewed</strong>: 1/31/2018, 4:23:49 PM<br><strong>Message</strong>: <pre>Patch Set 4:

(4 comments)</pre><strong>Reviewer</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Reviewed</strong>: 1/31/2018, 4:25:00 PM<br><strong>Message</strong>: <pre>Uploaded patch set 5.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/31/2018, 4:26:32 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20591/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/31/2018, 4:28:00 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12294/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/31/2018, 4:28:05 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/1012/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/31/2018, 4:52:37 PM<br><strong>Message</strong>: <pre>Patch Set 5: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20591/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/20591

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12294/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/12294

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/1012/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/1012</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 1/31/2018, 6:03:31 PM<br><strong>Message</strong>: <pre>Patch Set 5:

(1 comment)

I think the overall logic is good now.  Just one remaining comment...</pre><strong>Reviewer</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Reviewed</strong>: 2/1/2018, 10:43:10 AM<br><strong>Message</strong>: <pre>Uploaded patch set 6: Patch Set 5 was rebased.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/1/2018, 10:48:26 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20635/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/1/2018, 10:48:39 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12334/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/1/2018, 10:48:40 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/1051/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/1/2018, 11:05:39 AM<br><strong>Message</strong>: <pre>Patch Set 6: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20635/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20635/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/20635

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12334/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12334/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/12334

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/1051/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/1051</pre><strong>Reviewer</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Reviewed</strong>: 2/1/2018, 11:27:21 AM<br><strong>Message</strong>: <pre>Patch Set 6:

(3 comments)</pre><strong>Reviewer</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Reviewed</strong>: 2/1/2018, 11:28:12 AM<br><strong>Message</strong>: <pre>Uploaded patch set 7.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/1/2018, 11:30:34 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20638/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/1/2018, 11:30:40 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12336/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/1/2018, 11:31:48 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/1053/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/1/2018, 11:48:12 AM<br><strong>Message</strong>: <pre>Patch Set 7: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20638/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20638/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/20638

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12336/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/12336

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/1053/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/1053</pre><strong>Reviewer</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Reviewed</strong>: 2/1/2018, 11:51:15 AM<br><strong>Message</strong>: <pre>Patch Set 7:

rebuild-x</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/1/2018, 11:54:50 AM<br><strong>Message</strong>: <pre>Patch Set 7: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/320/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/1/2018, 11:55:12 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20640/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/1/2018, 12:24:08 PM<br><strong>Message</strong>: <pre>Patch Set 7: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/320/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/320

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20640/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/20640</pre><strong>Reviewer</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Reviewed</strong>: 2/2/2018, 10:13:07 AM<br><strong>Message</strong>: <pre>Patch Set 8: Patch Set 7 was rebased</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/2/2018, 10:15:46 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20671/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/2/2018, 10:17:31 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12362/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/2/2018, 10:17:36 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/1079/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/2/2018, 10:50:56 AM<br><strong>Message</strong>: <pre>Patch Set 8: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12362/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12362/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/12362

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20671/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/20671

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/1079/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/1079</pre><strong>Reviewer</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Reviewed</strong>: 2/2/2018, 10:57:23 AM<br><strong>Message</strong>: <pre>Uploaded patch set 9.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/2/2018, 10:59:42 AM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20673/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/2/2018, 11:00:01 AM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12363/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/2/2018, 11:00:56 AM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/1080/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/2/2018, 11:47:29 AM<br><strong>Message</strong>: <pre>Patch Set 9: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20673/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/20673

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12363/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/12363

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/1080/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/1080</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 2/3/2018, 2:35:03 AM<br><strong>Message</strong>: <pre>Patch Set 9: Code-Review-1

Hmmmm, I see your final updates as of patch 8, but they disappeared as of patch 9.</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 2/3/2018, 2:36:25 AM<br><strong>Message</strong>: <pre>Patch Set 9:

Your rebase of https://gerrit.hyperledger.org/r/#/c/17417/ at 10:57 must have wiped out the final change.</pre><strong>Reviewer</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Reviewed</strong>: 2/3/2018, 5:01:59 PM<br><strong>Message</strong>: <pre>Uploaded patch set 10.</pre><strong>Reviewer</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Reviewed</strong>: 2/3/2018, 5:02:49 PM<br><strong>Message</strong>: <pre>Patch Set 10:

Not sure what happened.  I double checked then uploaded a new patch.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/3/2018, 5:05:47 PM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20694/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/3/2018, 5:05:55 PM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12383/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/3/2018, 5:06:34 PM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/1100/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/3/2018, 5:16:41 PM<br><strong>Message</strong>: <pre>Patch Set 10: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20694/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20694/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/20694

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12383/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/12383

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/1100/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/1100</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 2/3/2018, 5:17:49 PM<br><strong>Message</strong>: <pre>Patch Set 10:

rebuild-x</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/3/2018, 5:19:51 PM<br><strong>Message</strong>: <pre>Patch Set 10: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/359/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/3/2018, 5:20:15 PM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20695/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/3/2018, 5:42:39 PM<br><strong>Message</strong>: <pre>Patch Set 10: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/359/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/359

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20695/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/20695</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 2/3/2018, 5:56:43 PM<br><strong>Message</strong>: <pre>Patch Set 10: Code-Review+2</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 2/3/2018, 7:16:04 PM<br><strong>Message</strong>: <pre>Patch Set 10:

(1 comment)</pre><strong>Reviewer</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Reviewed</strong>: 2/5/2018, 9:02:57 AM<br><strong>Message</strong>: <pre>Uploaded patch set 11.</pre><strong>Reviewer</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Reviewed</strong>: 2/5/2018, 9:03:14 AM<br><strong>Message</strong>: <pre>Patch Set 11:

(1 comment)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/5/2018, 9:03:27 AM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20699/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/5/2018, 9:04:04 AM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12387/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/5/2018, 9:04:55 AM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/1104/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/5/2018, 9:31:47 AM<br><strong>Message</strong>: <pre>Patch Set 11: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20699/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20699/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/20699

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12387/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/12387

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/1104/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/1104</pre><strong>Reviewer</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Reviewed</strong>: 2/5/2018, 10:07:12 AM<br><strong>Message</strong>: <pre>Patch Set 11:

rebuild-x</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/5/2018, 10:09:29 AM<br><strong>Message</strong>: <pre>Patch Set 11: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/376/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/5/2018, 10:09:49 AM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20716/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/5/2018, 10:40:49 AM<br><strong>Message</strong>: <pre>Patch Set 11: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/376/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/376

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20716/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/20716</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 2/5/2018, 1:15:58 PM<br><strong>Message</strong>: <pre>Patch Set 11: Code-Review+2</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 2/5/2018, 3:55:51 PM<br><strong>Message</strong>: <pre>Patch Set 11: Code-Review+2</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 2/5/2018, 3:55:57 PM<br><strong>Message</strong>: <pre>Change has been successfully merged by David Enyeart</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/5/2018, 4:42:56 PM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-merge-x86_64/3145/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-x86_64/3145

https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/1817/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-end-2-end-x86_64/1817</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Uploader</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Created</strong>: 1/2/2018, 8:20:22 AM<br><strong>UnmergedRevision</strong>: [a492de670d31e3211cfdd7a8415c11806c7502df](https://github.com/hyperledger-gerrit-archive/fabric/commit/a492de670d31e3211cfdd7a8415c11806c7502df)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/2/2018, 9:09:32 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Uploader</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Created</strong>: 1/2/2018, 1:09:01 PM<br><strong>UnmergedRevision</strong>: [e242de6d8e3413319cda095162b04cff897bc7d4](https://github.com/hyperledger-gerrit-archive/fabric/commit/e242de6d8e3413319cda095162b04cff897bc7d4)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/2/2018, 2:20:32 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Uploader</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Created</strong>: 1/20/2018, 12:12:12 PM<br><strong>UnmergedRevision</strong>: [716d12262fc8ae8596adbb2fe88cdcc4e8b4383b](https://github.com/hyperledger-gerrit-archive/fabric/commit/716d12262fc8ae8596adbb2fe88cdcc4e8b4383b)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/20/2018, 12:39:46 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Approved</strong>: 1/30/2018, 9:48:49 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/util/couchdb/couchdb.go#L285](https://github.com/hyperledger-gerrit-archive/fabric/blob/716d12262fc8ae8596adbb2fe88cdcc4e8b4383b/core/ledger/util/couchdb/couchdb.go#L285)<br><strong>Comment</strong>: <pre>This would add two sets of retries, the existing retries within handleRequest() and this one.  I don't think we need the new retries, I think that overly complicates it.  I think if the handleRequest() returns an error (due to couch db getting created between retries), then we can detect that after the handleRequest() in the pre-existing error handling code.  I think simply calling a final GetDatabaseInfo() within the error handling block is all that is needed.  If we can query for the database at that point, then all is good and we can ignore the error that came back from handleRequest(). If we still cant query for the database at that point, then go ahead and return the error that came back from handleRequest().

Does that make sense, or am I over simplifying it?</pre><strong>Commenter</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/util/couchdb/couchdb.go#L285](https://github.com/hyperledger-gerrit-archive/fabric/blob/716d12262fc8ae8596adbb2fe88cdcc4e8b4383b/core/ledger/util/couchdb/couchdb.go#L285)<br><strong>Comment</strong>: <pre>All of the changes originally in this CR tie together.  The change in retry logic allow for one pass without retry.   I treated this as a special case originally.    I have changed this to your suggestion and removed the retry logic changes.  I will open a separate defect.</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/util/couchdb/couchdb.go#L707](https://github.com/hyperledger-gerrit-archive/fabric/blob/716d12262fc8ae8596adbb2fe88cdcc4e8b4383b/core/ledger/util/couchdb/couchdb.go#L707)<br><strong>Comment</strong>: <pre>Message needs to indicate nil resp.</pre><strong>Commenter</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/util/couchdb/couchdb.go#L707](https://github.com/hyperledger-gerrit-archive/fabric/blob/716d12262fc8ae8596adbb2fe88cdcc4e8b4383b/core/ledger/util/couchdb/couchdb.go#L707)<br><strong>Comment</strong>: <pre>Removed pending new CR for retry logic.</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/util/couchdb/couchdb.go#L1500](https://github.com/hyperledger-gerrit-archive/fabric/blob/716d12262fc8ae8596adbb2fe88cdcc4e8b4383b/core/ledger/util/couchdb/couchdb.go#L1500)<br><strong>Comment</strong>: <pre>This change of allowing maxRetries of 0 isn't related to the core problem being solved in this CR is it? If not, I'd suggest put in a separate CR to avoid confusion.</pre><strong>Commenter</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/util/couchdb/couchdb.go#L1500](https://github.com/hyperledger-gerrit-archive/fabric/blob/716d12262fc8ae8596adbb2fe88cdcc4e8b4383b/core/ledger/util/couchdb/couchdb.go#L1500)<br><strong>Comment</strong>: <pre>Removed pending new CR for retry logic.</pre></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Uploader</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Created</strong>: 1/31/2018, 9:20:06 AM<br><strong>UnmergedRevision</strong>: [173f27a3c9cafa6c596525f72b810fd75d85adc8](https://github.com/hyperledger-gerrit-archive/fabric/commit/173f27a3c9cafa6c596525f72b810fd75d85adc8)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/31/2018, 9:34:05 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/util/couchdb/couchdb.go#L273](https://github.com/hyperledger-gerrit-archive/fabric/blob/173f27a3c9cafa6c596525f72b810fd75d85adc8/core/ledger/util/couchdb/couchdb.go#L273)<br><strong>Comment</strong>: <pre>This if statement can be removed. We already returned the err above if it was not a 404 error.  In any other scenario we want to proceed with the create database below, therefore no need for this if statement.

This is a standard Go practice... avoid extra ifs and indents if possible, have the main path code read top-down in the function, and handle unexpected situations with a return or break or continue to exit from the main path.</pre><strong>Commenter</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/util/couchdb/couchdb.go#L273](https://github.com/hyperledger-gerrit-archive/fabric/blob/173f27a3c9cafa6c596525f72b810fd75d85adc8/core/ledger/util/couchdb/couchdb.go#L273)<br><strong>Comment</strong>: <pre>I agree with the standard Go practice, but we still need an If condition here.   If the database is confirmed to exist, then we do not want to attempt to create the database.  I can make this more readable and conform better to standard Go practices.</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/util/couchdb/couchdb.go#L293](https://github.com/hyperledger-gerrit-archive/fabric/blob/173f27a3c9cafa6c596525f72b810fd75d85adc8/core/ledger/util/couchdb/couchdb.go#L293)<br><strong>Comment</strong>: <pre>Since the scenario that we are trying to handle is not intuitive, let's add more comments here.  For example:

// Even though handleRequest() returned an error, the
// database may have been created and a false error
// returned due to a timeout or race condition.
// Do a final check to see if the database really got created.</pre><strong>Commenter</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/util/couchdb/couchdb.go#L293](https://github.com/hyperledger-gerrit-archive/fabric/blob/173f27a3c9cafa6c596525f72b810fd75d85adc8/core/ledger/util/couchdb/couchdb.go#L293)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/util/couchdb/couchdb.go#L302](https://github.com/hyperledger-gerrit-archive/fabric/blob/173f27a3c9cafa6c596525f72b810fd75d85adc8/core/ledger/util/couchdb/couchdb.go#L302)<br><strong>Comment</strong>: <pre>If the handleRequest() error was legit, that is, the database really didn't get created, then we should return the original handleRequest() error here, not the GetDatabaseInfo() error.  So need to use two different variables instead of "err".</pre><strong>Commenter</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/util/couchdb/couchdb.go#L302](https://github.com/hyperledger-gerrit-archive/fabric/blob/173f27a3c9cafa6c596525f72b810fd75d85adc8/core/ledger/util/couchdb/couchdb.go#L302)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/util/couchdb/couchdb.go#L315](https://github.com/hyperledger-gerrit-archive/fabric/blob/173f27a3c9cafa6c596525f72b810fd75d85adc8/core/ledger/util/couchdb/couchdb.go#L315)<br><strong>Comment</strong>: <pre>I checked the callers of CreateDatabaseIfNotExist.  None of them referenced the dbResponse.  Therefore let's use this opportunity to remove it and remove that confusion, from here and from the newly added code above.</pre><strong>Commenter</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/util/couchdb/couchdb.go#L315](https://github.com/hyperledger-gerrit-archive/fabric/blob/173f27a3c9cafa6c596525f72b810fd75d85adc8/core/ledger/util/couchdb/couchdb.go#L315)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 5</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Uploader</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Created</strong>: 1/31/2018, 4:25:00 PM<br><strong>UnmergedRevision</strong>: [96903aeced0508eb01c2e5f43387811bf3d666ad](https://github.com/hyperledger-gerrit-archive/fabric/commit/96903aeced0508eb01c2e5f43387811bf3d666ad)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/31/2018, 4:52:37 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/util/couchdb/couchdb.go#L308](https://github.com/hyperledger-gerrit-archive/fabric/blob/96903aeced0508eb01c2e5f43387811bf3d666ad/core/ledger/util/couchdb/couchdb.go#L308)<br><strong>Comment</strong>: <pre>This is also corrected,  the check should be if errDbInfo == nil.  In that case, the database exists.</pre><strong>Commenter</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/util/couchdb/couchdb.go#L309](https://github.com/hyperledger-gerrit-archive/fabric/blob/96903aeced0508eb01c2e5f43387811bf3d666ad/core/ledger/util/couchdb/couchdb.go#L309)<br><strong>Comment</strong>: <pre>Changed to an info statement that the database was created.</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/util/couchdb/couchdb.go#L323](https://github.com/hyperledger-gerrit-archive/fabric/blob/96903aeced0508eb01c2e5f43387811bf3d666ad/core/ledger/util/couchdb/couchdb.go#L323)<br><strong>Comment</strong>: <pre>I realize this part is not new, but let's think through this. Seems strange to check the response just to log an Info message. 

Is it possible for handleRequest() to succeed, but get something other than Ok = true?  Probably not...

If that's the case, it seems to me that we don't need to do this check at all.

If handleRequest() returned success, then we could simply return success at that point (would still need to closeResponseBody() but wouldn't need to decode it).

If handleRequest() returned err, then we already have the final check in place for GetDatabaseInfo(), as the final determination.

I do want to keep the log Info when a DB is created, I just think we can do without the Ok check.</pre><strong>Commenter</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/util/couchdb/couchdb.go#L323](https://github.com/hyperledger-gerrit-archive/fabric/blob/96903aeced0508eb01c2e5f43387811bf3d666ad/core/ledger/util/couchdb/couchdb.go#L323)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 6</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Uploader</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Created</strong>: 2/1/2018, 10:43:10 AM<br><strong>UnmergedRevision</strong>: [45e870af416d5684e81b0df58e76c175d1bac860](https://github.com/hyperledger-gerrit-archive/fabric/commit/45e870af416d5684e81b0df58e76c175d1bac860)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/1/2018, 11:05:39 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 7</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Uploader</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Created</strong>: 2/1/2018, 11:28:12 AM<br><strong>UnmergedRevision</strong>: [46a1e7e69b7b5b51d3ed8cf6e46e392aea6efa42](https://github.com/hyperledger-gerrit-archive/fabric/commit/46a1e7e69b7b5b51d3ed8cf6e46e392aea6efa42)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/1/2018, 12:24:08 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 8</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Uploader</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Created</strong>: 2/2/2018, 10:13:07 AM<br><strong>UnmergedRevision</strong>: [218682590a992bfa24c31a98fe852b49c4d30a28](https://github.com/hyperledger-gerrit-archive/fabric/commit/218682590a992bfa24c31a98fe852b49c4d30a28)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/2/2018, 10:50:56 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 9</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Uploader</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Created</strong>: 2/2/2018, 10:57:23 AM<br><strong>UnmergedRevision</strong>: [e14441015ccc0505732198b5d9095481880aa321](https://github.com/hyperledger-gerrit-archive/fabric/commit/e14441015ccc0505732198b5d9095481880aa321)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/2/2018, 11:47:29 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Approved</strong>: 2/3/2018, 2:35:03 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 10</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Uploader</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Created</strong>: 2/3/2018, 5:01:59 PM<br><strong>UnmergedRevision</strong>: [067bd48314a3ecccf7f1edf31540e72984d77e77](https://github.com/hyperledger-gerrit-archive/fabric/commit/067bd48314a3ecccf7f1edf31540e72984d77e77)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/3/2018, 5:42:39 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Approved</strong>: 2/3/2018, 5:56:43 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/util/couchdb/couchdb.go#L274](https://github.com/hyperledger-gerrit-archive/fabric/blob/067bd48314a3ecccf7f1edf31540e72984d77e77/core/ledger/util/couchdb/couchdb.go#L274)<br><strong>Comment</strong>: <pre>in line 305 you simply check for `err == nil` to conclude that the db exists. If that check is sufficient, it would simplify the code here by returning after line 266 after a check of `err == nil` or you missed to add this elaborate check at line 305?</pre><strong>Commenter</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/util/couchdb/couchdb.go#L274](https://github.com/hyperledger-gerrit-archive/fabric/blob/067bd48314a3ecccf7f1edf31540e72984d77e77/core/ledger/util/couchdb/couchdb.go#L274)<br><strong>Comment</strong>: <pre>That is a good catch.  I added additional checks at line 305 to ensure the same level of checking to make sure the database was successfully created.</pre></blockquote><h3>PatchSet Number: 11</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Uploader</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Created</strong>: 2/5/2018, 9:02:57 AM<br><strong>GitHubMergedRevision</strong>: [c0b6e8cd9a83f6f7a891b357853cb8e067fcadc1](https://github.com/hyperledger-gerrit-archive/fabric/commit/c0b6e8cd9a83f6f7a891b357853cb8e067fcadc1)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/5/2018, 10:40:49 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Approved</strong>: 2/5/2018, 1:15:58 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Approved</strong>: 2/5/2018, 3:55:51 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: David Enyeart<br><strong>Merged</strong>: 2/5/2018, 3:55:57 PM<br><br></blockquote>