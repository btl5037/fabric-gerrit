<strong>Project</strong>: fabric<br><strong>Branch</strong>: master<br><strong>ID</strong>: 3025<br><strong>Subject</strong>: Rework of MSP (config and factories)<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Assignee</strong>:<br><strong>Created</strong>: 12/6/2016, 11:48:56 AM<br><strong>LastUpdated</strong>: 12/8/2016, 11:24:57 AM<br><strong>CommitMessage</strong>:<br><pre>Rework of MSP (config and factories)

This change-set introduces a local MSP and per-chain MSPs for the peer to use.
The local MSP is configured from local config files and is used to get the
signing identity for the peer. Per-chain MSPs are used on each chain to
validate creators/signatures on the various messages. Additionally, in
msp/configfilegenerator there is a sample program file that shows how the
client config may be built out of certificates and keys. It can be removed
later on but it is useful for now to show how to construct that file.

Change-Id: Id9b92a96800a67b27124cc98a6228ad3e03f531a
Signed-off-by: Alessandro Sorniotti <ale.linux@sopit.net>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 12/6/2016, 11:48:56 AM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/6/2016, 11:54:47 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/3715/</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 12/6/2016, 11:59:13 AM<br><strong>Message</strong>: <pre>Uploaded patch set 2.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/6/2016, 12:03:44 PM<br><strong>Message</strong>: <pre>Patch Set 1: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/3715/ : FAILURE</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/6/2016, 12:03:45 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/3719/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/6/2016, 12:44:00 PM<br><strong>Message</strong>: <pre>Patch Set 2: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/3719/ : SUCCESS</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 12/7/2016, 5:37:23 AM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/7/2016, 5:38:27 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/3738/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/7/2016, 6:13:38 AM<br><strong>Message</strong>: <pre>Patch Set 3: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/3738/ : SUCCESS</pre><strong>Reviewer</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>Reviewed</strong>: 12/7/2016, 7:24:08 AM<br><strong>Message</strong>: <pre>Patch Set 3: Code-Review+1

(1 comment)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 12/7/2016, 7:25:18 AM<br><strong>Message</strong>: <pre>Patch Set 3:

(1 comment)</pre><strong>Reviewer</strong>: Elli Androulaki - lli@zurich.ibm.com<br><strong>Reviewed</strong>: 12/7/2016, 8:50:20 AM<br><strong>Message</strong>: <pre>Patch Set 3:

(9 comments)

Hi,

Thanks Ale! Just few comments.

With kind regards,
Elli</pre><strong>Reviewer</strong>: Elli Androulaki - lli@zurich.ibm.com<br><strong>Reviewed</strong>: 12/7/2016, 8:50:39 AM<br><strong>Message</strong>: <pre>Patch Set 3: Code-Review+1

Sorry, aimed to +1 it.</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 12/7/2016, 10:19:55 AM<br><strong>Message</strong>: <pre>Patch Set 3:

(2 comments)

So this is definitely starting to look much better.  Had a couple of comments / questions and can you also go back through Elli and Angelo's comments and mark which ones are done?</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 12/7/2016, 12:27:45 PM<br><strong>Message</strong>: <pre>Patch Set 3:

(9 comments)

Thanks Gari and Elli, please see my responses below. Wdyt?</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 12/7/2016, 1:12:24 PM<br><strong>Message</strong>: <pre>Patch Set 3:

(1 comment)</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 12/7/2016, 1:12:59 PM<br><strong>Message</strong>: <pre>Patch Set 3:

(1 comment)</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 12/7/2016, 1:15:28 PM<br><strong>Message</strong>: <pre>Patch Set 3: Code-Review+2

(1 comment)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 12/8/2016, 4:35:46 AM<br><strong>Message</strong>: <pre>Uploaded patch set 4.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/8/2016, 4:37:12 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/3765/</pre><strong>Reviewer</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>Reviewed</strong>: 12/8/2016, 4:39:36 AM<br><strong>Message</strong>: <pre>Patch Set 4: Code-Review+1

Thanks :)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 12/8/2016, 4:57:38 AM<br><strong>Message</strong>: <pre>Uploaded patch set 5.</pre><strong>Reviewer</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>Reviewed</strong>: 12/8/2016, 5:01:28 AM<br><strong>Message</strong>: <pre>Patch Set 5: Code-Review+1

Thanks</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/8/2016, 5:02:49 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/3768/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/8/2016, 5:25:27 AM<br><strong>Message</strong>: <pre>Patch Set 4: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/3765/ : SUCCESS</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/8/2016, 5:44:30 AM<br><strong>Message</strong>: <pre>Patch Set 5: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/3768/ : SUCCESS</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 12/8/2016, 7:54:05 AM<br><strong>Message</strong>: <pre>Patch Set 5: Code-Review+2</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 12/8/2016, 10:27:07 AM<br><strong>Message</strong>: <pre>Patch Set 5: Code-Review-1

After discussions with Binh and Murali, I would like to put in some more stuff before it's merged. -1'ing it so it doesn't get merged too early - thx</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 12/8/2016, 10:36:22 AM<br><strong>Message</strong>: <pre>Patch Set 5: Code-Review-1

Looks good but a bit of reorg needed.

Basically now that we are close to create chain via join, CSCC is managing the structures for the chain. Better leave the MSPManager with those chain structures than have the msp package manage it. It also helps simplify the msp package (which is common to both peer and orderer).
   .</pre><strong>Reviewer</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>Reviewed</strong>: 12/8/2016, 10:42:14 AM<br><strong>Message</strong>: <pre>Patch Set 5: Code-Review+2

Discussed with Ale on additional changes but we'll get that in with another CR.</pre><strong>Reviewer</strong>: Gerrit Code Review - gerrit@hyperledger.org<br><strong>Reviewed</strong>: 12/8/2016, 10:42:38 AM<br><strong>Message</strong>: <pre>Change has been successfully merged by Binh Nguyen</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/8/2016, 10:46:36 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-x86_64/520/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/8/2016, 11:24:57 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-merge-x86_64/520/ : SUCCESS</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 12/6/2016, 11:48:56 AM<br><strong>UnmergedRevision</strong>: [c69901fe85affdc71c76c955476eb25a71fe7f90](https://github.com/hyperledger-gerrit-archive/fabric/commit/c69901fe85affdc71c76c955476eb25a71fe7f90)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/6/2016, 12:03:44 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 12/6/2016, 11:59:13 AM<br><strong>UnmergedRevision</strong>: [f9d6cc1408648c2e4f36c3a5b192a22d0689e691](https://github.com/hyperledger-gerrit-archive/fabric/commit/f9d6cc1408648c2e4f36c3a5b192a22d0689e691)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/6/2016, 12:44:00 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Elli Androulaki - lli@zurich.ibm.com<br><strong>CommentLine</strong>: [msp/msp.go#L72](https://github.com/hyperledger-gerrit-archive/fabric/blob/f9d6cc1408648c2e4f36c3a5b192a22d0689e691/msp/msp.go#L72)<br><strong>Comment</strong>: <pre>Not immediately related to this changeset, but maybe we rename this to AffiliationChain()/OrganizationUnits()?</pre><strong>Commenter</strong>: Elli Androulaki - lli@zurich.ibm.com<br><strong>CommentLine</strong>: [msp/peermsp.go#L59](https://github.com/hyperledger-gerrit-archive/fabric/blob/f9d6cc1408648c2e4f36c3a5b192a22d0689e691/msp/peermsp.go#L59)<br><strong>Comment</strong>: <pre>Shall we remove the Policy function?</pre></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 12/7/2016, 5:37:23 AM<br><strong>UnmergedRevision</strong>: [b58507575f38d260bbe40bb15cd54205d6e7def6](https://github.com/hyperledger-gerrit-archive/fabric/commit/b58507575f38d260bbe40bb15cd54205d6e7def6)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/7/2016, 6:13:38 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>Approved</strong>: 12/7/2016, 7:24:08 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Approved</strong>: 12/7/2016, 1:15:28 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Elli Androulaki - lli@zurich.ibm.com<br><strong>Approved</strong>: 12/7/2016, 8:50:39 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Elli Androulaki - lli@zurich.ibm.com<br><strong>CommentLine</strong>: [core/peer/msgvalidation.go#L125](https://github.com/hyperledger-gerrit-archive/fabric/blob/b58507575f38d260bbe40bb15cd54205d6e7def6/core/peer/msgvalidation.go#L125)<br><strong>Comment</strong>: <pre>So, does the chainid needs to be in the arguments of this function? 

I understand we would need this for the creator to fetch the appropriate manager, but since the manager is already retrieved from the previous command cant we leverage it to check identity validity? 
And i can hear your follow-up comment on this "Would we still need an identity.Validate() function"? 

In general, would it make sense that the deserialization of the identity adds a pointer inside the identity structure of the MSP it belongs to? Then Validate could be easily done, without the need to pass the chainid. But maybe too complex..</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/peer/msgvalidation.go#L125](https://github.com/hyperledger-gerrit-archive/fabric/blob/b58507575f38d260bbe40bb15cd54205d6e7def6/core/peer/msgvalidation.go#L125)<br><strong>Comment</strong>: <pre>Actually that's a pretty good suggestion, I'll implement it (identity keeps reference of its manager). At least we don't need to pass the chainid in as an argument. But I think Validate() is still required, right? Unless you are suggesting that we do the validation internally when we call DeserializeIdentity?</pre><strong>Commenter</strong>: Elli Androulaki - lli@zurich.ibm.com<br><strong>CommentLine</strong>: [core/peer/msgvalidation.go#L324](https://github.com/hyperledger-gerrit-archive/fabric/blob/b58507575f38d260bbe40bb15cd54205d6e7def6/core/peer/msgvalidation.go#L324)<br><strong>Comment</strong>: <pre>Similar comment as above: do we need to get the chainid, or are we supposed to be already in a chain-specific context?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/peer/msgvalidation.go#L324](https://github.com/hyperledger-gerrit-archive/fabric/blob/b58507575f38d260bbe40bb15cd54205d6e7def6/core/peer/msgvalidation.go#L324)<br><strong>Comment</strong>: <pre>I think we still need to pass it in here because checkSignatureFromCreator deserializes the identity and needs to know which chain manager to use. But of course your comment would apply to the call to Validate() issued by checkSignatureFromCreator, which I will change according to your previous comment</pre><strong>Commenter</strong>: Elli Androulaki - lli@zurich.ibm.com<br><strong>CommentLine</strong>: [msp/bccspmsp.go#L101](https://github.com/hyperledger-gerrit-archive/fabric/blob/b58507575f38d260bbe40bb15cd54205d6e7def6/msp/bccspmsp.go#L101)<br><strong>Comment</strong>: <pre>Good question. Perhaps this field is updated after the object is created;For example, this can be part of the certificate data ( a hash of the public key, or a dedicated field inside the certificate).</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [msp/bccspmsp.go#L101](https://github.com/hyperledger-gerrit-archive/fabric/blob/b58507575f38d260bbe40bb15cd54205d6e7def6/msp/bccspmsp.go#L101)<br><strong>Comment</strong>: <pre>Yup. I think we need to stick a pin in it for now (if you also agree) because it's not clear what this identity should be. As soon as it's clear, we can revisit. Does that make sense?</pre><strong>Commenter</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>CommentLine</strong>: [msp/configfilegenerator/generatesamplepeerconfig.go#L74](https://github.com/hyperledger-gerrit-archive/fabric/blob/b58507575f38d260bbe40bb15cd54205d6e7def6/msp/configfilegenerator/generatesamplepeerconfig.go#L74)<br><strong>Comment</strong>: <pre>I'm not sure that it really matters one way or another, but was there a reason why you chose using encoded bytes within the JSON rather than outputting a more natural JSON structure?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [msp/configfilegenerator/generatesamplepeerconfig.go#L74](https://github.com/hyperledger-gerrit-archive/fabric/blob/b58507575f38d260bbe40bb15cd54205d6e7def6/msp/configfilegenerator/generatesamplepeerconfig.go#L74)<br><strong>Comment</strong>: <pre>No real reason tbh... I can change it either way</pre><strong>Commenter</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>CommentLine</strong>: [msp/configfilegenerator/generatesamplepeerconfig.go#L74](https://github.com/hyperledger-gerrit-archive/fabric/blob/b58507575f38d260bbe40bb15cd54205d6e7def6/msp/configfilegenerator/generatesamplepeerconfig.go#L74)<br><strong>Comment</strong>: <pre>let's leave it for now - does not hurt anything and I like using a utility to generate it.  We can revisit if needed</pre><strong>Commenter</strong>: Elli Androulaki - lli@zurich.ibm.com<br><strong>CommentLine</strong>: [msp/msp.go#L72](https://github.com/hyperledger-gerrit-archive/fabric/blob/b58507575f38d260bbe40bb15cd54205d6e7def6/msp/msp.go#L72)<br><strong>Comment</strong>: <pre>Shall we rename this to OrganizationUnits() or Affiliations()?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [msp/msp.go#L72](https://github.com/hyperledger-gerrit-archive/fabric/blob/b58507575f38d260bbe40bb15cd54205d6e7def6/msp/msp.go#L72)<br><strong>Comment</strong>: <pre>Either one is fine for me - you pick! :)</pre><strong>Commenter</strong>: Elli Androulaki - lli@zurich.ibm.com<br><strong>CommentLine</strong>: [msp/mspconfigschema.go#L23](https://github.com/hyperledger-gerrit-archive/fabric/blob/b58507575f38d260bbe40bb15cd54205d6e7def6/msp/mspconfigschema.go#L23)<br><strong>Comment</strong>: <pre>So,  you may want to rename this to NodeLocalConfig, as orderers can also leverage this config struct (with additional/optional fields)</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [msp/mspconfigschema.go#L23](https://github.com/hyperledger-gerrit-archive/fabric/blob/b58507575f38d260bbe40bb15cd54205d6e7def6/msp/mspconfigschema.go#L23)<br><strong>Comment</strong>: <pre>Good point, will do!</pre><strong>Commenter</strong>: Elli Androulaki - lli@zurich.ibm.com<br><strong>CommentLine</strong>: [msp/mspconfigschema.go#L27](https://github.com/hyperledger-gerrit-archive/fabric/blob/b58507575f38d260bbe40bb15cd54205d6e7def6/msp/mspconfigschema.go#L27)<br><strong>Comment</strong>: <pre>Actually here we may need only an MSPConfig, since for the beginning we will only have one local MSP per node:)</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [msp/mspconfigschema.go#L27](https://github.com/hyperledger-gerrit-archive/fabric/blob/b58507575f38d260bbe40bb15cd54205d6e7def6/msp/mspconfigschema.go#L27)<br><strong>Comment</strong>: <pre>Yup, I agree! And as a matter of fact I could even remove MSPManagerConfig and just have the manager take an array of MSPConfig refs - wdyt?</pre><strong>Commenter</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>CommentLine</strong>: [msp/mspmanagerhandler.go#L46](https://github.com/hyperledger-gerrit-archive/fabric/blob/b58507575f38d260bbe40bb15cd54205d6e7def6/msp/mspmanagerhandler.go#L46)<br><strong>Comment</strong>: <pre>Shall we have a fatal log here in case of error? It the BCCSP-based MSP cannot be instantiated there is no way to continue. No?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [msp/mspmanagerhandler.go#L46](https://github.com/hyperledger-gerrit-archive/fabric/blob/b58507575f38d260bbe40bb15cd54205d6e7def6/msp/mspmanagerhandler.go#L46)<br><strong>Comment</strong>: <pre>Good point, I'll add it - thx!</pre><strong>Commenter</strong>: Elli Androulaki - lli@zurich.ibm.com<br><strong>CommentLine</strong>: [msp/peermsp.go#L59](https://github.com/hyperledger-gerrit-archive/fabric/blob/b58507575f38d260bbe40bb15cd54205d6e7def6/msp/peermsp.go#L59)<br><strong>Comment</strong>: <pre>Shall we remove this policy field?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [msp/peermsp.go#L59](https://github.com/hyperledger-gerrit-archive/fabric/blob/b58507575f38d260bbe40bb15cd54205d6e7def6/msp/peermsp.go#L59)<br><strong>Comment</strong>: <pre>Will do!</pre><strong>Commenter</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>CommentLine</strong>: [peer/main.go#L137](https://github.com/hyperledger-gerrit-archive/fabric/blob/b58507575f38d260bbe40bb15cd54205d6e7def6/peer/main.go#L137)<br><strong>Comment</strong>: <pre>I am not sure why we need to call this "setupfake..." ?  Minimally, isn't this the intended way to set up the local peer identity?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [peer/main.go#L137](https://github.com/hyperledger-gerrit-archive/fabric/blob/b58507575f38d260bbe40bb15cd54205d6e7def6/peer/main.go#L137)<br><strong>Comment</strong>: <pre>So the point is the following (and I might need your help on how to phrase it clearly in the comments): in order to function when it comes to both generating signatures and also validating signatures, the peer process needs i) a local MSP (to generate sigs) and ii) one MSP manager per chain (to verify certs/sigs for txes on that chain). Support for the local MSP is ready right now. However, per-chain managers are still not created when a chain is created (I don't even know if there is full support for chain creation in the current master). So then the problem is that when we get a tx on the fake test chain we use for testing purposes, we need a manager for that chain which currently isn't created automatically. SetupFake... basically sets up the local MSP and an MSP for the fake test chain we use for CI tests (and with the CLI/SDK etc) so that we don't break all that. It's only a temp workaround until chain creation also creates an MSP manager. Does that make sense?</pre><strong>Commenter</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>CommentLine</strong>: [peer/main.go#L137](https://github.com/hyperledger-gerrit-archive/fabric/blob/b58507575f38d260bbe40bb15cd54205d6e7def6/peer/main.go#L137)<br><strong>Comment</strong>: <pre>okay - got it.  thanks for the detailed explanation.  I kinda thought this was the case and now I get the approach</pre><strong>Commenter</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>CommentLine</strong>: [peer/main.go#L137](https://github.com/hyperledger-gerrit-archive/fabric/blob/b58507575f38d260bbe40bb15cd54205d6e7def6/peer/main.go#L137)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 12/8/2016, 4:35:46 AM<br><strong>UnmergedRevision</strong>: [7b9ba6dc1723882641d12d06f58b3acaa2fa064d](https://github.com/hyperledger-gerrit-archive/fabric/commit/7b9ba6dc1723882641d12d06f58b3acaa2fa064d)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/8/2016, 5:25:27 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>Approved</strong>: 12/8/2016, 4:39:36 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 5</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 12/8/2016, 4:57:38 AM<br><strong>GitHubMergedRevision</strong>: [96637cf8f6f3c518d5fead6b9d9b9dbf5afddac8](https://github.com/hyperledger-gerrit-archive/fabric/commit/96637cf8f6f3c518d5fead6b9d9b9dbf5afddac8)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/8/2016, 5:44:30 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>Approved</strong>: 12/8/2016, 10:42:14 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Binh Nguyen<br><strong>Merged</strong>: 12/8/2016, 10:42:38 AM<br><br><strong>Approver</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Approved</strong>: 12/8/2016, 10:36:22 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>Approved</strong>: 12/8/2016, 5:01:28 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Approved</strong>: 12/8/2016, 10:27:07 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Approved</strong>: 12/8/2016, 7:54:05 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br></blockquote>