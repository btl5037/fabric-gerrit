<strong>Project</strong>: fabric</br><strong>Branch</strong>: master<br><strong>ID</strong>: 11151<br><strong>Subject</strong>: [FAB-5004] Improve UT coverage of orderer/configupdate<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Assignee</strong>:<strong>Created</strong>: 6/26/2017, 11:18:38 AM<br><strong>LastUpdated</strong>: 7/17/2017, 6:00:17 PM<br><strong>CommitMessage</strong>:<br><pre>[FAB-5004] Improve UT coverage of orderer/configupdate

Change-Id: I667d5597f81c9f78cc3967e2216598e7d45a13f0
Signed-off-by: Jay Guo <guojiannan1101@gmail.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 6/26/2017, 11:18:38 AM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/26/2017, 11:18:46 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/9468/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/26/2017, 11:20:18 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/5318/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/26/2017, 11:24:01 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/7867/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/26/2017, 11:24:08 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/13815/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/26/2017, 11:58:46 AM<br><strong>Message</strong>: <pre>Patch Set 1: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/13815/ : FAILURE

Logs: https://logs.hyperledger.org/jobbuilder/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/13815

https://jenkins.hyperledger.org/job/fabric-verify-z/9468/ : SUCCESS

Logs: https://logs.hyperledger.org/jobbuilder/vex-yul-hyp-jenkins-1/fabric-verify-z/9468

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/5318/ : SUCCESS

Logs: https://logs.hyperledger.org/jobbuilder/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/5318

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/7867/ : SUCCESS

Logs: https://logs.hyperledger.org/jobbuilder/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/7867</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 6/26/2017, 11:20:01 PM<br><strong>Message</strong>: <pre>Patch Set 1:

reverify</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/26/2017, 11:20:09 PM<br><strong>Message</strong>: <pre>Patch Set 1: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/9481/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/26/2017, 11:22:11 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/5331/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/26/2017, 11:22:29 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/7880/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/26/2017, 11:23:04 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/13828/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/27/2017, 1:41:05 AM<br><strong>Message</strong>: <pre>Patch Set 1: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-z/9481/ : SUCCESS

Logs: https://logs.hyperledger.org/jobbuilder/vex-yul-hyp-jenkins-1/fabric-verify-z/9481

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/5331/ : SUCCESS

Logs: https://logs.hyperledger.org/jobbuilder/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/5331

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/7880/ : SUCCESS

Logs: https://logs.hyperledger.org/jobbuilder/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/7880

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/13828/ : SUCCESS

Logs: https://logs.hyperledger.org/jobbuilder/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/13828</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 7/9/2017, 5:14:25 PM<br><strong>Message</strong>: <pre>Patch Set 1: Code-Review+1

I'm not sure I agree with the multiple assertions per single test. I understand that the original code does that as well, but in my mind every assertion should --at a minimum -- be a sub-test, i.e. t.Run().

Does my take go against common sense or standard testing practices? If so, don't hesitate to drop the science on me.

At any rate, +1 for me since the changeset delivers on what it's supposed to, but my observation above stands.

Jason wrote the configeupdate package originally so the final take is his.</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 7/10/2017, 12:02:20 AM<br><strong>Message</strong>: <pre>Patch Set 1: Code-Review+2

This works for me.</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 7/10/2017, 1:07:48 AM<br><strong>Message</strong>: <pre>Patch Set 1:

> I'm not sure I agree with the multiple assertions per single test.
 > I understand that the original code does that as well, but in my
 > mind every assertion should --at a minimum -- be a sub-test, i.e.
 > t.Run().
 > 
 > Does my take go against common sense or standard testing practices?
 > If so, don't hesitate to drop the science on me.
 > 
 > At any rate, +1 for me since the changeset delivers on what it's
 > supposed to, but my observation above stands.
 > 
 > Jason wrote the configeupdate package originally so the final take
 > is his.

I agree that one assertion per test is easier to reason about and we should strive to write tests in such fashion.

However, sometimes we are asserting preconditions towards the end goal, a->b->c. Putting three assertions into separate unit tests would result running `a` three times and `b` two times, which slows the test.

In general, I think it depends on the code logic to test. For b<-a->c, I tend to have two tests for {ab} and {ac}, whereas for a->b->c, I think one test {abc} would be sufficient.

Furthermore, I think it's OK to have multiple assertions at the end to test expected results, e.g. fields in http response.

Ultimately, I'd like to have multiple `expect` and single `assertion` in one test, if we use some other test frameworks like ginkgo.

Hope this makes sense to you.</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 7/10/2017, 8:06:43 AM<br><strong>Message</strong>: <pre>Patch Set 1: Code-Review+2

> Hope this makes sense to you.

It does. You're right, I stand corrected.</pre><strong>Reviewer</strong>: Gerrit Code Review - gerrit@hyperledger.org<br><strong>Reviewed</strong>: 7/17/2017, 4:06:24 PM<br><strong>Message</strong>: <pre>Change has been successfully merged by Christopher Ferris</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 7/17/2017, 4:23:46 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-behave-x86_64/1270/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 7/17/2017, 4:32:05 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-x86_64/2278/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 7/17/2017, 4:32:13 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/960/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 7/17/2017, 4:41:32 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-z/1791/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 7/17/2017, 6:00:17 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-merge-behave-x86_64/1270/ : SUCCESS

Logs: https://logs.hyperledger.org/jobbuilder/vex-yul-hyp-jenkins-1/fabric-merge-behave-x86_64/1270

https://jenkins.hyperledger.org/job/fabric-merge-x86_64/2278/ : SUCCESS

Logs: https://logs.hyperledger.org/jobbuilder/vex-yul-hyp-jenkins-1/fabric-merge-x86_64/2278

https://jenkins.hyperledger.org/job/fabric-merge-z/1791/ : SUCCESS

Logs: https://logs.hyperledger.org/jobbuilder/vex-yul-hyp-jenkins-1/fabric-merge-z/1791

https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/960/ : SUCCESS

Logs: https://logs.hyperledger.org/jobbuilder/vex-yul-hyp-jenkins-1/fabric-merge-end-2-end-x86_64/960</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Uploader</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Created</strong>: 1498490318<br><strong>GitHubRevision</strong>: [fad8282139f47f9d400f1c41802289a0661dd940](https://github.com/hyperledger/fabric/commit/fad8282139f47f9d400f1c41802289a0661dd940)<br><br><strong>MergedBy</strong>: Christopher Ferris<br><strong>Merged</strong>: 7/17/2017, 4:06:24 PM<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 6/27/2017, 1:41:05 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Approved</strong>: 7/10/2017, 8:06:43 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Approved</strong>: 7/10/2017, 12:02:20 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br></blockquote>