<strong>Project</strong>: fabric<br><strong>Branch</strong>: master<br><strong>ID</strong>: 26342<br><strong>Subject</strong>: [FAB-12027] fix a base UT func<br><strong>Status</strong>: ABANDONED<br><strong>Owner</strong>: Ping Huang - norberthu30@gmail.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 9/17/2018, 10:00:27 AM<br><strong>LastUpdated</strong>: 9/19/2018, 10:44:39 AM<br><strong>CommitMessage</strong>:<br><pre>[FAB-12027] fix a base UT func

Change-Id: I1decdcdb148067c0bdacbaf7d07e65b5d97fc109
Signed-off-by: ping40 <norberthu30@gmail.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Ping Huang - norberthu30@gmail.com<br><strong>Reviewed</strong>: 9/17/2018, 10:00:27 AM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/17/2018, 10:03:33 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/5248/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/17/2018, 10:04:29 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/17/2018, 10:11:45 AM<br><strong>Message</strong>: <pre>Patch Set 1: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run SmokeTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/17/2018, 10:12:26 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/5248/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/5248</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/17/2018, 10:15:53 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-smoke-tests-x86_64/3441/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/17/2018, 10:16:22 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting smoke tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/17/2018, 10:35:45 AM<br><strong>Message</strong>: <pre>Patch Set 1: F2-SmokeTest+1

Succeeded, Run UnitTest, Run IntegrationTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/17/2018, 10:40:04 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/4713/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/17/2018, 10:40:39 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/2131/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/17/2018, 10:40:48 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/17/2018, 10:41:48 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/17/2018, 10:55:47 AM<br><strong>Message</strong>: <pre>Patch Set 1: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/17/2018, 10:57:22 AM<br><strong>Message</strong>: <pre>Patch Set 1: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/17/2018, 10:58:07 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-smoke-tests-x86_64/3441/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-smoke-tests-x86_64/3441

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/4713/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/4713

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/2131/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/2131</pre><strong>Reviewer</strong>: Christopher Ferris - chris.ferris@gmail.com<br><strong>Reviewed</strong>: 9/17/2018, 11:18:03 AM<br><strong>Message</strong>: <pre>Patch Set 1: Code-Review+2</pre><strong>Reviewer</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Reviewed</strong>: 9/17/2018, 12:25:50 PM<br><strong>Message</strong>: <pre>Patch Set 1: Code-Review-1

Logic looks wrong.</pre><strong>Reviewer</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Reviewed</strong>: 9/17/2018, 12:38:51 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(2 comments)

I appreciate that we're trying to fix an issue but this CR hasn't really made a functional difference as if either actual or expected were a proto.Message, the proto.Equal method would have returned the "correct" answer.

What really needs to happen here is for the function to be refactored to make more sense and be less verbose and magical.

switch {
    case expected == actual:
    case proto.Equal(expected, actual):
    case reflect.DeepEqual(expected, actual):
    case matchJSON(expected, actual): // implement as appropriate
    default:
        return t.Fatalf(...)
}</pre><strong>Reviewer</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Reviewed</strong>: 9/17/2018, 12:46:37 PM<br><strong>Message</strong>: <pre>Patch Set 1:

> Patch Set 1:

Stepping back even further, is there a reason why we can't just use testify's assert package instead of what's here? About 60% of the file would probably disappear.

/cc Manish</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 9/17/2018, 2:15:23 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Yes, we need to retire this test_util.go file. I had written this in 0.6 days when testify was not "discovered" :-)

Beyond what Matt highlights, there are other issues with these equality checks. There is Jira that I had opened for this and can be used to get rid of this file in the favor of testify.</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 9/17/2018, 2:16:26 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Forgot to refer the Jira in previous message - https://jira.hyperledger.org/browse/FAB-10686</pre><strong>Reviewer</strong>: Ping Huang - norberthu30@gmail.com<br><strong>Reviewed</strong>: 9/17/2018, 8:42:19 PM<br><strong>Message</strong>: <pre>Patch Set 1:

I modified the unit test and didn't get expected result, so I found the bug: 


func TestQueryResultHelper_Hash_OneLevel(t *testing.T) {
	maxDegree := 3
	kvReads := buildTestKVReads(t, 9)  ----> 9 changes to 90
	....
}</pre><strong>Reviewer</strong>: Ping Huang - norberthu30@gmail.com<br><strong>Reviewed</strong>: 9/17/2018, 9:41:29 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(1 comment)</pre><strong>Reviewer</strong>: Christopher Ferris - chris.ferris@gmail.com<br><strong>Reviewed</strong>: 9/18/2018, 10:30:34 AM<br><strong>Message</strong>: <pre>Removed Code-Review+2 by Christopher Ferris <chris.ferris@gmail.com>
</pre><strong>Reviewer</strong>: Ping Huang - norberthu30@gmail.com<br><strong>Reviewed</strong>: 9/18/2018, 8:21:29 PM<br><strong>Message</strong>: <pre>Abandoned</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 9/19/2018, 10:44:39 AM<br><strong>Message</strong>: <pre>Patch Set 1:

not sure why you abandoned this. At least, there was a bug getting fixed in this at this line https://gerrit.hyperledger.org/r/#/c/26342/1/common/ledger/testutil/test_util.go@69.

I was under impression that you are going to submit a patch taking care of @Matt's suggestion in the same CR. You are welcome to include Matt's changes but I am fine if you just want to submit a thinner patch with only one line change (that I highlighted above). At least, that will fix an obvious bug that got caught.</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ping Huang - norberthu30@gmail.com<br><strong>Uploader</strong>: Ping Huang - norberthu30@gmail.com<br><strong>Created</strong>: 1537192827<br><strong>UnmergedRevision</strong>: 3cb5b58f442c70ff7dbb68463a781002c5bae741<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/17/2018, 10:11:45 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/17/2018, 10:11:45 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/17/2018, 10:35:45 AM<br><strong>Type</strong>: F2-SmokeTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/17/2018, 10:55:47 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/17/2018, 10:57:22 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Approved</strong>: 9/17/2018, 12:25:50 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br></blockquote>