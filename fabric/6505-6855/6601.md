<strong>Project</strong>: fabric<br><strong>Branch</strong>: master<br><strong>ID</strong>: 6601<br><strong>Subject</strong>: BCCSP Filebased Keystore flexible file names<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Volodymyr Paprotski - vpaprots@ca.ibm.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 2/27/2017, 7:16:53 PM<br><strong>LastUpdated</strong>: 2/28/2017, 1:21:13 AM<br><strong>CommitMessage</strong>:<br><pre>BCCSP Filebased Keystore flexible file names

Pem files are very useful to be used directly by users. Lets make
the file names more human-readable.

Change-Id: I14d41d2f2e0c163b5cb1a15ef5ba26f0bd779285
Signed-off-by: Volodymyr Paprotski <vpaprots@ca.ibm.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Volodymyr Paprotski - vpaprots@ca.ibm.com<br><strong>Reviewed</strong>: 2/27/2017, 7:16:53 PM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/27/2017, 7:21:19 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7790/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/27/2017, 8:30:13 PM<br><strong>Message</strong>: <pre>Patch Set 1: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7790/ : SUCCESS</pre><strong>Reviewer</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>Reviewed</strong>: 2/27/2017, 11:22:03 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(1 comment)</pre><strong>Reviewer</strong>: Volodymyr Paprotski - vpaprots@ca.ibm.com<br><strong>Reviewed</strong>: 2/27/2017, 11:44:33 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(1 comment)</pre><strong>Reviewer</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>Reviewed</strong>: 2/27/2017, 11:45:44 PM<br><strong>Message</strong>: <pre>Patch Set 1: Code-Review+2</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 2/27/2017, 11:50:10 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(3 comments)</pre><strong>Reviewer</strong>: Volodymyr Paprotski - vpaprots@ca.ibm.com<br><strong>Reviewed</strong>: 2/28/2017, 12:04:23 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(3 comments)</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 2/28/2017, 12:11:56 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(2 comments)</pre><strong>Reviewer</strong>: Volodymyr Paprotski - vpaprots@ca.ibm.com<br><strong>Reviewed</strong>: 2/28/2017, 12:17:12 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(2 comments)</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 2/28/2017, 12:18:26 AM<br><strong>Message</strong>: <pre>Patch Set 1: Code-Review+2

(1 comment)</pre><strong>Reviewer</strong>: Gerrit Code Review - gerrit@hyperledger.org<br><strong>Reviewed</strong>: 2/28/2017, 12:18:29 AM<br><strong>Message</strong>: <pre>Change has been successfully merged by Jason Yellick</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/28/2017, 12:22:21 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-x86_64/1216/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/28/2017, 1:21:13 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-merge-x86_64/1216/ : SUCCESS</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Volodymyr Paprotski - vpaprots@ca.ibm.com<br><strong>Uploader</strong>: Volodymyr Paprotski - vpaprots@ca.ibm.com<br><strong>Created</strong>: 2/27/2017, 7:16:53 PM<br><strong>GitHubMergedRevision</strong>: [d953960504fe2ec301cb4adfe57789088670d669](https://github.com/hyperledger-gerrit-archive/fabric/commit/d953960504fe2ec301cb4adfe57789088670d669)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/27/2017, 8:30:13 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Approved</strong>: 2/28/2017, 12:18:26 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Jason Yellick<br><strong>Merged</strong>: 2/28/2017, 12:18:29 AM<br><br><strong>Approver</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>Approved</strong>: 2/27/2017, 11:45:44 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [bccsp/pkcs11/fileks.go#L195](https://github.com/hyperledger-gerrit-archive/fabric/blob/d953960504fe2ec301cb4adfe57789088670d669/bccsp/pkcs11/fileks.go#L195)<br><strong>Comment</strong>: <pre>Why are we ignoring this error?</pre><strong>Commenter</strong>: Volodymyr Paprotski - vpaprots@ca.ibm.com<br><strong>CommentLine</strong>: [bccsp/pkcs11/fileks.go#L195](https://github.com/hyperledger-gerrit-archive/fabric/blob/d953960504fe2ec301cb4adfe57789088670d669/bccsp/pkcs11/fileks.go#L195)<br><strong>Comment</strong>: <pre>Good point. Though to be honest, I think it still works and returns an error at the end of the function, since the loop will not run.

Got this loop from getSuffix() in this file, same problem, seems to work there for a while now. Can fix both, or really, just make sure "files" var is set to nil.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [bccsp/pkcs11/fileks.go#L195](https://github.com/hyperledger-gerrit-archive/fabric/blob/d953960504fe2ec301cb4adfe57789088670d669/bccsp/pkcs11/fileks.go#L195)<br><strong>Comment</strong>: <pre>Ah, I guess in this particular case, because ReadDir returns a slice of interfaces and not just an interface, it should most likely be okay to ignore the error.  Still, it's bad form, and you can consider that perhaps the list was partially generated and an error returned, or some other scenario where we would not be capturing the error despite our best intentions.

My preference would be to fix throughout, but we can defer this for another CR if you'd like.</pre><strong>Commenter</strong>: Volodymyr Paprotski - vpaprots@ca.ibm.com<br><strong>CommentLine</strong>: [bccsp/pkcs11/fileks.go#L195](https://github.com/hyperledger-gerrit-archive/fabric/blob/d953960504fe2ec301cb4adfe57789088670d669/bccsp/pkcs11/fileks.go#L195)<br><strong>Comment</strong>: <pre>I think this one blocking things, lets fix drop it in and address it as part of separate CR. Thanks</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [bccsp/pkcs11/fileks.go#L195](https://github.com/hyperledger-gerrit-archive/fabric/blob/d953960504fe2ec301cb4adfe57789088670d669/bccsp/pkcs11/fileks.go#L195)<br><strong>Comment</strong>: <pre>Agreed.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [bccsp/pkcs11/fileks.go#L197](https://github.com/hyperledger-gerrit-archive/fabric/blob/d953960504fe2ec301cb4adfe57789088670d669/bccsp/pkcs11/fileks.go#L197)<br><strong>Comment</strong>: <pre>If we are filtering out directories, should we also be filtering out files with the wrong extension?</pre><strong>Commenter</strong>: Volodymyr Paprotski - vpaprots@ca.ibm.com<br><strong>CommentLine</strong>: [bccsp/pkcs11/fileks.go#L197](https://github.com/hyperledger-gerrit-archive/fabric/blob/d953960504fe2ec301cb4adfe57789088670d669/bccsp/pkcs11/fileks.go#L197)<br><strong>Comment</strong>: <pre>I figure PEM parsing is sufficient filtering. If somebody wants efficiency (i.e. has 10/100/1k keys in the keystore somehow.. ) they can use the *_sk naming still. That one does do a directory traversal in getSuffix() but at least does not open every single file..</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [bccsp/pkcs11/fileks.go#L197](https://github.com/hyperledger-gerrit-archive/fabric/blob/d953960504fe2ec301cb4adfe57789088670d669/bccsp/pkcs11/fileks.go#L197)<br><strong>Comment</strong>: <pre>It seems like restricting the search to '.pem' files in the future might be the right thing to do.  Still, as you point out, this shouldn't create wrong results, so I'm okay for now.</pre><strong>Commenter</strong>: Volodymyr Paprotski - vpaprots@ca.ibm.com<br><strong>CommentLine</strong>: [bccsp/pkcs11/fileks.go#L197](https://github.com/hyperledger-gerrit-archive/fabric/blob/d953960504fe2ec301cb4adfe57789088670d669/bccsp/pkcs11/fileks.go#L197)<br><strong>Comment</strong>: <pre>Makes sense. I was thinking that since we already set precedent of creating _sk files without extension, enforcing *pem might be a bit inconsistent.. anyway, neither is wrong really right now and fits the use case we need</pre><strong>Commenter</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>CommentLine</strong>: [bccsp/sw/fileks.go#L225](https://github.com/hyperledger-gerrit-archive/fabric/blob/d953960504fe2ec301cb4adfe57789088670d669/bccsp/sw/fileks.go#L225)<br><strong>Comment</strong>: <pre>The pkcs11 has almost the same function. Should 1 call the other to reduce code dup?</pre><strong>Commenter</strong>: Volodymyr Paprotski - vpaprots@ca.ibm.com<br><strong>CommentLine</strong>: [bccsp/sw/fileks.go#L225](https://github.com/hyperledger-gerrit-archive/fabric/blob/d953960504fe2ec301cb4adfe57789088670d669/bccsp/sw/fileks.go#L225)<br><strong>Comment</strong>: <pre>The pkcs11 code has a lot of intentional dups right now. Its still work in progress. Eventually the pkcs11 copy will disappear, once I finish the pkcs11 support</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [bccsp/sw/fileks.go#L227](https://github.com/hyperledger-gerrit-archive/fabric/blob/d953960504fe2ec301cb4adfe57789088670d669/bccsp/sw/fileks.go#L227)<br><strong>Comment</strong>: <pre>Same comments as the other function Binh points out.</pre><strong>Commenter</strong>: Volodymyr Paprotski - vpaprots@ca.ibm.com<br><strong>CommentLine</strong>: [bccsp/sw/fileks.go#L227](https://github.com/hyperledger-gerrit-archive/fabric/blob/d953960504fe2ec301cb4adfe57789088670d669/bccsp/sw/fileks.go#L227)<br><strong>Comment</strong>: <pre>see my reply to Binh. WIP for pkcs11</pre></blockquote>