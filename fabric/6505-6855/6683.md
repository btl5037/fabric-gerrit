<strong>Project</strong>: fabric<br><strong>Branch</strong>: master<br><strong>ID</strong>: 6683<br><strong>Subject</strong>: FAB-2531 Range queries fail iterating beyond 100 items<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 3/1/2017, 12:53:21 PM<br><strong>LastUpdated</strong>: 3/8/2017, 9:55:39 AM<br><strong>CommitMessage</strong>:<br><pre>FAB-2531 Range queries fail iterating beyond 100 items

This is a temporary stabilization change until the following issue is
resolved and will prevent errors in queries for the beta:
FAB-2462 - Re-introduce paging for range queries and rich queries

Peer sends 100 results to shim.
When shim asks for 101st item, the request for the next 100 goes
back to peer and it fails due to a closed iterator.

This change also sets the HasMore flag on query result sets to
false.  This will prevent the requery from being called by the
shim and throwing an exception.

Purpose of this change is to stabilize the behavior for the
beta by setting a query size limit in core.yaml at 10000.

Then use the query size limit in the CouchDB query and in
the chaincode handler.

Added changes to chaincodetest.yaml to match core.yaml.

Added unit test cases for the new querylimit option.

Change-Id: I772d1f87beec2296db2eed68a0528181ac1ddeca
Signed-off-by: Chris Elder <chris.elder@us.ibm.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Reviewed</strong>: 3/1/2017, 12:53:21 PM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/1/2017, 12:57:12 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7872/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/1/2017, 1:23:27 PM<br><strong>Message</strong>: <pre>Patch Set 1: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7872/ : FAILURE</pre><strong>Reviewer</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Reviewed</strong>: 3/1/2017, 2:23:32 PM<br><strong>Message</strong>: <pre>Patch Set 1:

reverify</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/1/2017, 2:27:06 PM<br><strong>Message</strong>: <pre>Patch Set 1: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7877/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/1/2017, 3:03:31 PM<br><strong>Message</strong>: <pre>Patch Set 1: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7877/ : FAILURE</pre><strong>Reviewer</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Reviewed</strong>: 3/1/2017, 3:22:53 PM<br><strong>Message</strong>: <pre>Uploaded patch set 2: Patch Set 1 was rebased.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/1/2017, 3:26:20 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7879/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/1/2017, 3:45:15 PM<br><strong>Message</strong>: <pre>Patch Set 2: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7879/ : FAILURE</pre><strong>Reviewer</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Reviewed</strong>: 3/2/2017, 10:27:15 AM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/2/2017, 10:31:40 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7951/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/2/2017, 11:39:13 AM<br><strong>Message</strong>: <pre>Patch Set 3: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/7951/ : SUCCESS</pre><strong>Reviewer</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Reviewed</strong>: 3/6/2017, 5:02:16 PM<br><strong>Message</strong>: <pre>Uploaded patch set 4.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/6/2017, 5:06:26 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/8277/</pre><strong>Reviewer</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Reviewed</strong>: 3/6/2017, 5:07:42 PM<br><strong>Message</strong>: <pre>Uploaded patch set 5.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/6/2017, 5:11:43 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/8278/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/6/2017, 5:22:27 PM<br><strong>Message</strong>: <pre>Patch Set 4: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/8277/ : FAILURE</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/6/2017, 6:51:48 PM<br><strong>Message</strong>: <pre>Patch Set 5: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/8278/ : SUCCESS</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 3/7/2017, 6:17:01 AM<br><strong>Message</strong>: <pre>Patch Set 5:

(14 comments)</pre><strong>Reviewer</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Reviewed</strong>: 3/7/2017, 8:55:53 AM<br><strong>Message</strong>: <pre>Uploaded patch set 6.</pre><strong>Reviewer</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Reviewed</strong>: 3/7/2017, 8:56:19 AM<br><strong>Message</strong>: <pre>Patch Set 6:

(14 comments)

Added changes and retested.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/7/2017, 8:57:16 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/8322/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/7/2017, 10:11:16 AM<br><strong>Message</strong>: <pre>Patch Set 6: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/8322/ : SUCCESS</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 3/7/2017, 10:24:31 AM<br><strong>Message</strong>: <pre>Patch Set 6:

(3 comments)</pre><strong>Reviewer</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Reviewed</strong>: 3/7/2017, 11:04:41 AM<br><strong>Message</strong>: <pre>Patch Set 6:

(3 comments)</pre><strong>Reviewer</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Reviewed</strong>: 3/7/2017, 11:05:39 AM<br><strong>Message</strong>: <pre>Uploaded patch set 7.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/7/2017, 11:09:11 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/8330/</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 3/7/2017, 11:17:14 AM<br><strong>Message</strong>: <pre>Patch Set 7: Code-Review+1</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/7/2017, 11:59:13 AM<br><strong>Message</strong>: <pre>Patch Set 7: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/8330/ : SUCCESS</pre><strong>Reviewer</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>Reviewed</strong>: 3/7/2017, 5:38:15 PM<br><strong>Message</strong>: <pre>Patch Set 7: Code-Review+2</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 3/8/2017, 8:51:02 AM<br><strong>Message</strong>: <pre>Patch Set 7: Code-Review+2

Thanks, Chris.</pre><strong>Reviewer</strong>: Gerrit Code Review - gerrit@hyperledger.org<br><strong>Reviewed</strong>: 3/8/2017, 8:51:10 AM<br><strong>Message</strong>: <pre>Change has been successfully merged by Srinivasan Muralidharan</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/8/2017, 8:53:59 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-x86_64/1324/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/8/2017, 9:55:39 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-merge-x86_64/1324/ : SUCCESS</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Uploader</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Created</strong>: 3/1/2017, 12:53:21 PM<br><strong>UnmergedRevision</strong>: [24578c228c15b9f7b64d784bbd0900e1ca261bb9](https://github.com/hyperledger-gerrit-archive/fabric/commit/24578c228c15b9f7b64d784bbd0900e1ca261bb9)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 3/1/2017, 3:03:31 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Uploader</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Created</strong>: 3/1/2017, 3:22:53 PM<br><strong>UnmergedRevision</strong>: [636476be8bb66e4b17d43da2c87fd48b2c973c91](https://github.com/hyperledger-gerrit-archive/fabric/commit/636476be8bb66e4b17d43da2c87fd48b2c973c91)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 3/1/2017, 3:45:15 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Uploader</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Created</strong>: 3/2/2017, 10:27:15 AM<br><strong>UnmergedRevision</strong>: [c387f20b731abfbbd4d75412a0e52b542c88cea0](https://github.com/hyperledger-gerrit-archive/fabric/commit/c387f20b731abfbbd4d75412a0e52b542c88cea0)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 3/2/2017, 11:39:13 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Uploader</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Created</strong>: 3/6/2017, 5:02:16 PM<br><strong>UnmergedRevision</strong>: [f0fcf0f65b2f8d57adc03040f01269e3c6deb525](https://github.com/hyperledger-gerrit-archive/fabric/commit/f0fcf0f65b2f8d57adc03040f01269e3c6deb525)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 3/6/2017, 5:22:27 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 5</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Uploader</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Created</strong>: 3/6/2017, 5:07:42 PM<br><strong>UnmergedRevision</strong>: [2db3de6fddb28c20152200a92b63fd1875871c40](https://github.com/hyperledger-gerrit-archive/fabric/commit/2db3de6fddb28c20152200a92b63fd1875871c40)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 3/6/2017, 6:51:48 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/exectransaction_test.go#L932](https://github.com/hyperledger-gerrit-archive/fabric/blob/2db3de6fddb28c20152200a92b63fd1875871c40/core/chaincode/exectransaction_test.go#L932)<br><strong>Comment</strong>: <pre>This comment is an old copy/paste mistake.  Add comment describing this test.</pre><strong>Commenter</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/exectransaction_test.go#L932](https://github.com/hyperledger-gerrit-archive/fabric/blob/2db3de6fddb28c20152200a92b63fd1875871c40/core/chaincode/exectransaction_test.go#L932)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/exectransaction_test.go#L1079](https://github.com/hyperledger-gerrit-archive/fabric/blob/2db3de6fddb28c20152200a92b63fd1875871c40/core/chaincode/exectransaction_test.go#L1079)<br><strong>Comment</strong>: <pre>Mention specifically that this tests queryLimit, which may change in the future to a batch 'paging' design.</pre><strong>Commenter</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/exectransaction_test.go#L1079](https://github.com/hyperledger-gerrit-archive/fabric/blob/2db3de6fddb28c20152200a92b63fd1875871c40/core/chaincode/exectransaction_test.go#L1079)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/exectransaction_test.go#L1082](https://github.com/hyperledger-gerrit-archive/fabric/blob/2db3de6fddb28c20152200a92b63fd1875871c40/core/chaincode/exectransaction_test.go#L1082)<br><strong>Comment</strong>: <pre>Mention that this should return 10 marbles.  marble1 through marble7, plus marbles 10,11,12.  Actually would be better for a unit test to be more straightforward, that is, not include the confusing marbles 10, 11, 12 (it is not immediately obvious that those would be included in the range).</pre><strong>Commenter</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/exectransaction_test.go#L1082](https://github.com/hyperledger-gerrit-archive/fabric/blob/2db3de6fddb28c20152200a92b63fd1875871c40/core/chaincode/exectransaction_test.go#L1082)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/exectransaction_test.go#L1097](https://github.com/hyperledger-gerrit-archive/fabric/blob/2db3de6fddb28c20152200a92b63fd1875871c40/core/chaincode/exectransaction_test.go#L1097)<br><strong>Comment</strong>: <pre>Mention that query limit defaulted to 10000 and therefore there was no limit applied on the first query.</pre><strong>Commenter</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/exectransaction_test.go#L1097](https://github.com/hyperledger-gerrit-archive/fabric/blob/2db3de6fddb28c20152200a92b63fd1875871c40/core/chaincode/exectransaction_test.go#L1097)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/handler.go#L722](https://github.com/hyperledger-gerrit-archive/fabric/blob/2db3de6fddb28c20152200a92b63fd1875871c40/core/chaincode/handler.go#L722)<br><strong>Comment</strong>: <pre>If queryLimit was hit, need to log a Warning so that the admin knows why actual results do not match expected results.</pre><strong>Commenter</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/handler.go#L722](https://github.com/hyperledger-gerrit-archive/fabric/blob/2db3de6fddb28c20152200a92b63fd1875871c40/core/chaincode/handler.go#L722)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/handler.go#L824](https://github.com/hyperledger-gerrit-archive/fabric/blob/2db3de6fddb28c20152200a92b63fd1875871c40/core/chaincode/handler.go#L824)<br><strong>Comment</strong>: <pre>If queryLimit was hit, need to log a Warning so that the admin knows why actual results do not match expected results.</pre><strong>Commenter</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/handler.go#L824](https://github.com/hyperledger-gerrit-archive/fabric/blob/2db3de6fddb28c20152200a92b63fd1875871c40/core/chaincode/handler.go#L824)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/handler.go#L1005](https://github.com/hyperledger-gerrit-archive/fabric/blob/2db3de6fddb28c20152200a92b63fd1875871c40/core/chaincode/handler.go#L1005)<br><strong>Comment</strong>: <pre>If queryLimit was hit, need to log a Warning so that the admin knows why actual results do not match expected results.</pre><strong>Commenter</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/handler.go#L1005](https://github.com/hyperledger-gerrit-archive/fabric/blob/2db3de6fddb28c20152200a92b63fd1875871c40/core/chaincode/handler.go#L1005)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/handler.go#L1120](https://github.com/hyperledger-gerrit-archive/fabric/blob/2db3de6fddb28c20152200a92b63fd1875871c40/core/chaincode/handler.go#L1120)<br><strong>Comment</strong>: <pre>If queryLimit was hit, need to log a Warning so that the admin knows why actual results do not match expected results.</pre><strong>Commenter</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/handler.go#L1120](https://github.com/hyperledger-gerrit-archive/fabric/blob/2db3de6fddb28c20152200a92b63fd1875871c40/core/chaincode/handler.go#L1120)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/query_wrapper.go#L45](https://github.com/hyperledger-gerrit-archive/fabric/blob/2db3de6fddb28c20152200a92b63fd1875871c40/core/ledger/kvledger/txmgmt/statedb/statecouchdb/query_wrapper.go#L45)<br><strong>Comment</strong>: <pre>Mention that limit is based on config, and that skip is not currently used.</pre><strong>Commenter</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/query_wrapper.go#L45](https://github.com/hyperledger-gerrit-archive/fabric/blob/2db3de6fddb28c20152200a92b63fd1875871c40/core/ledger/kvledger/txmgmt/statedb/statecouchdb/query_wrapper.go#L45)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/query_wrapper_test.go#L31](https://github.com/hyperledger-gerrit-archive/fabric/blob/2db3de6fddb28c20152200a92b63fd1875871c40/core/ledger/kvledger/txmgmt/statedb/statecouchdb/query_wrapper_test.go#L31)<br><strong>Comment</strong>: <pre>Do you want to switch these all to 10000 since the default queryLimit is now 10000?</pre><strong>Commenter</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/query_wrapper_test.go#L31](https://github.com/hyperledger-gerrit-archive/fabric/blob/2db3de6fddb28c20152200a92b63fd1875871c40/core/ledger/kvledger/txmgmt/statedb/statecouchdb/query_wrapper_test.go#L31)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L222](https://github.com/hyperledger-gerrit-archive/fabric/blob/2db3de6fddb28c20152200a92b63fd1875871c40/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L222)<br><strong>Comment</strong>: <pre>Better to use a variable for skip and set to 0, and at the same time have a comment stating that skip is not currently used.</pre><strong>Commenter</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L222](https://github.com/hyperledger-gerrit-archive/fabric/blob/2db3de6fddb28c20152200a92b63fd1875871c40/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L222)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [examples/chaincode/go/marbles02/marbles_chaincode.go#L553](https://github.com/hyperledger-gerrit-archive/fabric/blob/2db3de6fddb28c20152200a92b63fd1875871c40/examples/chaincode/go/marbles02/marbles_chaincode.go#L553)<br><strong>Comment</strong>: <pre>I was careful to put the functions in order of increasing complexity and described the considerations for each type of query as a comment before the function.  
Place this one directly before transferMarblesBasedOnColor and copy/paste the transferMarblesBasedOnColor comment, making the obvious changes.  The important aspect is that this is a range query, similar to the partial composite key query in transferMarblesBasedOnColor, and therefore these types of queries can safely be used in update transactions. That part of the usage comment can be copied verbatim.</pre><strong>Commenter</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>CommentLine</strong>: [examples/chaincode/go/marbles02/marbles_chaincode.go#L553](https://github.com/hyperledger-gerrit-archive/fabric/blob/2db3de6fddb28c20152200a92b63fd1875871c40/examples/chaincode/go/marbles02/marbles_chaincode.go#L553)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [examples/chaincode/go/marbles02/marbles_chaincode.go#L568](https://github.com/hyperledger-gerrit-archive/fabric/blob/2db3de6fddb28c20152200a92b63fd1875871c40/examples/chaincode/go/marbles02/marbles_chaincode.go#L568)<br><strong>Comment</strong>: <pre>Actually for range queries these are 'QueryResults'</pre><strong>Commenter</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>CommentLine</strong>: [examples/chaincode/go/marbles02/marbles_chaincode.go#L568](https://github.com/hyperledger-gerrit-archive/fabric/blob/2db3de6fddb28c20152200a92b63fd1875871c40/examples/chaincode/go/marbles02/marbles_chaincode.go#L568)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [examples/chaincode/go/marbles02/marbles_chaincode.go#L574](https://github.com/hyperledger-gerrit-archive/fabric/blob/2db3de6fddb28c20152200a92b63fd1875871c40/examples/chaincode/go/marbles02/marbles_chaincode.go#L574)<br><strong>Comment</strong>: <pre>Actually for range queries the 2nd variable would be 'queryResultValue'.</pre><strong>Commenter</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>CommentLine</strong>: [examples/chaincode/go/marbles02/marbles_chaincode.go#L574](https://github.com/hyperledger-gerrit-archive/fabric/blob/2db3de6fddb28c20152200a92b63fd1875871c40/examples/chaincode/go/marbles02/marbles_chaincode.go#L574)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 6</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Uploader</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Created</strong>: 3/7/2017, 8:55:53 AM<br><strong>UnmergedRevision</strong>: [8ad78497967b6d0c143308014822bbe538f2028f](https://github.com/hyperledger-gerrit-archive/fabric/commit/8ad78497967b6d0c143308014822bbe538f2028f)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 3/7/2017, 10:11:16 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/exectransaction_test.go#L1100](https://github.com/hyperledger-gerrit-archive/fabric/blob/8ad78497967b6d0c143308014822bbe538f2028f/core/chaincode/exectransaction_test.go#L1100)<br><strong>Comment</strong>: <pre>"this query is effectively unlimited" is confusing.</pre><strong>Commenter</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/exectransaction_test.go#L1100](https://github.com/hyperledger-gerrit-archive/fabric/blob/8ad78497967b6d0c143308014822bbe538f2028f/core/chaincode/exectransaction_test.go#L1100)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/exectransaction_test.go#L1103](https://github.com/hyperledger-gerrit-archive/fabric/blob/8ad78497967b6d0c143308014822bbe538f2028f/core/chaincode/exectransaction_test.go#L1103)<br><strong>Comment</strong>: <pre>...should have returned 10...</pre><strong>Commenter</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/exectransaction_test.go#L1103](https://github.com/hyperledger-gerrit-archive/fabric/blob/8ad78497967b6d0c143308014822bbe538f2028f/core/chaincode/exectransaction_test.go#L1103)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [examples/chaincode/go/marbles02/marbles_chaincode.go#L338](https://github.com/hyperledger-gerrit-archive/fabric/blob/8ad78497967b6d0c143308014822bbe538f2028f/examples/chaincode/go/marbles02/marbles_chaincode.go#L338)<br><strong>Comment</strong>: <pre>Good.  Add more text here to clarify after the first line...
"Read-only function results are not typically submitted to ordering. If the read-only results are submitted to ordering, or if the query is used in an update transaction and submitted to ordering, then the committing peers will re-execute..."</pre><strong>Commenter</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>CommentLine</strong>: [examples/chaincode/go/marbles02/marbles_chaincode.go#L338](https://github.com/hyperledger-gerrit-archive/fabric/blob/8ad78497967b6d0c143308014822bbe538f2028f/examples/chaincode/go/marbles02/marbles_chaincode.go#L338)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 7</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Uploader</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Created</strong>: 3/7/2017, 11:05:39 AM<br><strong>GitHubMergedRevision</strong>: [0fc6c4df6855fed4c9a3c33a2535b0503f056325](https://github.com/hyperledger-gerrit-archive/fabric/commit/0fc6c4df6855fed4c9a3c33a2535b0503f056325)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 3/7/2017, 11:59:13 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>Approved</strong>: 3/7/2017, 5:38:15 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Approved</strong>: 3/8/2017, 8:51:02 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Srinivasan Muralidharan<br><strong>Merged</strong>: 3/8/2017, 8:51:10 AM<br><br><strong>Approver</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Approved</strong>: 3/7/2017, 11:17:14 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br></blockquote>