<strong>Project</strong>: fabric<br><strong>Branch</strong>: master<br><strong>ID</strong>: 28435<br><strong>Subject</strong>: FAB-13264 consensus migration: kafka2raft green path #1<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 12/31/2018, 11:47:49 AM<br><strong>LastUpdated</strong>: 1/30/2019, 12:31:14 PM<br><strong>CommitMessage</strong>:<br><pre>FAB-13264 consensus migration: kafka2raft green path #1

This is the first of four (1/4) sub-tasks that focus on the
"green" path of consensus-type migration from Kafka to Raft. 

By "green" we mean that there are no failures or aborts along
the way. The flow of the green path and the changes made in
these 4 tasks are described below. The 4 sub-tasks are staged
in a way that minimizes dependencies between them.

In this sub-task we introduce changes to the 
orderer/common/bootstrap package (see details below).
In essence, Just before the last config block of the system
channel (COMMIT) is written to the ledger, the bootstrap file
(a.k.a "genesis.block", do not confuse with the first block of
the ledger) is swapped with the last block of the system
channel. This sub-task extends package orderer/common/bootstrap
to support this functionality.

See respective JIRA item for further details.

The "green" path for migration is the following:

1. Start with a Kafka-based ordering service
2. Send a config update tx (START-TX) on the system channel that:
 - Has ConsensusType.MigrationState=START
 - This will disable the creation of new channels
 - This will disable the processing of normal (standard channel) transactions
3. Wait until the START-TX is committed and get the block height H of that tx
4. Send a config update tx (CONTEXT-TX) on each of the standard channels that:
 - Has ConsensusType.MigrationState=CONTEXT
 - Has ConsensusType.MigrationContext=H
 - Has ConsensusType.Type="etcdraft"
 - Has ConsensusType.Metadata=<a marshaled etcdraft metadata: Consenters,
   Options, etc>
5. Send a config update tx (COMMIT-TX) on the system channel that:
 - Has ConsensusType.MigrationState=COMMIT
 - Has ConsensusType.MigrationContext=H
 - Has ConsensusType.Type="etcdraft"
 - Has ConsensusType.Metadata=<a marshaled etcdraft metadata: Consenters,
   Options, etc>
 - The metadata should be the same as for the standard channels, with the same
   precautions.
 - If committed successfully, no further configuration will be possible
6. Restart each orderer
 - The orderer will bootstrap into an etcdraft mode
 - Each channel will form a cluster
 - Normal transactions can resume now
7. In order to configure the channels (system or standard), make sure that
   the first
   config update tx (on any given channel) after migration has:
 - Has ConsensusType.MigrationState=NONE
 - Has ConsensusType.MigrationS=NONE
 - In addition to other changes to the channel's config.

Change-Id: Iccd146bb7260bafa4e4d8c4ee457d2ac19f5a642
Signed-off-by: Yoav Tock <tock@il.ibm.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 12/31/2018, 11:47:49 AM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/31/2018, 11:51:14 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/8573/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/31/2018, 11:51:42 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/31/2018, 11:57:31 AM<br><strong>Message</strong>: <pre>Patch Set 1: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/31/2018, 11:58:23 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/8573/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/8573</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/31/2018, 11:59:56 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7540/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/31/2018, 12:00:27 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/31/2018, 12:00:53 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/4380/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/31/2018, 12:01:32 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/31/2018, 12:34:01 PM<br><strong>Message</strong>: <pre>Patch Set 1: F3-UnitTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/31/2018, 12:34:16 PM<br><strong>Message</strong>: <pre>Patch Set 1: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/31/2018, 12:35:07 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7540/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/7540

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/4380/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/4380</pre><strong>Reviewer</strong>: Sambhav Nidamarty - sambhavdutt@gmail.com<br><strong>Reviewed</strong>: 12/31/2018, 3:16:24 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Run UnitTest</pre><strong>Reviewer</strong>: Sambhav Nidamarty - sambhavdutt@gmail.com<br><strong>Reviewed</strong>: 12/31/2018, 3:16:27 PM<br><strong>Message</strong>: <pre>Removed reviewer Sambhav Nidamarty.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/31/2018, 3:20:25 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7541/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/31/2018, 3:20:55 PM<br><strong>Message</strong>: <pre>Patch Set 1: -F3-UnitTest

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/31/2018, 3:49:30 PM<br><strong>Message</strong>: <pre>Patch Set 1: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/31/2018, 3:50:16 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7541/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/7541</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 1/1/2019, 7:03:14 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(14 comments)

I did a mechanical code review, without going into the details. will read the code itself later :)</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/2/2019, 2:50:19 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(7 comments)

Thanks Yacov!</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/3/2019, 3:25:35 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(2 comments)</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/3/2019, 3:31:36 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(1 comment)</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/3/2019, 3:34:08 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(1 comment)</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/5/2019, 1:16:56 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(1 comment)</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/5/2019, 1:17:49 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(1 comment)</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/5/2019, 1:18:08 PM<br><strong>Message</strong>: <pre>Uploaded patch set 2.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/5/2019, 1:20:37 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/8643/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/5/2019, 1:21:08 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/5/2019, 1:27:22 PM<br><strong>Message</strong>: <pre>Patch Set 2: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/5/2019, 1:28:17 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/8643/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/8643</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/5/2019, 1:29:59 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7612/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/5/2019, 1:30:29 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/5/2019, 1:30:46 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/4433/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/5/2019, 1:31:23 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/5/2019, 1:41:32 PM<br><strong>Message</strong>: <pre>Patch Set 2: F3-UnitTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/5/2019, 2:02:04 PM<br><strong>Message</strong>: <pre>Patch Set 2: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/5/2019, 2:02:58 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7612/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/7612

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/4433/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/4433</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/5/2019, 3:53:46 PM<br><strong>Message</strong>: <pre>Uploaded patch set 3: Patch Set 2 was rebased.</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/5/2019, 3:54:26 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/5/2019, 3:57:39 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7615/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/5/2019, 3:58:15 PM<br><strong>Message</strong>: <pre>Patch Set 3: -F3-UnitTest

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/5/2019, 4:28:26 PM<br><strong>Message</strong>: <pre>Patch Set 3: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/5/2019, 4:29:15 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7615/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/7615</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/5/2019, 5:31:04 PM<br><strong>Message</strong>: <pre>Uploaded patch set 4.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/5/2019, 5:32:34 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/8646/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/5/2019, 5:33:04 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/5/2019, 5:35:05 PM<br><strong>Message</strong>: <pre>Patch Set 4: F1-VerifyBuild-1

code checks are failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/5/2019, 5:35:59 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/8646/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/8646</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/6/2019, 1:53:13 AM<br><strong>Message</strong>: <pre>Uploaded patch set 5.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/6/2019, 1:57:13 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/8649/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/6/2019, 1:57:41 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Starting verify build</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/6/2019, 1:57:58 AM<br><strong>Message</strong>: <pre>Patch Set 5:

@yacovm I addressed all your comments with the current patch. Thanks for the review!</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/6/2019, 2:02:57 AM<br><strong>Message</strong>: <pre>Patch Set 5: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/6/2019, 2:03:38 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/8649/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/8649</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/6/2019, 2:05:08 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7617/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/6/2019, 2:05:41 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/6/2019, 2:06:03 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/4435/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/6/2019, 2:06:38 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/6/2019, 2:37:17 AM<br><strong>Message</strong>: <pre>Patch Set 5: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/6/2019, 2:41:36 AM<br><strong>Message</strong>: <pre>Patch Set 5: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/6/2019, 2:42:31 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7617/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/7617

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/4435/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/4435</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 1/6/2019, 4:41:38 PM<br><strong>Message</strong>: <pre>Patch Set 5:

(13 comments)</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 1/6/2019, 7:36:35 PM<br><strong>Message</strong>: <pre>Patch Set 5:

(20 comments)</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 1/7/2019, 4:41:46 AM<br><strong>Message</strong>: <pre>Patch Set 5:

IMO, this is pretty big CR, over 1.7K of production LOC. Will it be possible to split it into smaller chunks?</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 1/7/2019, 4:44:40 AM<br><strong>Message</strong>: <pre>Patch Set 5:

This CR conflicts with the refactoring I've been working on, starting from https://gerrit.hyperledger.org/r/c/28345, and should be rebased atop (or the other way around). Let's discuss in scrum</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/7/2019, 6:27:08 AM<br><strong>Message</strong>: <pre>Patch Set 5:

(6 comments)</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/7/2019, 7:10:07 AM<br><strong>Message</strong>: <pre>Patch Set 5:

(3 comments)</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/7/2019, 7:40:03 AM<br><strong>Message</strong>: <pre>Patch Set 5:

(8 comments)</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/7/2019, 7:49:21 AM<br><strong>Message</strong>: <pre>Patch Set 5:

(3 comments)</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/7/2019, 7:49:54 AM<br><strong>Message</strong>: <pre>Patch Set 5:

> IMO, this is pretty big CR, over 1.7K of production LOC. Will it be
 > possible to split it into smaller chunks?</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/7/2019, 7:57:22 AM<br><strong>Message</strong>: <pre>Patch Set 5:

> > IMO, this is pretty big CR, over 1.7K of production LOC. Will it
 > be
 > > possible to split it into smaller chunks?

Note that 2.8K of these are auto generated mocks. 

"Only" 800 lines in "real" code not counting tests and mocks...

It would be hard to split without breaking the build, so I prefer to keep it this way.</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/7/2019, 8:11:06 AM<br><strong>Message</strong>: <pre>Patch Set 5:

(1 comment)</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 1/7/2019, 8:16:25 AM<br><strong>Message</strong>: <pre>Patch Set 5:

(1 comment)</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/7/2019, 9:21:23 AM<br><strong>Message</strong>: <pre>Patch Set 5:

(4 comments)</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/7/2019, 9:39:09 AM<br><strong>Message</strong>: <pre>Patch Set 5:

(1 comment)</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/7/2019, 9:46:18 AM<br><strong>Message</strong>: <pre>Patch Set 5:

(1 comment)</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/7/2019, 9:47:48 AM<br><strong>Message</strong>: <pre>Patch Set 5:

(1 comment)</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/7/2019, 10:42:42 AM<br><strong>Message</strong>: <pre>Patch Set 5:

(5 comments)</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/7/2019, 1:21:10 PM<br><strong>Message</strong>: <pre>Patch Set 5:

(1 comment)</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/7/2019, 2:04:44 PM<br><strong>Message</strong>: <pre>Uploaded patch set 6.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/7/2019, 2:09:35 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/8715/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/7/2019, 2:10:09 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/7/2019, 2:16:45 PM<br><strong>Message</strong>: <pre>Patch Set 6: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/7/2019, 2:17:33 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/8715/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/8715</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/7/2019, 2:20:29 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7669/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/7/2019, 2:21:01 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/7/2019, 2:21:08 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/4482/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/7/2019, 2:21:45 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/7/2019, 2:48:55 PM<br><strong>Message</strong>: <pre>Patch Set 6: F3-UnitTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/7/2019, 2:54:34 PM<br><strong>Message</strong>: <pre>Patch Set 6: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/7/2019, 2:55:18 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7669/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/7669

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/4482/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/4482</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/7/2019, 3:32:39 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/7/2019, 3:36:35 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7674/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/7/2019, 3:37:12 PM<br><strong>Message</strong>: <pre>Patch Set 6: -F3-UnitTest

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/7/2019, 3:56:33 PM<br><strong>Message</strong>: <pre>Patch Set 6: F3-UnitTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/7/2019, 3:57:20 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7674/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/7674</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/7/2019, 4:28:07 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/7/2019, 4:32:26 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7676/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/7/2019, 4:32:56 PM<br><strong>Message</strong>: <pre>Patch Set 6: -F3-UnitTest

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/7/2019, 4:47:45 PM<br><strong>Message</strong>: <pre>Patch Set 6: F3-UnitTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/7/2019, 4:48:34 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7676/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/7676</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 1/7/2019, 9:11:39 PM<br><strong>Message</strong>: <pre>Patch Set 6: Code-Review-1

(23 comments)

I'm nowhere near done (almost done with `registrar.go` and I'm going over the files in the order they appear in this CR) but I figured I'd post this review before I call it a day, even if it's incomplete.</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/8/2019, 9:22:02 AM<br><strong>Message</strong>: <pre>Patch Set 6:

(6 comments)</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/8/2019, 10:48:45 AM<br><strong>Message</strong>: <pre>Patch Set 6:

(11 comments)</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 1/8/2019, 1:09:46 PM<br><strong>Message</strong>: <pre>Patch Set 6: Code-Review-2

(19 comments)

Still not done (I have to go through the `etcdraft` and `kafka` packages), but I may as well push what I have for now, before I switch to another task.</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/9/2019, 8:18:35 AM<br><strong>Message</strong>: <pre>Patch Set 6:

(24 comments)

Thanks for the review! I will rebase and push a new patch shortly.</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/9/2019, 9:52:41 AM<br><strong>Message</strong>: <pre>Uploaded patch set 7.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/9/2019, 9:54:58 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/8777/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/9/2019, 9:55:29 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/9/2019, 10:00:23 AM<br><strong>Message</strong>: <pre>Patch Set 7: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/9/2019, 10:00:59 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/8777/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/8777</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/9/2019, 10:03:44 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7727/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/9/2019, 10:04:34 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/9/2019, 10:06:19 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/4530/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/9/2019, 10:07:04 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/9/2019, 10:38:54 AM<br><strong>Message</strong>: <pre>Patch Set 7: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/9/2019, 10:47:39 AM<br><strong>Message</strong>: <pre>Patch Set 7: F3-IntegrationTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/9/2019, 10:48:22 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/4530/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/4530

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7727/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/7727</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/9/2019, 11:05:59 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Run IntegrationTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/9/2019, 11:11:22 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/4536/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/9/2019, 11:12:03 AM<br><strong>Message</strong>: <pre>Patch Set 7: -F3-IntegrationTest

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/9/2019, 11:46:48 AM<br><strong>Message</strong>: <pre>Patch Set 7: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/9/2019, 11:47:36 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/4536/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/4536</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 1/9/2019, 11:14:36 PM<br><strong>Message</strong>: <pre>Patch Set 7:

(30 comments)

Still not done. Commented only on the parts that I had commented before.</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/10/2019, 6:24:49 AM<br><strong>Message</strong>: <pre>Patch Set 7:

(24 comments)

@kostats Thanks for the review! I really appreciate it. We are literally working around the clock.</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/10/2019, 6:39:49 AM<br><strong>Message</strong>: <pre>Uploaded patch set 8.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/10/2019, 6:45:25 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/8843/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/10/2019, 6:45:57 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/10/2019, 6:47:56 AM<br><strong>Message</strong>: <pre>Patch Set 8: F1-VerifyBuild-1

code checks are failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/10/2019, 6:49:05 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/8843/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/8843</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/10/2019, 6:59:19 AM<br><strong>Message</strong>: <pre>Uploaded patch set 9.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/10/2019, 7:03:05 AM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/8844/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/10/2019, 7:03:33 AM<br><strong>Message</strong>: <pre>Patch Set 9:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/10/2019, 7:08:28 AM<br><strong>Message</strong>: <pre>Patch Set 9: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/10/2019, 7:09:03 AM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/8844/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/8844</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/10/2019, 7:10:31 AM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7789/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/10/2019, 7:10:45 AM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/4592/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/10/2019, 7:11:04 AM<br><strong>Message</strong>: <pre>Patch Set 9:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/10/2019, 7:11:21 AM<br><strong>Message</strong>: <pre>Patch Set 9:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/10/2019, 7:25:18 AM<br><strong>Message</strong>: <pre>Patch Set 9: F3-UnitTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/10/2019, 7:46:28 AM<br><strong>Message</strong>: <pre>Patch Set 9: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/10/2019, 7:47:11 AM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7789/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/7789

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/4592/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/4592</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/10/2019, 10:18:17 AM<br><strong>Message</strong>: <pre>Patch Set 9:

Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/10/2019, 10:23:49 AM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7802/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/10/2019, 10:24:21 AM<br><strong>Message</strong>: <pre>Patch Set 9: -F3-UnitTest

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/10/2019, 10:39:52 AM<br><strong>Message</strong>: <pre>Patch Set 9: F3-UnitTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/10/2019, 10:40:48 AM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7802/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/7802</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/10/2019, 10:45:10 AM<br><strong>Message</strong>: <pre>Patch Set 9:

Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/10/2019, 10:48:35 AM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7804/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/10/2019, 10:49:06 AM<br><strong>Message</strong>: <pre>Patch Set 9: -F3-UnitTest

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/10/2019, 11:16:47 AM<br><strong>Message</strong>: <pre>Patch Set 9: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/10/2019, 11:17:40 AM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7804/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/7804</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 1/10/2019, 6:57:06 PM<br><strong>Message</strong>: <pre>Patch Set 9:

(47 comments)

Done for now, and I'll have a new look when a patchset is pushed. I may sound too critical in the comments but I will say: thanks for all the work you're putting into this.</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 1/10/2019, 9:50:44 PM<br><strong>Message</strong>: <pre>Patch Set 9:

(1 comment)</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 1/10/2019, 9:53:45 PM<br><strong>Message</strong>: <pre>Patch Set 9: Code-Review-1

(1 comment)

> Patch Set 9:
> 
> (1 comment)

I missed the</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 1/11/2019, 12:36:48 PM<br><strong>Message</strong>: <pre>Patch Set 9:

(1 comment)

Saw the earlier comment in this thread about this being ~800 (actual, not generated) LOC. I was waiting to review this CR in its entirety so that I can have an informed take on this. This CR should be split into a bunch of smaller CRs.

For instance:
- CR1: refactor existing boostrap tests
- CR2: add replacer
- CR3: etc.

Don't hesitate to introduce a type w/ unit tests into one CR, and then integrate that type into the hot path in the follow-up CR. Also do not hesitate to have CRs where the change is introduced gradually; i.e. you only get the 'kafka' plugin to satisfy one of your interfaces in CR4 (and have the same methods be no-ops in 'etcraft'). Then in CR5 you work on the implementation for 'etcdraft'.

Hopefully this will the task of breaking this CR down into smaller CRs a bit less intimidating. (Though it will still admittedly be a pain.)</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/13/2019, 8:00:10 AM<br><strong>Message</strong>: <pre>Patch Set 7:

(32 comments)</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/13/2019, 8:51:18 AM<br><strong>Message</strong>: <pre>Patch Set 9:

(13 comments)</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/13/2019, 10:10:20 AM<br><strong>Message</strong>: <pre>Uploaded patch set 10.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/13/2019, 10:12:11 AM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/8966/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/13/2019, 10:12:36 AM<br><strong>Message</strong>: <pre>Patch Set 10:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/13/2019, 10:17:22 AM<br><strong>Message</strong>: <pre>Patch Set 10: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/13/2019, 10:17:56 AM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/8966/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/8966</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/13/2019, 10:19:38 AM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7922/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/13/2019, 10:20:07 AM<br><strong>Message</strong>: <pre>Patch Set 10:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/13/2019, 10:20:28 AM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/4695/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/13/2019, 10:21:13 AM<br><strong>Message</strong>: <pre>Patch Set 10:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/13/2019, 10:45:16 AM<br><strong>Message</strong>: <pre>Patch Set 10: F3-UnitTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/13/2019, 10:55:39 AM<br><strong>Message</strong>: <pre>Patch Set 10: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/13/2019, 10:56:20 AM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7922/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/7922

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/4695/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/4695</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/14/2019, 5:54:22 AM<br><strong>Message</strong>: <pre>Patch Set 10:

> (1 comment)
 > 
 > Saw the earlier comment in this thread about this being ~800
 > (actual, not generated) LOC. I was waiting to review this CR in its
 > entirety so that I can have an informed take on this. This CR
 > should be split into a bunch of smaller CRs.
 > 
 > For instance:
 > - CR1: refactor existing boostrap tests
 > - CR2: add replacer
 > - CR3: etc.
 > 
 > Don't hesitate to introduce a type w/ unit tests into one CR, and
 > then integrate that type into the hot path in the follow-up CR.
 > Also do not hesitate to have CRs where the change is introduced
 > gradually; i.e. you only get the 'kafka' plugin to satisfy one of
 > your interfaces in CR4 (and have the same methods be no-ops in
 > 'etcraft'). Then in CR5 you work on the implementation for
 > 'etcdraft'.
 > 
 > Hopefully this will the task of breaking this CR down into smaller
 > CRs a bit less intimidating. (Though it will still admittedly be a
 > pain.)


I am in the process of  splitting it up. Stay tuned.</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/14/2019, 5:54:41 AM<br><strong>Message</strong>: <pre>Patch Set 10:

Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/14/2019, 5:58:00 AM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7937/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/14/2019, 5:58:28 AM<br><strong>Message</strong>: <pre>Patch Set 10: -F3-UnitTest

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/14/2019, 6:25:28 AM<br><strong>Message</strong>: <pre>Patch Set 10: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/14/2019, 6:26:06 AM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7937/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/7937</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/14/2019, 11:40:01 AM<br><strong>Message</strong>: <pre>Uploaded patch set 11.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/14/2019, 11:42:27 AM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/8995/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/14/2019, 11:43:00 AM<br><strong>Message</strong>: <pre>Patch Set 11:

Starting verify build</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/14/2019, 11:43:47 AM<br><strong>Message</strong>: <pre>Patch Set 11:

@kostas @yacovm @artem @C0rw1n This the first of 4 CRs that were split from the previously big CR that is in the previous patches. I choose to keep the comment history on this one in order not to lose the context of the discussion.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/14/2019, 11:48:57 AM<br><strong>Message</strong>: <pre>Patch Set 11: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/14/2019, 11:49:41 AM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/8995/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/8995</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/14/2019, 11:51:18 AM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7945/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/14/2019, 11:51:37 AM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/4715/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/14/2019, 11:51:55 AM<br><strong>Message</strong>: <pre>Patch Set 11:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/14/2019, 11:52:25 AM<br><strong>Message</strong>: <pre>Patch Set 11:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/14/2019, 12:21:16 PM<br><strong>Message</strong>: <pre>Patch Set 11: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/14/2019, 12:26:45 PM<br><strong>Message</strong>: <pre>Patch Set 11: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/14/2019, 12:27:42 PM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7945/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/7945

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/4715/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/4715</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 1/14/2019, 10:09:17 PM<br><strong>Message</strong>: <pre>Patch Set 11:

(2 comments)</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/15/2019, 3:55:43 AM<br><strong>Message</strong>: <pre>Patch Set 7:

(1 comment)</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/15/2019, 3:57:28 AM<br><strong>Message</strong>: <pre>Patch Set 11:

> (2 comments)
@kostas
Let's continue the discussion here:
https://gerrit.hyperledger.org/r/#/c/28707/
Take a look, tell me if you comment is still relevant. If it is, I'll address it.</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/17/2019, 5:08:30 AM<br><strong>Message</strong>: <pre>Uploaded patch set 12: Patch Set 11 was rebased.</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/17/2019, 2:49:05 PM<br><strong>Message</strong>: <pre>Uploaded patch set 13: Patch Set 12 was rebased.</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/21/2019, 9:43:37 AM<br><strong>Message</strong>: <pre>Uploaded patch set 14: Patch Set 13 was rebased.</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 1/23/2019, 5:47:09 AM<br><strong>Message</strong>: <pre>Patch Set 14:

(3 comments)</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/23/2019, 7:01:29 AM<br><strong>Message</strong>: <pre>Uploaded patch set 15: Patch Set 14 was rebased.</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/24/2019, 2:59:14 AM<br><strong>Message</strong>: <pre>Patch Set 14:

(3 comments)

Thanks for the review, Jay! I will push another patch addressing these comments soon.</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 1/24/2019, 3:19:57 AM<br><strong>Message</strong>: <pre>Patch Set 15:

(3 comments)</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/24/2019, 6:37:34 AM<br><strong>Message</strong>: <pre>Patch Set 15:

(3 comments)

Just pushed a new patch that addresses Jay's comments. Thanks for the review!</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/24/2019, 6:52:09 AM<br><strong>Message</strong>: <pre>Uploaded patch set 16.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/24/2019, 6:56:38 AM<br><strong>Message</strong>: <pre>Patch Set 16:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/9402/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/24/2019, 6:57:58 AM<br><strong>Message</strong>: <pre>Patch Set 16:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/24/2019, 7:04:12 AM<br><strong>Message</strong>: <pre>Patch Set 16: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/24/2019, 7:04:57 AM<br><strong>Message</strong>: <pre>Patch Set 16:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/9402/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/9402</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/24/2019, 7:06:33 AM<br><strong>Message</strong>: <pre>Patch Set 16:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/8317/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/24/2019, 7:06:52 AM<br><strong>Message</strong>: <pre>Patch Set 16:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/5012/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/24/2019, 7:07:53 AM<br><strong>Message</strong>: <pre>Patch Set 16:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/24/2019, 7:08:18 AM<br><strong>Message</strong>: <pre>Patch Set 16:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/24/2019, 7:37:33 AM<br><strong>Message</strong>: <pre>Patch Set 16: F3-UnitTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/24/2019, 7:37:49 AM<br><strong>Message</strong>: <pre>Patch Set 16: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/24/2019, 7:38:25 AM<br><strong>Message</strong>: <pre>Patch Set 16:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/8317/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/8317

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/5012/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/5012</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/24/2019, 11:20:02 AM<br><strong>Message</strong>: <pre>Patch Set 16:

Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/24/2019, 11:22:48 AM<br><strong>Message</strong>: <pre>Patch Set 16:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/8334/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/24/2019, 11:24:14 AM<br><strong>Message</strong>: <pre>Patch Set 16: -F3-UnitTest

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/24/2019, 11:58:35 AM<br><strong>Message</strong>: <pre>Patch Set 16: F3-UnitTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/24/2019, 11:59:44 AM<br><strong>Message</strong>: <pre>Patch Set 16:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/8334/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/8334</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/27/2019, 2:32:16 AM<br><strong>Message</strong>: <pre>Patch Set 16:

Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/27/2019, 2:34:26 AM<br><strong>Message</strong>: <pre>Patch Set 16:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/8373/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/27/2019, 2:36:23 AM<br><strong>Message</strong>: <pre>Patch Set 16: -F3-UnitTest

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/27/2019, 3:04:45 AM<br><strong>Message</strong>: <pre>Patch Set 16: F3-UnitTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/27/2019, 3:05:33 AM<br><strong>Message</strong>: <pre>Patch Set 16:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/8373/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/8373</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/27/2019, 3:22:14 AM<br><strong>Message</strong>: <pre>Patch Set 16:

Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/27/2019, 3:23:53 AM<br><strong>Message</strong>: <pre>Patch Set 16:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/8374/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/27/2019, 3:25:47 AM<br><strong>Message</strong>: <pre>Patch Set 16: -F3-UnitTest

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/27/2019, 3:51:49 AM<br><strong>Message</strong>: <pre>Patch Set 16: F3-UnitTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/27/2019, 3:52:45 AM<br><strong>Message</strong>: <pre>Patch Set 16:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/8374/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/8374</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/27/2019, 8:46:45 AM<br><strong>Message</strong>: <pre>Uploaded patch set 17.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/27/2019, 8:49:01 AM<br><strong>Message</strong>: <pre>Patch Set 17:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/9458/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/27/2019, 8:51:05 AM<br><strong>Message</strong>: <pre>Patch Set 17:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/27/2019, 8:56:38 AM<br><strong>Message</strong>: <pre>Patch Set 17: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/27/2019, 8:57:22 AM<br><strong>Message</strong>: <pre>Patch Set 17:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/9458/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/9458</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/27/2019, 8:58:47 AM<br><strong>Message</strong>: <pre>Patch Set 17:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/8375/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/27/2019, 8:59:27 AM<br><strong>Message</strong>: <pre>Patch Set 17:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/5059/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/27/2019, 9:00:53 AM<br><strong>Message</strong>: <pre>Patch Set 17:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/27/2019, 9:01:15 AM<br><strong>Message</strong>: <pre>Patch Set 17:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/27/2019, 9:31:05 AM<br><strong>Message</strong>: <pre>Patch Set 17: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/27/2019, 9:34:51 AM<br><strong>Message</strong>: <pre>Patch Set 17: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/27/2019, 9:35:36 AM<br><strong>Message</strong>: <pre>Patch Set 17:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/8375/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/8375

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/5059/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/5059</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 1/28/2019, 12:49:35 AM<br><strong>Message</strong>: <pre>Patch Set 17: -Code-Review</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 1/28/2019, 3:56:12 AM<br><strong>Message</strong>: <pre>Patch Set 17:

(1 comment)</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 1/28/2019, 4:01:25 AM<br><strong>Message</strong>: <pre>Patch Set 17:

(1 comment)</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 1/29/2019, 2:21:44 AM<br><strong>Message</strong>: <pre>Patch Set 17:

We'll need to update the commit message, and it would have been great if the NewReplacer constructor returned a struct (see [1] but do note I won't block this). This otherwise looks good to go, and a definite improvement over the tests we used to have in that package before. Thanks for the clean-up!

[1] Matt's slides: https://docs.google.com/presentation/d/1s-8b4XaELv9xz79vf0bVkqr7ORDOLEfeHqWqGhZVbHo/edit - pages 15 & 19</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 1/29/2019, 4:03:19 PM<br><strong>Message</strong>: <pre>Patch Set 17: Code-Review+2

> Patch Set 17:
> 
> We'll need to update the commit message

Actually, what on earth am I talking about. The commit message is right, as it does refer to the `bootstrap` work. Sorry about that.</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 1/30/2019, 11:38:10 AM<br><strong>Message</strong>: <pre>Patch Set 17: Code-Review+2</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 1/30/2019, 11:38:31 AM<br><strong>Message</strong>: <pre>Patch Set 18: Patch Set 17 was rebased</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 1/30/2019, 11:38:43 AM<br><strong>Message</strong>: <pre>Patch Set 18:

Run VerifyBuild</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 1/30/2019, 11:39:21 AM<br><strong>Message</strong>: <pre>Change has been successfully merged by Yacov Manevich</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/30/2019, 11:41:38 AM<br><strong>Message</strong>: <pre>Patch Set 18:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/9570/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/30/2019, 11:42:33 AM<br><strong>Message</strong>: <pre>Patch Set 18:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/4255/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/30/2019, 11:43:49 AM<br><strong>Message</strong>: <pre>Patch Set 18:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-x86_64/5570/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/30/2019, 11:48:31 AM<br><strong>Message</strong>: <pre>Patch Set 18:

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/30/2019, 11:53:08 AM<br><strong>Message</strong>: <pre>Patch Set 18:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/8477/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/30/2019, 11:53:21 AM<br><strong>Message</strong>: <pre>Patch Set 18:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/5153/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/30/2019, 12:23:45 PM<br><strong>Message</strong>: <pre>Patch Set 18:

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/30/2019, 12:24:00 PM<br><strong>Message</strong>: <pre>Patch Set 18:

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/30/2019, 12:24:59 PM<br><strong>Message</strong>: <pre>Patch Set 18:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/9570/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/9570

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/8477/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/8477

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/5153/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/5153</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/30/2019, 12:31:14 PM<br><strong>Message</strong>: <pre>Patch Set 18:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/4255/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-end-2-end-x86_64/4255

https://jenkins.hyperledger.org/job/fabric-merge-x86_64/5570/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-x86_64/5570</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Uploader</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Created</strong>: 12/31/2018, 11:47:49 AM<br><strong>UnmergedRevision</strong>: [c9a97ae861006273f74ca8aba8fbaa357742571a](https://github.com/hyperledger-gerrit-archive/fabric/commit/c9a97ae861006273f74ca8aba8fbaa357742571a)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/31/2018, 11:57:31 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/31/2018, 11:57:31 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/31/2018, 12:34:16 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/31/2018, 3:49:30 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap.go#L24](https://github.com/hyperledger-gerrit-archive/fabric/blob/c9a97ae861006273f74ca8aba8fbaa357742571a/orderer/common/bootstrap/file/bootstrap.go#L24)<br><strong>Comment</strong>: <pre>please fix imports by deleting the spaces and then running goimports -w</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap.go#L24](https://github.com/hyperledger-gerrit-archive/fabric/blob/c9a97ae861006273f74ca8aba8fbaa357742571a/orderer/common/bootstrap/file/bootstrap.go#L24)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap.go#L71](https://github.com/hyperledger-gerrit-archive/fabric/blob/c9a97ae861006273f74ca8aba8fbaa357742571a/orderer/common/bootstrap/file/bootstrap.go#L71)<br><strong>Comment</strong>: <pre>use the github.com/pkg/errors package instead of fmt</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap.go#L71](https://github.com/hyperledger-gerrit-archive/fabric/blob/c9a97ae861006273f74ca8aba8fbaa357742571a/orderer/common/bootstrap/file/bootstrap.go#L71)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap.go#L76](https://github.com/hyperledger-gerrit-archive/fabric/blob/c9a97ae861006273f74ca8aba8fbaa357742571a/orderer/common/bootstrap/file/bootstrap.go#L76)<br><strong>Comment</strong>: <pre>ditto</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap.go#L76](https://github.com/hyperledger-gerrit-archive/fabric/blob/c9a97ae861006273f74ca8aba8fbaa357742571a/orderer/common/bootstrap/file/bootstrap.go#L76)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap.go#L81](https://github.com/hyperledger-gerrit-archive/fabric/blob/c9a97ae861006273f74ca8aba8fbaa357742571a/orderer/common/bootstrap/file/bootstrap.go#L81)<br><strong>Comment</strong>: <pre>ditto</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap.go#L81](https://github.com/hyperledger-gerrit-archive/fabric/blob/c9a97ae861006273f74ca8aba8fbaa357742571a/orderer/common/bootstrap/file/bootstrap.go#L81)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap.go#L86](https://github.com/hyperledger-gerrit-archive/fabric/blob/c9a97ae861006273f74ca8aba8fbaa357742571a/orderer/common/bootstrap/file/bootstrap.go#L86)<br><strong>Comment</strong>: <pre>ditto</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap.go#L86](https://github.com/hyperledger-gerrit-archive/fabric/blob/c9a97ae861006273f74ca8aba8fbaa357742571a/orderer/common/bootstrap/file/bootstrap.go#L86)<br><strong>Comment</strong>: <pre>errors start with lowercase
https://github.com/golang/go/wiki/CodeReviewComments#error-strings</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap.go#L86](https://github.com/hyperledger-gerrit-archive/fabric/blob/c9a97ae861006273f74ca8aba8fbaa357742571a/orderer/common/bootstrap/file/bootstrap.go#L86)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap.go#L91](https://github.com/hyperledger-gerrit-archive/fabric/blob/c9a97ae861006273f74ca8aba8fbaa357742571a/orderer/common/bootstrap/file/bootstrap.go#L91)<br><strong>Comment</strong>: <pre>ditto</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap.go#L91](https://github.com/hyperledger-gerrit-archive/fabric/blob/c9a97ae861006273f74ca8aba8fbaa357742571a/orderer/common/bootstrap/file/bootstrap.go#L91)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap.go#L99](https://github.com/hyperledger-gerrit-archive/fabric/blob/c9a97ae861006273f74ca8aba8fbaa357742571a/orderer/common/bootstrap/file/bootstrap.go#L99)<br><strong>Comment</strong>: <pre>so, what's wrong with ioutil.ReadFile and then just ioutil.WriteFile ? should be less code lines...</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap.go#L99](https://github.com/hyperledger-gerrit-archive/fabric/blob/c9a97ae861006273f74ca8aba8fbaa357742571a/orderer/common/bootstrap/file/bootstrap.go#L99)<br><strong>Comment</strong>: <pre>ReadFile reads the entire file to memory and forces you to allocate a buffer the size of the file. Copy, on the other hand, manages it buffers internally, and in case you don't need access to the file's content before writing it out, does a slightly faster job. It is also safer on larger files since it reduces the chance of OOM. (See discussion here: https://opensource.com/article/18/6/copying-files-go).
I moved the backup into a function scope in order to be able to close files cleanly with defer.</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L68](https://github.com/hyperledger-gerrit-archive/fabric/blob/c9a97ae861006273f74ca8aba8fbaa357742571a/orderer/common/multichannel/chainsupport.go#L68)<br><strong>Comment</strong>: <pre>is this block section tested?</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L68](https://github.com/hyperledger-gerrit-archive/fabric/blob/c9a97ae861006273f74ca8aba8fbaa357742571a/orderer/common/multichannel/chainsupport.go#L68)<br><strong>Comment</strong>: <pre>Yes, it is tested in the integration/e2e/migration_test.go, in the "kafka2raft migration raft side" test-case. That test just handles the "green path" though; I plan to add more tests when I do the "abort" an "recovery" paths.
In addition, this will be covered in the Registrar unit tests.</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar.go#L281](https://github.com/hyperledger-gerrit-archive/fabric/blob/c9a97ae861006273f74ca8aba8fbaa357742571a/orderer/common/multichannel/registrar.go#L281)<br><strong>Comment</strong>: <pre>is this block section tested?</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar.go#L281](https://github.com/hyperledger-gerrit-archive/fabric/blob/c9a97ae861006273f74ca8aba8fbaa357742571a/orderer/common/multichannel/registrar.go#L281)<br><strong>Comment</strong>: <pre>Yes, it is tested in the integration/e2e/migration_test.go, "kafka2raft migration raft side" test case.
I will also add a test case to the registrar_test.go; in the next patch.</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/consensus.go#L34](https://github.com/hyperledger-gerrit-archive/fabric/blob/c9a97ae861006273f74ca8aba8fbaa357742571a/orderer/consensus/consensus.go#L34)<br><strong>Comment</strong>: <pre>From: https://golang.org/doc/effective_go.html#Getters

Go doesn't provide automatic support for getters and setters. There's nothing wrong with providing getters and setters yourself, and it's often appropriate to do so, but it's neither idiomatic nor necessary to put Get into the getter's name. If you have a field called owner (lower case, unexported), the getter method should be called Owner (upper case, exported), not GetOwner.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/consensus.go#L34](https://github.com/hyperledger-gerrit-archive/fabric/blob/c9a97ae861006273f74ca8aba8fbaa357742571a/orderer/consensus/consensus.go#L34)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/consenter.go#L15](https://github.com/hyperledger-gerrit-archive/fabric/blob/c9a97ae861006273f74ca8aba8fbaa357742571a/orderer/consensus/etcdraft/consenter.go#L15)<br><strong>Comment</strong>: <pre>please fix imports</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/consenter.go#L15](https://github.com/hyperledger-gerrit-archive/fabric/blob/c9a97ae861006273f74ca8aba8fbaa357742571a/orderer/consensus/etcdraft/consenter.go#L15)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain.go#L913](https://github.com/hyperledger-gerrit-archive/fabric/blob/c9a97ae861006273f74ca8aba8fbaa357742571a/orderer/consensus/kafka/chain.go#L913)<br><strong>Comment</strong>: <pre>is this block section tested?</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain.go#L913](https://github.com/hyperledger-gerrit-archive/fabric/blob/c9a97ae861006273f74ca8aba8fbaa357742571a/orderer/consensus/kafka/chain.go#L913)<br><strong>Comment</strong>: <pre>I refactored most of this into migration.go, to make it easier to test, and added unit test migration_test.go which covers it.</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/migration.go#L16](https://github.com/hyperledger-gerrit-archive/fabric/blob/c9a97ae861006273f74ca8aba8fbaa357742571a/orderer/consensus/migration.go#L16)<br><strong>Comment</strong>: <pre>this file is not tested</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/migration.go#L16](https://github.com/hyperledger-gerrit-archive/fabric/blob/c9a97ae861006273f74ca8aba8fbaa357742571a/orderer/consensus/migration.go#L16)<br><strong>Comment</strong>: <pre>I added migration_test.go which covers it (>90%)</pre></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Uploader</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Created</strong>: 1/5/2019, 1:18:08 PM<br><strong>UnmergedRevision</strong>: [54548dc7e1ae5c96b4afd66400bea1f362292d3d](https://github.com/hyperledger-gerrit-archive/fabric/commit/54548dc7e1ae5c96b4afd66400bea1f362292d3d)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/5/2019, 1:27:22 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/5/2019, 1:27:22 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/5/2019, 2:02:04 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/5/2019, 1:41:32 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Uploader</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Created</strong>: 1/5/2019, 3:53:46 PM<br><strong>UnmergedRevision</strong>: [03a99a32441471bf9579f272646509bd3253b202](https://github.com/hyperledger-gerrit-archive/fabric/commit/03a99a32441471bf9579f272646509bd3253b202)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/5/2019, 1:27:22 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/5/2019, 1:27:22 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/5/2019, 2:02:04 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/5/2019, 4:28:26 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Uploader</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Created</strong>: 1/5/2019, 5:31:04 PM<br><strong>UnmergedRevision</strong>: [97de06ac6dbc3394d1b23687c71bfcb2465ab027](https://github.com/hyperledger-gerrit-archive/fabric/commit/97de06ac6dbc3394d1b23687c71bfcb2465ab027)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/5/2019, 5:35:05 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 5</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Uploader</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Created</strong>: 1/6/2019, 1:53:13 AM<br><strong>UnmergedRevision</strong>: [3ed6eeafeca36ab408a00360060d481638fe7d37](https://github.com/hyperledger-gerrit-archive/fabric/commit/3ed6eeafeca36ab408a00360060d481638fe7d37)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/6/2019, 2:02:57 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/6/2019, 2:02:57 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/6/2019, 2:41:36 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/6/2019, 2:37:17 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap.go#L57](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/common/bootstrap/file/bootstrap.go#L57)<br><strong>Comment</strong>: <pre>using errors.Wrap is more appropriate here</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap.go#L57](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/common/bootstrap/file/bootstrap.go#L57)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap.go#L62](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/common/bootstrap/file/bootstrap.go#L62)<br><strong>Comment</strong>: <pre>errors.Wrapf could be used to wrap an existing error + add some context into error message.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap.go#L62](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/common/bootstrap/file/bootstrap.go#L62)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap.go#L72](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/common/bootstrap/file/bootstrap.go#L72)<br><strong>Comment</strong>: <pre>errors.Wrapf</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap.go#L72](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/common/bootstrap/file/bootstrap.go#L72)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap.go#L77](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/common/bootstrap/file/bootstrap.go#L77)<br><strong>Comment</strong>: <pre>errors.Wrapf</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap.go#L77](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/common/bootstrap/file/bootstrap.go#L77)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap.go#L78](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/common/bootstrap/file/bootstrap.go#L78)<br><strong>Comment</strong>: <pre>IMO it will be good if you will preserve same order of arguments while printing log message, e.g. line 73 you have genesis file, backup file and error. it will be more helpful to have same here.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap.go#L78](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/common/bootstrap/file/bootstrap.go#L78)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap_test.go#L236](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/common/bootstrap/file/bootstrap_test.go#L236)<br><strong>Comment</strong>: <pre>+= Bad</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap_test.go#L236](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/common/bootstrap/file/bootstrap_test.go#L236)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L71](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/common/multichannel/chainsupport.go#L71)<br><strong>Comment</strong>: <pre>can you export this block inside the if to a function?</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L71](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/common/multichannel/chainsupport.go#L71)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L80](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/common/multichannel/chainsupport.go#L80)<br><strong>Comment</strong>: <pre>this could be replaced with

     lastConfigIndex == lastBlock.Header.Number</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L80](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/common/multichannel/chainsupport.go#L80)<br><strong>Comment</strong>: <pre>I think this way is more descriptive and safe, no one has to go through the design doc and try to figure out what is in lastBlock.Header.Number.... (the height-1) ;-)</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L80](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/common/multichannel/chainsupport.go#L80)<br><strong>Comment</strong>: <pre>no one will look into design doc for implementation details anyway, having last block it's a bit weird going to ledger resource to query for current height.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L80](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/common/multichannel/chainsupport.go#L80)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L91](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/common/multichannel/chainsupport.go#L91)<br><strong>Comment</strong>: <pre>why do we do this?</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L91](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/common/multichannel/chainsupport.go#L91)<br><strong>Comment</strong>: <pre>Because the last config block after migration (COMMIT/CONTEXT) carries Kafka metadata (indices, etc), and the Raft code that follows panics because of it.</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar.go#L173](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/common/multichannel/registrar.go#L173)<br><strong>Comment</strong>: <pre>I think you should elaborate here, why.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar.go#L173](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/common/multichannel/registrar.go#L173)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar.go#L204](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/common/multichannel/registrar.go#L204)<br><strong>Comment</strong>: <pre>same as above.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar.go#L204](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/common/multichannel/registrar.go#L204)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar.go#L235](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/common/multichannel/registrar.go#L235)<br><strong>Comment</strong>: <pre>r.ConsensusMigrationPending()?</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar.go#L235](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/common/multichannel/registrar.go#L235)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar.go#L284](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/common/multichannel/registrar.go#L284)<br><strong>Comment</strong>: <pre>Please follow, https://github.com/Unknwon/go-code-convention/blob/master/en-US/naming_rules.md

this should be:

       sysST, sysCtx := ...</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar.go#L284](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/common/multichannel/registrar.go#L284)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar.go#L285](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/common/multichannel/registrar.go#L285)<br><strong>Comment</strong>: <pre>What is the meaning of magic zero context?</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar.go#L285](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/common/multichannel/registrar.go#L285)<br><strong>Comment</strong>: <pre>expected state=START, context>0. refactored to make it clearer.</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar.go#L295](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/common/multichannel/registrar.go#L295)<br><strong>Comment</strong>: <pre>errors.Errorf()</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar.go#L295](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/common/multichannel/registrar.go#L295)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar.go#L299](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/common/multichannel/registrar.go#L299)<br><strong>Comment</strong>: <pre>errors.Errorf()</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar.go#L299](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/common/multichannel/registrar.go#L299)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar.go#L306](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/common/multichannel/registrar.go#L306)<br><strong>Comment</strong>: <pre>Could you please add here some debug message?</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar.go#L306](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/common/multichannel/registrar.go#L306)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar_test.go#L77](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/common/multichannel/registrar_test.go#L77)<br><strong>Comment</strong>: <pre>why is this exported? do you use this outside the package too?</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar_test.go#L77](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/common/multichannel/registrar_test.go#L77)<br><strong>Comment</strong>: <pre>No... just copied from above ;-) fixed</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar_test.go#L197](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/common/multichannel/registrar_test.go#L197)<br><strong>Comment</strong>: <pre>channels</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar_test.go#L197](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/common/multichannel/registrar_test.go#L197)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar_test.go#L202](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/common/multichannel/registrar_test.go#L202)<br><strong>Comment</strong>: <pre>can you use assert.EqualError in the assert.Errors in this test, so we can be sure the error is what we expect it to be, and not some generic error by chance?</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar_test.go#L202](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/common/multichannel/registrar_test.go#L202)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/consensus.go#L53](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/consensus/consensus.go#L53)<br><strong>Comment</strong>: <pre>this name stutters. Why not call it instead - MigrationController?

from: https://blog.golang.org/package-names
----------------------------------------
Avoid stutter. Since client code uses the package name as a prefix when referring to the package contents, the names for those contents need not repeat the package name. The HTTP server provided by the http package is called Server, not HTTPServer. Client code refers to this type as http.Server, so there is no ambiguity.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/consensus.go#L53](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/consensus/consensus.go#L53)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L243](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/consensus/etcdraft/chain.go#L243)<br><strong>Comment</strong>: <pre>TODO what?</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L243](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/consensus/etcdraft/chain.go#L243)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L247](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/consensus/etcdraft/chain.go#L247)<br><strong>Comment</strong>: <pre>is this function tested? I was bitten by this code section in the past...</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L247](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/consensus/etcdraft/chain.go#L247)<br><strong>Comment</strong>: <pre>Yes, by the integration tests. I was bitten by it too...</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L277](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/consensus/etcdraft/chain.go#L277)<br><strong>Comment</strong>: <pre>IMO, you can instead use:

    c.support.Sequence()

according to godoc it "Sequence returns the current config squence."</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L277](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/consensus/etcdraft/chain.go#L277)<br><strong>Comment</strong>: <pre>I am not sure whether the config sequence is the index of the config block or the number of configs since genesis... Do you know?</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L301](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/consensus/etcdraft/chain.go#L301)<br><strong>Comment</strong>: <pre>a nit but can you reverse here logic to skip one level of indentation? 

    if !c.support.SharedConfig().Capabilities().Kafka2RaftMigration() {
      return false
    }
    // here rest of the logic</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L301](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/consensus/etcdraft/chain.go#L301)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/consenter.go#L135](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/consensus/etcdraft/consenter.go#L135)<br><strong>Comment</strong>: <pre>why would we want to dump this to the log every time the chain is started?

IMO we only need to dump stuff such as these, if we have a problem and something went wrong...</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/consenter.go#L135](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/consensus/etcdraft/consenter.go#L135)<br><strong>Comment</strong>: <pre>I scoped it behind a condition that checks that MigrationState != NONE, which means it is logged only after migration.
As an aside - this code suffers from lack of logging. Chain restart is a rare event and there is no harm in putting extra info in the log.</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/inactive/inactive_chain.go#L50](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/consensus/inactive/inactive_chain.go#L50)<br><strong>Comment</strong>: <pre>IMO we should panic here. Because we shouldn't have any inactive chains at all when we migrate, because all OSNs are in all the application channels... no?</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/inactive/inactive_chain.go#L50](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/consensus/inactive/inactive_chain.go#L50)<br><strong>Comment</strong>: <pre>We don't need to panic. we'll get a segfault if someone ever calls it, and tries to de-reference it. It is never called in correct code.</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain.go#L921](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/consensus/kafka/chain.go#L921)<br><strong>Comment</strong>: <pre>is this method tested?</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain.go#L921](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/consensus/kafka/chain.go#L921)<br><strong>Comment</strong>: <pre>Yes, in the integration/e2e/migration_test.go tests. Next CR</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/migration.go#L34](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/consensus/migration.go#L34)<br><strong>Comment</strong>: <pre>What ensures that these migration{State, Context} are initialized with the values that are persisted in the blockchain when the node crashes and comes up again?</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/migration.go#L34](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/consensus/migration.go#L34)<br><strong>Comment</strong>: <pre>You know it is a great question when the answer appears in the next slide ;-). This will be handled in the "recovery from crashes" JIRA FAB-13247. In a nutshell, during recovery, the last config block of every channel will be read, starting with the system channel. Then, if it is detected that migration crashed mid-way, the migration status will be set to the correct value, and migration will resume from the point before it crashed.</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/migration.go#L43](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/consensus/migration.go#L43)<br><strong>Comment</strong>: <pre>you can use here a read lock</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/migration.go#L43](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/consensus/migration.go#L43)<br><strong>Comment</strong>: <pre>I don't think there is a need for a RWMutex here. It is only beneficial when there is contention and a lot of reads w.r.t writes. I don't think this is the case here. I think with RWMutex we are more likely to see degraded performance.</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/migration.go#L78](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/consensus/migration.go#L78)<br><strong>Comment</strong>: <pre>a nit, but else redundant here</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/migration.go#L78](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/consensus/migration.go#L78)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/migration.go#L84](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/consensus/migration.go#L84)<br><strong>Comment</strong>: <pre>could use read mutex instead</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/migration.go#L84](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/consensus/migration.go#L84)<br><strong>Comment</strong>: <pre>same as above</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/migration.go#L95](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/consensus/migration.go#L95)<br><strong>Comment</strong>: <pre>will it be possible to split this function to make it more readable?</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/migration.go#L95](https://github.com/hyperledger-gerrit-archive/fabric/blob/3ed6eeafeca36ab408a00360060d481638fe7d37/orderer/consensus/migration.go#L95)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 6</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Uploader</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Created</strong>: 1/7/2019, 2:04:44 PM<br><strong>UnmergedRevision</strong>: [3bd6da9d8e07d572b8cf32ee937e7301323fd94f](https://github.com/hyperledger-gerrit-archive/fabric/commit/3bd6da9d8e07d572b8cf32ee937e7301323fd94f)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/7/2019, 2:16:45 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/7/2019, 2:16:45 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/7/2019, 2:54:34 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/7/2019, 4:47:45 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Approved</strong>: 1/8/2019, 1:09:46 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap.go#L28](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/bootstrap/file/bootstrap.go#L28)<br><strong>Comment</strong>: <pre>Remember the dot :)</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap.go#L28](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/bootstrap/file/bootstrap.go#L28)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap.go#L39](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/bootstrap/file/bootstrap.go#L39)<br><strong>Comment</strong>: <pre>:thumbsup:</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap.go#L39](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/bootstrap/file/bootstrap.go#L39)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap_test.go#L16](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/bootstrap/file/bootstrap_test.go#L16)<br><strong>Comment</strong>: <pre>We always want to create test artifacts in a temp folder: https://golang.org/pkg/os/#TempDir

(I know the existing tests in this file don't do this, but the existing tests in this file suck. See my comment below.)</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap_test.go#L16](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/bootstrap/file/bootstrap_test.go#L16)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap_test.go#L90](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/bootstrap/file/bootstrap_test.go#L90)<br><strong>Comment</strong>: <pre>(These are not yours, I know, but they're badly written tests. Keep them in mind for some quick rewriting using the assert package when you rewrite your tests below?)</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap_test.go#L90](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/bootstrap/file/bootstrap_test.go#L90)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap_test.go#L92](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/bootstrap/file/bootstrap_test.go#L92)<br><strong>Comment</strong>: <pre>This, and the test below should probably be two subtests of `TestReplaceGenesisBlockFile` (subtest-1: "Good", subtest-2: "Bad").</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap_test.go#L92](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/bootstrap/file/bootstrap_test.go#L92)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap_test.go#L155](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/bootstrap/file/bootstrap_test.go#L155)<br><strong>Comment</strong>: <pre>Again, I know you were just following the idiom you saw in this file, so this is not your fault.

But this is a silly idiom that we shouldn't have allowed in, in the first place. So let's remove it when we get a chance.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap_test.go#L155](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/bootstrap/file/bootstrap_test.go#L155)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L31](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/chainsupport.go#L31)<br><strong>Comment</strong>: <pre>Why can't we have the isSystemChannel method defined at the end of the file check for ledgerResources.ConsortiumsConfig and call it a day?

In general not a big fan of normalizing derived data.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L31](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/chainsupport.go#L31)<br><strong>Comment</strong>: <pre>You are correct. When I started, I wasn't sure what is the right way to derive this info. However, since this value never changes after creation, I think it is better to compute it once and keep a copy, for efficiency. I removed it from the constructor signature, as you  suggested.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L40](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/chainsupport.go#L40)<br><strong>Comment</strong>: <pre>We can drop this comment since we have it in line 31.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L40](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/chainsupport.go#L40)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L72](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/chainsupport.go#L72)<br><strong>Comment</strong>: <pre>panicking</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L72](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/chainsupport.go#L72)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L93](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/chainsupport.go#L93)<br><strong>Comment</strong>: <pre>As a reader of this code, I think it'd be helpful if you outlined what you're after here.

E.g.

// We have a migration if all of the below are true:
// 1. foo
// 2. bar
// 3. baz

WDYT?

At any rate, a nit. Feel free to ignore.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L93](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/chainsupport.go#L93)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L94](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/chainsupport.go#L94)<br><strong>Comment</strong>: <pre>Do you actually need this as an argument? Is there any reason why you cannot check the `systemChan` field of your `cs` struct?</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L94](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/chainsupport.go#L94)<br><strong>Comment</strong>: <pre>Good catch! I actually do not need ledgerResources either, only lastBlock.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L94](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/chainsupport.go#L94)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L96](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/chainsupport.go#L96)<br><strong>Comment</strong>: <pre>Going back to the "comma, ok" comment 2 CRs back, you might want to layer this check:

1. Check whether we have Capabilities to begin with
2. Check for Kafka2RaftMigration</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L96](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/chainsupport.go#L96)<br><strong>Comment</strong>: <pre>Same reply as before, SharedConfig().Capabilities() always returns a valid object.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L96](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/chainsupport.go#L96)<br><strong>Comment</strong>: <pre>Right, I had written this before your follow-up.

Done.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L100](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/chainsupport.go#L100)<br><strong>Comment</strong>: <pre>Is this us being paranoid, or we can actually get this error?

If it's the former, I vote that we drop this check. What do you (& others) think?</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L100](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/chainsupport.go#L100)<br><strong>Comment</strong>: <pre>I followed the idioms of the code in this component, I say better safe then sorry...</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L105](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/chainsupport.go#L105)<br><strong>Comment</strong>: <pre>Why is this needed?</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L105](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/chainsupport.go#L105)<br><strong>Comment</strong>: <pre>This identifies the last block as a config-tx block. When migration ends successfully, every channel will have a config block as the last block. On the system channel, containing state=COMMIT; on standard channels, containing state=CONTEXT.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L105](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/chainsupport.go#L105)<br><strong>Comment</strong>: <pre>I am referring to the highlighted comment fragment. Seems unnecessary?</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L105](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/chainsupport.go#L105)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L110](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/chainsupport.go#L110)<br><strong>Comment</strong>: <pre>This can work, but FWIW I'm under the impression that in Go it's more idiomatic to express this as a switch statement:

```
switch {
case foo:
case bar:
}
```

T minus 5 before someone else calls BS on this though.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L110](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/chainsupport.go#L110)<br><strong>Comment</strong>: <pre>I say use a switch when the number of cases > 2.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L110](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/chainsupport.go#L110)<br><strong>Comment</strong>: <pre>Works for me.

Can we at least break down the composite statements in nested checks?

```if systemChan {
  if ledgerResources.SharedConfig().ConsensusMigrationState() == orderer.ConsensusType_MIG_STATE_COMMIT {
    isMigration = true
  }
else {
  if ledgerResources.SharedConfig().ConsensusMigrationState() == orderer.ConsensusType_MIG_STATE_CONTEXT {
    isMigration = true
  }
}
```</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L110](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/chainsupport.go#L110)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L113](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/chainsupport.go#L113)<br><strong>Comment</strong>: <pre>When I see this, is the migration completed? Just begun? Need some clarity here?</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L113](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/chainsupport.go#L113)<br><strong>Comment</strong>: <pre>when you see this, you are restarting for the first time after what seems to be a successful migration, on to the new consensus-type (etcdraft). I improved the log message.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L113](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/chainsupport.go#L113)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L215](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/chainsupport.go#L215)<br><strong>Comment</strong>: <pre>I'd drop this line entirely.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L215](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/chainsupport.go#L215)<br><strong>Comment</strong>: <pre>I prefer to compute it once from ledgerResources.ConsortiumsConfig(), and return this value from then on, for efficiency.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L215](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/chainsupport.go#L215)<br><strong>Comment</strong>: <pre>That is fine. My point is: there is no need for line 215. This getter seems useful in general.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L215](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/chainsupport.go#L215)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar.go#L146](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/registrar.go#L146)<br><strong>Comment</strong>: <pre>I can't quite get what you mean by `consensus-type migration`. Which phase do you refer to? When it starts? When it's completed?</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar.go#L146](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/registrar.go#L146)<br><strong>Comment</strong>: <pre>I use the term "consensus-type migration" to refer to the entire process. I try to use it consistently across the board so that a text search on "consensus-type migration" will lead you to all the places where I made changes for migration. (well, almost - certainly all the files and all the functions, though). This is a TODO - a note to myself -when I am done with recovery from crashes it will be clearer.

If, during review, you find a place where i did not add "consensus-type migration" in the comments - please notify me.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar.go#L175](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/registrar.go#L175)<br><strong>Comment</strong>: <pre>See my comment in chainsupport.go, I don't think we need to expand the constructor signature for this.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar.go#L175](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/registrar.go#L175)<br><strong>Comment</strong>: <pre>You are correct. I fixed it.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar.go#L175](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/registrar.go#L175)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar.go#L240](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/registrar.go#L240)<br><strong>Comment</strong>: <pre>("is pending" OR "because of pending ...". I vote for the latter.)</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar.go#L240](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/registrar.go#L240)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar.go#L258](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/registrar.go#L258)<br><strong>Comment</strong>: <pre>channel.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar.go#L258](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/registrar.go#L258)<br><strong>Comment</strong>: <pre>Remember the dot ;-)</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar.go#L258](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/registrar.go#L258)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar.go#L285](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/registrar.go#L285)<br><strong>Comment</strong>: <pre>migration.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar.go#L285](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/registrar.go#L285)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar.go#L321](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/registrar.go#L321)<br><strong>Comment</strong>: <pre>Can we move all of these to a migrate.go (or sth similar) file in the `multichannel` package?</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar.go#L321](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/registrar.go#L321)<br><strong>Comment</strong>: <pre>I am not sure how and what would it gain us. These accept the (r *Registrar), and need access to the r.lock, r.systemChannel, and r.chains fields. 
So I really see no point in making it more complicated then it is.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar.go#L321](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/registrar.go#L321)<br><strong>Comment</strong>: <pre>I said different file, not different package.

You will still have access to the same internal struct fields as you do now.

Same reasoning as here pretty much: https://gerrit.hyperledger.org/r/c/28435/7/orderer/common/bootstrap/file/bootstrap.go#33</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar.go#L321](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/registrar.go#L321)<br><strong>Comment</strong>: <pre>I think that splitting this to another file will be confusing to future maintainers. You need a very good reaon to do so, for example if the file is huge, say >2000 LOC; or is clearly serving two very different purposes. This is not the case here. Why would you force someone to browse two files for the functionality of the Registrar, which is after all, a very simple thing.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar.go#L321](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/registrar.go#L321)<br><strong>Comment</strong>: <pre>Because it makes identifying migration-related changes easier to identify?

I do not see what the length of the file has to do with splitting.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar_test.go#L39](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/registrar_test.go#L39)<br><strong>Comment</strong>: <pre>We are littering the package namespace with these declarations here. Same goes for TestChainID* below, etc.

All of these should de defined in the scope within which they are used.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar_test.go#L39](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/registrar_test.go#L39)<br><strong>Comment</strong>: <pre>You are absolutely right. I'll fix it. I think the primal sin is that this test is defined in the same package as the production code, though. I'll check if there is an easy fix for that, too.

UPDATE: I checked - changing the package to multichannel_test involves more work then I can afford right now. I recommend  a new JIRA that will refactor registrar_test.go, blockwriter_test.co & util_test.go.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar_test.go#L57](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/registrar_test.go#L57)<br><strong>Comment</strong>: <pre>You are blameless on this, because you are merely extending existing norms, but this is the case where the existing practice needs to die.

init is awful and we need to kill it. Also see: https://peter.bourgon.org/blog/2017/06/09/theory-of-modern-go.html

So please declare/instantiate/initialize within your own test.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar_test.go#L57](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/registrar_test.go#L57)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar_test.go#L77](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/registrar_test.go#L77)<br><strong>Comment</strong>: <pre>This is not a function. It's a throw-away, one-off thing. The logic for this should be included in your test.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar_test.go#L77](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/registrar_test.go#L77)<br><strong>Comment</strong>: <pre>Right now it is a one time thing, correct. However, I plan to use it more than once when I add the "abort path" and "recovery from crashes" test cases. So please bear with me until that is in CR. If by that time I discover that it remains a one time thing - I will refactor it into one of the tests.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar_test.go#L77](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/registrar_test.go#L77)<br><strong>Comment</strong>: <pre>I do not doubt your diligence. I've picked up from other comments in your code (such as the `consensus-type migration` one) that you are being methodical about it. Which is great.

However you're human, and so am I. You make a mental note that you will use it come abort time, but you may forget to do so. I make a mental note that I should make sure you use it come abort time, and I ~may~ WILL forget to do so.

Let us turn this into a function _when_ the need comes.

Besides that however, my fundamental objection does not have to do as much with the fact that you won't re-use it, as it has to do with the fact that this code fragment shouldn't be a function to begin with. In the grand scheme of things this is simply a convenient macro. I had expressed similar concerns in other CRs in the past [1-2]. Our functions should be tightly scoped with a single responsibility and reusability (in the grand scheme of things, not in the "I need to call this set of commands 3 times" sense).

[1] https://gerrit.hyperledger.org/r/c/27163/32/orderer/consensus/etcdraft/chain.go#900
[2] https://gerrit.hyperledger.org/r/c/27163/30/orderer/consensus/etcdraft/chain.go#835</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar_test.go#L77](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/common/multichannel/registrar_test.go#L77)<br><strong>Comment</strong>: <pre>Done. It is now called two times, coupled with a programmatic commitment to complete the abort path test when its done (because the existing one will fail if I don't).</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/consensus.go#L77](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/consensus/consensus.go#L77)<br><strong>Comment</strong>: <pre>Interfaces are defined at the point of consumption - these do not belong here.

Consenter and Chain are defined here because we were looking for an easy way to say to other developers "this is what you need to implement for your own consensus plugin" (we were young and naive).</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/consensus.go#L77](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/consensus/consensus.go#L77)<br><strong>Comment</strong>: <pre>Makes sense. I'll move them to migration.go</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/consensus.go#L77](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/consensus/consensus.go#L77)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/migration.go#L4](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/consensus/migration.go#L4)<br><strong>Comment</strong>: <pre>This file does not belong in this package. You probably need to introduce a migration package.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/migration.go#L4](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/consensus/migration.go#L4)<br><strong>Comment</strong>: <pre>Will do. This will require renaming some of the structs within to avoid stutter.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/migration.go#L22](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/consensus/migration.go#L22)<br><strong>Comment</strong>: <pre>The norm is to group the fields protected by a mutex together with the guarding mutex. Then you can drop all of the comments.

See: https://golang.org/doc/effective_go.html#commentary

> Grouping can also indicate relationships between items, such as the fact that a set of variables is protected by a mutex.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/migration.go#L22](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/consensus/migration.go#L22)<br><strong>Comment</strong>: <pre>Grouping with var () does not work on struct fields.

I prefer extra comments for future generations... and in  case that I will have to revisit this in few months. I restructured them to be clearer, though.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/migration.go#L22](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/consensus/migration.go#L22)<br><strong>Comment</strong>: <pre>I did not mean `var()` grouping. I meant:


```
type foo struct {
	lock sync.Mutex
	bar int
	
	baz string
}
```

The newline gives you a grouping of `lock` and `bar`, suggesting that `lock` guards `bar`. (Which is what you ended up doing as best as I can tell.)</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/migration.go#L22](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/consensus/migration.go#L22)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/migration.go#L23](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/consensus/migration.go#L23)<br><strong>Comment</strong>: <pre>Technically, one can declare a variable of type MigrationStatusImpl with whatever name they wish - it doesn't have to carry "migration" in its name. But realistically it will.

And then your migration* fields will stutter. Let's drop the migration prefix from all the fields.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/migration.go#L23](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/consensus/migration.go#L23)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/migration.go#L29](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/consensus/migration.go#L29)<br><strong>Comment</strong>: <pre>Dots across the comments in this file.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/migration.go#L29](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/consensus/migration.go#L29)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/migration.go#L55](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/consensus/migration.go#L55)<br><strong>Comment</strong>: <pre>returns</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/migration.go#L55](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/consensus/migration.go#L55)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/migration.go#L56](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/consensus/migration.go#L56)<br><strong>Comment</strong>: <pre>This is obvious from the function definition.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/migration.go#L56](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/consensus/migration.go#L56)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/migration.go#L62](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/consensus/migration.go#L62)<br><strong>Comment</strong>: <pre>If this is not needed, let's remove.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/migration.go#L62](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/consensus/migration.go#L62)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/migration.go#L68](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/consensus/migration.go#L68)<br><strong>Comment</strong>: <pre>returns</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/migration.go#L68](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/consensus/migration.go#L68)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/migration.go#L69](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/consensus/migration.go#L69)<br><strong>Comment</strong>: <pre>As above.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/migration.go#L69](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/consensus/migration.go#L69)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/migration.go#L90](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/consensus/migration.go#L90)<br><strong>Comment</strong>: <pre>What's with the sudden linebreak here?</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/migration.go#L90](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/consensus/migration.go#L90)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/migration.go#L91](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/consensus/migration.go#L91)<br><strong>Comment</strong>: <pre>I'm confused, and scared of functions that do two things.

Can we break this down into two separate functions?</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/migration.go#L91](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/consensus/migration.go#L91)<br><strong>Comment</strong>: <pre>When we get a message that is not a COMMIT, we decide whether it is valid and can go through. If it can, we just commit the block to the ledger. 

When we get a message that is a COMMIT, we decide whether it is valid and can go through. If it can, we BOTH commit the block to the ledger AND replace the bootstrap file (genesis block). 

Think of it as a function that returns a ternary value (no-commits, commit-to-ledger-only, commit-to-ledger-and replace-boot-file). I choose to encode it in two booleans for clarity.

This is all done in the kafka/chain.go that invokes this one and receives two boolean return values. Not very complicated. It would actually be convoluted and confusing to split this.

So I prefer not to split.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/migration.go#L91](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/consensus/migration.go#L91)<br><strong>Comment</strong>: <pre>ACK. Will keep it in mind, and thanks for the explanation.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/migration.go#L94](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/consensus/migration.go#L94)<br><strong>Comment</strong>: <pre>This comment does not explain what the method's purpose is however.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/migration.go#L94](https://github.com/hyperledger-gerrit-archive/fabric/blob/3bd6da9d8e07d572b8cf32ee937e7301323fd94f/orderer/consensus/migration.go#L94)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 7</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Uploader</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Created</strong>: 1/9/2019, 9:52:41 AM<br><strong>UnmergedRevision</strong>: [895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09](https://github.com/hyperledger-gerrit-archive/fabric/commit/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/9/2019, 10:00:23 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/9/2019, 10:00:23 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/9/2019, 11:46:48 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/9/2019, 10:38:54 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Approved</strong>: 1/8/2019, 1:09:46 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap.go#L33](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/common/bootstrap/file/bootstrap.go#L33)<br><strong>Comment</strong>: <pre>Can we move all migration-related files to a `migrate.go` file within this package? There is simply no reason for migration related code to exist within `bootstrap.go`.

In Go, code is organized by its functional responsibilities, and using multiple files is encouraged.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap.go#L33](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/common/bootstrap/file/bootstrap.go#L33)<br><strong>Comment</strong>: <pre>In principle, you are correct. However I think in this case that would be a wrong interpretation of the principle. This is a package that deals with boostrap/file, and it just defines two capabilities on the file: read a block, and replace a block (while creating a backup). Note also that this is not a functionality that is specific to migration, it just replaces the file with another block, and is completely generic... one may find uses for this in other parts of the code someday. The "replace" does not belong in a file "migration", just like the "read" does not belong in file "server-main".

Note that only the comment mentions that it is used in migration, again, because of my policy to put "consensus-type migration" wherever I add stuff, for the benefit of being able so search for it.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap.go#L33](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/common/bootstrap/file/bootstrap.go#L33)<br><strong>Comment</strong>: <pre>You're right! I stand corrected on this one.

Done.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap_test.go#L9](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/common/bootstrap/file/bootstrap_test.go#L9)<br><strong>Comment</strong>: <pre>Nit: blank line.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap_test.go#L9](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/common/bootstrap/file/bootstrap_test.go#L9)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap_test.go#L20](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/common/bootstrap/file/bootstrap_test.go#L20)<br><strong>Comment</strong>: <pre>This is polluting the namespace. Fixed it by changing the package name.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap_test.go#L23](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/common/bootstrap/file/bootstrap_test.go#L23)<br><strong>Comment</strong>: <pre>Nit: blank line.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap_test.go#L23](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/common/bootstrap/file/bootstrap_test.go#L23)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap_test.go#L41](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/common/bootstrap/file/bootstrap_test.go#L41)<br><strong>Comment</strong>: <pre>Let's declare and instantiate the variables within the scope that they're used. Unless I'm mistaken, all of these variables are only used in the `GenesisBlock` sub-test, so let's move them there.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap_test.go#L41](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/common/bootstrap/file/bootstrap_test.go#L41)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap_test.go#L43](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/common/bootstrap/file/bootstrap_test.go#L43)<br><strong>Comment</strong>: <pre>Nit: Curious, why e2e? This is not end-to-end testing?</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap_test.go#L43](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/common/bootstrap/file/bootstrap_test.go#L43)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap_test.go#L71](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/common/bootstrap/file/bootstrap_test.go#L71)<br><strong>Comment</strong>: <pre>The parent test is TestGenesisBlock. This test case needs a more descriptive name.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap_test.go#L71](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/common/bootstrap/file/bootstrap_test.go#L71)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap_test.go#L83](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/common/bootstrap/file/bootstrap_test.go#L83)<br><strong>Comment</strong>: <pre>Do we need the dot here? You don't have it in the previous error messages above (but you do on the ones below). I'm good with either choice, as long as we're consistent.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap_test.go#L83](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/common/bootstrap/file/bootstrap_test.go#L83)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap_test.go#L97](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/common/bootstrap/file/bootstrap_test.go#L97)<br><strong>Comment</strong>: <pre>Blank line.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap_test.go#L154](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/common/bootstrap/file/bootstrap_test.go#L154)<br><strong>Comment</strong>: <pre>Do we want the assert package here, or the require one?

https://godoc.org/github.com/stretchr/testify/require

Put differently, if this call fails, is there any point in proceeding with test execution?</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap_test.go#L154](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/common/bootstrap/file/bootstrap_test.go#L154)<br><strong>Comment</strong>: <pre>Good catch, thanks!</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap_test.go#L162](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/common/bootstrap/file/bootstrap_test.go#L162)<br><strong>Comment</strong>: <pre>We need to turn all of the expected values in this series of assertions should be references to the variables in lines 132-146.

This helps with both:
1. duplication (rather the avoidance of it), and
2. expressing intent. "I want you to be equal to 'def'" is different to "I want you to be equal to the content of the block I marshaled in the beginning (and which I passed on the replacer)." The latter is preferable.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap_test.go#L162](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/common/bootstrap/file/bootstrap_test.go#L162)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap_test.go#L187](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/common/bootstrap/file/bootstrap_test.go#L187)<br><strong>Comment</strong>: <pre>This does not read like a phrase? Same below with the ", origin" idiom.

In general, keep in mind that the failing test's name will also be printed. If the tests are nested properly and are singularly focused, it should be obvious whether we're talking about backup or foo or bar.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap_test.go#L187](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/common/bootstrap/file/bootstrap_test.go#L187)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap_test.go#L213](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/common/bootstrap/file/bootstrap_test.go#L213)<br><strong>Comment</strong>: <pre>Leaving this comment for last.

I think in general, it'd be useful to have a look at how ginkgo and nested specs can be used to avoid the repetition of boilerplate setup code, a pattern that I see throughout your tests here.

Have a look at the blockcutter tests here, and how they were rewritten: https://gerrit.hyperledger.org/r/c/27834/

Jason had written the pros about the benefits of this ginkgo-based approach to testing way better than I could have, and I'm reposting his take here (with permission):

> Everything's the same now as with normal go test, but then under go test to exercise a failure or odd condition, I would basically need to either:
>
> a) copy all of that boilerplate setup into the new test [the maintenance is a nightmare, especially for say, adding a new thing like metrics which must get initialized]
> b) factor that setup out into a function [works okay, but with nested setup, it becomes hard to expose the setup to mutation]
> c) cherry-pick the bits of the boilerplate that matters. [I really dislike this, because it makes your code very brittle, and epitomizes 'bad unit tests' to me]
>
> But, in ginkgo-land instead, I add a new `Context` section, which includes its own `BeforeEach`, since this section runs _after_ the one in the outer layer of the `Describe`, I can already assume all of that setup has been done for me, and I just go and override the bits of the setup that need to change, the return value of some mock method for instance. There's none of the repetition from (a), because everything is wired with scopes vars you don't have to worry about the headaches of exposing the setup pieces like (b), and finally you already know that things are configured for the green path to work, so you may refactor your code safely without worrying about false positives from the unit tests like in (c).</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap_test.go#L213](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/common/bootstrap/file/bootstrap_test.go#L213)<br><strong>Comment</strong>: <pre>I completely agree. 
I suggest you put a JIRA "rewrite all orderer/common tests with ginkgo" and prioritize it. 

I was simply following the convention I found in each test I stumbled upon across the way. Some were good, some were bad, and some were ugly...

I was focusing on getting this:

PASS
coverage: 91.2% of statements

I think coverage is more important then form.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap_test.go#L213](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/common/bootstrap/file/bootstrap_test.go#L213)<br><strong>Comment</strong>: <pre>> I think coverage is more important then form.

I disagree with that. Form is what helps us maintain these tests as we extend the functionality, and developers come and go.

I'm torn as to what the right call is here, as the request does feel a bit "boil-the-ocean-y".

I'll let other maintainers chime in. (Do create that JIRA nonetheless though.)</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap_test.go#L213](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/common/bootstrap/file/bootstrap_test.go#L213)<br><strong>Comment</strong>: <pre>My $0.02.

The existing tests in this package are, as noted quite bad (it was the pattern at the time, and I have written more than my share of bad tests, so I don't mean this as attack on the original committer).  I would consider them to be debt, and extending them and their pattern is extending that debt.

Of course I realize the goal here is to get Raft functionality done, and rewriting tests is an obstacle to that.  However, the tests here are quite simple.  Approximately 60 lines (likely less).  And, they could be rewritten in Ginkgo in a matter of an hour or so.  So, to me, taking the time to refactor the tests before extending a bad pattern.

In this particular instance, I would defer to Kostas as leading the Raft effort, but were it me, I would insist on the test rewrite.

And, although I should probably simply let this one go:

> I think coverage is more important then form.

I cannot disagree more with this statement.  Code coverage may be an easily quantifiable metric, but I would much rather have 75% code coverage with well architected, meaningful, and maintainable tests, than 95% code coverage of bad tests.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap_test.go#L213](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/common/bootstrap/file/bootstrap_test.go#L213)<br><strong>Comment</strong>: <pre>Just to add, when I mention that this is '60 lines', I do mean only the bootstrap test.  Obviously this is a large CR, and there is more than hour of work here.  But, consider likewise that we are multiplying the technical debt by an equal magnitude of the effort required to fix the tests.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap_test.go#L213](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/common/bootstrap/file/bootstrap_test.go#L213)<br><strong>Comment</strong>: <pre>Jason, thanks for chiming in. I agree with your suggestion -- let's address this debt now.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap_test.go#L213](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/common/bootstrap/file/bootstrap_test.go#L213)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap_test.go#L213](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/common/bootstrap/file/bootstrap_test.go#L213)<br><strong>Comment</strong>: <pre>This is the JIRA https://jira.hyperledger.org/browse/FAB-13246</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/blockwriter_test.go#L160](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/common/multichannel/blockwriter_test.go#L160)<br><strong>Comment</strong>: <pre>Where else do we see blank lines after the function name?</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/blockwriter_test.go#L160](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/common/multichannel/blockwriter_test.go#L160)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/blockwriter_test.go#L165](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/common/multichannel/blockwriter_test.go#L165)<br><strong>Comment</strong>: <pre>Why is this a sub-test? We only have one test.

Also the parent test is called `TestGoodWriteConfig`.

What additional value do we get out of "Test WriteConfig - ok" as the name of this sub-test?</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/blockwriter_test.go#L165](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/common/multichannel/blockwriter_test.go#L165)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar_test.go#L36](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/common/multichannel/registrar_test.go#L36)<br><strong>Comment</strong>: <pre>Why do we need this function?

xAndY is always a code smell. A function should one thing.

Also see comments below.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar_test.go#L36](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/common/multichannel/registrar_test.go#L36)<br><strong>Comment</strong>: <pre>Actually, newRAMLedger(...) is the smell because it just erases one return value fro this. Removed it.

This one is fine, just returns a factory and a ledger, which is used extensively across the tests (8 times, to be precise).</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar_test.go#L105](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/common/multichannel/registrar_test.go#L105)<br><strong>Comment</strong>: <pre>No.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/registrar_test.go#L105](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/common/multichannel/registrar_test.go#L105)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/inactive/inactive_chain.go#L48](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/inactive/inactive_chain.go#L48)<br><strong>Comment</strong>: <pre>You can skip this comment, the same we do for all methods in this file. (We've documented the description in `consenter.go`.)</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/inactive/inactive_chain.go#L48](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/inactive/inactive_chain.go#L48)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain.go#L118](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/kafka/chain.go#L118)<br><strong>Comment</strong>: <pre>Define an interface locally with the methods you want the `migrationStatus` field to implement. This is the type of the field. You shouldn't have to care about the implementation, only about the expected behavior.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain.go#L118](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/kafka/chain.go#L118)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain.go#L218](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/kafka/chain.go#L218)<br><strong>Comment</strong>: <pre>Across all log messages in this file, this is a bracketed prefix, not a suffix. Can we adjust accordingly?</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain.go#L218](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/kafka/chain.go#L218)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain.go#L219](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/kafka/chain.go#L219)<br><strong>Comment</strong>: <pre>See my comment about line-breaking variables elsewhere in this CR. We are not being consistent about it.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain.go#L219](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/kafka/chain.go#L219)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain.go#L243](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/kafka/chain.go#L243)<br><strong>Comment</strong>: <pre>See comment below.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain.go#L243](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/kafka/chain.go#L243)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain.go#L248](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/kafka/chain.go#L248)<br><strong>Comment</strong>: <pre>Let's a create a string containing the message of interest, and let's print that to screen using the logger, and return it as an error to the caller as well.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain.go#L248](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/kafka/chain.go#L248)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain.go#L905](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/kafka/chain.go#L905)<br><strong>Comment</strong>: <pre>Line-break.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain.go#L905](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/kafka/chain.go#L905)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/consenter.go#L20](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/kafka/consenter.go#L20)<br><strong>Comment</strong>: <pre>No. We want a variable name that alludes to the fact that this is a migration controller.

The fact that we're implementing this by passing in the multichannel.Registrar is irrelevant.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/consenter.go#L20](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/kafka/consenter.go#L20)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/consenter.go#L41](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/kafka/consenter.go#L41)<br><strong>Comment</strong>: <pre>As above, this is the wrong name for the field. You're not looking for the registrar here. You're looking for whatever, as long as it implements migration.Controller.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/consenter.go#L41](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/kafka/consenter.go#L41)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/consenter.go#L58](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/kafka/consenter.go#L58)<br><strong>Comment</strong>: <pre>filename</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/consenter.go#L58](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/kafka/consenter.go#L58)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/consenter.go#L61](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/kafka/consenter.go#L61)<br><strong>Comment</strong>: <pre>*All* of these consensus-type migration-related fields are not/should not be first class citizens in the `consenterImpl` type definition.

Create a `migrate` field and a corresponding type, and encapsulate all of the fields that you need to coordinate consensus-type implementation inside that field. Bonus points if we do this in a `migrate.go` file.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/consenter.go#L61](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/kafka/consenter.go#L61)<br><strong>Comment</strong>: <pre>I believe I solved this in a much more elegant way.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/consenter.go#L61](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/kafka/consenter.go#L61)<br><strong>Comment</strong>: <pre>Let's continue the discussion here:
https://gerrit.hyperledger.org/r/#/c/28707/</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/consenter.go#L83](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/kafka/consenter.go#L83)<br><strong>Comment</strong>: <pre>As above, let's define a migration-related interface with the methods that are useful, and let's embed this interface anonymously inside the `commonConsenter` one.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/consenter.go#L83](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/kafka/consenter.go#L83)<br><strong>Comment</strong>: <pre>I believe I solved this in a much more elegant way.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/consenter.go#L83](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/kafka/consenter.go#L83)<br><strong>Comment</strong>: <pre>Are you saying that the existing implementation is more elegant, or the one that you're working on?</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/consenter.go#L99](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/kafka/consenter.go#L99)<br><strong>Comment</strong>: <pre>"passed-in migration.Controller implementation, which coordinates consensus-type migration.
(Optional) This is implemented the multichannel.Registrar."</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/consenter.go#L99](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/kafka/consenter.go#L99)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/consenter.go#L132](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/kafka/consenter.go#L132)<br><strong>Comment</strong>: <pre>migrate.go</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/consenter.go#L132](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/kafka/consenter.go#L132)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/migration/migration.go#L17](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/migration/migration.go#L17)<br><strong>Comment</strong>: <pre>Nit: blank line.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/migration/migration.go#L17](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/migration/migration.go#L17)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/migration/migration.go#L18](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/migration/migration.go#L18)<br><strong>Comment</strong>: <pre>n. (repeat as needed throughout the file)</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/migration/migration.go#L18](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/migration/migration.go#L18)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/migration/migration.go#L37](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/migration/migration.go#L37)<br><strong>Comment</strong>: <pre>I gotta ask: what dictates where the line-breaks go? The line-breaking here seems completely arbitrary.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/migration/migration.go#L37](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/migration/migration.go#L37)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/migration/migration.go#L66](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/migration/migration.go#L66)<br><strong>Comment</strong>: <pre>(Excellent documentation here. Thanks!)</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/migration/migration.go#L68](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/migration/migration.go#L68)<br><strong>Comment</strong>: <pre>Nit: newline.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/migration/migration.go#L68](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/migration/migration.go#L68)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/migration/migration.go#L116](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/migration/migration.go#L116)<br><strong>Comment</strong>: <pre>We can just have this statement outside of the if-else construct. (And in fact your Go linter will advise you to do the same.)

```
if ms.systemChannel {
    return foo
}

return bar
```</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/migration/migration.go#L116](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/migration/migration.go#L116)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/migration/migration.go#L129](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/migration/migration.go#L129)<br><strong>Comment</strong>: <pre>This means that IsCommitted always returns false for an application channel. Is that what we want?</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/migration/migration.go#L129](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/migration/migration.go#L129)<br><strong>Comment</strong>: <pre>Correct</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/migration/migration.go#L137](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/migration/migration.go#L137)<br><strong>Comment</strong>: <pre>%t - it's a boolean.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/migration/migration.go#L137](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/migration/migration.go#L137)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/migration/migration.go#L147](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/migration/migration.go#L147)<br><strong>Comment</strong>: <pre>I don't quite get this :-(

First of all, as a reader, I think it'd be useful to explain who the caller is. Hopefully this will shine light into how the input arguments are set. If not, this needs to be explained as well.

Then, I'm really not sure what dictates whether a valid COMMIT "can go through".

Comments are not meant to substitute documentation or go over the how, so there's no need to go crazy with detail here, but let's be just descriptive enough to hold the reader's hand.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/migration/migration.go#L147](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/migration/migration.go#L147)<br><strong>Comment</strong>: <pre>I'll rephrase.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/migration/migration.go#L150](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/migration/migration.go#L150)<br><strong>Comment</strong>: <pre>I do not follow this.

Perhaps it's better to add this comment where the method is called?

Or maybe rephrase it as a call to action? "If you intend to call X, make sure you do Y!"</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/migration/migration.go#L150](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/migration/migration.go#L150)<br><strong>Comment</strong>: <pre>The registrar is calling individual migration.Status objects, which take the mutex. I am merely documenting the fact that from here, the registrar should never be called with the mutex taken. 

I will rephrase.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/migration/migration.go#L163](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/migration/migration.go#L163)<br><strong>Comment</strong>: <pre>This will print out `state`, `context`, and `sys`. Yet on this same line we also refer to `sys` as `system` (system=%v) and to `context` as `ctx` (ctx=%d).

Let's decide whether we're going with full names, abbreviations, camel-case, variable names, whatever, and stick with it throughout this line of work.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/migration/migration.go#L163](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/migration/migration.go#L163)<br><strong>Comment</strong>: <pre>Have a look into the logger's `With` method which allows you to add KV pairs to your logger output.

We've gotten into the habit of doing this recently, so I'd look into the `etcdraft` package (or Yacov's work on the cluster?) for examples. The first one that comes to mind is [1].

Feel free to edit accordingly across your changes throughout this CR, especially for new files. (i.e. Let's not try to boil the ocean by fixing all the old files you're touching, but let's be good citizens with any files that we're adding.)

[1] https://github.com/hyperledger/fabric/blob/de0f5914ca3ad9bb70f7876a7160009803501b6d/orderer/consensus/etcdraft/chain.go#L156</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/migration/migration.go#L163](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/migration/migration.go#L163)<br><strong>Comment</strong>: <pre>The %v verb will work because Go is smart enough, but we know the type already (boolean), and we know that %t is the right verb for booleans, so let's go with that.

I will also note that most of your debug messages are a bit more codified and succinct than they probably should be. If you're the one debugging this in prod, we're golden ;) But if not, it would probably help to be a tiny bit more verbose. For instance is it "Type", or would "Next Type" be more accurate? Just another thing to keep in mind as you write this. I won't stand much in the way of this.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/migration/migration.go#L163](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/migration/migration.go#L163)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/migration/migration.go#L163](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/migration/migration.go#L163)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/migration/migration.go#L163](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/migration/migration.go#L163)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/migration/migration.go#L187](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/migration/migration.go#L187)<br><strong>Comment</strong>: <pre>These are default values for booleans, no need for this initialization.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/migration/migration.go#L187](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/migration/migration.go#L187)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/migration/migration.go#L226](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/migration/migration.go#L226)<br><strong>Comment</strong>: <pre>When can we reach this case?</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/migration/migration.go#L226](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/migration/migration.go#L226)<br><strong>Comment</strong>: <pre>When the user (admin) sends another COMMIT after the first one was applied, before the orderer is restarted.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/migration/migration.go#L241](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/migration/migration.go#L241)<br><strong>Comment</strong>: <pre>We have a longer logger line 4 lines above, where we don't line break between the spec and the variable names. Why do we this here? Let's mitigate those inconsistencies.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/migration/migration.go#L241](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/migration/migration.go#L241)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/migration/migration.go#L244](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/migration/migration.go#L244)<br><strong>Comment</strong>: <pre>Nit: line-breaks. I don't *think* I've seen a single line-break in switch statements throughout the codebase.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/migration/migration.go#L244](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/migration/migration.go#L244)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/migration/migration.go#L254](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/migration/migration.go#L254)<br><strong>Comment</strong>: <pre>Two things:

1. We've had the Status struct implement the Stringer interface (which is great!). If we're saying that the status is unexpected, why don't we just fmt.Printf("status: %s", ms), and we go over its components one-by-one again?
2. I would imagine that we'd also want the *next* values printed out here, so as to make debugging easier?</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/migration/migration.go#L254](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/migration/migration.go#L254)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/migration/migration_test.go#L1](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/migration/migration_test.go#L1)<br><strong>Comment</strong>: <pre>I have to ask whether we're sure we need 500 lines of tests here, and whether the ginkgo-based common-boilerplate approach that I pointed to earlier cannot save us from a lot of duplication? (Either in the set-up, or in the assertion phase.)

Give it some thought, and LMK.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/migration/migration_test.go#L1](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/migration/migration_test.go#L1)<br><strong>Comment</strong>: <pre>Alas, we have to, and ginkgo would not help us here.

PASS
coverage: 93.7% of statements</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/migration/migration_test.go#L17](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/migration/migration_test.go#L17)<br><strong>Comment</strong>: <pre>All of these linebreaks before the function's body must die :)</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/migration/migration_test.go#L17](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/migration/migration_test.go#L17)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/migration/migration_test.go#L23](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/migration/migration_test.go#L23)<br><strong>Comment</strong>: <pre>Why aren't we putting a reference to the expected variable here, and instead we repeat its contents? The current practice goes both against the DRY principle and also makes debugging harder. If I were to change the `expected` variable w/o updating the error message, I'd be scratching my head.

If we instead put a reference to the expected variable in the error message, we'll only need to do one modification.

(Repeat throughout this CR as applicable.)</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/migration/migration_test.go#L23](https://github.com/hyperledger-gerrit-archive/fabric/blob/895a320b3d75e9889f50fbd1ac5ebb4bbb4cad09/orderer/consensus/migration/migration_test.go#L23)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 8</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Uploader</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Created</strong>: 1/10/2019, 6:39:49 AM<br><strong>UnmergedRevision</strong>: [a9464a78560396ef24e734b0143f1663a9ff8327](https://github.com/hyperledger-gerrit-archive/fabric/commit/a9464a78560396ef24e734b0143f1663a9ff8327)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/10/2019, 6:47:56 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Approved</strong>: 1/8/2019, 1:09:46 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 9</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Uploader</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Created</strong>: 1/10/2019, 6:59:19 AM<br><strong>UnmergedRevision</strong>: [13f03ff30a08d4d0b6b0050298c48c557c0f5d26](https://github.com/hyperledger-gerrit-archive/fabric/commit/13f03ff30a08d4d0b6b0050298c48c557c0f5d26)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/10/2019, 7:08:28 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/10/2019, 7:08:28 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/10/2019, 7:46:28 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/10/2019, 11:16:47 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Approved</strong>: 1/8/2019, 1:09:46 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Approved</strong>: 1/10/2019, 9:53:45 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L147](https://github.com/hyperledger-gerrit-archive/fabric/blob/13f03ff30a08d4d0b6b0050298c48c557c0f5d26/orderer/consensus/etcdraft/chain.go#L147)<br><strong>Comment</strong>: <pre>See comment in kafka/chain.go about the type of this field.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L147](https://github.com/hyperledger-gerrit-archive/fabric/blob/13f03ff30a08d4d0b6b0050298c48c557c0f5d26/orderer/consensus/etcdraft/chain.go#L147)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L207](https://github.com/hyperledger-gerrit-archive/fabric/blob/13f03ff30a08d4d0b6b0050298c48c557c0f5d26/orderer/consensus/etcdraft/chain.go#L207)<br><strong>Comment</strong>: <pre>Same comments apply as in the kafka package. Create a single type that contains everything migration-related, and use that to encapsulate all migration-related fields. I get that you only have one field here, but you still need the type for consistency with the kafka chain.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L207](https://github.com/hyperledger-gerrit-archive/fabric/blob/13f03ff30a08d4d0b6b0050298c48c557c0f5d26/orderer/consensus/etcdraft/chain.go#L207)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L274](https://github.com/hyperledger-gerrit-archive/fabric/blob/13f03ff30a08d4d0b6b0050298c48c557c0f5d26/orderer/consensus/etcdraft/chain.go#L274)<br><strong>Comment</strong>: <pre>migrate.go</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L274](https://github.com/hyperledger-gerrit-archive/fabric/blob/13f03ff30a08d4d0b6b0050298c48c557c0f5d26/orderer/consensus/etcdraft/chain.go#L274)<br><strong>Comment</strong>: <pre>A new file for one method? really?</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/consenter.go#L122](https://github.com/hyperledger-gerrit-archive/fabric/blob/13f03ff30a08d4d0b6b0050298c48c557c0f5d26/orderer/consensus/etcdraft/consenter.go#L122)<br><strong>Comment</strong>: <pre>Is this a TODO? (Same question for line 138?)</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/consenter.go#L122](https://github.com/hyperledger-gerrit-archive/fabric/blob/13f03ff30a08d4d0b6b0050298c48c557c0f5d26/orderer/consensus/etcdraft/consenter.go#L122)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/consenter.go#L123](https://github.com/hyperledger-gerrit-archive/fabric/blob/13f03ff30a08d4d0b6b0050298c48c557c0f5d26/orderer/consensus/etcdraft/consenter.go#L123)<br><strong>Comment</strong>: <pre>I get that it's a debug statement, but `SharedConfig()` and `meta-len` is not the way to go. Let's try to write polished, consistent messages.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/consenter.go#L123](https://github.com/hyperledger-gerrit-archive/fabric/blob/13f03ff30a08d4d0b6b0050298c48c557c0f5d26/orderer/consensus/etcdraft/consenter.go#L123)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/consenter.go#L127](https://github.com/hyperledger-gerrit-archive/fabric/blob/13f03ff30a08d4d0b6b0050298c48c557c0f5d26/orderer/consensus/etcdraft/consenter.go#L127)<br><strong>Comment</strong>: <pre>Why do we need the space if we line-break?</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/consenter.go#L127](https://github.com/hyperledger-gerrit-archive/fabric/blob/13f03ff30a08d4d0b6b0050298c48c557c0f5d26/orderer/consensus/etcdraft/consenter.go#L127)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain.go#L921](https://github.com/hyperledger-gerrit-archive/fabric/blob/13f03ff30a08d4d0b6b0050298c48c557c0f5d26/orderer/consensus/kafka/chain.go#L921)<br><strong>Comment</strong>: <pre>Nit: As I've wrote elsewhere, I do not understand why we suddenly decide to switch our line-breaking strategy.

If we care about all line being of equal length (which is not a bad idea!), this should apply across the snippet in lines 915-921.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain.go#L921](https://github.com/hyperledger-gerrit-archive/fabric/blob/13f03ff30a08d4d0b6b0050298c48c557c0f5d26/orderer/consensus/kafka/chain.go#L921)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain.go#L922](https://github.com/hyperledger-gerrit-archive/fabric/blob/13f03ff30a08d4d0b6b0050298c48c557c0f5d26/orderer/consensus/kafka/chain.go#L922)<br><strong>Comment</strong>: <pre>--> migrate.go</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain.go#L922](https://github.com/hyperledger-gerrit-archive/fabric/blob/13f03ff30a08d4d0b6b0050298c48c557c0f5d26/orderer/consensus/kafka/chain.go#L922)<br><strong>Comment</strong>: <pre>This is an envelope. Not a context.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain.go#L922](https://github.com/hyperledger-gerrit-archive/fabric/blob/13f03ff30a08d4d0b6b0050298c48c557c0f5d26/orderer/consensus/kafka/chain.go#L922)<br><strong>Comment</strong>: <pre>ctx stands for config-tx. I renamed it.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain.go#L922](https://github.com/hyperledger-gerrit-archive/fabric/blob/13f03ff30a08d4d0b6b0050298c48c557c0f5d26/orderer/consensus/kafka/chain.go#L922)<br><strong>Comment</strong>: <pre>need chain.CreateNextBlock here, no easy way to move it. Let me think about it.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain.go#L922](https://github.com/hyperledger-gerrit-archive/fabric/blob/13f03ff30a08d4d0b6b0050298c48c557c0f5d26/orderer/consensus/kafka/chain.go#L922)<br><strong>Comment</strong>: <pre>Right. My point was that in almost every Go package, ctx is reserved as the variable name for context.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain.go#L930](https://github.com/hyperledger-gerrit-archive/fabric/blob/13f03ff30a08d4d0b6b0050298c48c557c0f5d26/orderer/consensus/kafka/chain.go#L930)<br><strong>Comment</strong>: <pre>Have we considered whether panicking here (and across your code) leaves us at a state of no return? It's OK if we haven't considered this yet, but we must for obvious reasons.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain.go#L930](https://github.com/hyperledger-gerrit-archive/fabric/blob/13f03ff30a08d4d0b6b0050298c48c557c0f5d26/orderer/consensus/kafka/chain.go#L930)<br><strong>Comment</strong>: <pre>This is no different than what happens in the blockwriter and everywhere else in the code. I merely copied the standard in this component. However, your point is valid. The possibility of panic in the middle of migration (from here or anywhere else) should be addressed. I'll do that in the JIRA that handles with crashes and recovery from them.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain.go#L989](https://github.com/hyperledger-gerrit-archive/fabric/blob/13f03ff30a08d4d0b6b0050298c48c557c0f5d26/orderer/consensus/kafka/chain.go#L989)<br><strong>Comment</strong>: <pre>Do we have a JIRA for this under the migration story?</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain.go#L989](https://github.com/hyperledger-gerrit-archive/fabric/blob/13f03ff30a08d4d0b6b0050298c48c557c0f5d26/orderer/consensus/kafka/chain.go#L989)<br><strong>Comment</strong>: <pre>yes: https://jira.hyperledger.org/browse/FAB-13496</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain.go#L990](https://github.com/hyperledger-gerrit-archive/fabric/blob/13f03ff30a08d4d0b6b0050298c48c557c0f5d26/orderer/consensus/kafka/chain.go#L990)<br><strong>Comment</strong>: <pre>Broadcast</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain.go#L990](https://github.com/hyperledger-gerrit-archive/fabric/blob/13f03ff30a08d4d0b6b0050298c48c557c0f5d26/orderer/consensus/kafka/chain.go#L990)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain_test.go#L2248](https://github.com/hyperledger-gerrit-archive/fabric/blob/13f03ff30a08d4d0b6b0050298c48c557c0f5d26/orderer/consensus/kafka/chain_test.go#L2248)<br><strong>Comment</strong>: <pre>JIRA?</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain_test.go#L2248](https://github.com/hyperledger-gerrit-archive/fabric/blob/13f03ff30a08d4d0b6b0050298c48c557c0f5d26/orderer/consensus/kafka/chain_test.go#L2248)<br><strong>Comment</strong>: <pre>Yes: https://jira.hyperledger.org/browse/FAB-13246</pre></blockquote><h3>PatchSet Number: 10</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Uploader</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Created</strong>: 1/13/2019, 10:10:20 AM<br><strong>UnmergedRevision</strong>: [3375f038ec8bd6ac4d098eb4e8c0aec25d71cf12](https://github.com/hyperledger-gerrit-archive/fabric/commit/3375f038ec8bd6ac4d098eb4e8c0aec25d71cf12)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/13/2019, 10:17:22 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/13/2019, 10:17:22 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/13/2019, 10:55:39 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/14/2019, 6:25:28 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Approved</strong>: 1/8/2019, 1:09:46 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 11</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Uploader</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Created</strong>: 1/14/2019, 11:40:01 AM<br><strong>UnmergedRevision</strong>: [c95549bd946c6e675b6b55d3037271c230283f82](https://github.com/hyperledger-gerrit-archive/fabric/commit/c95549bd946c6e675b6b55d3037271c230283f82)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/14/2019, 11:48:57 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/14/2019, 11:48:57 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/14/2019, 12:26:45 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/14/2019, 12:21:16 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Approved</strong>: 1/8/2019, 1:09:46 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 12</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Uploader</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Created</strong>: 1/17/2019, 5:08:30 AM<br><strong>UnmergedRevision</strong>: [6da0b1e037cdd9b1e2746f10ea3213ec4ceb7c05](https://github.com/hyperledger-gerrit-archive/fabric/commit/6da0b1e037cdd9b1e2746f10ea3213ec4ceb7c05)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/14/2019, 11:48:57 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/14/2019, 11:48:57 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/14/2019, 12:26:45 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/14/2019, 12:21:16 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Approved</strong>: 1/8/2019, 1:09:46 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 13</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Uploader</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Created</strong>: 1/17/2019, 2:49:05 PM<br><strong>UnmergedRevision</strong>: [993a90ed57f8e7c00991a5393794736b768db7af](https://github.com/hyperledger-gerrit-archive/fabric/commit/993a90ed57f8e7c00991a5393794736b768db7af)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/14/2019, 11:48:57 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/14/2019, 11:48:57 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/14/2019, 12:26:45 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/14/2019, 12:21:16 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Approved</strong>: 1/8/2019, 1:09:46 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 14</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Uploader</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Created</strong>: 1/21/2019, 9:43:37 AM<br><strong>UnmergedRevision</strong>: [fb903b24b0295e69b5e1a18431e121efa534c9be](https://github.com/hyperledger-gerrit-archive/fabric/commit/fb903b24b0295e69b5e1a18431e121efa534c9be)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/14/2019, 11:48:57 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/14/2019, 11:48:57 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/14/2019, 12:26:45 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/14/2019, 12:21:16 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Approved</strong>: 1/8/2019, 1:09:46 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/bootstrap.go#L22](https://github.com/hyperledger-gerrit-archive/fabric/blob/fb903b24b0295e69b5e1a18431e121efa534c9be/orderer/common/bootstrap/bootstrap.go#L22)<br><strong>Comment</strong>: <pre>why do we need this interface?</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/bootstrap.go#L22](https://github.com/hyperledger-gerrit-archive/fabric/blob/fb903b24b0295e69b5e1a18431e121efa534c9be/orderer/common/bootstrap/bootstrap.go#L22)<br><strong>Comment</strong>: <pre>I wanted to follow the design pattern in this package - i.e. mimic how Helper.GenesisBlock() is implemented. This is kind of like the "Reader" "Writer" interfaces in the io package. It is implemented by bootstrap/file. I agree that if I had to design this upfront I would have probably  done something different; but given that I am just extending this package, and that I want to minimize changes to parts of the code-base not related to migration, I decided to continue with the line that the original writer of the package chose to implement.</pre><strong>Commenter</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/bootstrap.go#L22](https://github.com/hyperledger-gerrit-archive/fabric/blob/fb903b24b0295e69b5e1a18431e121efa534c9be/orderer/common/bootstrap/bootstrap.go#L22)<br><strong>Comment</strong>: <pre>Understood. Although I would still argue that your code works just fine without defining extra interface, and can be more concise that way. I would say correct pattern beats consistency here. With this being said, i'm not strongly against it and let's see what others think</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/bootstrap.go#L22](https://github.com/hyperledger-gerrit-archive/fabric/blob/fb903b24b0295e69b5e1a18431e121efa534c9be/orderer/common/bootstrap/bootstrap.go#L22)<br><strong>Comment</strong>: <pre>I don't see how this violates any pattern. Returning an interface that provides just what the consumer needs and no more is a correct pattern in OOP.</pre><strong>Commenter</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap.go#L29](https://github.com/hyperledger-gerrit-archive/fabric/blob/fb903b24b0295e69b5e1a18431e121efa534c9be/orderer/common/bootstrap/file/bootstrap.go#L29)<br><strong>Comment</strong>: <pre>why can't we return the struct here? and why do we need this initializer?</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap.go#L29](https://github.com/hyperledger-gerrit-archive/fabric/blob/fb903b24b0295e69b5e1a18431e121efa534c9be/orderer/common/bootstrap/file/bootstrap.go#L29)<br><strong>Comment</strong>: <pre>Again, I am doing the same as "New(fileName string) bootstrap.Helper" does. It is a design pattern that aims to hide the implementation from the consumer of the package. Here, struct fileBootstrapper is package scope, and cannot be exposed directly to users outside of the package. ote that package bootstrap/file simply exposes 2 methods that deal with the bootstrap-file: reading, and replacing. This actually a very common design pattern in OOP.</pre><strong>Commenter</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap.go#L29](https://github.com/hyperledger-gerrit-archive/fabric/blob/fb903b24b0295e69b5e1a18431e121efa534c9be/orderer/common/bootstrap/file/bootstrap.go#L29)<br><strong>Comment</strong>: <pre>This is in line with the interface argument in previous file. If we simply use an exposed struct, this slim constructor is unnecessary. And I don't see the value of hiding this struct from users with constructor. As people say, we should follow the "Go way".

Again, not a big deal, we could perhaps roll with this.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap.go#L29](https://github.com/hyperledger-gerrit-archive/fabric/blob/fb903b24b0295e69b5e1a18431e121efa534c9be/orderer/common/bootstrap/file/bootstrap.go#L29)<br><strong>Comment</strong>: <pre>Again, same comment as before. This is a common and correct pattern in OOP. The "Go way" is no argument at all, software engineering patterns are valid in Go as well, and most GoF patterns can be implemented in Go just like in Java and C++ and so on.</pre><strong>Commenter</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap.go#L77](https://github.com/hyperledger-gerrit-archive/fabric/blob/fb903b24b0295e69b5e1a18431e121efa534c9be/orderer/common/bootstrap/file/bootstrap.go#L77)<br><strong>Comment</strong>: <pre>don't we need to restore backup here?</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap.go#L77](https://github.com/hyperledger-gerrit-archive/fabric/blob/fb903b24b0295e69b5e1a18431e121efa534c9be/orderer/common/bootstrap/file/bootstrap.go#L77)<br><strong>Comment</strong>: <pre>I thought about it, and figured out that it would probably be impossible. Most likely the failure is due to the fact that the file has only read permission, and cannot be written. In this case, there is no point to try and restore... 

However, your comment made me realize that I could check whether that file is writable well prior to commit... I could check "IsWritable()" during start! If it is not, I will not permit migration to start, knowing it is doomed to fail.

Another thing I could do in case of failure is compare the backup file to the original file and check whether the origin is intact or corrupt.</pre><strong>Commenter</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap.go#L77](https://github.com/hyperledger-gerrit-archive/fabric/blob/fb903b24b0295e69b5e1a18431e121efa534c9be/orderer/common/bootstrap/file/bootstrap.go#L77)<br><strong>Comment</strong>: <pre>Ack.

IMHO we should be checking the sanity of original file as you suggested here, and fail early before performing any other operations.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/file/bootstrap.go#L77](https://github.com/hyperledger-gerrit-archive/fabric/blob/fb903b24b0295e69b5e1a18431e121efa534c9be/orderer/common/bootstrap/file/bootstrap.go#L77)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 15</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Uploader</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Created</strong>: 1/23/2019, 7:01:29 AM<br><strong>UnmergedRevision</strong>: [51d2af69b8bce0176c10c86b2aaed2c2b7eef8dc](https://github.com/hyperledger-gerrit-archive/fabric/commit/51d2af69b8bce0176c10c86b2aaed2c2b7eef8dc)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/14/2019, 11:48:57 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/14/2019, 11:48:57 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/14/2019, 12:26:45 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/14/2019, 12:21:16 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Approved</strong>: 1/8/2019, 1:09:46 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 16</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Uploader</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Created</strong>: 1/24/2019, 6:52:09 AM<br><strong>UnmergedRevision</strong>: [0af44547ccff8a188de39c06989aa16b0d561103](https://github.com/hyperledger-gerrit-archive/fabric/commit/0af44547ccff8a188de39c06989aa16b0d561103)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/24/2019, 7:04:12 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/24/2019, 7:04:12 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/24/2019, 7:37:49 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/27/2019, 3:51:49 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Approved</strong>: 1/8/2019, 1:09:46 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 17</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Uploader</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Created</strong>: 1/27/2019, 8:46:45 AM<br><strong>UnmergedRevision</strong>: [0696fda98f9a5652fad1e955c848a9073ea352cb](https://github.com/hyperledger-gerrit-archive/fabric/commit/0696fda98f9a5652fad1e955c848a9073ea352cb)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/27/2019, 8:56:38 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/27/2019, 8:56:38 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/27/2019, 9:34:51 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/27/2019, 9:31:05 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Approved</strong>: 1/29/2019, 4:03:19 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Approved</strong>: 1/30/2019, 11:38:10 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/bootstrap.go#L37](https://github.com/hyperledger-gerrit-archive/fabric/blob/0696fda98f9a5652fad1e955c848a9073ea352cb/orderer/common/bootstrap/bootstrap.go#L37)<br><strong>Comment</strong>: <pre>who's going to call this other than tests?</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/bootstrap/bootstrap.go#L37](https://github.com/hyperledger-gerrit-archive/fabric/blob/0696fda98f9a5652fad1e955c848a9073ea352cb/orderer/common/bootstrap/bootstrap.go#L37)<br><strong>Comment</strong>: <pre>FAB-13908</pre></blockquote><h3>PatchSet Number: 18</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Uploader</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Created</strong>: 1/30/2019, 11:38:31 AM<br><strong>GitHubMergedRevision</strong>: [bccbd4d2a5792832650ae56fe76e772dd75ad315](https://github.com/hyperledger-gerrit-archive/fabric/commit/bccbd4d2a5792832650ae56fe76e772dd75ad315)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/27/2019, 8:56:38 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/27/2019, 8:56:38 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/27/2019, 9:34:51 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/27/2019, 9:31:05 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Approved</strong>: 1/29/2019, 4:03:19 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Approved</strong>: 1/30/2019, 11:38:10 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Yacov Manevich<br><strong>Merged</strong>: 1/30/2019, 11:39:21 AM<br><br></blockquote>