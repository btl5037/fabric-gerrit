<strong>Project</strong>: fabric<br><strong>Branch</strong>: master<br><strong>ID</strong>: 28532<br><strong>Subject</strong>: [FAB-13544] Expose metrics provider instance<br><strong>Status</strong>: ABANDONED<br><strong>Owner</strong>: Firas Qutishat - firas.qutishat@securekey.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 1/7/2019, 12:39:52 PM<br><strong>LastUpdated</strong>: 1/23/2019, 2:12:40 PM<br><strong>CommitMessage</strong>:<br><pre>[FAB-13544] Expose metrics provider instance

Change-Id: I4be8f242e662235a430cfdf5b966af2564511adb
Signed-off-by: Firas Qutishat <firas.qutishat@securekey.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Firas Qutishat - firas.qutishat@securekey.com<br><strong>Reviewed</strong>: 1/7/2019, 12:39:52 PM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Sandra Vrtikapa - sandra.vrtikapa@securekey.com<br><strong>Reviewed</strong>: 1/7/2019, 12:42:39 PM<br><strong>Message</strong>: <pre>Patch Set 1: Code-Review+1</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/7/2019, 12:44:35 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/8707/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/7/2019, 12:45:11 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting verify build</pre><strong>Reviewer</strong>: Firas Qutishat - firas.qutishat@securekey.com<br><strong>Reviewed</strong>: 1/7/2019, 12:48:42 PM<br><strong>Message</strong>: <pre>Patch Set 1: Code-Review-1</pre><strong>Reviewer</strong>: Firas Qutishat - firas.qutishat@securekey.com<br><strong>Reviewed</strong>: 1/7/2019, 12:48:47 PM<br><strong>Message</strong>: <pre>Removed Code-Review+1 by Sandra Vrtikapa <sandra.vrtikapa@securekey.com>
</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/7/2019, 12:51:14 PM<br><strong>Message</strong>: <pre>Patch Set 1: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/7/2019, 12:52:18 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/8707/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/8707</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/7/2019, 12:53:47 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7663/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/7/2019, 12:54:16 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/7/2019, 12:54:58 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/4476/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/7/2019, 12:55:42 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting Integration tests</pre><strong>Reviewer</strong>: Firas Qutishat - firas.qutishat@securekey.com<br><strong>Reviewed</strong>: 1/7/2019, 1:03:30 PM<br><strong>Message</strong>: <pre>Uploaded patch set 2.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/7/2019, 1:08:38 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/8709/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/7/2019, 1:09:06 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/7/2019, 1:13:35 PM<br><strong>Message</strong>: <pre>Patch Set 1: F3-UnitTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/7/2019, 1:14:45 PM<br><strong>Message</strong>: <pre>Patch Set 2: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/7/2019, 1:15:26 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/8709/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/8709</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/7/2019, 1:15:40 PM<br><strong>Message</strong>: <pre>Patch Set 1: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/4476/ : ABORTED

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/4476

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7663/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/7663</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/7/2019, 1:17:54 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7664/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/7/2019, 1:18:11 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/4477/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/7/2019, 1:18:29 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/7/2019, 1:18:54 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Starting Integration tests</pre><strong>Reviewer</strong>: Sandra Vrtikapa - sandra.vrtikapa@securekey.com<br><strong>Reviewed</strong>: 1/7/2019, 1:27:45 PM<br><strong>Message</strong>: <pre>Patch Set 2: Code-Review+1</pre><strong>Reviewer</strong>: George Bolo - george.bolo@gmail.com<br><strong>Reviewed</strong>: 1/7/2019, 1:41:44 PM<br><strong>Message</strong>: <pre>Patch Set 2: Code-Review+1

Simple change that makes a whole lot of sense. Let's merge this</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/7/2019, 1:51:45 PM<br><strong>Message</strong>: <pre>Patch Set 2: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/7/2019, 1:58:24 PM<br><strong>Message</strong>: <pre>Patch Set 2: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/7/2019, 1:59:19 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7664/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/7664

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/4477/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/4477</pre><strong>Reviewer</strong>: Kyriakos Georgiou - kyriakos.a.georgiou@gmail.com<br><strong>Reviewed</strong>: 1/7/2019, 2:09:52 PM<br><strong>Message</strong>: <pre>Patch Set 2: Code-Review+1</pre><strong>Reviewer</strong>: Baohua Yang - yangbaohua@gmail.com<br><strong>Reviewed</strong>: 1/8/2019, 8:39:41 PM<br><strong>Message</strong>: <pre>Patch Set 2: Code-Review+1</pre><strong>Reviewer</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Reviewed</strong>: 1/11/2019, 11:16:00 AM<br><strong>Message</strong>: <pre>Patch Set 2: Code-Review-1

We need to move away from package globals not extend their usage.</pre><strong>Reviewer</strong>: Firas Qutishat - firas.qutishat@securekey.com<br><strong>Reviewed</strong>: 1/11/2019, 11:39:26 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Hi Matthew, Can you suggest alternative solution for using the metrics provider within a SCC plugin</pre><strong>Reviewer</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Reviewed</strong>: 1/11/2019, 12:11:30 PM<br><strong>Message</strong>: <pre>Patch Set 2:

> Patch Set 2:
> 
> Hi Matthew, Can you suggest alternative solution for using the metrics provider within a SCC plugin

The metrics provider instantiated and exposed by the the operations layer in the peer? No. That said, this shouldn't prevent a plugin from exposing metrics via some other provider that it configures and instantiates.

The system chaincode contract was defined as an analog of non-system chaincode and metrics capabilities have not been exposed there; as such, there is no supported way to use it in system chaincode.</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 1/11/2019, 1:50:03 PM<br><strong>Message</strong>: <pre>Patch Set 2: Code-Review-2

I agree with Matt on this although I'm going to go with a stronger -2.
Perhaps if we decide to grant access to the metrics subsystem from chaincode we can consider this in the future, but internal peer code should not be linked to user code.</pre><strong>Reviewer</strong>: Troy Ronda - troy@troyronda.com<br><strong>Reviewed</strong>: 1/11/2019, 2:29:15 PM<br><strong>Message</strong>: <pre>Patch Set 2:

There is a desire to send metrics from SCC using the common Fabric metrics configuration (and provider). 

I am wondering if you are you doing a stronger -2 on that request or on this particular implementation? i.e., would it be acceptable to see if there is a way to pass this provider into the SCC or plugin interface?</pre><strong>Reviewer</strong>: George Bolo - george.bolo@gmail.com<br><strong>Reviewed</strong>: 1/11/2019, 3:18:31 PM<br><strong>Message</strong>: <pre>Patch Set 2:

I think it would be very convenient (and more efficient) to use the same prometheus http server (when using that metric provider) to collect metrics from a peer. Otherwise, I will have to create yet another firewall rule or slap nginx in front to reverse proxy to support two prometheus servers with same firewalled port. I don't think fabric developers have much experience in actually running hyperledger fabric in a real environment, instead of just their walled docker-compose garden. Come on, let's get some input from some system guys for a change...</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 1/11/2019, 4:43:34 PM<br><strong>Message</strong>: <pre>Patch Set 2:

> I think it would be very convenient (and more efficient) to use the
 > same prometheus http server (when using that metric provider) to
 > collect metrics from a peer. Otherwise, I will have to create yet
 > another firewall rule or slap nginx in front to reverse proxy to
 > support two prometheus servers with same firewalled port. I don't
 > think fabric developers have much experience in actually running
 > hyperledger fabric in a real environment, instead of just their
 > walled docker-compose garden. Come on, let's get some input from
 > some system guys for a change...

This has nothing to do with "systems guys" ... we know how to run stuff outside of Docker compose ... so come on ... this has to do with the fact that not everything is supposed to be accessed by USER code</pre><strong>Reviewer</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Reviewed</strong>: 1/11/2019, 5:10:36 PM<br><strong>Message</strong>: <pre>Patch Set 2:

> Patch Set 2:
> 
> I think it would be very convenient (and more efficient) to use the same prometheus http server (when using that metric provider) to collect metrics from a peer. 

And you probably can. The handler that's surfaced by the peer is associated with the default gatherer in the prometheus API.</pre><strong>Reviewer</strong>: Firas Qutishat - firas.qutishat@securekey.com<br><strong>Reviewed</strong>: 1/23/2019, 2:12:40 PM<br><strong>Message</strong>: <pre>Abandoned</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Firas Qutishat - firas.qutishat@securekey.com<br><strong>Uploader</strong>: Firas Qutishat - firas.qutishat@securekey.com<br><strong>Created</strong>: 1546882792<br><strong>UnmergedRevision</strong>: 9463be6f90aecd37f7f28fdb6c69712fc8bc7e69<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/7/2019, 12:51:14 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/7/2019, 12:51:14 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/7/2019, 1:13:35 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/7/2019, 1:15:40 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Firas Qutishat - firas.qutishat@securekey.com<br><strong>Approved</strong>: 1/7/2019, 12:48:42 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Firas Qutishat - firas.qutishat@securekey.com<br><strong>Uploader</strong>: Firas Qutishat - firas.qutishat@securekey.com<br><strong>Created</strong>: 1546884210<br><strong>UnmergedRevision</strong>: df54783d9153e285e7e542f153c614b61d9a4912<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/7/2019, 1:14:45 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/7/2019, 1:14:45 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/7/2019, 1:58:24 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/7/2019, 1:51:45 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Baohua Yang - yangbaohua@gmail.com<br><strong>Approved</strong>: 1/8/2019, 8:39:41 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Approved</strong>: 1/11/2019, 1:50:03 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Sandra Vrtikapa - sandra.vrtikapa@securekey.com<br><strong>Approved</strong>: 1/7/2019, 1:27:45 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: George Bolo - george.bolo@gmail.com<br><strong>Approved</strong>: 1/7/2019, 1:41:44 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Approved</strong>: 1/11/2019, 11:16:00 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Kyriakos Georgiou - kyriakos.a.georgiou@gmail.com<br><strong>Approved</strong>: 1/7/2019, 2:09:52 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br></blockquote>