<strong>Project</strong>: fabric<br><strong>Branch</strong>: master<br><strong>ID</strong>: 27773<br><strong>Subject</strong>: [FAB-12949] finish reconfiguration after restart<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 11/28/2018, 6:28:10 AM<br><strong>LastUpdated</strong>: 12/11/2018, 5:50:27 PM<br><strong>CommitMessage</strong>:<br><pre>[FAB-12949] finish reconfiguration after restart

This commits handles the case where config transaction of
type B is submitted and Raft cluster quorum fails/shutdowns.
During startup, leader compares last known configuration with Raft
config state and if there is a difference, finalize reconfiguration by
proposing delta.

Change-Id: I3cdf03533602489cb56c503f1d6651f27a5fc6a1
Signed-off-by: Artem Barger <bartem@il.ibm.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 11/28/2018, 6:28:10 AM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/28/2018, 6:32:04 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/7558/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/28/2018, 6:32:42 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/28/2018, 6:41:00 AM<br><strong>Message</strong>: <pre>Patch Set 1: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/28/2018, 6:41:48 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/7558/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/7558</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/28/2018, 6:44:01 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/6546/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/28/2018, 6:45:01 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/3626/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/28/2018, 6:45:01 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/28/2018, 6:46:05 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/28/2018, 7:03:48 AM<br><strong>Message</strong>: <pre>Patch Set 1: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/28/2018, 7:06:49 AM<br><strong>Message</strong>: <pre>Patch Set 1: F3-UnitTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/28/2018, 7:07:40 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/6546/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/6546

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/3626/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/3626</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 11/28/2018, 9:43:56 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/28/2018, 9:49:25 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/6558/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/28/2018, 9:50:07 AM<br><strong>Message</strong>: <pre>Patch Set 1: -F3-UnitTest

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/28/2018, 10:05:12 AM<br><strong>Message</strong>: <pre>Patch Set 1: F3-UnitTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/28/2018, 10:06:06 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/6558/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/6558</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 11/28/2018, 11:23:10 AM<br><strong>Message</strong>: <pre>Patch Set 1:

15:02:07 --- FAIL: TestServerInterceptors (0.01s)</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 11/28/2018, 11:23:32 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/28/2018, 11:26:36 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/6565/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/28/2018, 11:27:23 AM<br><strong>Message</strong>: <pre>Patch Set 1: -F3-UnitTest

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/28/2018, 11:45:30 AM<br><strong>Message</strong>: <pre>Patch Set 1: F3-UnitTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/28/2018, 11:46:16 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/6565/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/6565</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 11/28/2018, 9:21:06 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/28/2018, 9:23:30 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/6589/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/28/2018, 9:25:08 PM<br><strong>Message</strong>: <pre>Patch Set 1: -F3-UnitTest

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/28/2018, 9:52:46 PM<br><strong>Message</strong>: <pre>Patch Set 1: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/28/2018, 9:53:30 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/6589/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/6589</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 11/28/2018, 10:33:25 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(7 comments)

Where do we test this code?</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 11/29/2018, 9:18:28 AM<br><strong>Message</strong>: <pre>Uploaded patch set 2.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/29/2018, 9:21:18 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/7629/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/29/2018, 9:21:59 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/29/2018, 9:29:53 AM<br><strong>Message</strong>: <pre>Patch Set 2: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/29/2018, 9:30:33 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/7629/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/7629</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/29/2018, 9:32:35 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/6607/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/29/2018, 9:33:14 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/3702/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/29/2018, 9:33:20 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/29/2018, 9:35:01 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Starting Integration tests</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 11/29/2018, 9:44:09 AM<br><strong>Message</strong>: <pre>Patch Set 2:

(7 comments)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/29/2018, 9:48:59 AM<br><strong>Message</strong>: <pre>Patch Set 2: F3-UnitTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/29/2018, 9:57:43 AM<br><strong>Message</strong>: <pre>Patch Set 2: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/29/2018, 9:58:24 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/6607/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/6607

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/3702/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/3702</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 11/29/2018, 10:24:42 AM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/29/2018, 10:28:08 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/7637/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/29/2018, 10:29:06 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/29/2018, 10:38:54 AM<br><strong>Message</strong>: <pre>Patch Set 3: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/29/2018, 10:39:40 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/7637/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/7637</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/29/2018, 10:41:08 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/6614/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/29/2018, 10:41:40 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/3710/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/29/2018, 10:41:54 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/29/2018, 10:42:38 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/29/2018, 11:01:38 AM<br><strong>Message</strong>: <pre>Patch Set 3: F3-UnitTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/29/2018, 11:02:53 AM<br><strong>Message</strong>: <pre>Patch Set 3: F3-IntegrationTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/29/2018, 11:03:40 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/6614/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/6614

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/3710/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/3710</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 11/29/2018, 3:57:05 PM<br><strong>Message</strong>: <pre>Patch Set 3:

(4 comments)

Run IntegrationTest
Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/29/2018, 3:59:32 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/6630/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/29/2018, 4:00:10 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/3721/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/29/2018, 4:00:25 PM<br><strong>Message</strong>: <pre>Patch Set 3: -F3-UnitTest

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/29/2018, 4:01:08 PM<br><strong>Message</strong>: <pre>Patch Set 3: -F3-IntegrationTest

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/29/2018, 4:25:08 PM<br><strong>Message</strong>: <pre>Patch Set 3: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/29/2018, 4:32:20 PM<br><strong>Message</strong>: <pre>Patch Set 3: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/29/2018, 4:33:20 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/6630/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/6630

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/3721/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/3721</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 11/29/2018, 8:22:49 PM<br><strong>Message</strong>: <pre>Patch Set 4: Patch Set 3 was rebased</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 12/2/2018, 7:11:21 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(1 comment)</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 12/4/2018, 12:14:21 PM<br><strong>Message</strong>: <pre>Patch Set 4:

(1 comment)</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 12/4/2018, 2:11:36 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(1 comment)</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 12/4/2018, 3:32:18 PM<br><strong>Message</strong>: <pre>Uploaded patch set 5.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/4/2018, 3:34:44 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/7859/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/4/2018, 3:35:12 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/4/2018, 3:39:07 PM<br><strong>Message</strong>: <pre>Patch Set 5: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/4/2018, 3:39:51 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/7859/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/7859</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/4/2018, 3:41:39 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/6804/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/4/2018, 3:42:07 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/4/2018, 3:42:33 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/3876/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/4/2018, 3:42:59 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/4/2018, 4:04:42 PM<br><strong>Message</strong>: <pre>Patch Set 5: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/4/2018, 4:10:16 PM<br><strong>Message</strong>: <pre>Patch Set 5: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/4/2018, 4:11:01 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/6804/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/6804

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/3876/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/3876</pre><strong>Reviewer</strong>: Adarsh Saraf - adarshsaraf123@gmail.com<br><strong>Reviewed</strong>: 12/5/2018, 12:28:01 AM<br><strong>Message</strong>: <pre>Patch Set 5: Code-Review-1

(6 comments)

-1 for the time being to see if we can optimize on the calls to `handleReconfigurationFailure` as described in the comment.</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 12/5/2018, 2:49:16 AM<br><strong>Message</strong>: <pre>Patch Set 5:

(3 comments)</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 12/5/2018, 6:48:20 AM<br><strong>Message</strong>: <pre>Patch Set 5:

(7 comments)</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 12/5/2018, 6:51:15 AM<br><strong>Message</strong>: <pre>Uploaded patch set 6.</pre><strong>Reviewer</strong>: Adarsh Saraf - adarshsaraf123@gmail.com<br><strong>Reviewed</strong>: 12/5/2018, 6:55:01 AM<br><strong>Message</strong>: <pre>Patch Set 6: Code-Review+1

(4 comments)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/5/2018, 6:55:36 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/7883/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/5/2018, 6:56:04 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/5/2018, 7:00:15 AM<br><strong>Message</strong>: <pre>Patch Set 6: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/5/2018, 7:00:58 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/7883/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/7883</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/5/2018, 7:02:04 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/6835/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/5/2018, 7:02:29 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/5/2018, 7:03:11 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/3896/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/5/2018, 7:03:41 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/5/2018, 7:24:51 AM<br><strong>Message</strong>: <pre>Patch Set 6: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/5/2018, 7:26:39 AM<br><strong>Message</strong>: <pre>Patch Set 6: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/5/2018, 7:27:21 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/6835/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/6835

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/3896/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/3896</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 12/5/2018, 12:29:07 PM<br><strong>Message</strong>: <pre>Patch Set 6:

(2 comments)</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 12/5/2018, 4:45:59 PM<br><strong>Message</strong>: <pre>Patch Set 5:

(1 comment)</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 12/5/2018, 4:46:18 PM<br><strong>Message</strong>: <pre>Patch Set 5:

(1 comment)</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 12/5/2018, 10:27:12 PM<br><strong>Message</strong>: <pre>Patch Set 6:

(1 comment)</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 12/6/2018, 12:21:40 AM<br><strong>Message</strong>: <pre>Patch Set 5:

(1 comment)</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 12/6/2018, 10:19:52 AM<br><strong>Message</strong>: <pre>Uploaded patch set 7.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/6/2018, 10:22:24 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/7922/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/6/2018, 10:22:50 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/6/2018, 10:25:56 AM<br><strong>Message</strong>: <pre>Patch Set 7: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/6/2018, 10:26:39 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/7922/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/7922</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/6/2018, 10:28:01 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/6881/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/6/2018, 10:28:28 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/6/2018, 10:29:35 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/3927/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/6/2018, 10:30:19 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/6/2018, 10:46:05 AM<br><strong>Message</strong>: <pre>Patch Set 7: F3-UnitTest-1

Failed</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 12/6/2018, 10:51:27 AM<br><strong>Message</strong>: <pre>Patch Set 8: Patch Set 7 was rebased</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 12/6/2018, 10:51:36 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Run VerifyBuild</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/6/2018, 10:51:49 AM<br><strong>Message</strong>: <pre>Patch Set 7: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/6/2018, 10:52:39 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/6881/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/6881

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/3927/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/3927</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/6/2018, 10:56:12 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/7924/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/6/2018, 10:56:42 AM<br><strong>Message</strong>: <pre>Patch Set 8: -F2-DocBuild -F1-VerifyBuild -F3-UnitTest

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/6/2018, 11:00:54 AM<br><strong>Message</strong>: <pre>Patch Set 8: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/6/2018, 11:03:42 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/6884/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/6/2018, 11:03:49 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/3930/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/6/2018, 11:04:12 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/6/2018, 11:04:31 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/6/2018, 11:21:40 AM<br><strong>Message</strong>: <pre>Patch Set 8: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/6/2018, 11:29:26 AM<br><strong>Message</strong>: <pre>Patch Set 8: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/6/2018, 11:30:14 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/7924/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/7924

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/6884/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/6884

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/3930/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/3930</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 12/6/2018, 11:10:05 PM<br><strong>Message</strong>: <pre>Patch Set 8: Code-Review+1</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 12/7/2018, 6:34:52 AM<br><strong>Message</strong>: <pre>Uploaded patch set 9: Patch Set 8 was rebased.</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 12/7/2018, 10:07:58 AM<br><strong>Message</strong>: <pre>Patch Set 9: Code-Review+2</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 12/11/2018, 2:15:15 PM<br><strong>Message</strong>: <pre>Patch Set 10: Patch Set 9 was rebased</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 12/11/2018, 3:08:06 PM<br><strong>Message</strong>: <pre>Uploaded patch set 11: Patch Set 10 was rebased.</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 12/11/2018, 5:14:17 PM<br><strong>Message</strong>: <pre>Patch Set 11: Code-Review+2

(4 comments)

Left a comment in the test, please take a look.

I'll merge in the meantime</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 12/11/2018, 5:14:20 PM<br><strong>Message</strong>: <pre>Change has been successfully merged by Yacov Manevich</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/11/2018, 5:16:37 PM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/3838/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/11/2018, 5:17:00 PM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-x86_64/5160/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/11/2018, 5:50:27 PM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/3838/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-end-2-end-x86_64/3838

https://jenkins.hyperledger.org/job/fabric-merge-x86_64/5160/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-x86_64/5160</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Uploader</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Created</strong>: 11/28/2018, 6:28:10 AM<br><strong>UnmergedRevision</strong>: [675fd4eb05bb6f3ca4000c2701c4603b71b2eb37](https://github.com/hyperledger-gerrit-archive/fabric/commit/675fd4eb05bb6f3ca4000c2701c4603b71b2eb37)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 11/28/2018, 6:41:00 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 11/28/2018, 6:41:00 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 11/28/2018, 7:03:48 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 11/28/2018, 9:52:46 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [/COMMIT_MSG#L10](https://github.com/hyperledger-gerrit-archive/fabric/blob/675fd4eb05bb6f3ca4000c2701c4603b71b2eb37//COMMIT_MSG#L10)<br><strong>Comment</strong>: <pre>(Of what type?)</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [/COMMIT_MSG#L10](https://github.com/hyperledger-gerrit-archive/fabric/blob/675fd4eb05bb6f3ca4000c2701c4603b71b2eb37//COMMIT_MSG#L10)<br><strong>Comment</strong>: <pre>B ;)</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L925](https://github.com/hyperledger-gerrit-archive/fabric/blob/675fd4eb05bb6f3ca4000c2701c4603b71b2eb37/orderer/consensus/etcdraft/chain.go#L925)<br><strong>Comment</strong>: <pre>I'm wondering whether we need this check? Have you bumped into such a case?</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L925](https://github.com/hyperledger-gerrit-archive/fabric/blob/675fd4eb05bb6f3ca4000c2701c4603b71b2eb37/orderer/consensus/etcdraft/chain.go#L925)<br><strong>Comment</strong>: <pre>Nope, but if there is something really bad happens or some programing error, I'd prefer to stop node from serving the cluster. wdyt?</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L925](https://github.com/hyperledger-gerrit-archive/fabric/blob/675fd4eb05bb6f3ca4000c2701c4603b71b2eb37/orderer/consensus/etcdraft/chain.go#L925)<br><strong>Comment</strong>: <pre>I hear you. I think it's redundant, but maybe that's just me. Let's see what others think.</pre><strong>Commenter</strong>: Adarsh Saraf - adarshsaraf123@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L925](https://github.com/hyperledger-gerrit-archive/fabric/blob/675fd4eb05bb6f3ca4000c2701c4603b71b2eb37/orderer/consensus/etcdraft/chain.go#L925)<br><strong>Comment</strong>: <pre>I personally am not too sure if it is a redundant check while thinking of the case where somebody messes with the ledger storage. Not too sure if this will be caught by the ledger implementation. In any case I don't think leaving this check in hurts.</pre><strong>Commenter</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L925](https://github.com/hyperledger-gerrit-archive/fabric/blob/675fd4eb05bb6f3ca4000c2701c4603b71b2eb37/orderer/consensus/etcdraft/chain.go#L925)<br><strong>Comment</strong>: <pre>I personally felt this is redundant, and we are not performing this check in `NewChain`</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L925](https://github.com/hyperledger-gerrit-archive/fabric/blob/675fd4eb05bb6f3ca4000c2701c4603b71b2eb37/orderer/consensus/etcdraft/chain.go#L925)<br><strong>Comment</strong>: <pre>> I personally felt this is redundant, and we are not performing this check in `NewChain`

How making sure we capable to read block is redundant?</pre><strong>Commenter</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L925](https://github.com/hyperledger-gerrit-archive/fabric/blob/675fd4eb05bb6f3ca4000c2701c4603b71b2eb37/orderer/consensus/etcdraft/chain.go#L925)<br><strong>Comment</strong>: <pre>I'm just not sure when will this ever happen... and if we are to handle it, i think it should better be handled one layer lower in `support.Block()`. But this is just nit..</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L927](https://github.com/hyperledger-gerrit-archive/fabric/blob/675fd4eb05bb6f3ca4000c2701c4603b71b2eb37/orderer/consensus/etcdraft/chain.go#L927)<br><strong>Comment</strong>: <pre>I know I'm nitpicking here, but we don't need these comments. It's fairly obvious from lines 926 and 928 that this what we're doing. Comments explain the why not the what.</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L927](https://github.com/hyperledger-gerrit-archive/fabric/blob/675fd4eb05bb6f3ca4000c2701c4603b71b2eb37/orderer/consensus/etcdraft/chain.go#L927)<br><strong>Comment</strong>: <pre>ok, removing.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L951](https://github.com/hyperledger-gerrit-archive/fabric/blob/675fd4eb05bb6f3ca4000c2701c4603b71b2eb37/orderer/consensus/etcdraft/chain.go#L951)<br><strong>Comment</strong>: <pre>Can you please remind me: how do we handle the ConfChangeUpdateNode case? Do we care about it? If not, why?</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L951](https://github.com/hyperledger-gerrit-archive/fabric/blob/675fd4eb05bb6f3ca4000c2701c4603b71b2eb37/orderer/consensus/etcdraft/chain.go#L951)<br><strong>Comment</strong>: <pre>we do not have update of the node, we cannot provide such semantic. instead we add and remove node if we would like to update TLS certificates for example.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L951](https://github.com/hyperledger-gerrit-archive/fabric/blob/675fd4eb05bb6f3ca4000c2701c4603b71b2eb37/orderer/consensus/etcdraft/chain.go#L951)<br><strong>Comment</strong>: <pre>Got it. Thanks!</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L957](https://github.com/hyperledger-gerrit-archive/fabric/blob/675fd4eb05bb6f3ca4000c2701c4603b71b2eb37/orderer/consensus/etcdraft/chain.go#L957)<br><strong>Comment</strong>: <pre>Two questions:

1. What does it mean if the `ProposeConfChange` returns w/o error? That the change has been persisted by a quorum and will most definitely go through? A weaker guarantee?
2. If this call errors, we issue a warning and keep going. How do we eventually get to the right state? (*That* deserves a comment in the code for instance.)</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L957](https://github.com/hyperledger-gerrit-archive/fabric/blob/675fd4eb05bb6f3ca4000c2701c4603b71b2eb37/orderer/consensus/etcdraft/chain.go#L957)<br><strong>Comment</strong>: <pre>1. ConfChange written to WAL and proposed to cluster
2. It will return error only if Raft node is turned down.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L957](https://github.com/hyperledger-gerrit-archive/fabric/blob/675fd4eb05bb6f3ca4000c2701c4603b71b2eb37/orderer/consensus/etcdraft/chain.go#L957)<br><strong>Comment</strong>: <pre>1. It's unclear to me whether writing to WAL means that it's persisted by a quorum. Is that the case?
2. What do we mean by "turned down"? (As in: "you are no longer the leader"?)</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L957](https://github.com/hyperledger-gerrit-archive/fabric/blob/675fd4eb05bb6f3ca4000c2701c4603b71b2eb37/orderer/consensus/etcdraft/chain.go#L957)<br><strong>Comment</strong>: <pre>1. It means persisted by the leader.
2. Literally called chain.Halt()</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L957](https://github.com/hyperledger-gerrit-archive/fabric/blob/675fd4eb05bb6f3ca4000c2701c4603b71b2eb37/orderer/consensus/etcdraft/chain.go#L957)<br><strong>Comment</strong>: <pre>2. Is that the only case? What happens if that node is partitioned? I imagine that the rest of the cluster would move on to elect a new leader, and that call would also error then as well?</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L957](https://github.com/hyperledger-gerrit-archive/fabric/blob/675fd4eb05bb6f3ca4000c2701c4603b71b2eb37/orderer/consensus/etcdraft/chain.go#L957)<br><strong>Comment</strong>: <pre>This is how the internal implementation of ProposeConfChange:

    func (n *node) ProposeConfChange(ctx context.Context, cc pb.ConfChange) error {
	data, err := cc.Marshal()
	if err != nil {
		return err
	}
	return n.Step(ctx, pb.Message{Type: pb.MsgProp, Entries: []pb.Entry{{Type: pb.EntryConfChange, Data: data}}})
    }

which comes down to:

    func (n *node) Step(ctx context.Context, m pb.Message) error {
	// ignore unexpected local messages receiving over network
	if IsLocalMsg(m.Type) {
		// TODO: return an error?
		return nil
	}
	return n.step(ctx, m)
    }

and step function:


    // Step advances the state machine using msgs. The ctx.Err() will be returned,
    // if any.
    func (n *node) step(ctx context.Context, m pb.Message) error {
	ch := n.recvc
	if m.Type == pb.MsgProp {
		ch = n.propc
	}

	select {
	case ch <- m:
		return nil
	case <-ctx.Done():
		return ctx.Err()
	case <-n.done:
		return ErrStopped
	}
    }

so following this path errors would be due to marshaling or node is stopped. Other possibility is due to context cancellation which is irrelevant because we use context.TODO(). Configuration change message would be pushed into n.proc channel, hence if there is a network partition Raft will handle and drop/reject it asynchronously to this call.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain_test.go#L687](https://github.com/hyperledger-gerrit-archive/fabric/blob/675fd4eb05bb6f3ca4000c2701c4603b71b2eb37/orderer/consensus/etcdraft/chain_test.go#L687)<br><strong>Comment</strong>: <pre>Why is this block commented out? (And indented.)</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain_test.go#L687](https://github.com/hyperledger-gerrit-archive/fabric/blob/675fd4eb05bb6f3ca4000c2701c4603b71b2eb37/orderer/consensus/etcdraft/chain_test.go#L687)<br><strong>Comment</strong>: <pre>left over</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain_test.go#L687](https://github.com/hyperledger-gerrit-archive/fabric/blob/675fd4eb05bb6f3ca4000c2701c4603b71b2eb37/orderer/consensus/etcdraft/chain_test.go#L687)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/util.go#L389](https://github.com/hyperledger-gerrit-archive/fabric/blob/675fd4eb05bb6f3ca4000c2701c4603b71b2eb37/orderer/consensus/etcdraft/util.go#L389)<br><strong>Comment</strong>: <pre>NodeExists?</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/util.go#L389](https://github.com/hyperledger-gerrit-archive/fabric/blob/675fd4eb05bb6f3ca4000c2701c4603b71b2eb37/orderer/consensus/etcdraft/util.go#L389)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Uploader</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Created</strong>: 11/29/2018, 9:18:28 AM<br><strong>UnmergedRevision</strong>: [507362475b3cd246ed3ebcb6d7b5122cbbd497e5](https://github.com/hyperledger-gerrit-archive/fabric/commit/507362475b3cd246ed3ebcb6d7b5122cbbd497e5)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 11/29/2018, 9:29:53 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 11/29/2018, 9:29:53 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 11/29/2018, 9:57:43 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 11/29/2018, 9:48:59 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Uploader</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Created</strong>: 11/29/2018, 10:24:42 AM<br><strong>UnmergedRevision</strong>: [b61f9ac3152d30e6e3a9242ffb6ce828d428b563](https://github.com/hyperledger-gerrit-archive/fabric/commit/b61f9ac3152d30e6e3a9242ffb6ce828d428b563)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 11/29/2018, 10:38:54 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 11/29/2018, 10:38:54 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 11/29/2018, 4:25:08 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 11/29/2018, 4:32:20 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Uploader</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Created</strong>: 11/29/2018, 8:22:49 PM<br><strong>UnmergedRevision</strong>: [7650b6098ba7a206e2cd0f616b03b79d991cc8b5](https://github.com/hyperledger-gerrit-archive/fabric/commit/7650b6098ba7a206e2cd0f616b03b79d991cc8b5)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 11/29/2018, 10:38:54 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 11/29/2018, 10:38:54 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 11/29/2018, 4:25:08 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 11/29/2018, 4:32:20 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 5</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Uploader</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Created</strong>: 12/4/2018, 3:32:18 PM<br><strong>UnmergedRevision</strong>: [1332c3b8630219976dd39e1f16389e5828a96f08](https://github.com/hyperledger-gerrit-archive/fabric/commit/1332c3b8630219976dd39e1f16389e5828a96f08)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/4/2018, 3:39:07 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/4/2018, 3:39:07 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/4/2018, 4:04:42 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/4/2018, 4:10:16 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Adarsh Saraf - adarshsaraf123@gmail.com<br><strong>Approved</strong>: 12/5/2018, 12:28:01 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Adarsh Saraf - adarshsaraf123@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L661](https://github.com/hyperledger-gerrit-archive/fabric/blob/1332c3b8630219976dd39e1f16389e5828a96f08/orderer/consensus/etcdraft/chain.go#L661)<br><strong>Comment</strong>: <pre>I personally don't like the fact that now we will `handleReconfigurationFailover` every time there is a leadership change. For example, let's say that there is no config update at all ever since the running of the orderer. In that case, we are running this check unnecessarily every time. The only case that we actually need to `handleReconfigurationFailover` apart from when `configChangeInProgress` is when this is the first time a leader has been elected after booting up the raft node. So is it worth it to add another bool to keep track of whether this is the first leader election after the raft node was started (not sure if etcd/raft provides this in the first place) and optimize the calls to `handleReconfigurationFailure`? wdyt?</pre><strong>Commenter</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L661](https://github.com/hyperledger-gerrit-archive/fabric/blob/1332c3b8630219976dd39e1f16389e5828a96f08/orderer/consensus/etcdraft/chain.go#L661)<br><strong>Comment</strong>: <pre>>  we are running this check unnecessarily every time.

this check is only performed when there's a leadership change, which is supposedly not frequent, no?</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L661](https://github.com/hyperledger-gerrit-archive/fabric/blob/1332c3b8630219976dd39e1f16389e5828a96f08/orderer/consensus/etcdraft/chain.go#L661)<br><strong>Comment</strong>: <pre>> The only case that we actually need to `handleReconfigurationFailover` apart from when `configChangeInProgress` is when this is the first time a leader has been elected after booting up the raft node.

This is not the only time, this also need to be checked after partitioning is healed for example assuming you lost a quorum not because of rebooting, but due to networking issues.

> this check is only performed when there's a leadership change, which is supposedly not frequent, no?

Yes, this should be infrequent. Moreover there are code which skips proposing config changes if last block was a regular one. See lines: 931-940.</pre><strong>Commenter</strong>: Adarsh Saraf - adarshsaraf123@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L661](https://github.com/hyperledger-gerrit-archive/fabric/blob/1332c3b8630219976dd39e1f16389e5828a96f08/orderer/consensus/etcdraft/chain.go#L661)<br><strong>Comment</strong>: <pre>> This is not the only time, this also need to be checked after partitioning is healed for example assuming you lost a quorum not because of rebooting, but due to networking issues.

Ah! Missed this one!</pre><strong>Commenter</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L970](https://github.com/hyperledger-gerrit-archive/fabric/blob/1332c3b8630219976dd39e1f16389e5828a96f08/orderer/consensus/etcdraft/chain.go#L970)<br><strong>Comment</strong>: <pre>why wouldn't we need to wait for confchange to take effect, like what we did with happy path>?</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L970](https://github.com/hyperledger-gerrit-archive/fabric/blob/1332c3b8630219976dd39e1f16389e5828a96f08/orderer/consensus/etcdraft/chain.go#L970)<br><strong>Comment</strong>: <pre>We do waiting, if leader was changed/failed, nodes will still keep waiting in updateMembership method. And after restart communication bootstrapped from metadata written to last config, hence the first thing would be re-configuring raft before anything else.</pre><strong>Commenter</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L970](https://github.com/hyperledger-gerrit-archive/fabric/blob/1332c3b8630219976dd39e1f16389e5828a96f08/orderer/consensus/etcdraft/chain.go#L970)<br><strong>Comment</strong>: <pre>is following scenario possible?
- cluster reboots after commit of config block, before Proposing ConfChange
- leader is elected and it's *about to* propose ConfChange
- a normal block is cut and proposed
- `ProposeConfChange` is called
- somehow normal block is consented, but `ConfChange` is not, due to leader crash
- a new leader is elected
- it looks at ledger, and finds out the last block is a normal block

therefore, this conf change is never going to be proposed by anyone. i feel we should always wait for configs to settle before accepting new envelopes.</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L970](https://github.com/hyperledger-gerrit-archive/fabric/blob/1332c3b8630219976dd39e1f16389e5828a96f08/orderer/consensus/etcdraft/chain.go#L970)<br><strong>Comment</strong>: <pre>The handleReconfigurationFailover call blocks serveRaft go-routine, right after leader is being electing leading to ProposeConfChange, hence whenever there is a block created it will be serialzied after config change. Am I missing here something?</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L970](https://github.com/hyperledger-gerrit-archive/fabric/blob/1332c3b8630219976dd39e1f16389e5828a96f08/orderer/consensus/etcdraft/chain.go#L970)<br><strong>Comment</strong>: <pre>> i feel we should always wait for configs to settle before accepting new envelopes.

This is actually a good point, but I do not think that blocking serveRequest gorouting from serveRaft is a right way to go, but probably we just need not to accept incoming request until we handle reconfiguration after the restart. wdyt?</pre><strong>Commenter</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L970](https://github.com/hyperledger-gerrit-archive/fabric/blob/1332c3b8630219976dd39e1f16389e5828a96f08/orderer/consensus/etcdraft/chain.go#L970)<br><strong>Comment</strong>: <pre>> whenever there is a block created it will be serialzied after config change

but `serveRequest` go routine is not blocked, and may still call `Propose` independently from `ProposeConfChange`, right? therefore, etcd/raft go routine may receive normal block prior to conf change, which leads to the scenario i described before.

> we just need not to accept incoming request until we handle reconfiguration after the restart

i agree, settling unfinished config block should be done at bootstrap</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L970](https://github.com/hyperledger-gerrit-archive/fabric/blob/1332c3b8630219976dd39e1f16389e5828a96f08/orderer/consensus/etcdraft/chain.go#L970)<br><strong>Comment</strong>: <pre>> but `serveRequest` go routine is not blocked, and may still call `Propose` independently from `ProposeConfChange`, right? therefore, etcd/raft go routine may receive normal block prior to conf change, which leads to the scenario i described before.

>> we just need not to accept incoming request until we handle reconfiguration after the restart

> i agree, settling unfinished config block should be done at bootstrap

Okay, so I will just add a flag to prevent from serving until we settle configuration if needed.</pre><strong>Commenter</strong>: Adarsh Saraf - adarshsaraf123@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain_test.go#L770](https://github.com/hyperledger-gerrit-archive/fabric/blob/1332c3b8630219976dd39e1f16389e5828a96f08/orderer/consensus/etcdraft/chain_test.go#L770)<br><strong>Comment</strong>: <pre>I don't think we need the locking here.</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain_test.go#L770](https://github.com/hyperledger-gerrit-archive/fabric/blob/1332c3b8630219976dd39e1f16389e5828a96f08/orderer/consensus/etcdraft/chain_test.go#L770)<br><strong>Comment</strong>: <pre>this added after go race detector failed on it.</pre><strong>Commenter</strong>: Adarsh Saraf - adarshsaraf123@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain_test.go#L770](https://github.com/hyperledger-gerrit-archive/fabric/blob/1332c3b8630219976dd39e1f16389e5828a96f08/orderer/consensus/etcdraft/chain_test.go#L770)<br><strong>Comment</strong>: <pre>Cool.</pre><strong>Commenter</strong>: Adarsh Saraf - adarshsaraf123@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain_test.go#L2275](https://github.com/hyperledger-gerrit-archive/fabric/blob/1332c3b8630219976dd39e1f16389e5828a96f08/orderer/consensus/etcdraft/chain_test.go#L2275)<br><strong>Comment</strong>: <pre>Was this introduced to avoid calls to len(ledger)?</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain_test.go#L2275](https://github.com/hyperledger-gerrit-archive/fabric/blob/1332c3b8630219976dd39e1f16389e5828a96f08/orderer/consensus/etcdraft/chain_test.go#L2275)<br><strong>Comment</strong>: <pre>nope, some of snapshot test starts from the few blocks in the ledger, hence len(ledger) returns incorrect value.</pre><strong>Commenter</strong>: Adarsh Saraf - adarshsaraf123@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain_test.go#L2275](https://github.com/hyperledger-gerrit-archive/fabric/blob/1332c3b8630219976dd39e1f16389e5828a96f08/orderer/consensus/etcdraft/chain_test.go#L2275)<br><strong>Comment</strong>: <pre>Thanks.</pre><strong>Commenter</strong>: Adarsh Saraf - adarshsaraf123@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain_test.go#L2352](https://github.com/hyperledger-gerrit-archive/fabric/blob/1332c3b8630219976dd39e1f16389e5828a96f08/orderer/consensus/etcdraft/chain_test.go#L2352)<br><strong>Comment</strong>: <pre>Just curious: When will this condition not be met?</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain_test.go#L2352](https://github.com/hyperledger-gerrit-archive/fabric/blob/1332c3b8630219976dd39e1f16389e5828a96f08/orderer/consensus/etcdraft/chain_test.go#L2352)<br><strong>Comment</strong>: <pre>see my answer about snapshot tests.</pre><strong>Commenter</strong>: Adarsh Saraf - adarshsaraf123@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain_test.go#L2352](https://github.com/hyperledger-gerrit-archive/fabric/blob/1332c3b8630219976dd39e1f16389e5828a96f08/orderer/consensus/etcdraft/chain_test.go#L2352)<br><strong>Comment</strong>: <pre>Got it.</pre><strong>Commenter</strong>: Adarsh Saraf - adarshsaraf123@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/util.go#L418](https://github.com/hyperledger-gerrit-archive/fabric/blob/1332c3b8630219976dd39e1f16389e5828a96f08/orderer/consensus/etcdraft/util.go#L418)<br><strong>Comment</strong>: <pre>Assign this outside of the loop to avoid recalculation of the slice for each iteration in the loop.</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/util.go#L418](https://github.com/hyperledger-gerrit-archive/fabric/blob/1332c3b8630219976dd39e1f16389e5828a96f08/orderer/consensus/etcdraft/util.go#L418)<br><strong>Comment</strong>: <pre>good point.</pre></blockquote><h3>PatchSet Number: 6</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Uploader</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Created</strong>: 12/5/2018, 6:51:15 AM<br><strong>UnmergedRevision</strong>: [509d549b44a6e063a92680d68f21b5460bb99821](https://github.com/hyperledger-gerrit-archive/fabric/commit/509d549b44a6e063a92680d68f21b5460bb99821)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/5/2018, 7:00:15 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/5/2018, 7:00:15 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/5/2018, 7:24:51 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/5/2018, 7:26:39 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Adarsh Saraf - adarshsaraf123@gmail.com<br><strong>Approved</strong>: 12/5/2018, 6:55:01 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 7</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Uploader</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Created</strong>: 12/6/2018, 10:19:52 AM<br><strong>UnmergedRevision</strong>: [d9afdf718bf9020ddadd60986fa7fc257258155d](https://github.com/hyperledger-gerrit-archive/fabric/commit/d9afdf718bf9020ddadd60986fa7fc257258155d)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/6/2018, 10:25:56 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/6/2018, 10:25:56 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/6/2018, 10:51:49 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/6/2018, 10:46:05 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 8</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Uploader</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Created</strong>: 12/6/2018, 10:51:27 AM<br><strong>UnmergedRevision</strong>: [3ef3c7fd526c111c58a8c64845d50244c768adbd](https://github.com/hyperledger-gerrit-archive/fabric/commit/3ef3c7fd526c111c58a8c64845d50244c768adbd)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/6/2018, 11:00:54 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/6/2018, 11:00:54 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/6/2018, 11:21:40 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/6/2018, 11:29:26 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Approved</strong>: 12/6/2018, 11:10:05 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 9</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Uploader</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Created</strong>: 12/7/2018, 6:34:52 AM<br><strong>UnmergedRevision</strong>: [2c5672261bbced671c08e53bf9afbf9ab53ad9af](https://github.com/hyperledger-gerrit-archive/fabric/commit/2c5672261bbced671c08e53bf9afbf9ab53ad9af)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/6/2018, 11:00:54 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/6/2018, 11:00:54 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/6/2018, 11:21:40 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/6/2018, 11:29:26 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Approved</strong>: 12/7/2018, 10:07:58 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Approved</strong>: 12/6/2018, 11:10:05 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 10</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Uploader</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Created</strong>: 12/11/2018, 2:15:15 PM<br><strong>UnmergedRevision</strong>: [3a7ff82675711807bbdae7d7ae82a7b9a48adde6](https://github.com/hyperledger-gerrit-archive/fabric/commit/3a7ff82675711807bbdae7d7ae82a7b9a48adde6)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/6/2018, 11:00:54 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/6/2018, 11:00:54 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/6/2018, 11:21:40 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/6/2018, 11:29:26 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Approved</strong>: 12/7/2018, 10:07:58 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Approved</strong>: 12/6/2018, 11:10:05 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 11</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Uploader</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Created</strong>: 12/11/2018, 3:08:06 PM<br><strong>GitHubMergedRevision</strong>: [d915ee9a82a89d8a3034f111ed5c16355daae939](https://github.com/hyperledger-gerrit-archive/fabric/commit/d915ee9a82a89d8a3034f111ed5c16355daae939)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/6/2018, 11:00:54 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/6/2018, 11:00:54 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/6/2018, 11:21:40 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/6/2018, 11:29:26 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Approved</strong>: 12/7/2018, 10:07:58 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Approved</strong>: 12/11/2018, 5:14:17 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Yacov Manevich<br><strong>Merged</strong>: 12/11/2018, 5:14:20 PM<br><br><strong>Approver</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Approved</strong>: 12/6/2018, 11:10:05 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L247](https://github.com/hyperledger-gerrit-archive/fabric/blob/d915ee9a82a89d8a3034f111ed5c16355daae939/orderer/consensus/etcdraft/chain.go#L247)<br><strong>Comment</strong>: <pre>this actually can be initialized via struct instantiation, since there is a happens-before relation, if it is.</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L967](https://github.com/hyperledger-gerrit-archive/fabric/blob/d915ee9a82a89d8a3034f111ed5c16355daae939/orderer/consensus/etcdraft/chain.go#L967)<br><strong>Comment</strong>: <pre>way to go, best API ever!</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain_test.go#L1614](https://github.com/hyperledger-gerrit-archive/fabric/blob/d915ee9a82a89d8a3034f111ed5c16355daae939/orderer/consensus/etcdraft/chain_test.go#L1614)<br><strong>Comment</strong>: <pre>who is c?</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/util.go#L387](https://github.com/hyperledger-gerrit-archive/fabric/blob/d915ee9a82a89d8a3034f111ed5c16355daae939/orderer/consensus/etcdraft/util.go#L387)<br><strong>Comment</strong>: <pre>true</pre></blockquote>