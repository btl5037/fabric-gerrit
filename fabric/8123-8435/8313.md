<strong>Project</strong>: fabric<br><strong>Branch</strong>: master<br><strong>ID</strong>: 8313<br><strong>Subject</strong>: [FAB-3156] check correctness of instant'n policy<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Assignee</strong>:<br><strong>Created</strong>: 4/20/2017, 1:14:56 PM<br><strong>LastUpdated</strong>: 5/11/2017, 10:17:13 AM<br><strong>CommitMessage</strong>:<br><pre>[FAB-3156] check correctness of instant'n policy

The purpose of this change set is that for each invocation, we check that
the instantiated chaincode matches the installed one (if any) in terms of
its instantiation policy, just to avoid repercussions from any rogue
instantiation of a chaincode.

Change-Id: I4dbdb3459076a8d6d3f145d2ee7b89022f107e4b
Signed-off-by: Alessandro Sorniotti <ale.linux@sopit.net>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 4/20/2017, 1:14:56 PM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/20/2017, 1:47:46 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/4025/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/20/2017, 1:55:27 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/9957/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/20/2017, 1:55:28 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/1492/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/20/2017, 3:56:51 PM<br><strong>Message</strong>: <pre>Patch Set 1: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/4025/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/9957/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/1492/ : FAILURE (skipped)</pre><strong>Reviewer</strong>: Elli Androulaki - lli@zurich.ibm.com<br><strong>Reviewed</strong>: 4/20/2017, 4:20:15 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(1 comment)

Hi Ale,
I know the CI is failing, but this is a prelim comment :)
Thanks!</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 4/21/2017, 3:08:09 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(1 comment)

Thanks for your comment, pls see below!</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 4/21/2017, 3:08:15 AM<br><strong>Message</strong>: <pre>Patch Set 1:

reverify</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/21/2017, 3:37:43 AM<br><strong>Message</strong>: <pre>Patch Set 1: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/4095/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/21/2017, 3:44:13 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/10027/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/21/2017, 3:44:44 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/1562/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/21/2017, 4:50:26 AM<br><strong>Message</strong>: <pre>Patch Set 1: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/4095/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/10027/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/1562/ : FAILURE (skipped)</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 4/21/2017, 7:53:41 AM<br><strong>Message</strong>: <pre>Patch Set 2: Patch Set 1 was rebased</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/21/2017, 8:15:21 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/4129/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/21/2017, 8:16:11 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/10061/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/21/2017, 8:24:59 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/1596/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/21/2017, 10:19:40 AM<br><strong>Message</strong>: <pre>Patch Set 2: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/4129/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/10061/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/1596/ : FAILURE (skipped)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 4/21/2017, 10:45:02 AM<br><strong>Message</strong>: <pre>Patch Set 2:

reverify</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 4/21/2017, 10:54:27 AM<br><strong>Message</strong>: <pre>Patch Set 2: Code-Review+2</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/21/2017, 12:45:08 PM<br><strong>Message</strong>: <pre>Patch Set 2: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/4163/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/21/2017, 12:45:09 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/10096/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/21/2017, 12:54:13 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/1630/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/21/2017, 1:32:01 PM<br><strong>Message</strong>: <pre>Patch Set 2: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/4163/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/10096/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/1630/ : FAILURE (skipped)</pre><strong>Reviewer</strong>: Elli Androulaki - lli@zurich.ibm.com<br><strong>Reviewed</strong>: 4/21/2017, 1:39:43 PM<br><strong>Message</strong>: <pre>Patch Set 2:

(1 comment)

Hi Ale, Thanks!
Below an extended comment. Hope it helps.</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 4/21/2017, 3:14:56 PM<br><strong>Message</strong>: <pre>Patch Set 2:

(1 comment)

Thanks, Elli. One question from my side below</pre><strong>Reviewer</strong>: Elli Androulaki - lli@zurich.ibm.com<br><strong>Reviewed</strong>: 4/21/2017, 5:18:38 PM<br><strong>Message</strong>: <pre>Patch Set 2: Code-Review-1

(1 comment)

Hi Ale,

Please find my comment below. Hope it helps.
I -1ed the CR as with Yacov's +2 it may be merged and the comments lost.

Thanks much!</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 4/22/2017, 4:39:06 AM<br><strong>Message</strong>: <pre>Patch Set 2:

(1 comment)

Thx, Elli! See below</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 4/22/2017, 7:33:39 AM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 4/22/2017, 7:35:04 AM<br><strong>Message</strong>: <pre>Uploaded patch set 4.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/22/2017, 7:35:23 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/4257/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/22/2017, 7:36:11 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/4258/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/22/2017, 7:36:21 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/10191/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/22/2017, 7:36:42 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/1724/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/22/2017, 7:36:54 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/10192/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/22/2017, 7:37:16 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/1725/ (3/3)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 4/22/2017, 7:45:00 AM<br><strong>Message</strong>: <pre>Uploaded patch set 5.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/22/2017, 7:45:48 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/4261/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/22/2017, 7:46:02 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/10195/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/22/2017, 7:46:50 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/1728/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/22/2017, 7:48:41 AM<br><strong>Message</strong>: <pre>Patch Set 3: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/4257/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/10191/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/1724/ : FAILURE (skipped)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/22/2017, 7:49:55 AM<br><strong>Message</strong>: <pre>Patch Set 4: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/4258/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/10192/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/1725/ : FAILURE (skipped)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/22/2017, 8:29:23 AM<br><strong>Message</strong>: <pre>Patch Set 5: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/4261/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/10195/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/1728/ : FAILURE (skipped)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 4/22/2017, 8:33:56 AM<br><strong>Message</strong>: <pre>Uploaded patch set 6.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/22/2017, 8:35:57 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/4268/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/22/2017, 8:36:03 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/10202/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/22/2017, 8:36:37 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/1735/ (3/3)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 4/22/2017, 8:46:33 AM<br><strong>Message</strong>: <pre>Uploaded patch set 7.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/22/2017, 8:48:12 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/4270/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/22/2017, 8:48:46 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/10204/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/22/2017, 8:48:51 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/1737/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/22/2017, 9:17:44 AM<br><strong>Message</strong>: <pre>Patch Set 6: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/4268/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/10202/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/1735/ : FAILURE (skipped)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/22/2017, 9:20:34 AM<br><strong>Message</strong>: <pre>Patch Set 7: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/4270/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/10204/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/1737/ : FAILURE (skipped)</pre><strong>Reviewer</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>Reviewed</strong>: 4/22/2017, 9:31:39 AM<br><strong>Message</strong>: <pre>Patch Set 7:

reverify</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/22/2017, 9:31:48 AM<br><strong>Message</strong>: <pre>Patch Set 7: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/4276/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/22/2017, 9:36:42 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/10210/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/22/2017, 9:37:18 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/1743/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/22/2017, 10:29:46 AM<br><strong>Message</strong>: <pre>Patch Set 7: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/4276/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/10210/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/1743/ : FAILURE (skipped)</pre><strong>Reviewer</strong>: Elli Androulaki - lli@zurich.ibm.com<br><strong>Reviewed</strong>: 4/22/2017, 11:57:24 AM<br><strong>Message</strong>: <pre>Patch Set 7:

reverify</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/22/2017, 12:14:10 PM<br><strong>Message</strong>: <pre>Patch Set 7: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/4300/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/22/2017, 12:14:15 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/10234/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/22/2017, 12:14:26 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/1767/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/22/2017, 1:29:03 PM<br><strong>Message</strong>: <pre>Patch Set 7: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/4300/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/1767/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/10234/ : SUCCESS</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 4/22/2017, 1:40:49 PM<br><strong>Message</strong>: <pre>Uploaded patch set 8.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/22/2017, 1:41:50 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/4302/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/22/2017, 1:42:20 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/10236/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/22/2017, 1:43:19 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/1769/ (3/3)</pre><strong>Reviewer</strong>: Christopher Ferris - chris.ferris@gmail.com<br><strong>Reviewed</strong>: 4/22/2017, 2:29:27 PM<br><strong>Message</strong>: <pre>Patch Set 8: Code-Review-1

(1 comment)

so, two new functions and no new tests? Both can be easily unit tested, and should be.

Now, as for the patch itself, how exactly does the chaincode get into the cache in the first place? At the very least, you should have a means of populating defined in the interface and you could add a stub for the impl if you wanted to keep the patch small.</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 4/22/2017, 2:34:24 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Thanks, Chris. I'll add tests asap and push a new revision. The cache is just a means of not having to go to the file system every time; for every chaincode name/version pair, the cache is populated at the time of the first lookup. ChaincodeData is immutable and so we don't need to every change it.</pre><strong>Reviewer</strong>: Christopher Ferris - chris.ferris@gmail.com<br><strong>Reviewed</strong>: 4/22/2017, 2:36:35 PM<br><strong>Message</strong>: <pre>Patch Set 8:

> Thanks, Chris. I'll add tests asap and push a new revision. The
 > cache is just a means of not having to go to the file system every
 > time; for every chaincode name/version pair, the cache is populated
 > at the time of the first lookup. ChaincodeData is immutable and so
 > we don't need to every change it.

ah, missed that thanks...</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/22/2017, 2:39:45 PM<br><strong>Message</strong>: <pre>Patch Set 8: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/4302/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/10236/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/1769/ : FAILURE (skipped)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 4/23/2017, 3:42:36 AM<br><strong>Message</strong>: <pre>Uploaded patch set 9.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/23/2017, 3:46:24 AM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/4326/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/23/2017, 3:46:29 AM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/10260/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/23/2017, 3:47:08 AM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/1793/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/23/2017, 4:43:55 AM<br><strong>Message</strong>: <pre>Patch Set 9: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/4326/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/10260/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/1793/ : FAILURE (skipped)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 4/23/2017, 4:51:24 AM<br><strong>Message</strong>: <pre>Uploaded patch set 10.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/23/2017, 4:53:05 AM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/4329/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/23/2017, 4:54:01 AM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/10263/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/23/2017, 4:54:11 AM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/1796/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/23/2017, 6:00:06 AM<br><strong>Message</strong>: <pre>Patch Set 10: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/4329/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/10263/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/1796/ : FAILURE (skipped)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 4/23/2017, 8:00:33 AM<br><strong>Message</strong>: <pre>Patch Set 10:

reverify</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/23/2017, 8:01:51 AM<br><strong>Message</strong>: <pre>Patch Set 10: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/4339/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/23/2017, 8:02:52 AM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/10273/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/23/2017, 8:03:26 AM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/1806/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/23/2017, 9:20:39 AM<br><strong>Message</strong>: <pre>Patch Set 10: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/4339/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/10273/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/1806/ : FAILURE (skipped)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 4/23/2017, 9:22:02 AM<br><strong>Message</strong>: <pre>Patch Set 10:

reverify</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/23/2017, 9:23:50 AM<br><strong>Message</strong>: <pre>Patch Set 10: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/4342/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/23/2017, 9:24:27 AM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/10276/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/23/2017, 9:25:21 AM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/1809/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/23/2017, 10:32:08 AM<br><strong>Message</strong>: <pre>Patch Set 10: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/4342/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/1809/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/10276/ : SUCCESS</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 4/23/2017, 11:01:27 AM<br><strong>Message</strong>: <pre>Uploaded patch set 11: Patch Set 10 was rebased.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/23/2017, 11:02:47 AM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/4351/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/23/2017, 11:03:59 AM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/10285/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/23/2017, 11:04:55 AM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/1818/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/23/2017, 12:14:06 PM<br><strong>Message</strong>: <pre>Patch Set 11: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/4351/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/1818/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/10285/ : SUCCESS</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 4/23/2017, 3:44:25 PM<br><strong>Message</strong>: <pre>Patch Set 11: Code-Review-1

(6 comments)</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 4/23/2017, 10:02:07 PM<br><strong>Message</strong>: <pre>Patch Set 11: Code-Review-1

Hi Ale, In my opinion the invoker should not have to specify chaincode version.  We don't support multiple versions of the chaincode and use the latest. In fact user does not have to provide version for invoke and query in the CLI (so we'll have to add those checks in CLI too btw). In addition to extending the codepath this adds a complexity and extra book keeping (such as cache) etc.

At least can we move this post 1.1 when we'll have more time to think through this please ?</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 4/24/2017, 4:36:06 AM<br><strong>Message</strong>: <pre>Patch Set 11:

> Hi Ale, In my opinion the invoker should not have to specify chaincode version.  We don't support multiple versions of the chaincode and use the latest. In fact user does not have to provide version for invoke and query in the CLI (so we'll have to add those checks in CLI too btw). In addition to extending the codepath this adds a complexity and extra book keeping (such as cache) etc.
At least can we move this post 1.1 when we'll have more time to think through this please ?

Hi Murali, thanks for your comments! Maybe the purpose of this CR wasn't too clear, let me summarize it here:
1) ***IF*** the invoker specifies the version (because they want to make sure that they invoke the right version in case it may be concurrently upgraded), the peer honors the request and aborts the invocation if the running cc does not match the requested one; once more: there's no obligation to specify a version. The check is performed only if one is specified.
2) for each invocation, we check that the instantiated chaincode matches the installed one (if any) in terms of its instantiation policy, just to avoid repercussions from any rogue instantiation of a chaincode.

Does that make sense?</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 4/24/2017, 6:40:46 AM<br><strong>Message</strong>: <pre>Patch Set 11:

> > Hi Ale, In my opinion the invoker should not have to specify
 > chaincode version.  We don't support multiple versions of the
 > chaincode and use the latest. In fact user does not have to provide
 > version for invoke and query in the CLI (so we'll have to add those
 > checks in CLI too btw). In addition to extending the codepath this
 > adds a complexity and extra book keeping (such as cache) etc.
 > At least can we move this post 1.1 when we'll have more time to
 > think through this please ?
 > 
 > Hi Murali, thanks for your comments! Maybe the purpose of this CR
 > wasn't too clear, let me summarize it here:
 > 1) ***IF*** the invoker specifies the version (because they want to
 > make sure that they invoke the right version in case it may be
 > concurrently upgraded), the peer honors the request and aborts the
 > invocation if the running cc does not match the requested one; once
 > more: there's no obligation to specify a version. The check is
 > performed only if one is specified.
 > 2) for each invocation, we check that the instantiated chaincode
 > matches the installed one (if any) in terms of its instantiation
 > policy, just to avoid repercussions from any rogue instantiation of
 > a chaincode.
 > 
 > Does that make sense?

Hi Ale,
Ok. I went with the CR Commit Message which says "the invoker must specify the chaincode version that they want to invoke ...." . Are you saying the intent is really "if the invoker specifies the chaincode version that they want to invoke..." ?</pre><strong>Reviewer</strong>: YAOGUO JIANG - jiangyaoguo@gmail.com<br><strong>Reviewed</strong>: 4/24/2017, 6:45:04 AM<br><strong>Message</strong>: <pre>Patch Set 11:

Is there a real scenario that invoker wants to invoke previous version chaincode on purpose while the chaincode being upgraded?</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 4/24/2017, 8:21:17 AM<br><strong>Message</strong>: <pre>Patch Set 11:

> Is there a real scenario that invoker wants to invoke previous version chaincode on purpose while the chaincode being upgraded?

The point is slightly different; the question is: is there a scenario in which the invoker might want to make sure that the cc being invoked is at a specific version? I believe the answer may very well be yes. While it's impossible to list all reasons, a few could be: 
 - it would be a very simple way of notifying invokers of a cc upgrade event without having to listen to events;
 - it could be a way of propagating upgrades;
 - it could be a way of not having to coordinate too tightly between front- and back-end during cc upgrades: just roll clients that can handle both old and new version, have them invoke specifying the old version and switch to the new version at the first error;</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 4/24/2017, 8:35:57 AM<br><strong>Message</strong>: <pre>Patch Set 11:

Hey Murali

> Ok. I went with the CR Commit Message which says "the invoker must specify the chaincode version that they want to invoke ...." . Are you saying the intent is really "if the invoker specifies the chaincode version that they want to invoke..." ?

Yeah, I suppose the commit message is indeed a bit misleading. Let me change that. Thx!</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 4/24/2017, 8:41:17 AM<br><strong>Message</strong>: <pre>Patch Set 11:

(4 comments)

Thanks Yacov for your comments, see below!</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 4/24/2017, 8:44:22 AM<br><strong>Message</strong>: <pre>Uploaded patch set 12: Commit message was updated.</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 4/24/2017, 9:09:03 AM<br><strong>Message</strong>: <pre>Patch Set 12: Code-Review-1

(4 comments)</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 4/25/2017, 9:56:34 PM<br><strong>Message</strong>: <pre>Patch Set 12: Code-Review-1

Hi Ale, feel uncomfortable with this. Assuming upgrade is an infrequent operation, IMO this is an overhead for small  returns. Rarely do we actually check for software version on a transaction basis. And even if we need to do that, its likely not the end user but the SDK which would manage this. In that case it can query and get the chaincode version in a separate operation. We should keep the runtime lean/mean.

My 2c but willing to be overridden by convincing comeback :-)</pre><strong>Reviewer</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>Reviewed</strong>: 4/27/2017, 1:26:05 PM<br><strong>Message</strong>: <pre>Patch Set 12: Code-Review-2

We only support 1 version in this release -- the latest one, so why would we allow anyone to specify a version. That should be the bug. Not this and this solution.

I recommend abandon both fab-3156 and this CR.</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 5/9/2017, 5:08:30 AM<br><strong>Message</strong>: <pre>Uploaded patch set 13.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/9/2017, 5:10:10 AM<br><strong>Message</strong>: <pre>Patch Set 13:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/5379/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/9/2017, 5:10:53 AM<br><strong>Message</strong>: <pre>Patch Set 13:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/11320/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/9/2017, 5:11:34 AM<br><strong>Message</strong>: <pre>Patch Set 13:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/2849/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/9/2017, 5:54:29 AM<br><strong>Message</strong>: <pre>Patch Set 13: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/5379/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/11320/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/2849/ : FAILURE (skipped)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 5/9/2017, 6:14:12 AM<br><strong>Message</strong>: <pre>Uploaded patch set 14.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/9/2017, 6:15:57 AM<br><strong>Message</strong>: <pre>Patch Set 14:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/5382/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/9/2017, 6:16:10 AM<br><strong>Message</strong>: <pre>Patch Set 14:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/11323/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/9/2017, 6:16:12 AM<br><strong>Message</strong>: <pre>Patch Set 14:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/2852/ (3/3)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 5/9/2017, 6:18:38 AM<br><strong>Message</strong>: <pre>Patch Set 14:

(4 comments)

Thanks, Yacov. I've rebased and addressed all your comments.</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 5/9/2017, 6:20:21 AM<br><strong>Message</strong>: <pre>Patch Set 14:

Thanks Binh and Murali. I've removed the check invokedcc.ver == instantiatedcc.ver. I've only left the check that the instantiation policy of the instantiated cc (from the ledger) matches the info on the file system - just to avoid any rogue party bypassing instantiation policies. Thx!</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/9/2017, 6:44:22 AM<br><strong>Message</strong>: <pre>Patch Set 14: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/5382/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/11323/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/2852/ : FAILURE (skipped)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 5/9/2017, 7:45:28 AM<br><strong>Message</strong>: <pre>Uploaded patch set 15.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/9/2017, 7:46:58 AM<br><strong>Message</strong>: <pre>Patch Set 15:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/5384/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/9/2017, 7:47:50 AM<br><strong>Message</strong>: <pre>Patch Set 15:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/11325/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/9/2017, 7:47:57 AM<br><strong>Message</strong>: <pre>Patch Set 15:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/2854/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/9/2017, 9:05:45 AM<br><strong>Message</strong>: <pre>Patch Set 15: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/5384/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/2854/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/11325/ : SUCCESS</pre><strong>Reviewer</strong>: YAOGUO JIANG - jiangyaoguo@gmail.com<br><strong>Reviewed</strong>: 5/9/2017, 9:50:42 AM<br><strong>Message</strong>: <pre>Patch Set 14:

(1 comment)</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 5/9/2017, 11:31:30 AM<br><strong>Message</strong>: <pre>Patch Set 15:

(2 comments)</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 5/9/2017, 11:34:51 AM<br><strong>Message</strong>: <pre>Patch Set 15:

> (1 comment)

(Ale to override ... but my impression was the point of this check is the reverse of what you suggest Yacov.... an LSCC entry from a second peer on a new channel may not match the one on this peer. Invokes are checked against the local install as an additional measure of security.</pre><strong>Reviewer</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>Reviewed</strong>: 5/9/2017, 1:56:21 PM<br><strong>Message</strong>: <pre>Patch Set 15:

(6 comments)

Ale, I keep -2 as I don't see this implementation solve the stated problem. The assumption here is that we are facing some rogue instantiates, which could very well include exactly the same cc name, version and instantiation policy.

In addition, I have some comments in the code.</pre><strong>Reviewer</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>Reviewed</strong>: 5/9/2017, 3:01:44 PM<br><strong>Message</strong>: <pre>Patch Set 15: Code-Review-1

(1 comment)

Ale, I discussed with Elli and Murali and learned that my assumption was incorrect. Instantiation policy was being used to ensure that only those in the policy may sign the transaction. So I am satisfied with that code and the solution, except the comments in code. Please address them so that we can merge ASAP.</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 5/10/2017, 1:52:11 PM<br><strong>Message</strong>: <pre>Patch Set 15:

(8 comments)

Thanks for your review, please see below and the new patch set.</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 5/10/2017, 1:55:04 PM<br><strong>Message</strong>: <pre>Uploaded patch set 16.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/10/2017, 1:57:44 PM<br><strong>Message</strong>: <pre>Patch Set 16:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/5474/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/10/2017, 1:59:09 PM<br><strong>Message</strong>: <pre>Patch Set 16:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/11415/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/10/2017, 2:00:04 PM<br><strong>Message</strong>: <pre>Patch Set 16:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/2945/ (3/3)</pre><strong>Reviewer</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>Reviewed</strong>: 5/10/2017, 3:15:17 PM<br><strong>Message</strong>: <pre>Patch Set 16: Code-Review+1

(3 comments)

LGTM with a couple of minor comments. Waiting for CI to complete</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/10/2017, 3:22:04 PM<br><strong>Message</strong>: <pre>Patch Set 16: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/5474/ : SUCCESS

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/11415/ : SUCCESS

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/2945/ : SUCCESS</pre><strong>Reviewer</strong>: Elli Androulaki - lli@zurich.ibm.com<br><strong>Reviewed</strong>: 5/10/2017, 4:44:37 PM<br><strong>Message</strong>: <pre>Patch Set 16: Code-Review+1

(1 comment)

Thanks Ale!
I am good, as soon as Binh and Murali are happy with their comments being addressed.</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 5/10/2017, 4:51:33 PM<br><strong>Message</strong>: <pre>Patch Set 16:

(1 comment)

Thanks Binh and Elli, see below!</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 5/10/2017, 6:58:42 PM<br><strong>Message</strong>: <pre>Patch Set 16: Code-Review+2

(1 comment)

Thanks, Ale.</pre><strong>Reviewer</strong>: Christopher Ferris - chris.ferris@gmail.com<br><strong>Reviewed</strong>: 5/11/2017, 8:18:05 AM<br><strong>Message</strong>: <pre>Patch Set 16: Code-Review+2</pre><strong>Reviewer</strong>: Gerrit Code Review - gerrit@hyperledger.org<br><strong>Reviewed</strong>: 5/11/2017, 8:18:07 AM<br><strong>Message</strong>: <pre>Change has been successfully merged by Christopher Ferris</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/11/2017, 8:20:07 AM<br><strong>Message</strong>: <pre>Patch Set 16:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-x86_64/1799/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/11/2017, 8:21:07 AM<br><strong>Message</strong>: <pre>Patch Set 16:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/481/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/11/2017, 8:21:11 AM<br><strong>Message</strong>: <pre>Patch Set 16:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-behave-x86_64/793/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/11/2017, 10:17:13 AM<br><strong>Message</strong>: <pre>Patch Set 16:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-merge-x86_64/1799/ : SUCCESS

https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/481/ : SUCCESS

https://jenkins.hyperledger.org/job/fabric-merge-behave-x86_64/793/ : SUCCESS</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 4/20/2017, 1:14:56 PM<br><strong>UnmergedRevision</strong>: [b3631c1f0abfe5df457d3297eb223608ea26c72c](https://github.com/hyperledger-gerrit-archive/fabric/commit/b3631c1f0abfe5df457d3297eb223608ea26c72c)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/21/2017, 4:50:26 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Elli Androulaki - lli@zurich.ibm.com<br><strong>CommentLine</strong>: [core/endorser/endorser.go#L196](https://github.com/hyperledger-gerrit-archive/fabric/blob/b3631c1f0abfe5df457d3297eb223608ea26c72c/core/endorser/endorser.go#L196)<br><strong>Comment</strong>: <pre>Here we also need to add the check on instantiation policy & owners. Btw, is this function also used for cc2cc?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/endorser/endorser.go#L196](https://github.com/hyperledger-gerrit-archive/fabric/blob/b3631c1f0abfe5df457d3297eb223608ea26c72c/core/endorser/endorser.go#L196)<br><strong>Comment</strong>: <pre>I'm not sure how to do that: when a cc is invoked, we receive from the SDK request only cc name and version, and so we can check that against lscc's data. How do you suggest I check for instantiation policy and owners?

Also, this only covers direct invocation through proposal. Unfortunately, we can't do it for cc2cc invocation because the invoker can't specify the version of cc they want to invoke. They can invoke lscc to check which version it is, though so I believe we're good. Would you agree?</pre><strong>Commenter</strong>: Elli Androulaki - lli@zurich.ibm.com<br><strong>CommentLine</strong>: [core/endorser/endorser.go#L196](https://github.com/hyperledger-gerrit-archive/fabric/blob/b3631c1f0abfe5df457d3297eb223608ea26c72c/core/endorser/endorser.go#L196)<br><strong>Comment</strong>: <pre>Hm, but the invoker does not need to specify the version. In the channel there is only one version available, the one corresponding to the latest upgrade. 

So, the way I was hoping it to work is the following:
1. client -> peer: proposal 
2. peer : i) checks client signature/creator
               ii) retrieves the name of the invoked chaincode, say ccName
               iii) looks up from lscc the ccdata corresponding to ccName, say ccDataInChannel
                iiii) checks its lscc table of installed chaincodes to see if there is an entry for a chaincode with ccName, and with version, instantiation policy that matches ccDataInChannel. If not, it rejects the call. Otherwise it continuees with the simulation/execution.

Does this make sense?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/endorser/endorser.go#L196](https://github.com/hyperledger-gerrit-archive/fabric/blob/b3631c1f0abfe5df457d3297eb223608ea26c72c/core/endorser/endorser.go#L196)<br><strong>Comment</strong>: <pre>I'm still not sure... I checked with Matthias who told me the following wrt. what was left of 3156:

(14:29:58) Matthias Neugschwandtner: I think everything's there already
(14:30:30) Matthias Neugschwandtner: to the best of my understanding lscc checks that it's spinning up the right chaincode (Murali did that) - see my comments
(14:31:45) Matthias Neugschwandtner: and your 8313 does the rest
(14:32:11) Matthias Neugschwandtner: (matching invoke version vs version that is running)

With this in mind, do we still need to perform the check that you described in your comments?</pre><strong>Commenter</strong>: Elli Androulaki - lli@zurich.ibm.com<br><strong>CommentLine</strong>: [core/endorser/endorser.go#L196](https://github.com/hyperledger-gerrit-archive/fabric/blob/b3631c1f0abfe5df457d3297eb223608ea26c72c/core/endorser/endorser.go#L196)<br><strong>Comment</strong>: <pre>We need to check all the components of what we call chaincode identifier in 3155 and 3156, otherwise instantiation policy is endangered of being by-passed. 

A peer may have installed a chaincode with the same pair (name, version), but with different instantiation policy than the one appearing in the chain, and being tricked into producing an endorsement for it while it should not.

It is indeed that with Matthias we had discussed only checking version and name but that was last week, and since then i realised there was a security hole if the additional checks were not to be made... I thought 3156 was reflecting that, as well as the description of the flow of 3155.. but yeah, it is complex enough ;)</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/endorser/endorser.go#L196](https://github.com/hyperledger-gerrit-archive/fabric/blob/b3631c1f0abfe5df457d3297eb223608ea26c72c/core/endorser/endorser.go#L196)<br><strong>Comment</strong>: <pre>Thanks for the explanation, Elli! :) It's indeed clear to me now which checks are missing and why they are needed. I'll push a new patch set shortly and will ask for your review again!</pre></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Created</strong>: 4/21/2017, 7:53:41 AM<br><strong>UnmergedRevision</strong>: [7c5e00e70689f23447ebea0d7f8c4c90faaa39bf](https://github.com/hyperledger-gerrit-archive/fabric/commit/7c5e00e70689f23447ebea0d7f8c4c90faaa39bf)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/21/2017, 1:32:01 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Approved</strong>: 4/21/2017, 10:54:27 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Elli Androulaki - lli@zurich.ibm.com<br><strong>Approved</strong>: 4/21/2017, 5:18:38 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 4/22/2017, 7:33:39 AM<br><strong>UnmergedRevision</strong>: [d6cbe614584c69188d7c4b3f20aec9dba7616530](https://github.com/hyperledger-gerrit-archive/fabric/commit/d6cbe614584c69188d7c4b3f20aec9dba7616530)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/22/2017, 7:48:41 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 4/22/2017, 7:35:04 AM<br><strong>UnmergedRevision</strong>: [f4df833916aef5d143adee7fc5958cbf253240aa](https://github.com/hyperledger-gerrit-archive/fabric/commit/f4df833916aef5d143adee7fc5958cbf253240aa)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/22/2017, 7:49:55 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 5</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 4/22/2017, 7:45:00 AM<br><strong>UnmergedRevision</strong>: [b49d833b4a1aa28c190fb953921bcf00e4381dba](https://github.com/hyperledger-gerrit-archive/fabric/commit/b49d833b4a1aa28c190fb953921bcf00e4381dba)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/22/2017, 8:29:23 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 6</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 4/22/2017, 8:33:56 AM<br><strong>UnmergedRevision</strong>: [2e10cdecf4acbb736e2f73dcaf7384e18258fda2](https://github.com/hyperledger-gerrit-archive/fabric/commit/2e10cdecf4acbb736e2f73dcaf7384e18258fda2)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/22/2017, 9:17:44 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 7</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 4/22/2017, 8:46:33 AM<br><strong>UnmergedRevision</strong>: [b3311a3020c5b787e4bceaaf9fd3baba595290e7](https://github.com/hyperledger-gerrit-archive/fabric/commit/b3311a3020c5b787e4bceaaf9fd3baba595290e7)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/22/2017, 1:29:03 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 8</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 4/22/2017, 1:40:49 PM<br><strong>UnmergedRevision</strong>: [86d8f3d9c44fae65f2e1037e79a6f32e3c1132f2](https://github.com/hyperledger-gerrit-archive/fabric/commit/86d8f3d9c44fae65f2e1037e79a6f32e3c1132f2)<br><br><strong>Approver</strong>: Christopher Ferris - chris.ferris@gmail.com<br><strong>Approved</strong>: 4/22/2017, 2:29:27 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/22/2017, 2:39:45 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Christopher Ferris - chris.ferris@gmail.com<br><strong>CommentLine</strong>: [core/common/ccprovider/ccinfocache.go#L26](https://github.com/hyperledger-gerrit-archive/fabric/blob/86d8f3d9c44fae65f2e1037e79a6f32e3c1132f2/core/common/ccprovider/ccinfocache.go#L26)<br><strong>Comment</strong>: <pre>s/version; if/version; it/</pre></blockquote><h3>PatchSet Number: 9</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 4/23/2017, 3:42:36 AM<br><strong>UnmergedRevision</strong>: [f688e9e67385a84b54e5f2fe71ff052424c344cb](https://github.com/hyperledger-gerrit-archive/fabric/commit/f688e9e67385a84b54e5f2fe71ff052424c344cb)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/23/2017, 4:43:55 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 10</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 4/23/2017, 4:51:24 AM<br><strong>UnmergedRevision</strong>: [1f56e571c33f30ab90700181995ef0e7255a9569](https://github.com/hyperledger-gerrit-archive/fabric/commit/1f56e571c33f30ab90700181995ef0e7255a9569)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/23/2017, 10:32:08 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 11</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 4/23/2017, 11:01:27 AM<br><strong>UnmergedRevision</strong>: [66d29ff19a54fe2f6d47b29e474423f4ce725c25](https://github.com/hyperledger-gerrit-archive/fabric/commit/66d29ff19a54fe2f6d47b29e474423f4ce725c25)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/23/2017, 12:14:06 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Approved</strong>: 4/23/2017, 10:02:07 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Approved</strong>: 4/23/2017, 3:44:25 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [core/common/ccprovider/ccinfocache.go#L37](https://github.com/hyperledger-gerrit-archive/fabric/blob/66d29ff19a54fe2f6d47b29e474423f4ce725c25/core/common/ccprovider/ccinfocache.go#L37)<br><strong>Comment</strong>: <pre>isn't there some risk of overloading the memory? The cache is an monotonously increasing set, no? Why not restrict the cache to a finite size, or alternatively - have a goroutine in the background, that expires un-used entries?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/common/ccprovider/ccinfocache.go#L37](https://github.com/hyperledger-gerrit-archive/fabric/blob/66d29ff19a54fe2f6d47b29e474423f4ce725c25/core/common/ccprovider/ccinfocache.go#L37)<br><strong>Comment</strong>: <pre>I thought about this but decided against putting in any purging logic because of the following reason: before we decide how to prune entries from this cache we might want to decide about a logic to terminate the containers (and remove the images of) older versions of chaincodes. When we put in this logic, we can just hook it to remove entries from this cache.</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [core/common/ccprovider/ccinfocache.go#L37](https://github.com/hyperledger-gerrit-archive/fabric/blob/66d29ff19a54fe2f6d47b29e474423f4ce725c25/core/common/ccprovider/ccinfocache.go#L37)<br><strong>Comment</strong>: <pre>OK, can you at least open a JIRA issue to track this?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/common/ccprovider/ccinfocache.go#L37](https://github.com/hyperledger-gerrit-archive/fabric/blob/66d29ff19a54fe2f6d47b29e474423f4ce725c25/core/common/ccprovider/ccinfocache.go#L37)<br><strong>Comment</strong>: <pre>Done! https://jira.hyperledger.org/browse/FAB-3742 

thx!</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [core/common/ccprovider/ccinfocache.go#L45](https://github.com/hyperledger-gerrit-archive/fabric/blob/66d29ff19a54fe2f6d47b29e474423f4ce725c25/core/common/ccprovider/ccinfocache.go#L45)<br><strong>Comment</strong>: <pre>The only way of obtaining a reference to some ccInfoCacheImpl is via the NewCCInfoCache so this code isn't reachable.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/common/ccprovider/ccinfocache.go#L45](https://github.com/hyperledger-gerrit-archive/fabric/blob/66d29ff19a54fe2f6d47b29e474423f4ce725c25/core/common/ccprovider/ccinfocache.go#L45)<br><strong>Comment</strong>: <pre>It's probably not reachable now, with the current version of the code. I can't speak for the future and so I see value in this panic.</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [core/common/ccprovider/ccinfocache.go#L45](https://github.com/hyperledger-gerrit-archive/fabric/blob/66d29ff19a54fe2f6d47b29e474423f4ce725c25/core/common/ccprovider/ccinfocache.go#L45)<br><strong>Comment</strong>: <pre>So, in the future when someone submits a change set that changes the code - that someone would still preserve the invariant that this c.cache cannot be nil.
Otherwise, some maintainer would review it hopefully would see the problem.

I see no value in creating 'if's that panic for conditions that cannot take place.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/common/ccprovider/ccinfocache.go#L45](https://github.com/hyperledger-gerrit-archive/fabric/blob/66d29ff19a54fe2f6d47b29e474423f4ce725c25/core/common/ccprovider/ccinfocache.go#L45)<br><strong>Comment</strong>: <pre>Gotcha, I've removed it, thx!</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [core/common/ccprovider/ccinfocache.go#L57](https://github.com/hyperledger-gerrit-archive/fabric/blob/66d29ff19a54fe2f6d47b29e474423f4ce725c25/core/common/ccprovider/ccinfocache.go#L57)<br><strong>Comment</strong>: <pre>Is this code reachable at all?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/common/ccprovider/ccinfocache.go#L57](https://github.com/hyperledger-gerrit-archive/fabric/blob/66d29ff19a54fe2f6d47b29e474423f4ce725c25/core/common/ccprovider/ccinfocache.go#L57)<br><strong>Comment</strong>: <pre>It's probably not reachable now, with the current version of the code. I can't speak for the future and so I see value in this panic.</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [core/common/ccprovider/ccinfocache.go#L57](https://github.com/hyperledger-gerrit-archive/fabric/blob/66d29ff19a54fe2f6d47b29e474423f4ce725c25/core/common/ccprovider/ccinfocache.go#L57)<br><strong>Comment</strong>: <pre>When you read from a map with a,b := m[k]
unless you put nil into m[k], you will never get non-nil if b is false. 

The code doesn't put nil into the map (you have this comment "this is guaranteed to be not nil") and if you're not sure you can also check that it's not nil in line 67.

This code is redundant, I think we should not have it.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/common/ccprovider/ccinfocache.go#L57](https://github.com/hyperledger-gerrit-archive/fabric/blob/66d29ff19a54fe2f6d47b29e474423f4ce725c25/core/common/ccprovider/ccinfocache.go#L57)<br><strong>Comment</strong>: <pre>Yup, removed. Thx!</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [core/common/ccprovider/ccinfocache.go#L61](https://github.com/hyperledger-gerrit-archive/fabric/blob/66d29ff19a54fe2f6d47b29e474423f4ce725c25/core/common/ccprovider/ccinfocache.go#L61)<br><strong>Comment</strong>: <pre>this line here makes this module not test-friendly.
IMO you should declare an interface in this file that returns to you the ccpack (i.e CCPackageFactory or CCPackageGetter or CCPackageRetriever) and then pass it via the constructor.

This would make tests so much easier!</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/common/ccprovider/ccinfocache.go#L61](https://github.com/hyperledger-gerrit-archive/fabric/blob/66d29ff19a54fe2f6d47b29e474423f4ce725c25/core/common/ccprovider/ccinfocache.go#L61)<br><strong>Comment</strong>: <pre>Good point! If you don't disagree I'll take this with a new change-set, in the spirit of keeping change sets small and with a single purpose, as required by Chris Ferris in his emails a few weeks back. If you want me to, I'd be happy to create a jira to keep track of this work item?</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [core/common/ccprovider/ccinfocache.go#L61](https://github.com/hyperledger-gerrit-archive/fabric/blob/66d29ff19a54fe2f6d47b29e474423f4ce725c25/core/common/ccprovider/ccinfocache.go#L61)<br><strong>Comment</strong>: <pre>On the contrary. 
Look at your test.
You're messing with the file system and writing files to disk because you have created a coupling between the file system and your cache, even though you don't need to do such a thing.

If you have an interface or a function that returns to you the CCpack, you can mock that in the test and get rid of all that file system initialization you're doing here, so the change set would even be smaller :)</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/common/ccprovider/ccinfocache.go#L61](https://github.com/hyperledger-gerrit-archive/fabric/blob/66d29ff19a54fe2f6d47b29e474423f4ce725c25/core/common/ccprovider/ccinfocache.go#L61)<br><strong>Comment</strong>: <pre>Good point, I've added an interface + mocks for my tests so I no longer have to write to the fs during the tests.</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [core/common/ccprovider/ccprovider.go#L311](https://github.com/hyperledger-gerrit-archive/fabric/blob/66d29ff19a54fe2f6d47b29e474423f4ce725c25/core/common/ccprovider/ccprovider.go#L311)<br><strong>Comment</strong>: <pre>While this is nice, I think this should be "cd" and then a local variable should use the "this".
Doesn't golint complain when you run it on this package? I'm pretty sure it will.</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [core/common/ccprovider/ccprovider.go#L319](https://github.com/hyperledger-gerrit-archive/fabric/blob/66d29ff19a54fe2f6d47b29e474423f4ce725c25/core/common/ccprovider/ccprovider.go#L319)<br><strong>Comment</strong>: <pre>This is because this is just a string, and not a proto message. Right?</pre></blockquote><h3>PatchSet Number: 12</h3><blockquote><strong>Type</strong>: NO_CODE_CHANGE<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 4/24/2017, 8:44:22 AM<br><strong>UnmergedRevision</strong>: [2048e37216f1c9a72cca728ad0fa80d9abd93f30](https://github.com/hyperledger-gerrit-archive/fabric/commit/2048e37216f1c9a72cca728ad0fa80d9abd93f30)<br><br><strong>Approver</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>Approved</strong>: 4/27/2017, 1:26:05 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Approved</strong>: 4/25/2017, 9:56:34 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Approved</strong>: 4/24/2017, 9:09:03 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 13</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 5/9/2017, 5:08:30 AM<br><strong>UnmergedRevision</strong>: [004f948a13bf6286a8a70cb085dc2e6044aacafc](https://github.com/hyperledger-gerrit-archive/fabric/commit/004f948a13bf6286a8a70cb085dc2e6044aacafc)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/9/2017, 5:54:29 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>Approved</strong>: 4/27/2017, 1:26:05 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 14</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 5/9/2017, 6:14:12 AM<br><strong>UnmergedRevision</strong>: [63e945479835ed5eb65be098166161e8d8aa4897](https://github.com/hyperledger-gerrit-archive/fabric/commit/63e945479835ed5eb65be098166161e8d8aa4897)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/9/2017, 6:44:22 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>Approved</strong>: 4/27/2017, 1:26:05 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: YAOGUO JIANG - jiangyaoguo@gmail.com<br><strong>CommentLine</strong>: [core/endorser/endorser.go#L183](https://github.com/hyperledger-gerrit-archive/fabric/blob/63e945479835ed5eb65be098166161e8d8aa4897/core/endorser/endorser.go#L183)<br><strong>Comment</strong>: <pre>We should trust CDS got from lscc. Why we validate InstantiationPolicy on FS especially? If using a cache, we still can't ensure lscc and FS are the same.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/endorser/endorser.go#L183](https://github.com/hyperledger-gerrit-archive/fabric/blob/63e945479835ed5eb65be098166161e8d8aa4897/core/endorser/endorser.go#L183)<br><strong>Comment</strong>: <pre>Thanks Yaoguo, see below:

> We should trust CDS got from lscc

I don't think that we should. They could be the outcome of a rogue CC instantiation attempt from a malicious peer. All this peer trust is its own chaincode. I've added a bit more comment about this, and there's more discussion about why this is needed in the JIRA item.

> If using a cache, we still can't ensure lscc and FS are the same

That's correct, which is precisely why we have this check</pre><strong>Commenter</strong>: Elli Androulaki - lli@zurich.ibm.com<br><strong>CommentLine</strong>: [core/endorser/endorser.go#L183](https://github.com/hyperledger-gerrit-archive/fabric/blob/63e945479835ed5eb65be098166161e8d8aa4897/core/endorser/endorser.go#L183)<br><strong>Comment</strong>: <pre>So this is correct, we do trust the CDS from LSCC. 
However we need to ensure that the CDS from LSCC matches the chaincode (identified by the triplet name, version and instantiation policy) that the peer has locally stored, prior to simulating the execution. Cause if this is not the case, the endorser should ignore the proposal.

More information on the topic and potential attacks can be found in  FAB-3156.</pre></blockquote><h3>PatchSet Number: 15</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 5/9/2017, 7:45:28 AM<br><strong>UnmergedRevision</strong>: [2f5fcc057cd349a65c34804d9c51bbf4f31a5016](https://github.com/hyperledger-gerrit-archive/fabric/commit/2f5fcc057cd349a65c34804d9c51bbf4f31a5016)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/9/2017, 9:05:45 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>Approved</strong>: 5/9/2017, 3:01:44 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>CommentLine</strong>: [/COMMIT_MSG#L7](https://github.com/hyperledger-gerrit-archive/fabric/blob/2f5fcc057cd349a65c34804d9c51bbf4f31a5016//COMMIT_MSG#L7)<br><strong>Comment</strong>: <pre>This doesn't seem to go with the jira item.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [/COMMIT_MSG#L7](https://github.com/hyperledger-gerrit-archive/fabric/blob/2f5fcc057cd349a65c34804d9c51bbf4f31a5016//COMMIT_MSG#L7)<br><strong>Comment</strong>: <pre>Thanks, fixed</pre><strong>Commenter</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>CommentLine</strong>: [core/common/ccprovider/ccinfocache.go#L35](https://github.com/hyperledger-gerrit-archive/fabric/blob/2f5fcc057cd349a65c34804d9c51bbf4f31a5016/core/common/ccprovider/ccinfocache.go#L35)<br><strong>Comment</strong>: <pre>It doesn't make sense to me: we are defining an interface and implementation, yet the actual implementation is somewhere else. This function should have been implemented here; otherwise, why would we bother with interface? Why wouldn't we just call this function directly from CCInfoCache?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/common/ccprovider/ccinfocache.go#L35](https://github.com/hyperledger-gerrit-archive/fabric/blob/2f5fcc057cd349a65c34804d9c51bbf4f31a5016/core/common/ccprovider/ccinfocache.go#L35)<br><strong>Comment</strong>: <pre>Thx, I've moved this function in the appropriate file and replaced this passthrough call with the real implementation.</pre><strong>Commenter</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>CommentLine</strong>: [core/common/ccprovider/ccinfocache.go#L40](https://github.com/hyperledger-gerrit-archive/fabric/blob/2f5fcc057cd349a65c34804d9c51bbf4f31a5016/core/common/ccprovider/ccinfocache.go#L40)<br><strong>Comment</strong>: <pre>it</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/common/ccprovider/ccinfocache.go#L40](https://github.com/hyperledger-gerrit-archive/fabric/blob/2f5fcc057cd349a65c34804d9c51bbf4f31a5016/core/common/ccprovider/ccinfocache.go#L40)<br><strong>Comment</strong>: <pre>Done, thanks</pre><strong>Commenter</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>CommentLine</strong>: [core/common/ccprovider/ccinfocache.go#L71](https://github.com/hyperledger-gerrit-archive/fabric/blob/2f5fcc057cd349a65c34804d9c51bbf4f31a5016/core/common/ccprovider/ccinfocache.go#L71)<br><strong>Comment</strong>: <pre>Another approach would be have ccprovider manage the cache directly so GetChaincodeFromFS will return from cache if one exists. It would also make any lock mgmt we might add to ccprovider take care of this too. This has the benefit of all uses of GetChaincodeFromFS use cache. What do you think ?</pre><strong>Commenter</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>CommentLine</strong>: [core/common/ccprovider/ccinfocache.go#L71](https://github.com/hyperledger-gerrit-archive/fabric/blob/2f5fcc057cd349a65c34804d9c51bbf4f31a5016/core/common/ccprovider/ccinfocache.go#L71)<br><strong>Comment</strong>: <pre>I agreed with your suggestion so that everyone would benefit from the cache rather than just this code, especially related to my comment above on CCInfoFSStorageMgrImpl.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/common/ccprovider/ccinfocache.go#L71](https://github.com/hyperledger-gerrit-archive/fabric/blob/2f5fcc057cd349a65c34804d9c51bbf4f31a5016/core/common/ccprovider/ccinfocache.go#L71)<br><strong>Comment</strong>: <pre>I've done as you suggested, with the following caveat: enabling the cache by default would break some tests. Why? Tests are currently not able to mock this CC info provider (because it doesn't exist yet). So what they end up doing  is they actually write to the file system in some temp directory. Furthermore, they "play" with this storage by furtively removing cc packages to simulate some test conditions. This way of testing is wrong and it also violates the immutable nature of chaincode packages in v1. However I sized it and fixing all tests was gonna be too much work. So Murali and I ended up agreeing that we could have a cache that is disabled for testing but enabled by the real peer instance. Does this make sense?</pre><strong>Commenter</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>CommentLine</strong>: [core/common/ccprovider/sigcdspackage.go#L133](https://github.com/hyperledger-gerrit-archive/fabric/blob/2f5fcc057cd349a65c34804d9c51bbf4f31a5016/core/common/ccprovider/sigcdspackage.go#L133)<br><strong>Comment</strong>: <pre>sDepSpec and InstantiationPolicy cannot not be nil for this package type either (All inits go through getCDSData which checks for that.)

Now that we are adding InstantiationPolicy to GetChaincodeData, perhaps the following code to be strict and consistent ? 
	//this has to be after creating a package and initializing it
	//If those steps fail, GetChaincodeData() should never be called
	if ccpack.depSpec == nil || ccpack.datab == nil || ccpack.id == nil ||
 ccpack.sDepSpec  == nil || ccpack.sDepSpec.InstantiationPolicy == nil {
		panic("GetChaincodeData called on uninitialized package")
	}
	return &ChaincodeData{Name: ccpack.depSpec.ChaincodeSpec.ChaincodeId.Name, Version: ccpack.depSpec.ChaincodeSpec.ChaincodeId.Version, Data: ccpack.datab, Id: ccpack.id, InstantiationPolicy: ccpack.sDepSpec.InstantiationPolicy}</pre><strong>Commenter</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>CommentLine</strong>: [core/endorser/endorser.go#L181](https://github.com/hyperledger-gerrit-archive/fabric/blob/2f5fcc057cd349a65c34804d9c51bbf4f31a5016/core/endorser/endorser.go#L181)<br><strong>Comment</strong>: <pre>we are not using version in the if-block below, so we should move it to after the if-block?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/endorser/endorser.go#L181](https://github.com/hyperledger-gerrit-archive/fabric/blob/2f5fcc057cd349a65c34804d9c51bbf4f31a5016/core/endorser/endorser.go#L181)<br><strong>Comment</strong>: <pre>Done, I've actually rearranged the code in a way that makes it more readable</pre><strong>Commenter</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>CommentLine</strong>: [core/endorser/endorser.go#L199](https://github.com/hyperledger-gerrit-archive/fabric/blob/2f5fcc057cd349a65c34804d9c51bbf4f31a5016/core/endorser/endorser.go#L199)<br><strong>Comment</strong>: <pre>why should we do this? the comment above just states the fact in the code rather than explaining why</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/endorser/endorser.go#L199](https://github.com/hyperledger-gerrit-archive/fabric/blob/2f5fcc057cd349a65c34804d9c51bbf4f31a5016/core/endorser/endorser.go#L199)<br><strong>Comment</strong>: <pre>Good point, thx! I've added a more clear comment</pre><strong>Commenter</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>CommentLine</strong>: [core/endorser/endorser.go#L200](https://github.com/hyperledger-gerrit-archive/fabric/blob/2f5fcc057cd349a65c34804d9c51bbf4f31a5016/core/endorser/endorser.go#L200)<br><strong>Comment</strong>: <pre>Installation or instantiation? i think you mean instantiation -- the words sound too similar :-(</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/endorser/endorser.go#L200](https://github.com/hyperledger-gerrit-archive/fabric/blob/2f5fcc057cd349a65c34804d9c51bbf4f31a5016/core/endorser/endorser.go#L200)<br><strong>Comment</strong>: <pre>Done, thx</pre></blockquote><h3>PatchSet Number: 16</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 5/10/2017, 1:55:04 PM<br><strong>GitHubMergedRevision</strong>: [341ac6c8bd5ae8752b2a2d785a613d533f20fba8](https://github.com/hyperledger-gerrit-archive/fabric/commit/341ac6c8bd5ae8752b2a2d785a613d533f20fba8)<br><br><strong>Approver</strong>: Christopher Ferris - chris.ferris@gmail.com<br><strong>Approved</strong>: 5/11/2017, 8:18:05 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Christopher Ferris<br><strong>Merged</strong>: 5/11/2017, 8:18:07 AM<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/10/2017, 3:22:04 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>Approved</strong>: 5/10/2017, 3:15:17 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Approved</strong>: 5/10/2017, 6:58:42 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Elli Androulaki - lli@zurich.ibm.com<br><strong>Approved</strong>: 5/10/2017, 4:44:37 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>CommentLine</strong>: [core/common/ccprovider/ccinfocache.go#L66](https://github.com/hyperledger-gerrit-archive/fabric/blob/341ac6c8bd5ae8752b2a2d785a613d533f20fba8/core/common/ccprovider/ccinfocache.go#L66)<br><strong>Comment</strong>: <pre>There's a chance that this segment allows the following:
- 2 threads arrive on line 48, and one gets in first. The second will get in after the first unlock, so both have "in" = false
- Both continue to load ccpack and set the cache
- No harm done but extra work</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/common/ccprovider/ccinfocache.go#L66](https://github.com/hyperledger-gerrit-archive/fabric/blob/341ac6c8bd5ae8752b2a2d785a613d533f20fba8/core/common/ccprovider/ccinfocache.go#L66)<br><strong>Comment</strong>: <pre>Nicely spotted! I did think about this race but I convinced myself that i) correctness isn't violated and ii) it's very unlikely for the race to really happen in practice because the lscc invocation to deploy/upgrade is the first one to call GetChaincodeFromFS, thus priming the cache before any later proposal. It's very unlikely - if we exclude bugs - that a client will issue two concurrent lscc invocations for the same cc name/version concurrently and so the race should never actually happen. That said, I don't mind changing the logic if you want me to.</pre><strong>Commenter</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>CommentLine</strong>: [core/common/ccprovider/ccinfocache.go#L66](https://github.com/hyperledger-gerrit-archive/fabric/blob/341ac6c8bd5ae8752b2a2d785a613d533f20fba8/core/common/ccprovider/ccinfocache.go#L66)<br><strong>Comment</strong>: <pre>As the cache hit is going to happen for every proposal, we can live with the 1 time collision to reap the benefit of a RLock on the outside.</pre><strong>Commenter</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>CommentLine</strong>: [core/common/ccprovider/ccinfocache.go#L103](https://github.com/hyperledger-gerrit-archive/fabric/blob/341ac6c8bd5ae8752b2a2d785a613d533f20fba8/core/common/ccprovider/ccinfocache.go#L103)<br><strong>Comment</strong>: <pre>same as above</pre><strong>Commenter</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>CommentLine</strong>: [core/endorser/endorser.go#L201](https://github.com/hyperledger-gerrit-archive/fabric/blob/341ac6c8bd5ae8752b2a2d785a613d533f20fba8/core/endorser/endorser.go#L201)<br><strong>Comment</strong>: <pre>thank you for this comment</pre></blockquote>