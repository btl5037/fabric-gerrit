<strong>Project</strong>: fabric<br><strong>Branch</strong>: master<br><strong>ID</strong>: 11729<br><strong>Subject</strong>: (WIP) [FAB-4663] Gossip test with BDD framework<br><strong>Status</strong>: ABANDONED<br><strong>Owner</strong>: Adnan C - adnan.choudhury@itpeoplecorp.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 7/18/2017, 11:58:41 AM<br><strong>LastUpdated</strong>: 8/10/2017, 2:50:24 PM<br><strong>CommitMessage</strong>:<br><pre>(WIP) [FAB-4663] Gossip test with BDD framework

Gossip test to see if gossip-leader can successfully overcome temporary
disconnection.

Change-Id: Ifddd1d37f505b73d357b196d1651aa58cb754697
Signed-off-by: Adnan Choudhury <adnan.choudhury@itpeoplecorp.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Adnan C - adnan.choudhury@itpeoplecorp.com<br><strong>Reviewed</strong>: 7/18/2017, 11:58:41 AM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 7/18/2017, 11:58:50 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/9882/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 7/18/2017, 12:01:25 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/14230/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 7/18/2017, 12:02:09 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/5733/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 7/18/2017, 12:02:49 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/8279/ (4/4)</pre><strong>Reviewer</strong>: Adnan C - adnan.choudhury@itpeoplecorp.com<br><strong>Reviewed</strong>: 7/18/2017, 12:15:04 PM<br><strong>Message</strong>: <pre>Uploaded patch set 2.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 7/18/2017, 12:15:15 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/9885/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 7/18/2017, 12:16:49 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/14233/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 7/18/2017, 12:17:30 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/5736/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 7/18/2017, 12:18:33 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/8282/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 7/18/2017, 1:59:41 PM<br><strong>Message</strong>: <pre>Patch Set 2: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/14233/ : SUCCESS

Logs: https://logs.hyperledger.org/jobbuilder/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/14233

https://jenkins.hyperledger.org/job/fabric-verify-z/9885/ : SUCCESS

Logs: https://logs.hyperledger.org/jobbuilder/vex-yul-hyp-jenkins-1/fabric-verify-z/9885

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/5736/ : SUCCESS

Logs: https://logs.hyperledger.org/jobbuilder/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/5736

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/8282/ : SUCCESS

Logs: https://logs.hyperledger.org/jobbuilder/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/8282</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 7/18/2017, 2:11:28 PM<br><strong>Message</strong>: <pre>Patch Set 1: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/14230/ : SUCCESS

Logs: https://logs.hyperledger.org/jobbuilder/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/14230

https://jenkins.hyperledger.org/job/fabric-verify-z/9882/ : SUCCESS

Logs: https://logs.hyperledger.org/jobbuilder/vex-yul-hyp-jenkins-1/fabric-verify-z/9882

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/5733/ : SUCCESS

Logs: https://logs.hyperledger.org/jobbuilder/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/5733

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/8279/ : SUCCESS

Logs: https://logs.hyperledger.org/jobbuilder/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/8279</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 7/19/2017, 5:17:14 PM<br><strong>Message</strong>: <pre>Patch Set 2: Code-Review-1

(10 comments)</pre><strong>Reviewer</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>Reviewed</strong>: 7/24/2017, 10:59:00 AM<br><strong>Message</strong>: <pre>Patch Set 2: Code-Review-1

(11 comments)</pre><strong>Reviewer</strong>: Adnan C - adnan.choudhury@itpeoplecorp.com<br><strong>Reviewed</strong>: 8/10/2017, 2:50:24 PM<br><strong>Message</strong>: <pre>Abandoned

Will be moved to fabric-test repo.</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Adnan C - adnan.choudhury@itpeoplecorp.com<br><strong>Uploader</strong>: Adnan C - adnan.choudhury@itpeoplecorp.com<br><strong>Created</strong>: 7/18/2017, 11:58:41 AM<br><strong>UnmergedRevision</strong>: [e167630ae64a18eb6b598c4dba3641769e376220](https://github.com/hyperledger-gerrit-archive/fabric/commit/e167630ae64a18eb6b598c4dba3641769e376220)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 7/18/2017, 2:11:28 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Adnan C - adnan.choudhury@itpeoplecorp.com<br><strong>Uploader</strong>: Adnan C - adnan.choudhury@itpeoplecorp.com<br><strong>Created</strong>: 7/18/2017, 12:15:04 PM<br><strong>UnmergedRevision</strong>: [3a960f5bbd407c7ce9d177bfd46461a1f79f06d5](https://github.com/hyperledger-gerrit-archive/fabric/commit/3a960f5bbd407c7ce9d177bfd46461a1f79f06d5)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 7/18/2017, 1:59:41 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Approved</strong>: 7/19/2017, 5:17:14 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>Approved</strong>: 7/24/2017, 10:59:00 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>CommentLine</strong>: [test/feature/gossip.feature#L6](https://github.com/hyperledger-gerrit-archive/fabric/blob/3a960f5bbd407c7ce9d177bfd46461a1f79f06d5/test/feature/gossip.feature#L6)<br><strong>Comment</strong>: <pre>Do we want these to have their own feature file or do we want these in the peer feature file. I'm ok with either, but since this is a feature of peers, so it could go into the same file.</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [test/feature/gossip.feature#L11](https://github.com/hyperledger-gerrit-archive/fabric/blob/3a960f5bbd407c7ce9d177bfd46461a1f79f06d5/test/feature/gossip.feature#L11)<br><strong>Comment</strong>: <pre>This FAB and this outline says non-leader is taken down, but you are bouncing an org leader in line 24 and 26. I suspect the error is here in this line, and instead we should say leader peer (and change the FAB number accordingly).</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [test/feature/gossip.feature#L11](https://github.com/hyperledger-gerrit-archive/fabric/blob/3a960f5bbd407c7ce9d177bfd46461a1f79f06d5/test/feature/gossip.feature#L11)<br><strong>Comment</strong>: <pre>typo "e"</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [test/feature/gossip.feature#L14](https://github.com/hyperledger-gerrit-archive/fabric/blob/3a960f5bbd407c7ce9d177bfd46461a1f79f06d5/test/feature/gossip.feature#L14)<br><strong>Comment</strong>: <pre>Seems like we should say 'named". This way, this command uses same step formatting syntax as the invokes and queries.</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [test/feature/gossip.feature#L14](https://github.com/hyperledger-gerrit-archive/fabric/blob/3a960f5bbd407c7ce9d177bfd46461a1f79f06d5/test/feature/gossip.feature#L14)<br><strong>Comment</strong>: <pre>Seems like we should say 'with args'</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [test/feature/gossip.feature#L23](https://github.com/hyperledger-gerrit-archive/fabric/blob/3a960f5bbd407c7ce9d177bfd46461a1f79f06d5/test/feature/gossip.feature#L23)<br><strong>Comment</strong>: <pre>scenario outline says non-leader is taken down, but you are taking bouncing an org leader here and in line 26. Which is correct?
Also, if restarting an org leader, then we should query on non-leader peer too.</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [test/feature/gossip.feature#L26](https://github.com/hyperledger-gerrit-archive/fabric/blob/3a960f5bbd407c7ce9d177bfd46461a1f79f06d5/test/feature/gossip.feature#L26)<br><strong>Comment</strong>: <pre>the node that was leader a moment ago is no longer a leader.</pre><strong>Commenter</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>CommentLine</strong>: [test/feature/gossip.feature#L26](https://github.com/hyperledger-gerrit-archive/fabric/blob/3a960f5bbd407c7ce9d177bfd46461a1f79f06d5/test/feature/gossip.feature#L26)<br><strong>Comment</strong>: <pre>So I'm assuming that you mean to take down a non-gossip leader (as Scott pointed out), then in this situation, wouldn't you want to query one of the peers that was not taken down to ensure it's value? Then when you bring that peer back, and query after some time you can verify that it has the same value as the other peers when it was down?

I think this is a great test, though to show what happens when you take down a gossip leader!</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [test/feature/gossip.feature#L32](https://github.com/hyperledger-gerrit-archive/fabric/blob/3a960f5bbd407c7ce9d177bfd46461a1f79f06d5/test/feature/gossip.feature#L32)<br><strong>Comment</strong>: <pre>When restarting an org leader, then at the end we should also query a non-leader peer in the same org, in addition to org leader.</pre><strong>Commenter</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>CommentLine</strong>: [test/feature/steps/basic_impl.py#L3](https://github.com/hyperledger-gerrit-archive/fabric/blob/3a960f5bbd407c7ce9d177bfd46461a1f79f06d5/test/feature/steps/basic_impl.py#L3)<br><strong>Comment</strong>: <pre>Are we supposed to be changing the license headers? I was unaware...</pre><strong>Commenter</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>CommentLine</strong>: [test/feature/steps/endorser_impl.py#L51](https://github.com/hyperledger-gerrit-archive/fabric/blob/3a960f5bbd407c7ce9d177bfd46461a1f79f06d5/test/feature/steps/endorser_impl.py#L51)<br><strong>Comment</strong>: <pre>You can just leave this as "step_impl" unless someone else is calling this method and I'm just missing it.</pre><strong>Commenter</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>CommentLine</strong>: [test/feature/steps/endorser_impl.py#L63](https://github.com/hyperledger-gerrit-archive/fabric/blob/3a960f5bbd407c7ce9d177bfd46461a1f79f06d5/test/feature/steps/endorser_impl.py#L63)<br><strong>Comment</strong>: <pre>You can leave this as "step_impl".</pre><strong>Commenter</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>CommentLine</strong>: [test/feature/steps/endorser_impl.py#L149](https://github.com/hyperledger-gerrit-archive/fabric/blob/3a960f5bbd407c7ce9d177bfd46461a1f79f06d5/test/feature/steps/endorser_impl.py#L149)<br><strong>Comment</strong>: <pre>You can leave this as "step_impl".</pre><strong>Commenter</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>CommentLine</strong>: [test/feature/steps/endorser_util.py#L239](https://github.com/hyperledger-gerrit-archive/fabric/blob/3a960f5bbd407c7ce9d177bfd46461a1f79f06d5/test/feature/steps/endorser_util.py#L239)<br><strong>Comment</strong>: <pre>better to say "if not hasattr(context, 'leader'):"</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [test/feature/steps/endorser_util.py#L241](https://github.com/hyperledger-gerrit-archive/fabric/blob/3a960f5bbd407c7ce9d177bfd46461a1f79f06d5/test/feature/steps/endorser_util.py#L241)<br><strong>Comment</strong>: <pre>Remove this line. To be accurate, this function get_leader() must always recompute the current leader(s).
Also: "context.leader" is a moving target. Can we instead use a local variable here, instead of storing it in context? We don't want other code functions to try to use it, since it is only a "list" of the first leader in the specified org; it is not a complete list of all leaders in all orgs, and could be out of date immediately after this function is called.</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [test/feature/steps/endorser_util.py#L244](https://github.com/hyperledger-gerrit-archive/fabric/blob/3a960f5bbd407c7ce9d177bfd46461a1f79f06d5/test/feature/steps/endorser_util.py#L244)<br><strong>Comment</strong>: <pre>A peer may become a leader, and then stop being a leader when another peer is elected leader. That means we need to ensure that it became a leader AND there is no subsequent log that indicates it stopped being a leader (by looking for some kind of log that indicates it is a follower rather than a leader)</pre><strong>Commenter</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>CommentLine</strong>: [test/feature/steps/endorser_util.py#L244](https://github.com/hyperledger-gerrit-archive/fabric/blob/3a960f5bbd407c7ce9d177bfd46461a1f79f06d5/test/feature/steps/endorser_util.py#L244)<br><strong>Comment</strong>: <pre>undefined</pre><strong>Commenter</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>CommentLine</strong>: [test/feature/steps/endorser_util.py#L249](https://github.com/hyperledger-gerrit-archive/fabric/blob/3a960f5bbd407c7ce9d177bfd46461a1f79f06d5/test/feature/steps/endorser_util.py#L249)<br><strong>Comment</strong>: <pre>I think you mean "break" here and not "sys.exit". This will halt all remaining tests from running.</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [test/feature/steps/endorser_util.py#L250](https://github.com/hyperledger-gerrit-archive/fabric/blob/3a960f5bbd407c7ce9d177bfd46461a1f79f06d5/test/feature/steps/endorser_util.py#L250)<br><strong>Comment</strong>: <pre>Since we removed line 241, then this statement will never be hit. do we still need it?</pre><strong>Commenter</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>CommentLine</strong>: [test/feature/steps/endorser_util.py#L250](https://github.com/hyperledger-gerrit-archive/fabric/blob/3a960f5bbd407c7ce9d177bfd46461a1f79f06d5/test/feature/steps/endorser_util.py#L250)<br><strong>Comment</strong>: <pre>We do need to return the leader, but I don't think that we need it to be in the context at this point, as stated earlier.</pre><strong>Commenter</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>CommentLine</strong>: [test/feature/steps/endorser_util.py#L258](https://github.com/hyperledger-gerrit-archive/fabric/blob/3a960f5bbd407c7ce9d177bfd46461a1f79f06d5/test/feature/steps/endorser_util.py#L258)<br><strong>Comment</strong>: <pre>This method would be better in the compose_util.py file since it is a docker specific command.

Also it would be better to return all instances of where the keyText was found in a list. The list can be empty if nothing was found.</pre></blockquote>