<strong>Project</strong>: fabric<br><strong>Branch</strong>: master<br><strong>ID</strong>: 21049<br><strong>Subject</strong>: [FAB-9722] allow collection updates - lscc side<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 4/26/2018, 8:38:52 AM<br><strong>LastUpdated</strong>: 5/6/2018, 3:51:25 PM<br><strong>CommitMessage</strong>:<br><pre>[FAB-9722] allow collection updates - lscc side

This CR makes lscc to process collection config package during
chaincode upgrade.

Change-Id: I439b574d1e655b1803c52b7ba946ef5399ca0009
Signed-off-by: senthil <cendhu@gmail.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 4/26/2018, 8:38:52 AM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/26/2018, 8:42:06 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/834/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/26/2018, 8:42:33 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/26/2018, 8:47:51 AM<br><strong>Message</strong>: <pre>Patch Set 1: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run SmokeTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/26/2018, 8:48:16 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/834/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/834</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/26/2018, 8:51:02 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-smoke-tests-x86_64/549/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/26/2018, 8:51:32 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting smoke tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/26/2018, 8:56:20 AM<br><strong>Message</strong>: <pre>Patch Set 1: F2-SmokeTest+1

Succeeded, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/26/2018, 8:58:30 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/1261/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/26/2018, 8:59:02 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/26/2018, 9:16:58 AM<br><strong>Message</strong>: <pre>Patch Set 1: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/26/2018, 9:17:24 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-smoke-tests-x86_64/549/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-smoke-tests-x86_64/549

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/1261/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/1261</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 4/26/2018, 6:11:39 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(4 comments)</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 4/26/2018, 10:08:22 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(2 comments)</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 4/26/2018, 10:10:55 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(1 comment)</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 4/26/2018, 10:12:11 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Jason, do my comments about capabilities make sense?  Or were you thinking of an alternate approach?</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 4/27/2018, 2:16:20 AM<br><strong>Message</strong>: <pre>Patch Set 2: Patch Set 1 was rebased</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 4/27/2018, 2:29:39 AM<br><strong>Message</strong>: <pre>Patch Set 2:

(3 comments)</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 4/27/2018, 2:42:22 AM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/27/2018, 2:46:24 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/865/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/27/2018, 2:46:45 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/27/2018, 2:51:13 AM<br><strong>Message</strong>: <pre>Patch Set 3: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run SmokeTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/27/2018, 2:51:34 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/865/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/865</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/27/2018, 2:54:17 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-smoke-tests-x86_64/564/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/27/2018, 2:54:43 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Starting smoke tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/27/2018, 2:58:39 AM<br><strong>Message</strong>: <pre>Patch Set 3: F2-SmokeTest+1

Succeeded, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/27/2018, 3:02:05 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/1279/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/27/2018, 3:02:31 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/27/2018, 3:20:48 AM<br><strong>Message</strong>: <pre>Patch Set 3: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/27/2018, 3:21:31 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-smoke-tests-x86_64/564/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-smoke-tests-x86_64/564

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/1279/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/1279</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 4/27/2018, 6:49:14 AM<br><strong>Message</strong>: <pre>Patch Set 3:

(1 comment)</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 4/27/2018, 9:45:02 AM<br><strong>Message</strong>: <pre>Patch Set 3: Code-Review-1

(3 comments)</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 4/27/2018, 10:20:53 AM<br><strong>Message</strong>: <pre>Patch Set 3:

(1 comment)</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 4/27/2018, 10:32:10 AM<br><strong>Message</strong>: <pre>Patch Set 3:

(1 comment)</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 4/27/2018, 2:01:31 PM<br><strong>Message</strong>: <pre>Uploaded patch set 4.</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 4/27/2018, 2:03:37 PM<br><strong>Message</strong>: <pre>Patch Set 4:

UnitTest is added. FAB-9765 to add new capability called CollectionUpgrade.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/27/2018, 2:03:53 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/924/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/27/2018, 2:04:21 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/27/2018, 2:09:18 PM<br><strong>Message</strong>: <pre>Patch Set 4: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run SmokeTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/27/2018, 2:09:40 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/924/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/924</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/27/2018, 2:12:43 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-smoke-tests-x86_64/590/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/27/2018, 2:13:10 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Starting smoke tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/27/2018, 2:17:06 PM<br><strong>Message</strong>: <pre>Patch Set 4: F2-SmokeTest+1

Succeeded, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/27/2018, 2:21:49 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/1311/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/27/2018, 2:22:21 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/27/2018, 2:37:56 PM<br><strong>Message</strong>: <pre>Patch Set 4: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/27/2018, 2:38:22 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-smoke-tests-x86_64/590/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-smoke-tests-x86_64/590

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/1311/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/1311</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 5/2/2018, 2:02:28 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Created FAB-9851 to enable private data capability by default in v1.2</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 5/2/2018, 2:35:01 PM<br><strong>Message</strong>: <pre>Patch Set 4: Code-Review+2</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 5/3/2018, 11:20:06 AM<br><strong>Message</strong>: <pre>Patch Set 4: Code-Review+2</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 5/3/2018, 11:47:07 AM<br><strong>Message</strong>: <pre>Patch Set 5: Patch Set 4 was rebased</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 5/4/2018, 8:33:12 AM<br><strong>Message</strong>: <pre>Patch Set 6: Patch Set 5 was rebased</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 5/4/2018, 8:38:24 AM<br><strong>Message</strong>: <pre>Patch Set 7: Patch Set 6 was rebased</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 5/6/2018, 3:18:22 PM<br><strong>Message</strong>: <pre>Change has been successfully merged by Jason Yellick</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/6/2018, 3:20:51 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-x86_64/3707/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/6/2018, 3:21:03 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/2376/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/6/2018, 3:51:25 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-merge-x86_64/3707/ : FAILURE (skipped)

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-merge-x86_64/3707/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-x86_64/3707

https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/2376/ : FAILURE (skipped)

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/2376/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-end-2-end-x86_64/2376</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Uploader</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Created</strong>: 4/26/2018, 8:38:52 AM<br><strong>UnmergedRevision</strong>: [5692b71a33d830c0d80dbf9c39eb6f1f1f1d85fd](https://github.com/hyperledger-gerrit-archive/fabric/commit/5692b71a33d830c0d80dbf9c39eb6f1f1f1d85fd)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/26/2018, 8:47:51 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/26/2018, 8:47:51 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/26/2018, 8:56:20 AM<br><strong>Type</strong>: F2-SmokeTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/26/2018, 9:16:58 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/scc/lscc/lscc.go#L528](https://github.com/hyperledger-gerrit-archive/fabric/blob/5692b71a33d830c0d80dbf9c39eb6f1f1f1d85fd/core/scc/lscc/lscc.go#L528)<br><strong>Comment</strong>: <pre>I think that this change is unnecessary. This check is already being made in the 'Invoke' function (see line 691) and is redundant here.</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/scc/lscc/lscc.go#L528](https://github.com/hyperledger-gerrit-archive/fabric/blob/5692b71a33d830c0d80dbf9c39eb6f1f1f1d85fd/core/scc/lscc/lscc.go#L528)<br><strong>Comment</strong>: <pre>I think this check is needed. The one in line 691 checks for the argument length. Here, we add another entry to write set only if the privatechanneldata capability is enabled. Otherwise, we would put a nil and hence need to change VSCC validation logic a bit. Correct me if I am wrong.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/scc/lscc/lscc.go#L611](https://github.com/hyperledger-gerrit-archive/fabric/blob/5692b71a33d830c0d80dbf9c39eb6f1f1f1d85fd/core/scc/lscc/lscc.go#L611)<br><strong>Comment</strong>: <pre>I would to get other's view here. What is preferred here, simply use V1_2 capability for the regular features (such as private data collection update) or introduce new capability tags for each such feature separately. The existing tags in 1.1 (such as PrivateChannelData) made sense because it was an exprimental feature even with in 1.1</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/scc/lscc/lscc.go#L611](https://github.com/hyperledger-gerrit-archive/fabric/blob/5692b71a33d830c0d80dbf9c39eb6f1f1f1d85fd/core/scc/lscc/lscc.go#L611)<br><strong>Comment</strong>: <pre>The intent is to use a common capability "V1_2" for all v1.2 features, rather than separate tags. But in the code we can still have CollectionUpdate(), which in application.go would

 return ap.v12

This would be used for things that are different in v1.1 and v1.2 due to the new collection update support.

And I think PrivateChannelData() in v1.2 would

 return ap.v11PvtDataExperimental || ap.v12

This would be used for things that are handled the same in v1.1 (experimental) and v1.2.</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/scc/lscc/lscc.go#L611](https://github.com/hyperledger-gerrit-archive/fabric/blob/5692b71a33d830c0d80dbf9c39eb6f1f1f1d85fd/core/scc/lscc/lscc.go#L611)<br><strong>Comment</strong>: <pre>Yes, I have exactly implemented this logic ( return ap.v12) for CollectionUpdate(). Rather than disturbing all CRs, I decided to push a separate CR once these are merged.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/scc/lscc/lscc.go#L612](https://github.com/hyperledger-gerrit-archive/fabric/blob/5692b71a33d830c0d80dbf9c39eb6f1f1f1d85fd/core/scc/lscc/lscc.go#L612)<br><strong>Comment</strong>: <pre>Is this check correct? As we are promoting pvt data as a regular feature in 1.2, there should not be a requirement to turn on 'PrivateChannelData()' in 1.2.</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/scc/lscc/lscc.go#L612](https://github.com/hyperledger-gerrit-archive/fabric/blob/5692b71a33d830c0d80dbf9c39eb6f1f1f1d85fd/core/scc/lscc/lscc.go#L612)<br><strong>Comment</strong>: <pre>Right, this one would simply be based on CollectionUpdate(), if we follow my comment above.</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/scc/lscc/lscc.go#L612](https://github.com/hyperledger-gerrit-archive/fabric/blob/5692b71a33d830c0d80dbf9c39eb6f1f1f1d85fd/core/scc/lscc/lscc.go#L612)<br><strong>Comment</strong>: <pre>Can this be done in a separate CR?</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/scc/lscc/lscc.go#L612](https://github.com/hyperledger-gerrit-archive/fabric/blob/5692b71a33d830c0d80dbf9c39eb6f1f1f1d85fd/core/scc/lscc/lscc.go#L612)<br><strong>Comment</strong>: <pre>Fine by me to do in a separate CR.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/scc/lscc/lscc.go#L612](https://github.com/hyperledger-gerrit-archive/fabric/blob/5692b71a33d830c0d80dbf9c39eb6f1f1f1d85fd/core/scc/lscc/lscc.go#L612)<br><strong>Comment</strong>: <pre>I'd much rather see this fixed before merging this CR, but if we want to defer, can we at least get a bug opened in JIRA for v1.2 so that it is not lost?</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/scc/lscc/lscc.go#L612](https://github.com/hyperledger-gerrit-archive/fabric/blob/5692b71a33d830c0d80dbf9c39eb6f1f1f1d85fd/core/scc/lscc/lscc.go#L612)<br><strong>Comment</strong>: <pre>Sorry, I do not understand how it is a bug. This condition checks the following:
(i) Is v11PvtDataExperimental enabled? If not, even if the collection config package is passed or not, just ignore and do not create a entry in lscc-wset. 
(ii) Given that v11PvtDataExperimental is enabled, is v12 enabled? If not enabled, then collection upgrades are not allowed. This is required during the rolling upgrade. 

Correct me if I am wrong.</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/scc/lscc/lscc.go#L612](https://github.com/hyperledger-gerrit-archive/fabric/blob/5692b71a33d830c0d80dbf9c39eb6f1f1f1d85fd/core/scc/lscc/lscc.go#L612)<br><strong>Comment</strong>: <pre>I agree that having ac.Capabilities().PrivateChannelData() is not required. If v12 is enabled, then allow upgrades. Otherwise just ignore. I will remove ac.Capabilities().PrivateChannelData() from this condition. If needed, In a separate CR, I would replace V1_2Validation() with CollectionUpdate() which would return v12.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/scc/lscc/lscc.go#L691](https://github.com/hyperledger-gerrit-archive/fabric/blob/5692b71a33d830c0d80dbf9c39eb6f1f1f1d85fd/core/scc/lscc/lscc.go#L691)<br><strong>Comment</strong>: <pre>Should this condition be 
"ac.Capabilities().V1_2Validation() || ac.Capabilities().PrivateChannelData()". So that we can abandon the capability 'PrivateChannelData' altogether from 1.3 code?</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/scc/lscc/lscc.go#L691](https://github.com/hyperledger-gerrit-archive/fabric/blob/5692b71a33d830c0d80dbf9c39eb6f1f1f1d85fd/core/scc/lscc/lscc.go#L691)<br><strong>Comment</strong>: <pre>If we follow my comment above, this one would remain as PrivateChannelData(), which would return true if either "V1_1_PVTDATA_EXPERIMENTAL" or "V1_2" is set on the channel.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/scc/lscc/lscc.go#L691](https://github.com/hyperledger-gerrit-archive/fabric/blob/5692b71a33d830c0d80dbf9c39eb6f1f1f1d85fd/core/scc/lscc/lscc.go#L691)<br><strong>Comment</strong>: <pre>Sorry I am a little late to the party here, but yes, the idea behind the collections framework within the peer is that there is the channel config side, which has strings like "V1_1_PRVTDATA_EXPERIMENTAL" and the interface side, where the peer checks how to behave.

By not coupling these, we can easily say for instance, that if either "V1_2" or "V1_1_PRVTDATA_EXPERIMENTAL" is set, the interface side returns true.  Then, the code can ignore the specific conditions in the config and simply decide its behavior based on the interface.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/scc/lscc/lscc_test.go#L622](https://github.com/hyperledger-gerrit-archive/fabric/blob/5692b71a33d830c0d80dbf9c39eb6f1f1f1d85fd/core/scc/lscc/lscc_test.go#L622)<br><strong>Comment</strong>: <pre>I realize the current state of SCC makes testing a bit difficult, but shouldn't we have some new test around this function?</pre></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Uploader</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Created</strong>: 4/27/2018, 2:16:20 AM<br><strong>UnmergedRevision</strong>: [b3d8fec8c0b78f45bb9f0786c639b330e5eed553](https://github.com/hyperledger-gerrit-archive/fabric/commit/b3d8fec8c0b78f45bb9f0786c639b330e5eed553)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/26/2018, 8:47:51 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/26/2018, 8:47:51 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/26/2018, 8:56:20 AM<br><strong>Type</strong>: F2-SmokeTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/26/2018, 9:16:58 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Uploader</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Created</strong>: 4/27/2018, 2:42:22 AM<br><strong>UnmergedRevision</strong>: [ebd30e92f28b293618fc249b59ed632f0387903e](https://github.com/hyperledger-gerrit-archive/fabric/commit/ebd30e92f28b293618fc249b59ed632f0387903e)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/27/2018, 2:51:13 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/27/2018, 2:51:13 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/27/2018, 2:58:39 AM<br><strong>Type</strong>: F2-SmokeTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/27/2018, 3:20:48 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Approved</strong>: 4/27/2018, 9:45:02 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Uploader</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Created</strong>: 4/27/2018, 2:01:31 PM<br><strong>UnmergedRevision</strong>: [c9592ae27eb23b33a73d4ad92b820a67020de3c7](https://github.com/hyperledger-gerrit-archive/fabric/commit/c9592ae27eb23b33a73d4ad92b820a67020de3c7)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/27/2018, 2:09:18 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/27/2018, 2:09:18 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/27/2018, 2:17:06 PM<br><strong>Type</strong>: F2-SmokeTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/27/2018, 2:37:56 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Approved</strong>: 5/2/2018, 2:35:01 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Approved</strong>: 5/3/2018, 11:20:06 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 5</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Uploader</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Created</strong>: 5/3/2018, 11:47:07 AM<br><strong>UnmergedRevision</strong>: [70fee2b0dfe976c46492996ebb0b856547a3fe31](https://github.com/hyperledger-gerrit-archive/fabric/commit/70fee2b0dfe976c46492996ebb0b856547a3fe31)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/27/2018, 2:09:18 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/27/2018, 2:09:18 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/27/2018, 2:17:06 PM<br><strong>Type</strong>: F2-SmokeTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/27/2018, 2:37:56 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Approved</strong>: 5/2/2018, 2:35:01 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Approved</strong>: 5/3/2018, 11:20:06 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 6</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Uploader</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Created</strong>: 5/4/2018, 8:33:12 AM<br><strong>UnmergedRevision</strong>: [a201f8db91ca141bd7edc6d55eb8b6a960afe414](https://github.com/hyperledger-gerrit-archive/fabric/commit/a201f8db91ca141bd7edc6d55eb8b6a960afe414)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/27/2018, 2:09:18 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/27/2018, 2:09:18 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/27/2018, 2:17:06 PM<br><strong>Type</strong>: F2-SmokeTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/27/2018, 2:37:56 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Approved</strong>: 5/2/2018, 2:35:01 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Approved</strong>: 5/3/2018, 11:20:06 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 7</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Uploader</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Created</strong>: 5/4/2018, 8:38:24 AM<br><strong>GitHubMergedRevision</strong>: [e26c37ccc26ceb570e9f31b496bbf79f0d865c8e](https://github.com/hyperledger-gerrit-archive/fabric/commit/e26c37ccc26ceb570e9f31b496bbf79f0d865c8e)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/27/2018, 2:09:18 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/27/2018, 2:09:18 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/27/2018, 2:17:06 PM<br><strong>Type</strong>: F2-SmokeTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/27/2018, 2:37:56 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Approved</strong>: 5/2/2018, 2:35:01 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Jason Yellick<br><strong>Merged</strong>: 5/6/2018, 3:18:22 PM<br><br><strong>Approver</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Approved</strong>: 5/3/2018, 11:20:06 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br></blockquote>