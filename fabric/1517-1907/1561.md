<strong>Project</strong>: fabric<br><strong>Branch</strong>: feature/convergence<br><strong>ID</strong>: 1561<br><strong>Subject</strong>: Next Fabric Protobuf Messages<br><strong>Status</strong>: ABANDONED<br><strong>Owner</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 10/6/2016, 11:23:43 AM<br><strong>LastUpdated</strong>: 10/25/2016, 7:51:23 AM<br><strong>CommitMessage</strong>:<br><pre>Next Fabric Protobuf Messages

This change-set contains the protobuf messages for the
next fabric architecture as decribed here:
https://hyperledgerproject.slack.com/files/adc/F2JKXGXEU/protobufmessagesandflow.pdf
and incoporates the feedback received from the community.

Change-Id: Ib5a70f36764f001fa82a9fb98f6461799f1ab716
Signed-off-by: Angelo De Caro <adc@zurich.ibm.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>Reviewed</strong>: 10/6/2016, 11:23:43 AM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/6/2016, 11:28:06 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/546/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/6/2016, 12:45:38 PM<br><strong>Message</strong>: <pre>Patch Set 1: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/546/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/1643/ : SUCCESS</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 10/10/2016, 12:23:36 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(4 comments)</pre><strong>Reviewer</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>Reviewed</strong>: 10/10/2016, 12:34:34 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(5 comments)</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 10/10/2016, 12:38:22 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(1 comment)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 10/12/2016, 4:47:59 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(8 comments)</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 10/12/2016, 10:48:39 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(2 comments)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 10/12/2016, 12:11:50 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(2 comments)</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 10/12/2016, 1:22:22 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(2 comments)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 10/13/2016, 5:18:32 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(2 comments)</pre><strong>Reviewer</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>Reviewed</strong>: 10/17/2016, 11:06:19 AM<br><strong>Message</strong>: <pre>Uploaded patch set 2.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/17/2016, 11:08:12 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/740/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/17/2016, 11:10:41 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/1843/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/17/2016, 12:22:35 PM<br><strong>Message</strong>: <pre>Patch Set 2: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/740/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/1843/ : SUCCESS</pre><strong>Reviewer</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>Reviewed</strong>: 10/17/2016, 12:44:23 PM<br><strong>Message</strong>: <pre>Patch Set 2:

(1 comment)</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 10/17/2016, 1:07:34 PM<br><strong>Message</strong>: <pre>Patch Set 2:

(1 comment)</pre><strong>Reviewer</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>Reviewed</strong>: 10/17/2016, 4:28:45 PM<br><strong>Message</strong>: <pre>Patch Set 2:

(1 comment)</pre><strong>Reviewer</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>Reviewed</strong>: 10/18/2016, 2:09:55 AM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/18/2016, 2:10:57 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/747/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/18/2016, 2:12:49 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/1850/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/18/2016, 2:59:47 AM<br><strong>Message</strong>: <pre>Patch Set 3: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/747/ : UNSTABLE (skipped)

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/1850/ : SUCCESS</pre><strong>Reviewer</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>Reviewed</strong>: 10/18/2016, 3:02:16 AM<br><strong>Message</strong>: <pre>Uploaded patch set 4.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/18/2016, 3:03:21 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/748/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/18/2016, 3:04:35 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/1851/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/18/2016, 3:27:24 AM<br><strong>Message</strong>: <pre>Patch Set 4: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/748/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/1851/ : FAILURE</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 10/18/2016, 9:28:18 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Although I'd prefer an even simpler transaction format, I'd like to chime in in support of Murali's comment, that if you remove the references to 'Proposal' from the Transaction, things appear to become much more generic.

Then you would have a SignedTransaction, which contains an array of Actions, which each have a Header, and a Payload.

As it stands, I also find it confusing that the "ProposalActions" payload has no corresponding defined non-chaincode contents.</pre><strong>Reviewer</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>Reviewed</strong>: 10/25/2016, 7:51:23 AM<br><strong>Message</strong>: <pre>Abandoned

This change-set has been moved to the master. This is the link to the new change-set: https://gerrit.hyperledger.org/r/#/c/1977/</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>Uploader</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>Created</strong>: 10/6/2016, 11:23:43 AM<br><strong>UnmergedRevision</strong>: [4012bc35f33df5324336884368fbd337cd6951bc](https://github.com/hyperledger-gerrit-archive/fabric/commit/4012bc35f33df5324336884368fbd337cd6951bc)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 10/6/2016, 12:45:38 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>CommentLine</strong>: [protos/next/fabric_proposal.proto#L38](https://github.com/hyperledger-gerrit-archive/fabric/blob/4012bc35f33df5324336884368fbd337cd6951bc/protos/next/fabric_proposal.proto#L38)<br><strong>Comment</strong>: <pre>If this is the signature of the proposal, we need to take it outside of the `Proposal` object so that verification doesn't have to unmarshal the object, which could also run into non-deterministic issue with protobuf</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [protos/next/fabric_proposal.proto#L38](https://github.com/hyperledger-gerrit-archive/fabric/blob/4012bc35f33df5324336884368fbd337cd6951bc/protos/next/fabric_proposal.proto#L38)<br><strong>Comment</strong>: <pre>The signature is on the header and the payload fields. Unmarshalling is required because the creator needs to be identified before the validation of the signature. The creator is a field of the header.</pre><strong>Commenter</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>CommentLine</strong>: [protos/next/fabric_proposal.proto#L52](https://github.com/hyperledger-gerrit-archive/fabric/blob/4012bc35f33df5324336884368fbd337cd6951bc/protos/next/fabric_proposal.proto#L52)<br><strong>Comment</strong>: <pre>I think we should use the version from the `Message`, which is the overall protocol version that the code should look to process compatibility.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [protos/next/fabric_proposal.proto#L52](https://github.com/hyperledger-gerrit-archive/fabric/blob/4012bc35f33df5324336884368fbd337cd6951bc/protos/next/fabric_proposal.proto#L52)<br><strong>Comment</strong>: <pre>I think that's a good suggestion. The thing is, this integer is signed, the one in the Message struct isn't.</pre><strong>Commenter</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>CommentLine</strong>: [protos/next/fabric_proposal.proto#L56](https://github.com/hyperledger-gerrit-archive/fabric/blob/4012bc35f33df5324336884368fbd337cd6951bc/protos/next/fabric_proposal.proto#L56)<br><strong>Comment</strong>: <pre>undefined</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [protos/next/fabric_proposal.proto#L56](https://github.com/hyperledger-gerrit-archive/fabric/blob/4012bc35f33df5324336884368fbd337cd6951bc/protos/next/fabric_proposal.proto#L56)<br><strong>Comment</strong>: <pre>Same as above</pre><strong>Commenter</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>CommentLine</strong>: [protos/next/fabric_proposal.proto#L62](https://github.com/hyperledger-gerrit-archive/fabric/blob/4012bc35f33df5324336884368fbd337cd6951bc/protos/next/fabric_proposal.proto#L62)<br><strong>Comment</strong>: <pre>I would add more comment on what a `creator` could be</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [protos/next/fabric_proposal.proto#L62](https://github.com/hyperledger-gerrit-archive/fabric/blob/4012bc35f33df5324336884368fbd337cd6951bc/protos/next/fabric_proposal.proto#L62)<br><strong>Comment</strong>: <pre>Good point. Creator is meant to be a generic way of identifying the entity that created the proposal. It is meant to be used in conjunction with the signature field in the proposal to determine the authenticity of the proposal. If we use normal digital signatures, then the public key or certificate of the signer is the creator.</pre><strong>Commenter</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>CommentLine</strong>: [protos/next/fabric_proposal.proto#L64](https://github.com/hyperledger-gerrit-archive/fabric/blob/4012bc35f33df5324336884368fbd337cd6951bc/protos/next/fabric_proposal.proto#L64)<br><strong>Comment</strong>: <pre>What is the unit of timeout and how being used?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [protos/next/fabric_proposal.proto#L64](https://github.com/hyperledger-gerrit-archive/fabric/blob/4012bc35f33df5324336884368fbd337cd6951bc/protos/next/fabric_proposal.proto#L64)<br><strong>Comment</strong>: <pre>This is not clear to me either - I believe we have just taken this field from an earlier proposal and included it here</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [protos/next/fabric_proposal_response.proto#L24](https://github.com/hyperledger-gerrit-archive/fabric/blob/4012bc35f33df5324336884368fbd337cd6951bc/protos/next/fabric_proposal_response.proto#L24)<br><strong>Comment</strong>: <pre>This definition seems very geared towards the idea that the proposal is somehow executed producing some result, and that the result of execution is eventually agreed upon.  I agree for generic chaincode this is definitely important, but, imagine for instance that two parties want to push a piece of non-repudiation information (like a hash) with no context to the chain.  This necessarily does not include any execution or results, only endorsement.  This structure seems much more complicated than needed for such a transaction.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [protos/next/fabric_proposal_response.proto#L24](https://github.com/hyperledger-gerrit-archive/fabric/blob/4012bc35f33df5324336884368fbd337cd6951bc/protos/next/fabric_proposal_response.proto#L24)<br><strong>Comment</strong>: <pre>ProposalResponse defines a message that is exchanged between an endorser and a client in the context of a chaincode execution. I don't think you would even need it in your example (provided I understand it - pls correct me): in your example you wouldn't need any endorsing and therefore you wouldn't use the "normal" flow. The only thing that matters in your case is that the message that makes its way into the ledger (that is, the Transaction) has all the fields you need.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [protos/next/fabric_proposal_response.proto#L24](https://github.com/hyperledger-gerrit-archive/fabric/blob/4012bc35f33df5324336884368fbd337cd6951bc/protos/next/fabric_proposal_response.proto#L24)<br><strong>Comment</strong>: <pre>Whether you call it endorsement or not is up in the air to me, but presumably the proposal should be signed by the other parties (sort of like endorsement) to show their approval of the proposal.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [protos/next/fabric_proposal_response.proto#L24](https://github.com/hyperledger-gerrit-archive/fabric/blob/4012bc35f33df5324336884368fbd337cd6951bc/protos/next/fabric_proposal_response.proto#L24)<br><strong>Comment</strong>: <pre>Thanks, I think I understand your point a little better now. Let me try this: would you agree that in your example, the "execution" phase might simply be a logical NOP that provides no action and no state change in the standard sense? Granted, it might be an overkill given the simplicity of this particular case.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [protos/next/fabric_proposal_response.proto#L24](https://github.com/hyperledger-gerrit-archive/fabric/blob/4012bc35f33df5324336884368fbd337cd6951bc/protos/next/fabric_proposal_response.proto#L24)<br><strong>Comment</strong>: <pre>I certainly don't disagree that you _could_ support the simple case I describe with the current structure, but yes, it is the simplicity that I am missing.

Although I've brought it up before in other contexts, I always like to think that some other 3rd party wishes to produce or consume these simple transactions without any dependency on the fabric code (protos are okay).  Requiring certain fields which are actually no-ops and other such things makes this scenario much more difficult.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [protos/next/fabric_proposal_response.proto#L24](https://github.com/hyperledger-gerrit-archive/fabric/blob/4012bc35f33df5324336884368fbd337cd6951bc/protos/next/fabric_proposal_response.proto#L24)<br><strong>Comment</strong>: <pre>I think this is one of those points that can be argued both ways: yes, it's good to have simple solutions to simple problems to ease adoption; but also, yes, it's great to have a general purpose system where you can do this that and the other.

At any rate: don't you think that the fact that we have types all over the place gives us a way to create a different set of messages if customers request more simplicity for some use cases?</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [protos/next/fabric_proposal_response.proto#L69](https://github.com/hyperledger-gerrit-archive/fabric/blob/4012bc35f33df5324336884368fbd337cd6951bc/protos/next/fabric_proposal_response.proto#L69)<br><strong>Comment</strong>: <pre>undefined</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [protos/next/fabric_proposal_response.proto#L69](https://github.com/hyperledger-gerrit-archive/fabric/blob/4012bc35f33df5324336884368fbd337cd6951bc/protos/next/fabric_proposal_response.proto#L69)<br><strong>Comment</strong>: <pre>undefined</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [protos/next/fabric_transaction.proto#L38](https://github.com/hyperledger-gerrit-archive/fabric/blob/4012bc35f33df5324336884368fbd337cd6951bc/protos/next/fabric_transaction.proto#L38)<br><strong>Comment</strong>: <pre>I would propose that this be made into a plain byte slice and that a type is added.  In this way, a transaction could be typed as a "ProposalResponse" transaction (or "ChaincodeProposalResponse" transaction) for the standard fabric cases, but that we could introduce other structures, such as a "Configuration" transaction, or an "OpaqueAgreement" transaction, etc.</pre><strong>Commenter</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>CommentLine</strong>: [protos/next/fabric_transaction.proto#L38](https://github.com/hyperledger-gerrit-archive/fabric/blob/4012bc35f33df5324336884368fbd337cd6951bc/protos/next/fabric_transaction.proto#L38)<br><strong>Comment</strong>: <pre>The suggestion to provide a level of indirection to payload via a Type specified makes sense to me.  If I understood it right, it is not just for future-proofing but might have immediate application where the fabric components such as orderer might need to construct transactions directly without a Proposal/proposalResponse flow.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [protos/next/fabric_transaction.proto#L41](https://github.com/hyperledger-gerrit-archive/fabric/blob/4012bc35f33df5324336884368fbd337cd6951bc/protos/next/fabric_transaction.proto#L41)<br><strong>Comment</strong>: <pre>It is not obvious who's identity to validate this signature against.  My understanding is that once unwrapping the proposalActions, and then the proposalHeaders, that all of the IDs in the proposalHeaders should match, and this should be the signing identity for this signature.  This is a little overly complicated to me, and because it requires nested unmarshaling seems like it might slow down the ordering service if it must validate this signature.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [protos/next/fabric_transaction.proto#L41](https://github.com/hyperledger-gerrit-archive/fabric/blob/4012bc35f33df5324336884368fbd337cd6951bc/protos/next/fabric_transaction.proto#L41)<br><strong>Comment</strong>: <pre>This is a great point that we should discuss. Let me tell you why it's here in this draft:

First, the signature should also cover the identity of the signer; I understand that for implementation reasons, it's best to have a structure of the kind

message foo {
    bytes signedPayload;
    bytes signatureOnThePayload;
}

if we want to sign the creator, it follows that the creator should somehow be inside the signedPayload.

Second, and more importantly, the signer of a transaction should be the same entity that triggered (and signed) the proposal. This has to do with a number of security requirements such as accountability. The link between the two entities is guaranteed by the set of security checks described on slide 23 of ProtobufMessagesAndFlow.pdf (shared on slack by Angelo last week).</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [protos/next/fabric_transaction.proto#L41](https://github.com/hyperledger-gerrit-archive/fabric/blob/4012bc35f33df5324336884368fbd337cd6951bc/protos/next/fabric_transaction.proto#L41)<br><strong>Comment</strong>: <pre>Okay, so I think the piece I was missing is that the signature should be over a thing which contains the identity of the signer.  It makes sense then that the identity would not be at the top level.

Still, I'm a little wary of too much unmarshaling, or structures that are too complicated and difficult to understand.  Naturally, I would think that we would have a structure like:

message signableBytes {
    bytes payload
    bytes signerIdentity
}

where the signedPayload is always of type signableBytes.

Another question, as the proto exists today, where there is a repeated section of bytes, what is the signature over? The concatenation of the repeated sections of bytes? If so, this also seems to add unwanted complexity.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [protos/next/fabric_transaction.proto#L41](https://github.com/hyperledger-gerrit-archive/fabric/blob/4012bc35f33df5324336884368fbd337cd6951bc/protos/next/fabric_transaction.proto#L41)<br><strong>Comment</strong>: <pre>I think we toyed with the idea of having something like what you suggest but we concluded that we might then have to repeat fields or complicate some other parts of the security validation. As an example, if we remove the creator from the proposal header, the chain of trust on slide 23 wouldn't work.

To your second Q: I'm not 100% sure about this particular detail. What's certain is that the entire array needs to be signed - whether the signature is over the marshalled array or the concatenation of its elements.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [protos/next/fabric_transaction.proto#L41](https://github.com/hyperledger-gerrit-archive/fabric/blob/4012bc35f33df5324336884368fbd337cd6951bc/protos/next/fabric_transaction.proto#L41)<br><strong>Comment</strong>: <pre>It is certainly a trade off, but I would lean towards simplicity with redundancy, over complexity with efficiency.  You could add the signer to the top level and not remove it from the header, in this way, it is easy to do a simple 'well formed validity check' without interrogating the full structure, but you don't lose the chain of trust.

So I would say we cannot rely on re-marshaling a repeated section to provide the bytes to sign over, as marshaling is not deterministic.  However, this points to a bigger question to me, why is this field repeated to begin with?  Is a transaction all or nothing then? What if some proposals are invalid and others are valid?  I can understand the value in a scheme like this, but once again, it is not obvious how this should work to me.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [protos/next/fabric_transaction.proto#L41](https://github.com/hyperledger-gerrit-archive/fabric/blob/4012bc35f33df5324336884368fbd337cd6951bc/protos/next/fabric_transaction.proto#L41)<br><strong>Comment</strong>: <pre>On your first point: designing protocol messages where security-relevant fields are repeated is often an antipattern - we're basically adding complexity to the validation. Why? Because if there's two creator fields (one at the top and one in the header), a developer might forget to check that the two must be equal, or they might do it now and then forget in the future when the code gets changed. If the two creators are different, attacks might be possible. On the other hand, if there is a single creator, you are basically guaranteeing by design that the correct check will be made with no possibility of error.

On your second point: yes, I believe the requirement is to have all-or-nothing semantics.</pre></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>Uploader</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>Created</strong>: 10/17/2016, 11:06:19 AM<br><strong>UnmergedRevision</strong>: [230849d3e73a09bca0a57123cf99ddbe12e9ca70](https://github.com/hyperledger-gerrit-archive/fabric/commit/230849d3e73a09bca0a57123cf99ddbe12e9ca70)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 10/17/2016, 12:22:35 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>CommentLine</strong>: [protos/next/fabric_proposal.proto#L82](https://github.com/hyperledger-gerrit-archive/fabric/blob/230849d3e73a09bca0a57123cf99ddbe12e9ca70/protos/next/fabric_proposal.proto#L82)<br><strong>Comment</strong>: <pre>please remove</pre><strong>Commenter</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>CommentLine</strong>: [protos/next/fabric_proposal_response.proto#L68](https://github.com/hyperledger-gerrit-archive/fabric/blob/230849d3e73a09bca0a57123cf99ddbe12e9ca70/protos/next/fabric_proposal_response.proto#L68)<br><strong>Comment</strong>: <pre>I missed this comment. Could you please remove.</pre><strong>Commenter</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>CommentLine</strong>: [protos/next/fabric_transaction.proto#L16](https://github.com/hyperledger-gerrit-archive/fabric/blob/230849d3e73a09bca0a57123cf99ddbe12e9ca70/protos/next/fabric_transaction.proto#L16)<br><strong>Comment</strong>: <pre>This pertains to point raised by Jason that Transaction should not be Proposal-centric and should be generalized to have a Type so we can have transactions outside of the Proposal flow.

The other way to do that would be to use the current structure where the Type comes from the header. If we are to do that, we need to remove "Proposal" from relevant types (ProposalHeader, ProposalActions) and move  ProposalHeader from fabric_proposal.proto to the right file.</pre></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>Uploader</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>Created</strong>: 10/18/2016, 2:09:55 AM<br><strong>UnmergedRevision</strong>: [d1102a40103929b717fc9bc90e7dca6eb230fcaa](https://github.com/hyperledger-gerrit-archive/fabric/commit/d1102a40103929b717fc9bc90e7dca6eb230fcaa)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 10/18/2016, 2:59:47 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>Uploader</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>Created</strong>: 10/18/2016, 3:02:16 AM<br><strong>UnmergedRevision</strong>: [1e3b63b3ceb460229e13e0f5d68f7063e2c309bd](https://github.com/hyperledger-gerrit-archive/fabric/commit/1e3b63b3ceb460229e13e0f5d68f7063e2c309bd)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 10/18/2016, 3:27:24 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote>