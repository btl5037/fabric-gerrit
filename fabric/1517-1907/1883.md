<strong>Project</strong>: fabric<br><strong>Branch</strong>: feature/ca<br><strong>ID</strong>: 1883<br><strong>Subject</strong>: Database API Implementation<br><strong>Status</strong>: ABANDONED<br><strong>Owner</strong>: Saad Karim - skarim@us.ibm.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 10/19/2016, 11:00:34 PM<br><strong>LastUpdated</strong>: 11/10/2016, 6:32:34 AM<br><strong>CommitMessage</strong>:<br><pre>Database API Implementation

Change-Id: Ief86677f176e9a600e3b70861c141e2bdf142293
Signed-off-by: Saad Karim <skarim@us.ibm.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Saad Karim - skarim@us.ibm.com<br><strong>Reviewed</strong>: 10/19/2016, 11:00:34 PM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/19/2016, 11:01:24 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/790/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/19/2016, 11:03:06 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/1893/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/19/2016, 11:05:05 PM<br><strong>Message</strong>: <pre>Patch Set 1: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/790/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/1893/ : FAILURE</pre><strong>Reviewer</strong>: Saad Karim - skarim@us.ibm.com<br><strong>Reviewed</strong>: 10/20/2016, 10:58:33 AM<br><strong>Message</strong>: <pre>Uploaded patch set 2.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/20/2016, 11:01:12 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/794/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/20/2016, 11:03:51 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/1897/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/20/2016, 11:06:10 AM<br><strong>Message</strong>: <pre>Patch Set 2: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/794/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/1897/ : FAILURE</pre><strong>Reviewer</strong>: Saad Karim - skarim@us.ibm.com<br><strong>Reviewed</strong>: 10/21/2016, 10:39:18 AM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/21/2016, 10:40:54 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/821/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/21/2016, 10:42:47 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/1924/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/21/2016, 10:45:05 AM<br><strong>Message</strong>: <pre>Patch Set 3: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/821/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/1924/ : FAILURE</pre><strong>Reviewer</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>Reviewed</strong>: 10/21/2016, 2:24:47 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Thanks. Shall we update the commit message with an underlying JIRA item/FAB (with a reference to the API/docs) ?</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 10/23/2016, 6:20:19 AM<br><strong>Message</strong>: <pre>Patch Set 3:

reverify</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/23/2016, 6:22:16 AM<br><strong>Message</strong>: <pre>Patch Set 3: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/840/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/23/2016, 6:24:05 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/1943/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/23/2016, 6:25:57 AM<br><strong>Message</strong>: <pre>Patch Set 3: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/840/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/1943/ : FAILURE</pre><strong>Reviewer</strong>: Keith Smith - keithsmithlfid@gmail.com<br><strong>Reviewed</strong>: 10/26/2016, 12:05:44 PM<br><strong>Message</strong>: <pre>Patch Set 3: Code-Review+1</pre><strong>Reviewer</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>Reviewed</strong>: 10/26/2016, 1:21:23 PM<br><strong>Message</strong>: <pre>Patch Set 3: Code-Review-1

JIRA item please.</pre><strong>Reviewer</strong>: Saad Karim - skarim@us.ibm.com<br><strong>Reviewed</strong>: 10/26/2016, 2:34:34 PM<br><strong>Message</strong>: <pre>Patch Set 3:

https://jira.hyperledger.org/browse/FAB-455</pre><strong>Reviewer</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>Reviewed</strong>: 10/27/2016, 5:52:05 PM<br><strong>Message</strong>: <pre>Patch Set 3:

(9 comments)

Hello Saad,

Please let's add the JIRA item as a full URL as part of the commit message (to make it easier for reviewers and others).

A few suggestions inline. The most important of which is that some of these (such as the "production" directories, etc...) should be actually written, reviewed and agreed upon early on (using JIRA/design-docs).

Thank you, Jonathan</pre><strong>Reviewer</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>Reviewed</strong>: 10/27/2016, 5:54:04 PM<br><strong>Message</strong>: <pre>Patch Set 3: Code-Review-2

-2 due to the missing license info + tests writing to "production"</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 11/10/2016, 6:32:34 AM<br><strong>Message</strong>: <pre>Abandoned

no longer in this repo</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Saad Karim - skarim@us.ibm.com<br><strong>Uploader</strong>: Saad Karim - skarim@us.ibm.com<br><strong>Created</strong>: 10/19/2016, 11:00:34 PM<br><strong>UnmergedRevision</strong>: [df032ec3e618f7b5ac84a98388b6222a776bea95](https://github.com/hyperledger-gerrit-archive/fabric/commit/df032ec3e618f7b5ac84a98388b6222a776bea95)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 10/19/2016, 11:05:05 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Saad Karim - skarim@us.ibm.com<br><strong>Uploader</strong>: Saad Karim - skarim@us.ibm.com<br><strong>Created</strong>: 10/20/2016, 10:58:33 AM<br><strong>UnmergedRevision</strong>: [6fbd81216c5a11d6961b05ef4a3e1d3e15f6dde1](https://github.com/hyperledger-gerrit-archive/fabric/commit/6fbd81216c5a11d6961b05ef4a3e1d3e15f6dde1)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 10/20/2016, 11:06:10 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Saad Karim - skarim@us.ibm.com<br><strong>Uploader</strong>: Saad Karim - skarim@us.ibm.com<br><strong>Created</strong>: 10/21/2016, 10:39:18 AM<br><strong>UnmergedRevision</strong>: [157002edebf1d8887064107bf215aee8f5268a2e](https://github.com/hyperledger-gerrit-archive/fabric/commit/157002edebf1d8887064107bf215aee8f5268a2e)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 10/23/2016, 6:25:57 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>Approved</strong>: 10/27/2016, 5:54:04 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Keith Smith - keithsmithlfid@gmail.com<br><strong>Approved</strong>: 10/26/2016, 12:05:44 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [/COMMIT_MSG#L7](https://github.com/hyperledger-gerrit-archive/fabric/blob/157002edebf1d8887064107bf215aee8f5268a2e//COMMIT_MSG#L7)<br><strong>Comment</strong>: <pre>Please let's add a link to the underlying FAB-XYZ item here as part of the COMMIT_MSG</pre><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [cop/api/error.go#L26](https://github.com/hyperledger-gerrit-archive/fabric/blob/157002edebf1d8887064107bf215aee8f5268a2e/cop/api/error.go#L26)<br><strong>Comment</strong>: <pre>COP's errors start from 100,000 to avoid an overlap with CFSSL Toolkit's errors.</pre><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [cop/api/error.go#L27](https://github.com/hyperledger-gerrit-archive/fabric/blob/157002edebf1d8887064107bf215aee8f5268a2e/cop/api/error.go#L27)<br><strong>Comment</strong>: <pre>Append new errors to the end of the below list for backward compatibility.</pre><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [cop/cfssl/certdb/certdb.go#L49](https://github.com/hyperledger-gerrit-archive/fabric/blob/157002edebf1d8887064107bf215aee8f5268a2e/cop/cfssl/certdb/certdb.go#L49)<br><strong>Comment</strong>: <pre>What's the difference between the above API and the "New APIs" please?</pre><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [cop/cfssl/sql/DA_Sqlite_test.go#L2](https://github.com/hyperledger-gerrit-archive/fabric/blob/157002edebf1d8887064107bf215aee8f5268a2e/cop/cfssl/sql/DA_Sqlite_test.go#L2)<br><strong>Comment</strong>: <pre>I don't like the naming convention. The _test is clear.... but why do we have a DA_Sqlite and not, say, DASQLite or so?</pre><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [cop/cfssl/sql/DA_Sqlite_test.go#L14](https://github.com/hyperledger-gerrit-archive/fabric/blob/157002edebf1d8887064107bf215aee8f5268a2e/cop/cfssl/sql/DA_Sqlite_test.go#L14)<br><strong>Comment</strong>: <pre>A few things here:

1. fabric code/logic, should probably write (if at all) to hyperledger/fabric/... directory, and not top level hyperledger.
2. I'm of the opinion that a test (especially not a SQL test, should not write to a `production` directory.
3. Whatever directory/convention we choose to go ahead with (for hl/fabric/cop)... let's set a const with the "prefix" and later on, append to it. It's not so nice to have 
(Line 14) dbPath = "/tmp/hyperledger/production/.cop/eca.db"
(Line 32) os.MkdirAll("/tmp/hyperledger/production/.cop", ... 
etc.

[Process]
Since gerrit is not a design-review tool:
1. I suggest to go back to the relevant JIRA item or a design document (e.g. COP's) and explicitly state there where will COP store test data, temporaries, certs, DBs, etc. 
2. Show it around/get an agreement over the above suggestion (make it a "policy", esp. for testing)
3. Point to such a document in the commit message.

If you can discuss it with the squad (Keith, et al.) or the Slack channel/email and reach a consensus quickly - that should take too long.</pre><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [cop/cfssl/sql/DA_Sqlite_test.go#L62](https://github.com/hyperledger-gerrit-archive/fabric/blob/157002edebf1d8887064107bf215aee8f5268a2e/cop/cfssl/sql/DA_Sqlite_test.go#L62)<br><strong>Comment</strong>: <pre>I'd rather we either:
- Uncomment these and have a panic("Not yet supported") for both mysql and postgres
, or,
- not to have these commented out lines (59-62) at all in this patchset, ending with the default panic("Unknown driver").</pre><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [cop/cfssl/sql/database_accessor.go#L1](https://github.com/hyperledger-gerrit-archive/fabric/blob/157002edebf1d8887064107bf215aee8f5268a2e/cop/cfssl/sql/database_accessor.go#L1)<br><strong>Comment</strong>: <pre>License, please.</pre><strong>Commenter</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>CommentLine</strong>: [cop/cfssl/sql/database_accessor.go#L415](https://github.com/hyperledger-gerrit-archive/fabric/blob/157002edebf1d8887064107bf215aee8f5268a2e/cop/cfssl/sql/database_accessor.go#L415)<br><strong>Comment</strong>: <pre>Let's check that err is not nil first, prior to checking the number of rows affected (1 , 2 or otherwise)</pre></blockquote>