<strong>Project</strong>: fabric<br><strong>Branch</strong>: feature/convergence<br><strong>ID</strong>: 1737<br><strong>Subject</strong>: [WIP] Fix SBFT bugs FAB-624<br><strong>Status</strong>: ABANDONED<br><strong>Owner</strong>: Gabor Hosszu - gabor@digitalasset.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 10/14/2016, 7:43:28 AM<br><strong>LastUpdated</strong>: 1/14/2017, 8:27:24 AM<br><strong>CommitMessage</strong>:<br><pre>[WIP] Fix SBFT bugs FAB-624

- fixes FAB-624
- only a single-shot pull sync protocol is added

Change-Id: I1bd5c2290db74d1e05ec45ddf21ca9024e04b064
Signed-off-by: Gabor Hosszu <gabor@digitalasset.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Gabor Hosszu - gabor@digitalasset.com<br><strong>Reviewed</strong>: 10/14/2016, 7:43:28 AM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/14/2016, 7:44:29 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/1785/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/14/2016, 7:45:55 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/684/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/14/2016, 8:05:07 AM<br><strong>Message</strong>: <pre>Patch Set 1: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/1785/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/684/ : UNSTABLE (skipped)</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 10/14/2016, 9:58:19 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(6 comments)</pre><strong>Reviewer</strong>: Gabor Hosszu - gabor@digitalasset.com<br><strong>Reviewed</strong>: 10/14/2016, 10:10:29 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(2 comments)</pre><strong>Reviewer</strong>: Marko Vukolic - mvu@zurich.ibm.com<br><strong>Reviewed</strong>: 10/14/2016, 1:22:40 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(5 comments)

- signature verification in handling incoming Hello msg missing
- Hello pull needs to be periodic
- These things if omitted must be marked visibly as TODOs and/or logger warnings</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 10/20/2016, 12:34:27 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(1 comment)</pre><strong>Reviewer</strong>: Gabor Hosszu - gabor@digitalasset.com<br><strong>Reviewed</strong>: 10/24/2016, 4:30:03 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(9 comments)</pre><strong>Reviewer</strong>: Gabor Hosszu - gabor@digitalasset.com<br><strong>Reviewed</strong>: 10/24/2016, 4:37:01 AM<br><strong>Message</strong>: <pre>Uploaded patch set 2.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/24/2016, 4:38:08 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/852/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/24/2016, 4:39:59 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/1955/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/24/2016, 5:12:52 AM<br><strong>Message</strong>: <pre>Patch Set 2: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/852/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/1955/ : FAILURE</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 10/24/2016, 5:19:27 AM<br><strong>Message</strong>: <pre>Patch Set 2:

reverify</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/24/2016, 5:21:49 AM<br><strong>Message</strong>: <pre>Patch Set 2: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/853/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/24/2016, 5:23:59 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/1956/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/24/2016, 6:24:21 AM<br><strong>Message</strong>: <pre>Patch Set 2: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/853/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/1956/ : SUCCESS</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 10/24/2016, 9:53:31 AM<br><strong>Message</strong>: <pre>Patch Set 2:

(1 comment)</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 10/25/2016, 9:39:21 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(1 comment)</pre><strong>Reviewer</strong>: Gabor Hosszu - gabor@digitalasset.com<br><strong>Reviewed</strong>: 10/25/2016, 10:43:13 AM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/25/2016, 10:52:19 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/925/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/25/2016, 10:52:20 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/2029/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/25/2016, 11:22:28 AM<br><strong>Message</strong>: <pre>Patch Set 3: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/925/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/2029/ : FAILURE</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 10/25/2016, 12:23:04 PM<br><strong>Message</strong>: <pre>Patch Set 3:

(1 comment)</pre><strong>Reviewer</strong>: Gabor Hosszu - gabor@digitalasset.com<br><strong>Reviewed</strong>: 10/25/2016, 12:45:59 PM<br><strong>Message</strong>: <pre>Uploaded patch set 4.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/25/2016, 12:48:56 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/932/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/25/2016, 12:50:35 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/2036/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/25/2016, 1:15:18 PM<br><strong>Message</strong>: <pre>Patch Set 4: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/932/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/2036/ : FAILURE</pre><strong>Reviewer</strong>: Simon Schubert - 2-hl-gerrit@0x2c.org<br><strong>Reviewed</strong>: 10/26/2016, 7:55:27 AM<br><strong>Message</strong>: <pre>Patch Set 4: Code-Review-2

(9 comments)</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 12/15/2016, 3:28:10 AM<br><strong>Message</strong>: <pre>Patch Set 4:

can we abandon this one?</pre><strong>Reviewer</strong>: Gabor Hosszu - gabor@digitalasset.com<br><strong>Reviewed</strong>: 1/14/2017, 8:27:24 AM<br><strong>Message</strong>: <pre>Abandoned</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Gabor Hosszu - gabor@digitalasset.com<br><strong>Uploader</strong>: Gabor Hosszu - gabor@digitalasset.com<br><strong>Created</strong>: 10/14/2016, 7:43:28 AM<br><strong>UnmergedRevision</strong>: [8cbd226fc3fc49ac8639be091c01672a0e74e11a](https://github.com/hyperledger-gerrit-archive/fabric/commit/8cbd226fc3fc49ac8639be091c01672a0e74e11a)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 10/14/2016, 8:05:07 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Marko Vukolic - mvu@zurich.ibm.com<br><strong>CommentLine</strong>: [consensus/simplebft/connection.go#L30](https://github.com/hyperledger-gerrit-archive/fabric/blob/8cbd226fc3fc49ac8639be091c01672a0e74e11a/consensus/simplebft/connection.go#L30)<br><strong>Comment</strong>: <pre>This TODO is wrong, as we MUST NOT transfer unsigned (pre)prepare and commit from an untrusted replica in Hello. Will submit as a separate issue.</pre><strong>Commenter</strong>: Simon Schubert - 2-hl-gerrit@0x2c.org<br><strong>CommentLine</strong>: [consensus/simplebft/connection.go#L30](https://github.com/hyperledger-gerrit-archive/fabric/blob/8cbd226fc3fc49ac8639be091c01672a0e74e11a/consensus/simplebft/connection.go#L30)<br><strong>Comment</strong>: <pre>We're not relaying other replica's messages, but only our own.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [consensus/simplebft/connection.go#L43](https://github.com/hyperledger-gerrit-archive/fabric/blob/8cbd226fc3fc49ac8639be091c01672a0e74e11a/consensus/simplebft/connection.go#L43)<br><strong>Comment</strong>: <pre>I realize you're not done, but it looks like you did not run go  fmt.</pre><strong>Commenter</strong>: Gabor Hosszu - gabor@digitalasset.com<br><strong>CommentLine</strong>: [consensus/simplebft/connection.go#L43](https://github.com/hyperledger-gerrit-archive/fabric/blob/8cbd226fc3fc49ac8639be091c01672a0e74e11a/consensus/simplebft/connection.go#L43)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Gabor Hosszu - gabor@digitalasset.com<br><strong>CommentLine</strong>: [consensus/simplebft/connection.go#L54](https://github.com/hyperledger-gerrit-archive/fabric/blob/8cbd226fc3fc49ac8639be091c01672a0e74e11a/consensus/simplebft/connection.go#L54)<br><strong>Comment</strong>: <pre>CHECK INCOMING SIGNATURES</pre><strong>Commenter</strong>: Marko Vukolic - mvu@zurich.ibm.com<br><strong>CommentLine</strong>: [consensus/simplebft/connection.go#L54](https://github.com/hyperledger-gerrit-archive/fabric/blob/8cbd226fc3fc49ac8639be091c01672a0e74e11a/consensus/simplebft/connection.go#L54)<br><strong>Comment</strong>: <pre>This is critical functionality here as we cannot trust the replica sending Hello. So the receiving replica needs to verify the f+1 signatures accompanying the header.

Add a //TODO + logger Warning until signature verification is implemented</pre><strong>Commenter</strong>: Gabor Hosszu - gabor@digitalasset.com<br><strong>CommentLine</strong>: [consensus/simplebft/connection.go#L54](https://github.com/hyperledger-gerrit-archive/fabric/blob/8cbd226fc3fc49ac8639be091c01672a0e74e11a/consensus/simplebft/connection.go#L54)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Simon Schubert - 2-hl-gerrit@0x2c.org<br><strong>CommentLine</strong>: [consensus/simplebft/connection.go#L64](https://github.com/hyperledger-gerrit-archive/fabric/blob/8cbd226fc3fc49ac8639be091c01672a0e74e11a/consensus/simplebft/connection.go#L64)<br><strong>Comment</strong>: <pre>h only contains the header, but no payload, so we need to run a full sync anyways.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [consensus/simplebft/connection.go#L68](https://github.com/hyperledger-gerrit-archive/fabric/blob/8cbd226fc3fc49ac8639be091c01672a0e74e11a/consensus/simplebft/connection.go#L68)<br><strong>Comment</strong>: <pre>Presumably if we have not executed it, the timer should run and then cancel after execution?</pre><strong>Commenter</strong>: Gabor Hosszu - gabor@digitalasset.com<br><strong>CommentLine</strong>: [consensus/simplebft/connection.go#L68](https://github.com/hyperledger-gerrit-archive/fabric/blob/8cbd226fc3fc49ac8639be091c01672a0e74e11a/consensus/simplebft/connection.go#L68)<br><strong>Comment</strong>: <pre>Something like this is done now: as you can see, here, it is not stopped and after execution and checkpoint it is stopped.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [consensus/simplebft/newview.go#L43](https://github.com/hyperledger-gerrit-archive/fabric/blob/8cbd226fc3fc49ac8639be091c01672a0e74e11a/consensus/simplebft/newview.go#L43)<br><strong>Comment</strong>: <pre>Noted in viewchange.go, this method is only ever entered if we are the primary, so the if check bellow will always fail.  We need to start the new-view timer when we receive the 2f+1th view-change message, likely back in viewchange.go</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [consensus/simplebft/newview.go#L43](https://github.com/hyperledger-gerrit-archive/fabric/blob/8cbd226fc3fc49ac8639be091c01672a0e74e11a/consensus/simplebft/newview.go#L43)<br><strong>Comment</strong>: <pre>Just posting to call attention to this again since it has not been addressed, but this code block will never execute, since only the primary ever enters this block.</pre><strong>Commenter</strong>: Gabor Hosszu - gabor@digitalasset.com<br><strong>CommentLine</strong>: [consensus/simplebft/newview.go#L43](https://github.com/hyperledger-gerrit-archive/fabric/blob/8cbd226fc3fc49ac8639be091c01672a0e74e11a/consensus/simplebft/newview.go#L43)<br><strong>Comment</strong>: <pre>What if I removed the primary check from handleViewChange? (as I remember I did this before but failed to add the change) this way maybeSend... would be called for non-primary nodes, too, but cause of the 'return' statement at the end of this code, those nodes would not broadcast anything.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [consensus/simplebft/newview.go#L43](https://github.com/hyperledger-gerrit-archive/fabric/blob/8cbd226fc3fc49ac8639be091c01672a0e74e11a/consensus/simplebft/newview.go#L43)<br><strong>Comment</strong>: <pre>I think this would be fine.  However, what I think could be even better with a little more restructuring.  Perhaps turn maybeSendNewView into 'computeNewView', then back in recvViewChange if the new view was computed successfully, have a branching if of 'if primary (and not already sent) send it, else (and not already started) start new view timer.

At least this scheme makes more sense in my head.</pre><strong>Commenter</strong>: Gabor Hosszu - gabor@digitalasset.com<br><strong>CommentLine</strong>: [consensus/simplebft/newview.go#L45](https://github.com/hyperledger-gerrit-archive/fabric/blob/8cbd226fc3fc49ac8639be091c01672a0e74e11a/consensus/simplebft/newview.go#L45)<br><strong>Comment</strong>: <pre>// we start the exponentially increasing view change timer once we get 2f+1 VC messages
   this is not true.</pre><strong>Commenter</strong>: Marko Vukolic - mvu@zurich.ibm.com<br><strong>CommentLine</strong>: [consensus/simplebft/newview.go#L45](https://github.com/hyperledger-gerrit-archive/fabric/blob/8cbd226fc3fc49ac8639be091c01672a0e74e11a/consensus/simplebft/newview.go#L45)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Marko Vukolic - mvu@zurich.ibm.com<br><strong>CommentLine</strong>: [consensus/simplebft/newview.go#L45](https://github.com/hyperledger-gerrit-archive/fabric/blob/8cbd226fc3fc49ac8639be091c01672a0e74e11a/consensus/simplebft/newview.go#L45)<br><strong>Comment</strong>: <pre>These three lines of comment are not true better to have simpler statement:

// we start the exponentially increasing view change timer once we get 2f+1 VC messages</pre><strong>Commenter</strong>: Gabor Hosszu - gabor@digitalasset.com<br><strong>CommentLine</strong>: [consensus/simplebft/newview.go#L45](https://github.com/hyperledger-gerrit-archive/fabric/blob/8cbd226fc3fc49ac8639be091c01672a0e74e11a/consensus/simplebft/newview.go#L45)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Gabor Hosszu - gabor@digitalasset.com<br><strong>CommentLine</strong>: [consensus/simplebft/newview.go#L53](https://github.com/hyperledger-gerrit-archive/fabric/blob/8cbd226fc3fc49ac8639be091c01672a0e74e11a/consensus/simplebft/newview.go#L53)<br><strong>Comment</strong>: <pre>If we have an OK xSet we return here (we are non-primary) - nothing is sent. If we have a non-OK xSet we return up there (nothing is sent).</pre><strong>Commenter</strong>: Simon Schubert - 2-hl-gerrit@0x2c.org<br><strong>CommentLine</strong>: [consensus/simplebft/newview.go#L53](https://github.com/hyperledger-gerrit-archive/fabric/blob/8cbd226fc3fc49ac8639be091c01672a0e74e11a/consensus/simplebft/newview.go#L53)<br><strong>Comment</strong>: <pre>I don't think this timer set up should be in this function.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [consensus/simplebft/simplebft.go#L150](https://github.com/hyperledger-gerrit-archive/fabric/blob/8cbd226fc3fc49ac8639be091c01672a0e74e11a/consensus/simplebft/simplebft.go#L150)<br><strong>Comment</strong>: <pre>So we start a pull sync timer at startup, which asks for a Hello after 2 seconds.  Why do we assume the Hello is better after 2 seconds than at connection?</pre><strong>Commenter</strong>: Marko Vukolic - mvu@zurich.ibm.com<br><strong>CommentLine</strong>: [consensus/simplebft/simplebft.go#L150](https://github.com/hyperledger-gerrit-archive/fabric/blob/8cbd226fc3fc49ac8639be091c01672a0e74e11a/consensus/simplebft/simplebft.go#L150)<br><strong>Comment</strong>: <pre>The idea is to make this Hello pull periodic. This should be conveyed by at least by a TODO in the code.</pre><strong>Commenter</strong>: Gabor Hosszu - gabor@digitalasset.com<br><strong>CommentLine</strong>: [consensus/simplebft/simplebft.go#L150](https://github.com/hyperledger-gerrit-archive/fabric/blob/8cbd226fc3fc49ac8639be091c01672a0e74e11a/consensus/simplebft/simplebft.go#L150)<br><strong>Comment</strong>: <pre>As Marko said.</pre><strong>Commenter</strong>: Simon Schubert - 2-hl-gerrit@0x2c.org<br><strong>CommentLine</strong>: [consensus/simplebft/simplebft.go#L150](https://github.com/hyperledger-gerrit-archive/fabric/blob/8cbd226fc3fc49ac8639be091c01672a0e74e11a/consensus/simplebft/simplebft.go#L150)<br><strong>Comment</strong>: <pre>I don't like the periodic hello, nor do I like mixing this functionality in this patch set.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [consensus/simplebft/simplebft.proto#L19](https://github.com/hyperledger-gerrit-archive/fabric/blob/8cbd226fc3fc49ac8639be091c01672a0e74e11a/consensus/simplebft/simplebft.proto#L19)<br><strong>Comment</strong>: <pre>Generally, I think use of the empty proto is discouraged in protobuf because if you wish to add a message field in the future, you are out of luck.  I'd prefer that this be defined as an empty message locally.</pre><strong>Commenter</strong>: Gabor Hosszu - gabor@digitalasset.com<br><strong>CommentLine</strong>: [consensus/simplebft/simplebft.proto#L19](https://github.com/hyperledger-gerrit-archive/fabric/blob/8cbd226fc3fc49ac8639be091c01672a0e74e11a/consensus/simplebft/simplebft.proto#L19)<br><strong>Comment</strong>: <pre>I don't really get your arguments here. I use empty because I do not want to have any fields. If I want (in the future) I will have to change things. But with a local Empty I will have to do the same (change protos of this side and receiver side). Btw this whole thing is quite experimental now so I suggest keeping it this way.</pre><strong>Commenter</strong>: Simon Schubert - 2-hl-gerrit@0x2c.org<br><strong>CommentLine</strong>: [consensus/simplebft/viewchange.go#L48](https://github.com/hyperledger-gerrit-archive/fabric/blob/8cbd226fc3fc49ac8639be091c01672a0e74e11a/consensus/simplebft/viewchange.go#L48)<br><strong>Comment</strong>: <pre>why don't we set the timer here?</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [consensus/simplebft/viewchange.go#L94](https://github.com/hyperledger-gerrit-archive/fabric/blob/8cbd226fc3fc49ac8639be091c01672a0e74e11a/consensus/simplebft/viewchange.go#L94)<br><strong>Comment</strong>: <pre>Note that 'maybeSendNewView' is only called if primary</pre><strong>Commenter</strong>: Gabor Hosszu - gabor@digitalasset.com<br><strong>CommentLine</strong>: [consensus/simplebft/viewchange.go#L94](https://github.com/hyperledger-gerrit-archive/fabric/blob/8cbd226fc3fc49ac8639be091c01672a0e74e11a/consensus/simplebft/viewchange.go#L94)<br><strong>Comment</strong>: <pre>What about calling it for every node? See my suggestion.</pre><strong>Commenter</strong>: Simon Schubert - 2-hl-gerrit@0x2c.org<br><strong>CommentLine</strong>: [consensus/simplebft/viewchange.go#L94](https://github.com/hyperledger-gerrit-archive/fabric/blob/8cbd226fc3fc49ac8639be091c01672a0e74e11a/consensus/simplebft/viewchange.go#L94)<br><strong>Comment</strong>: <pre>Only primaries send new view messages.</pre></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Gabor Hosszu - gabor@digitalasset.com<br><strong>Uploader</strong>: Gabor Hosszu - gabor@digitalasset.com<br><strong>Created</strong>: 10/24/2016, 4:37:01 AM<br><strong>UnmergedRevision</strong>: [1a46fd968479274d5d2271866eed9fa0d3967048](https://github.com/hyperledger-gerrit-archive/fabric/commit/1a46fd968479274d5d2271866eed9fa0d3967048)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 10/24/2016, 6:24:21 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [consensus/simplebft/viewchange.go#L93](https://github.com/hyperledger-gerrit-archive/fabric/blob/1a46fd968479274d5d2271866eed9fa0d3967048/consensus/simplebft/viewchange.go#L93)<br><strong>Comment</strong>: <pre>This is where the new view timer should be started, on allCorrectQuorum, not in maybeSendNewView, as you see that is only entered by the primary.</pre></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Gabor Hosszu - gabor@digitalasset.com<br><strong>Uploader</strong>: Gabor Hosszu - gabor@digitalasset.com<br><strong>Created</strong>: 10/25/2016, 10:43:13 AM<br><strong>UnmergedRevision</strong>: [6be7a6f66243d9c8720019c2066934bf2ab4d2b1](https://github.com/hyperledger-gerrit-archive/fabric/commit/6be7a6f66243d9c8720019c2066934bf2ab4d2b1)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 10/25/2016, 11:22:28 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [consensus/simplebft/viewchange.go#L96](https://github.com/hyperledger-gerrit-archive/fabric/blob/6be7a6f66243d9c8720019c2066934bf2ab4d2b1/consensus/simplebft/viewchange.go#L96)<br><strong>Comment</strong>: <pre>Not sure if this is the source of the problem, but we should only be starting the view change timer the _first_ time the allquorum is received.  As it may occur multiple times.</pre></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Gabor Hosszu - gabor@digitalasset.com<br><strong>Uploader</strong>: Gabor Hosszu - gabor@digitalasset.com<br><strong>Created</strong>: 10/25/2016, 12:45:59 PM<br><strong>UnmergedRevision</strong>: [54eac0d66b4ecce4346ceaaddb8e132312cf1a67](https://github.com/hyperledger-gerrit-archive/fabric/commit/54eac0d66b4ecce4346ceaaddb8e132312cf1a67)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 10/25/2016, 1:15:18 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Simon Schubert - 2-hl-gerrit@0x2c.org<br><strong>Approved</strong>: 10/26/2016, 7:55:27 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Simon Schubert - 2-hl-gerrit@0x2c.org<br><strong>CommentLine</strong>: [consensus/simplebft/connection.go#L67](https://github.com/hyperledger-gerrit-archive/fabric/blob/54eac0d66b4ecce4346ceaaddb8e132312cf1a67/consensus/simplebft/connection.go#L67)<br><strong>Comment</strong>: <pre>h does not contain any payload and can not be delivered.  we need to run a full sync.</pre><strong>Commenter</strong>: Simon Schubert - 2-hl-gerrit@0x2c.org<br><strong>CommentLine</strong>: [consensus/simplebft/simplebft.go#L152](https://github.com/hyperledger-gerrit-archive/fabric/blob/54eac0d66b4ecce4346ceaaddb8e132312cf1a67/consensus/simplebft/simplebft.go#L152)<br><strong>Comment</strong>: <pre>I don't like this periodic sync.</pre><strong>Commenter</strong>: Simon Schubert - 2-hl-gerrit@0x2c.org<br><strong>CommentLine</strong>: [consensus/simplebft/viewchange.go#L99](https://github.com/hyperledger-gerrit-archive/fabric/blob/54eac0d66b4ecce4346ceaaddb8e132312cf1a67/consensus/simplebft/viewchange.go#L99)<br><strong>Comment</strong>: <pre>why do we only start the timer here?</pre></blockquote>