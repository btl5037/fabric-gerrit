<strong>Project</strong>: fabric</br><strong>Branch</strong>: master<br><strong>ID</strong>: 4767<br><strong>Subject</strong>: [FAB-204] Expose ledger rich query API to chaincode<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Assignee</strong>:<strong>Created</strong>: 1/24/2017, 10:47:27 AM<br><strong>LastUpdated</strong>: 1/28/2017, 11:22:43 AM<br><strong>CommitMessage</strong>:<br><pre>[FAB-204] Expose ledger rich query API to chaincode

Adding a new chaincode API called ExecuteQuery() that
executes a given rich query on the state DB
(if it is supported).

For example, if CouchDB is the state DB, chaincode can
utilize ExecuteQuery() API to execute declarative JSON
query to find documents which satisfy given criteria.
http://docs.couchdb.org/en/2.0.0/api/database/find.html

Change-Id: I296d261c247badc679a7d5bfa25172a9e19ccf34
Signed-off-by: senthil <cendhu@gmail.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 1/24/2017, 10:47:27 AM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/24/2017, 10:51:10 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5581/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/24/2017, 11:50:07 AM<br><strong>Message</strong>: <pre>Patch Set 1: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5581/ : SUCCESS</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 1/25/2017, 5:47:42 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(3 comments)

Senthil, I see a lot of code as duplicate of what exists for the range query. Since most of the code is about iteration state management, I think that we should reuse the existing code. If the only difference is in the query (i.e., the range query takes explicit startKey and endKey and the new query is a query string can be define different query structs that follow a common interface and then use common code for iteration?</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 1/25/2017, 10:18:14 AM<br><strong>Message</strong>: <pre>Patch Set 1:

I spoke to Murali, we can leave the duplicate code in this changeset, and then refactor in a subsequent changeset.  I've opened jira item for this: https://jira.hyperledger.org/browse/FAB-1841.</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 1/26/2017, 2:40:27 AM<br><strong>Message</strong>: <pre>Uploaded patch set 2.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/26/2017, 2:43:20 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5711/</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 1/26/2017, 2:48:29 AM<br><strong>Message</strong>: <pre>Patch Set 2:

> (3 comments)
 > 
 > Senthil, I see a lot of code as duplicate of what exists for the
 > range query. Since most of the code is about iteration state
 > management, I think that we should reuse the existing code. If the
 > only difference is in the query (i.e., the range query takes
 > explicit startKey and endKey and the new query is a query string
 > can be define different query structs that follow a common
 > interface and then use common code for iteration?

Removed duplicate code by using same iteration state for both RangeQuery() and ExecuteQuery().</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/26/2017, 3:39:52 AM<br><strong>Message</strong>: <pre>Patch Set 2: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5711/ : SUCCESS</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 1/26/2017, 4:02:30 AM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/26/2017, 4:05:22 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5713/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/26/2017, 4:43:23 AM<br><strong>Message</strong>: <pre>Patch Set 3: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5713/ : SUCCESS</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 1/26/2017, 6:18:57 AM<br><strong>Message</strong>: <pre>Patch Set 3: Code-Review+1

Thanks Senthil for refactoring. Though, I would be in the favor of even reusing the query initiation function because, it is only the payload (and which method on invoke on txsimulator) that differs for different queries. But will leave at Murali's discretion :-)</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 1/26/2017, 11:25:34 PM<br><strong>Message</strong>: <pre>Patch Set 3: Code-Review+1</pre><strong>Reviewer</strong>: Jim Zhang - jim_the_matrix@hotmail.com<br><strong>Reviewed</strong>: 1/27/2017, 2:05:15 PM<br><strong>Message</strong>: <pre>Patch Set 3: Code-Review+2</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 1/28/2017, 7:29:02 AM<br><strong>Message</strong>: <pre>Patch Set 3: Code-Review+1

this looks good but we should have Murali take a look</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 1/28/2017, 10:12:42 AM<br><strong>Message</strong>: <pre>Patch Set 3: Code-Review-1

(5 comments)

Dave, Senthil - looks good. The one Println forces a redo :-) ...so might as well do the others minor ones. 

But as all are cosmetic, fine with a separate CR to avoid churn.</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 1/28/2017, 10:17:56 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Thanks for the detailed review Murali.  We will make the minor updates in the subsequent changeset.  I've opened Jira item:
https://jira.hyperledger.org/browse/FAB-1917</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 1/28/2017, 10:19:15 AM<br><strong>Message</strong>: <pre>Patch Set 3: Code-Review+2

Works for me!</pre><strong>Reviewer</strong>: Gerrit Code Review - gerrit@hyperledger.org<br><strong>Reviewed</strong>: 1/28/2017, 10:19:17 AM<br><strong>Message</strong>: <pre>Change has been successfully merged by Srinivasan Muralidharan</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/28/2017, 10:22:10 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-x86_64/891/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/28/2017, 11:22:43 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-merge-x86_64/891/ : SUCCESS</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Uploader</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Created</strong>: 1485272847<br><strong>GitHubRevision</strong>: [25a8ef05531c257fd47e0bbab2d3f66e6507bf08](https://github.com/hyperledger/fabric/commit/25a8ef05531c257fd47e0bbab2d3f66e6507bf08)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/24/2017, 11:50:07 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Uploader</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Created</strong>: 1485416427<br><strong>GitHubRevision</strong>: [754b368a0615e62fded62f70572210b18e0f1649](https://github.com/hyperledger/fabric/commit/754b368a0615e62fded62f70572210b18e0f1649)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/26/2017, 3:39:52 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Uploader</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Created</strong>: 1485421350<br><strong>GitHubRevision</strong>: [d5467f3716075991ac0c685ebbc97a8e427cdb00](https://github.com/hyperledger/fabric/commit/d5467f3716075991ac0c685ebbc97a8e427cdb00)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/26/2017, 4:43:23 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Approved</strong>: 1/28/2017, 10:19:15 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Srinivasan Muralidharan<br><strong>Merged</strong>: 1/28/2017, 10:19:17 AM<br><br><strong>Approver</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Approved</strong>: 1/26/2017, 6:18:57 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Approved</strong>: 1/28/2017, 7:29:02 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Approved</strong>: 1/26/2017, 11:25:34 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Jim Zhang - jim_the_matrix@hotmail.com<br><strong>Approved</strong>: 1/27/2017, 2:05:15 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br></blockquote>