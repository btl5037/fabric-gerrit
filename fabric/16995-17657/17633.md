<strong>Project</strong>: fabric<br><strong>Branch</strong>: master<br><strong>ID</strong>: 17633<br><strong>Subject</strong>: [FAB-7952] Improve unclear and generic error message<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 2/7/2018, 2:35:58 PM<br><strong>LastUpdated</strong>: 5/20/2019, 2:54:31 AM<br><strong>CommitMessage</strong>:<br><pre>[FAB-7952] Improve unclear and generic error message

This CR changes the error message reported when a proposal is processed
for a channel that either does not exist or the creator is not a member
of. The message is still left vague ("access denied") to avoid potential
malicious users scanning for channels but echoes back the channel and
and org name supplied by the user to provide some troubleshooting help
for cases where there was a typo in the channel name or the user had an
unexpected MSP configured. The originating error message is logged as-is
on the peer to allow peer admins to know the exact root cause of the
error. This CR also updates the errors throughout the file to use the
github.com/pkg/errors package.

Change-Id: Id3589ceb56fa817a3b95026bb3e3e34629346f80
Signed-off-by: Will Lahti <wtlahti@us.ibm.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Reviewed</strong>: 2/7/2018, 2:35:58 PM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Reviewed</strong>: 2/7/2018, 2:37:32 PM<br><strong>Message</strong>: <pre>Uploaded patch set 2.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/7/2018, 2:37:34 PM<br><strong>Message</strong>: <pre>Patch Set 1:

No Builds Executed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/7/2018, 2:39:35 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/1229/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/7/2018, 2:39:37 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20785/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/7/2018, 2:40:01 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12471/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/7/2018, 3:05:57 PM<br><strong>Message</strong>: <pre>Patch Set 2: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/1229/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/1229

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20785/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/20785

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12471/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/12471</pre><strong>Reviewer</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Reviewed</strong>: 2/7/2018, 3:29:34 PM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/7/2018, 3:31:28 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/1233/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/7/2018, 3:32:03 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20789/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/7/2018, 3:32:15 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12475/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/7/2018, 4:01:09 PM<br><strong>Message</strong>: <pre>Patch Set 3: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/1233/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/1233

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20789/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/20789

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12475/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/12475</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 2/7/2018, 11:43:57 PM<br><strong>Message</strong>: <pre>Patch Set 3:

(1 comment)</pre><strong>Reviewer</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Reviewed</strong>: 2/8/2018, 7:58:08 AM<br><strong>Message</strong>: <pre>Patch Set 3:

(1 comment)

> Patch Set 3:
> 
> (1 comm</pre><strong>Reviewer</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Reviewed</strong>: 2/12/2018, 1:20:26 PM<br><strong>Message</strong>: <pre>Uploaded patch set 4.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/12/2018, 1:21:41 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20881/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/12/2018, 1:26:46 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12564/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/12/2018, 1:51:31 PM<br><strong>Message</strong>: <pre>Patch Set 4: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20881/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20881/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/20881

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12564/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/12564</pre><strong>Reviewer</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Reviewed</strong>: 2/12/2018, 2:04:32 PM<br><strong>Message</strong>: <pre>Patch Set 4:

rebuild-x</pre><strong>Reviewer</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Reviewed</strong>: 2/12/2018, 2:27:40 PM<br><strong>Message</strong>: <pre>Patch Set 4:

reverify-x</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/12/2018, 2:28:56 PM<br><strong>Message</strong>: <pre>Patch Set 4: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20882/</pre><strong>Reviewer</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Reviewed</strong>: 2/12/2018, 3:12:54 PM<br><strong>Message</strong>: <pre>Uploaded patch set 5.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/12/2018, 3:13:46 PM<br><strong>Message</strong>: <pre>Patch Set 4: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20882/ : ABORTED

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20882/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/20882</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/12/2018, 3:14:57 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20888/ (1/2)</pre><strong>Reviewer</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Reviewed</strong>: 2/12/2018, 3:16:25 PM<br><strong>Message</strong>: <pre>Uploaded patch set 6: Commit message was updated.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/12/2018, 3:16:28 PM<br><strong>Message</strong>: <pre>Patch Set 5: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20888/ : ABORTED

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20888/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/20888</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/12/2018, 3:16:55 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20889/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/12/2018, 3:18:32 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12570/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/12/2018, 3:38:56 PM<br><strong>Message</strong>: <pre>Patch Set 6: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20889/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/20889

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12570/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/12570</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 2/12/2018, 5:47:09 PM<br><strong>Message</strong>: <pre>Patch Set 6: Code-Review-1

(5 comments)</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 2/13/2018, 3:38:50 AM<br><strong>Message</strong>: <pre>Patch Set 6:

(1 comment)</pre><strong>Reviewer</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Reviewed</strong>: 2/13/2018, 11:58:39 AM<br><strong>Message</strong>: <pre>Patch Set 6:

(2 comments)

This error message was brought up in two separate JIRA usability "bugs" opened by testers. The "MSP <org-name> is unknown" message is very vague and hard for a legitimate user to see and understand what problem is occurring. The goal of this CR is to return additional information to allow the end user to troubleshoot their issue while logging the exact cause of the error in the peer log. Perhaps we are still unintentionally leaking information so any and all input on the best way to achieve this goal is welcome and appreciated!</pre><strong>Reviewer</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Reviewed</strong>: 2/13/2018, 3:32:08 PM<br><strong>Message</strong>: <pre>Patch Set 6:

(1 comment)</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 2/13/2018, 3:45:11 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Regardless of the comment discussion I think it can be good if Angelo and Alessandro can take a look at this.

It is, after all - their code which is being changed...</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 2/13/2018, 3:57:23 PM<br><strong>Message</strong>: <pre>Patch Set 6:

(2 comments)</pre><strong>Reviewer</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>Reviewed</strong>: 2/14/2018, 8:31:55 AM<br><strong>Message</strong>: <pre>Patch Set 6:

(5 comments)</pre><strong>Reviewer</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Reviewed</strong>: 2/14/2018, 9:49:22 AM<br><strong>Message</strong>: <pre>Patch Set 6:

(5 comments)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 2/14/2018, 4:03:51 PM<br><strong>Message</strong>: <pre>Patch Set 6:

(2 comments)

Hi Will - thx, please see some comments/thoughts below.</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 2/14/2018, 5:01:05 PM<br><strong>Message</strong>: <pre>Patch Set 6:

(1 comment)</pre><strong>Reviewer</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Reviewed</strong>: 2/14/2018, 5:06:38 PM<br><strong>Message</strong>: <pre>Patch Set 6:

(2 comments)</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 2/14/2018, 10:31:35 PM<br><strong>Message</strong>: <pre>Patch Set 6:

(1 comment)</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 2/15/2018, 3:00:31 AM<br><strong>Message</strong>: <pre>Patch Set 6:

(1 comment)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 2/15/2018, 3:41:15 AM<br><strong>Message</strong>: <pre>Patch Set 6:

(1 comment)</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 2/15/2018, 6:27:22 AM<br><strong>Message</strong>: <pre>Patch Set 6:

(1 comment)</pre><strong>Reviewer</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Reviewed</strong>: 2/15/2018, 12:05:12 PM<br><strong>Message</strong>: <pre>Patch Set 6:

(1 comment)</pre><strong>Reviewer</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Reviewed</strong>: 2/15/2018, 12:56:50 PM<br><strong>Message</strong>: <pre>Uploaded patch set 7.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2018, 12:58:32 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12636/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2018, 12:58:59 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20956/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2018, 1:22:07 PM<br><strong>Message</strong>: <pre>Patch Set 7: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12636/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/12636

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20956/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/20956</pre><strong>Reviewer</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Reviewed</strong>: 2/16/2018, 4:20:53 PM<br><strong>Message</strong>: <pre>Patch Set 7:

(1 comment)</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 2/20/2018, 5:48:02 PM<br><strong>Message</strong>: <pre>Patch Set 8: Patch Set 7 was rebased</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/20/2018, 5:51:59 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12746/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/20/2018, 5:54:16 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/21057/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/20/2018, 6:42:56 PM<br><strong>Message</strong>: <pre>Patch Set 8: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12746/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12746/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/12746

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/21057/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/21057/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/21057</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 2/21/2018, 1:25:52 AM<br><strong>Message</strong>: <pre>Patch Set 8:

(1 comment)</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 2/21/2018, 6:01:22 AM<br><strong>Message</strong>: <pre>Patch Set 8:

(1 comment)</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 2/21/2018, 6:05:18 AM<br><strong>Message</strong>: <pre>Patch Set 8:

reverify</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/21/2018, 6:07:49 AM<br><strong>Message</strong>: <pre>Patch Set 8: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12754/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/21/2018, 6:08:17 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/21064/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/21/2018, 6:59:35 AM<br><strong>Message</strong>: <pre>Patch Set 8: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12754/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12754/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/12754

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/21064/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/21064/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/21064</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 2/21/2018, 9:26:40 PM<br><strong>Message</strong>: <pre>Patch Set 8:

reverify</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/21/2018, 9:29:04 PM<br><strong>Message</strong>: <pre>Patch Set 8: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12792/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/21/2018, 9:29:24 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/21099/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/21/2018, 10:04:27 PM<br><strong>Message</strong>: <pre>Patch Set 8: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12792/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12792/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/12792

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/21099/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/21099</pre><strong>Reviewer</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Reviewed</strong>: 2/22/2018, 7:57:36 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Reworking this CR. Stay tuned for updates.</pre><strong>Reviewer</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Reviewed</strong>: 2/22/2018, 10:13:58 PM<br><strong>Message</strong>: <pre>Uploaded patch set 9.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/22/2018, 10:16:35 PM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12820/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/22/2018, 10:16:48 PM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/21126/ (2/2)</pre><strong>Reviewer</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Reviewed</strong>: 2/22/2018, 10:18:19 PM<br><strong>Message</strong>: <pre>Patch Set 9:

(1 comment)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/22/2018, 10:42:41 PM<br><strong>Message</strong>: <pre>Patch Set 9: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12820/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/12820

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/21126/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/21126</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 2/23/2018, 11:33:12 AM<br><strong>Message</strong>: <pre>Patch Set 9: Code-Review+2

Thanks for fixing this up to address the underlying flaw in mgmt directly (even if the solution is a bit more cludgy)</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 2/23/2018, 5:00:50 PM<br><strong>Message</strong>: <pre>Patch Set 9: Code-Review+2</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 2/23/2018, 5:00:54 PM<br><strong>Message</strong>: <pre>Change has been successfully merged by Artem Barger</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/23/2018, 5:26:57 PM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/1897/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-end-2-end-x86_64/1897

https://jenkins.hyperledger.org/job/fabric-merge-x86_64/3221/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-x86_64/3221</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Uploader</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Created</strong>: 2/7/2018, 2:35:58 PM<br><strong>UnmergedRevision</strong>: [8a4a6cf882d6d84b7e20c341af7f6909bc5063b2](https://github.com/hyperledger-gerrit-archive/fabric/commit/8a4a6cf882d6d84b7e20c341af7f6909bc5063b2)<br><br></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Uploader</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Created</strong>: 2/7/2018, 2:37:32 PM<br><strong>UnmergedRevision</strong>: [5424ff9121062774360b10c6e8d2f2a90fb1da4b](https://github.com/hyperledger-gerrit-archive/fabric/commit/5424ff9121062774360b10c6e8d2f2a90fb1da4b)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/7/2018, 3:05:57 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Uploader</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Created</strong>: 2/7/2018, 3:29:34 PM<br><strong>UnmergedRevision</strong>: [980ed4ade8876de8cc2c53f51b17634c03b80bc4](https://github.com/hyperledger-gerrit-archive/fabric/commit/980ed4ade8876de8cc2c53f51b17634c03b80bc4)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/7/2018, 4:01:09 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/common/validation/msgvalidation.go#L160](https://github.com/hyperledger-gerrit-archive/fabric/blob/980ed4ade8876de8cc2c53f51b17634c03b80bc4/core/common/validation/msgvalidation.go#L160)<br><strong>Comment</strong>: <pre>I agree with keeping the message vague so that clients can't fish for existing channels, but this message is not only vague but misleading.  When this message is hit, it is almost always for one of the reasons that you mentioned in https://gerrit.hyperledger.org/r/#/c/17639/ , rather than being a 'deserialization' error.
Is it possible to distinguish true deserialization errors from the other more common errors that you documented (channel does not exist, peer has not joined channel, client is not member of channel).</pre><strong>Commenter</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>CommentLine</strong>: [core/common/validation/msgvalidation.go#L160](https://github.com/hyperledger-gerrit-archive/fabric/blob/980ed4ade8876de8cc2c53f51b17634c03b80bc4/core/common/validation/msgvalidation.go#L160)<br><strong>Comment</strong>: <pre>Agreed. I know I took a look at that but I'll dive deeper to see if it's possible to only return a message including "failed to deserialize..." when it's a true deserialization failure.</pre></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Uploader</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Created</strong>: 2/12/2018, 1:20:26 PM<br><strong>UnmergedRevision</strong>: [937f5a537145975a1e607738f7c38ccb49b06122](https://github.com/hyperledger-gerrit-archive/fabric/commit/937f5a537145975a1e607738f7c38ccb49b06122)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/12/2018, 3:13:46 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 5</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Uploader</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Created</strong>: 2/12/2018, 3:12:54 PM<br><strong>UnmergedRevision</strong>: [f4530af9a0c5c53d3f8382b7c023eca2233947e5](https://github.com/hyperledger-gerrit-archive/fabric/commit/f4530af9a0c5c53d3f8382b7c023eca2233947e5)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/12/2018, 3:16:28 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 6</h3><blockquote><strong>Type</strong>: NO_CODE_CHANGE<br><strong>Author</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Uploader</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Created</strong>: 2/12/2018, 3:16:25 PM<br><strong>UnmergedRevision</strong>: [b44e3900ea29c35f3b556dba9f4f207b3c2ff019](https://github.com/hyperledger-gerrit-archive/fabric/commit/b44e3900ea29c35f3b556dba9f4f207b3c2ff019)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/12/2018, 3:38:56 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Approved</strong>: 2/12/2018, 5:47:09 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [core/common/validation/msgvalidation.go#L108](https://github.com/hyperledger-gerrit-archive/fabric/blob/b44e3900ea29c35f3b556dba9f4f207b3c2ff019/core/common/validation/msgvalidation.go#L108)<br><strong>Comment</strong>: <pre>If the signature is invalid the error returned is:
"The creator's signature over the proposal is not valid"
which doesn't contain the "channel" in it.
So, you're leaking here that a combination of an MSP-ID and a channel are valid. 
Am I missing something?</pre><strong>Commenter</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>CommentLine</strong>: [core/common/validation/msgvalidation.go#L108](https://github.com/hyperledger-gerrit-archive/fabric/blob/b44e3900ea29c35f3b556dba9f4f207b3c2ff019/core/common/validation/msgvalidation.go#L108)<br><strong>Comment</strong>: <pre>Good catch. I missed that.</pre><strong>Commenter</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>CommentLine</strong>: [core/common/validation/msgvalidation.go#L108](https://github.com/hyperledger-gerrit-archive/fabric/blob/b44e3900ea29c35f3b556dba9f4f207b3c2ff019/core/common/validation/msgvalidation.go#L108)<br><strong>Comment</strong>: <pre>This check also does not seem too robust.</pre><strong>Commenter</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>CommentLine</strong>: [core/common/validation/msgvalidation.go#L108](https://github.com/hyperledger-gerrit-archive/fabric/blob/b44e3900ea29c35f3b556dba9f4f207b3c2ff019/core/common/validation/msgvalidation.go#L108)<br><strong>Comment</strong>: <pre>Agreed. I'll try to think of a better way to handle this but also appreciate thoughts from any reviewers with ideas here.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/common/validation/msgvalidation.go#L108](https://github.com/hyperledger-gerrit-archive/fabric/blob/b44e3900ea29c35f3b556dba9f4f207b3c2ff019/core/common/validation/msgvalidation.go#L108)<br><strong>Comment</strong>: <pre>One idea would be to make sure that the error returned is a special struct implementing the Error interface. A typecast would make the check more robust. Wdyt?</pre><strong>Commenter</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>CommentLine</strong>: [core/common/validation/msgvalidation.go#L108](https://github.com/hyperledger-gerrit-archive/fabric/blob/b44e3900ea29c35f3b556dba9f4f207b3c2ff019/core/common/validation/msgvalidation.go#L108)<br><strong>Comment</strong>: <pre>Ah yes, makes perfect sense. Thanks for the suggestion!</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [core/common/validation/msgvalidation.go#L114](https://github.com/hyperledger-gerrit-archive/fabric/blob/b44e3900ea29c35f3b556dba9f4f207b3c2ff019/core/common/validation/msgvalidation.go#L114)<br><strong>Comment</strong>: <pre>So the idea here is to log the MSP ID the client invoked?</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [core/common/validation/msgvalidation.go#L115](https://github.com/hyperledger-gerrit-archive/fabric/blob/b44e3900ea29c35f3b556dba9f4f207b3c2ff019/core/common/validation/msgvalidation.go#L115)<br><strong>Comment</strong>: <pre>why not just return "access denied"?</pre><strong>Commenter</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>CommentLine</strong>: [core/common/validation/msgvalidation.go#L115](https://github.com/hyperledger-gerrit-archive/fabric/blob/b44e3900ea29c35f3b556dba9f4f207b3c2ff019/core/common/validation/msgvalidation.go#L115)<br><strong>Comment</strong>: <pre>The goal is to improve usability for legitimate users here, if possible, but that's tough without leaking information.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/common/validation/msgvalidation.go#L115](https://github.com/hyperledger-gerrit-archive/fabric/blob/b44e3900ea29c35f3b556dba9f4f207b3c2ff019/core/common/validation/msgvalidation.go#L115)<br><strong>Comment</strong>: <pre>Here's a possible approach (feel free to comment/criticize). The fact that there is an error already leaks information to the caller, so we must ensure that we keep that kind of disclosure to a minimum. Ideally we could produce on a *local* log a detailed error message about what went wrong, assigning that long entry a random ID. The invoker can be returned a generic error plus the random ID. If the invoker and this peer have a trust relationship, the peer admin can easily look up the detailed error message and give it to the invoker. If not, the invoker learns nothing, other than a random log entry ID and the fact that the invocation failed. Thoughts?</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [core/common/validation/msgvalidation.go#L115](https://github.com/hyperledger-gerrit-archive/fabric/blob/b44e3900ea29c35f3b556dba9f4f207b3c2ff019/core/common/validation/msgvalidation.go#L115)<br><strong>Comment</strong>: <pre>undefined</pre><strong>Commenter</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>CommentLine</strong>: [core/common/validation/msgvalidation.go#L115](https://github.com/hyperledger-gerrit-archive/fabric/blob/b44e3900ea29c35f3b556dba9f4f207b3c2ff019/core/common/validation/msgvalidation.go#L115)<br><strong>Comment</strong>: <pre>Interesting idea. I had a few other questions saved as a draft but Yacov answered the one major one regarding whether we're using this technique anywhere else in the Fabric codebase. Perhaps your (Ale's) suggested approach code be proposed as an improvement in 1.2 where we implement it uniformly across the codebase?</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/common/validation/msgvalidation.go#L115](https://github.com/hyperledger-gerrit-archive/fabric/blob/b44e3900ea29c35f3b556dba9f4f207b3c2ff019/core/common/validation/msgvalidation.go#L115)<br><strong>Comment</strong>: <pre>Is this really leaking information?  It was the client who passed in the channel and org info in the first place.  All Will is doing is echoing back that information in a user friendly format, stating that channel is unknown or org is unknown on channel, which is basically the same as access denied, but at least gives the client a hint as to what types of things to troubleshoot, without leaking the fact that a channel exists or not, by not specifying exactly which of the conditions happened.  
If "access denied" is simply returned, the malicious client can look up that message in the source code and determine the same information that Will is providing back. So it seems just returning "access denied" would hurt usability for the entire population of legit users (which have indeed been having issues with this), without making it more secure from malicious users.</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [core/common/validation/msgvalidation.go#L115](https://github.com/hyperledger-gerrit-archive/fabric/blob/b44e3900ea29c35f3b556dba9f4f207b3c2ff019/core/common/validation/msgvalidation.go#L115)<br><strong>Comment</strong>: <pre>I think we should return "access denied" in any case - be it incorrect MSP, incorrect channel name, incorrect signature, etc.

Otherwise an honest but curious client can probe the peer with different combinations of MSP ID and channel name, and if it receives that the signature is invalid - it knows that the combination of the MSP and channel it passed - belong to that peer, meaning - it exists in the blockchain.

For development we don't really need this, since a developer can just look at the peer log and see the real reason.

For production - it makes sense to hide as much information is possible.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/common/validation/msgvalidation.go#L115](https://github.com/hyperledger-gerrit-archive/fabric/blob/b44e3900ea29c35f3b556dba9f4f207b3c2ff019/core/common/validation/msgvalidation.go#L115)<br><strong>Comment</strong>: <pre>undefined</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/common/validation/msgvalidation.go#L115](https://github.com/hyperledger-gerrit-archive/fabric/blob/b44e3900ea29c35f3b556dba9f4f207b3c2ff019/core/common/validation/msgvalidation.go#L115)<br><strong>Comment</strong>: <pre>I agree with Ale's most recent recommendation.</pre><strong>Commenter</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>CommentLine</strong>: [core/common/validation/msgvalidation.go#L115](https://github.com/hyperledger-gerrit-archive/fabric/blob/b44e3900ea29c35f3b556dba9f4f207b3c2ff019/core/common/validation/msgvalidation.go#L115)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>CommentLine</strong>: [core/common/validation/msgvalidation.go#L175](https://github.com/hyperledger-gerrit-archive/fabric/blob/b44e3900ea29c35f3b556dba9f4f207b3c2ff019/core/common/validation/msgvalidation.go#L175)<br><strong>Comment</strong>: <pre>Shall we log the error then?</pre><strong>Commenter</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>CommentLine</strong>: [core/common/validation/msgvalidation.go#L175](https://github.com/hyperledger-gerrit-archive/fabric/blob/b44e3900ea29c35f3b556dba9f4f207b3c2ff019/core/common/validation/msgvalidation.go#L175)<br><strong>Comment</strong>: <pre>I'm not sure we should log it here, but I do agree it should be logged above in ValidateProposalMessage (that calls this function) for all errors and not just the channel-related ones I have it log at the moment. What do you think?</pre><strong>Commenter</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>CommentLine</strong>: [core/common/validation/msgvalidation.go#L183](https://github.com/hyperledger-gerrit-archive/fabric/blob/b44e3900ea29c35f3b556dba9f4f207b3c2ff019/core/common/validation/msgvalidation.go#L183)<br><strong>Comment</strong>: <pre>Same here.</pre><strong>Commenter</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>CommentLine</strong>: [core/common/validation/msgvalidation.go#L183](https://github.com/hyperledger-gerrit-archive/fabric/blob/b44e3900ea29c35f3b556dba9f4f207b3c2ff019/core/common/validation/msgvalidation.go#L183)<br><strong>Comment</strong>: <pre>See comment at line 175.</pre><strong>Commenter</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>CommentLine</strong>: [core/common/validation/msgvalidation.go#L191](https://github.com/hyperledger-gerrit-archive/fabric/blob/b44e3900ea29c35f3b556dba9f4f207b3c2ff019/core/common/validation/msgvalidation.go#L191)<br><strong>Comment</strong>: <pre>same here.</pre><strong>Commenter</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>CommentLine</strong>: [core/common/validation/msgvalidation.go#L191](https://github.com/hyperledger-gerrit-archive/fabric/blob/b44e3900ea29c35f3b556dba9f4f207b3c2ff019/core/common/validation/msgvalidation.go#L191)<br><strong>Comment</strong>: <pre>See comment at line 175.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [msp/mspmgrimpl.go#L56](https://github.com/hyperledger-gerrit-archive/fabric/blob/b44e3900ea29c35f3b556dba9f4f207b3c2ff019/msp/mspmgrimpl.go#L56)<br><strong>Comment</strong>: <pre>Even if there are no MSPs provided, the map is created.</pre><strong>Commenter</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>CommentLine</strong>: [msp/mspmgrimpl.go#L56](https://github.com/hyperledger-gerrit-archive/fabric/blob/b44e3900ea29c35f3b556dba9f4f207b3c2ff019/msp/mspmgrimpl.go#L56)<br><strong>Comment</strong>: <pre>Correct, as long as this Setup() function is called. However, it is possible to call NewMSPManager() for a nonexistent channel without calling Setup(), which is what msp/mgmt/mgmt.go's GetManagerForChain() function does, resulting in the  map not being created.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [msp/mspmgrimpl.go#L56](https://github.com/hyperledger-gerrit-archive/fabric/blob/b44e3900ea29c35f3b556dba9f4f207b3c2ff019/msp/mspmgrimpl.go#L56)<br><strong>Comment</strong>: <pre>I will do my best to not go off on a rant, but the fact that the msp/mgmt/ package exists, and that there is still peer code which depends on it, is a mistake and a problem.  I don't like the idea of adding custom log messages inside of the MSP implementation to address what is fundamentally a deficiency in the msp/mgmt/ package.</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [msp/mspmgrimpl.go#L56](https://github.com/hyperledger-gerrit-archive/fabric/blob/b44e3900ea29c35f3b556dba9f4f207b3c2ff019/msp/mspmgrimpl.go#L56)<br><strong>Comment</strong>: <pre>Jason, please keep the goals of this CR in mind... this CR fixes what is probably the most common misleading/confusing message that new users get, and needs to be scoped to what can be contained today so that it gets improved in 1.1. Will has no prior background in the msp code. What do you propose as the best tactical change so that the message improvement can get merged today?</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [msp/mspmgrimpl.go#L96](https://github.com/hyperledger-gerrit-archive/fabric/blob/b44e3900ea29c35f3b556dba9f4f207b3c2ff019/msp/mspmgrimpl.go#L96)<br><strong>Comment</strong>: <pre>Not sure how the error message is related to the cause. 
Also - doesn't the len(mgr.mspsMap) cover the == nil case?</pre><strong>Commenter</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>CommentLine</strong>: [msp/mspmgrimpl.go#L96](https://github.com/hyperledger-gerrit-archive/fabric/blob/b44e3900ea29c35f3b556dba9f4f207b3c2ff019/msp/mspmgrimpl.go#L96)<br><strong>Comment</strong>: <pre>This was added to allow us to report the exact cause of this and similar MSP errors in the peer log.</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [msp/mspmgrimpl.go#L100](https://github.com/hyperledger-gerrit-archive/fabric/blob/b44e3900ea29c35f3b556dba9f4f207b3c2ff019/msp/mspmgrimpl.go#L100)<br><strong>Comment</strong>: <pre>how is that even possible?</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [msp/mspmgrimpl.go#L100](https://github.com/hyperledger-gerrit-archive/fabric/blob/b44e3900ea29c35f3b556dba9f4f207b3c2ff019/msp/mspmgrimpl.go#L100)<br><strong>Comment</strong>: <pre>I guess maybe it makes sense to move https://gerrit.hyperledger.org/r/#/c/17633/6/msp/mspmgrimpl.go@56

to the NewMSPManager() method and then we can omit this check.</pre><strong>Commenter</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>CommentLine</strong>: [msp/mspmgrimpl.go#L100](https://github.com/hyperledger-gerrit-archive/fabric/blob/b44e3900ea29c35f3b556dba9f4f207b3c2ff019/msp/mspmgrimpl.go#L100)<br><strong>Comment</strong>: <pre>Is that what we want though?  I discussed with Jason Yellick and he mentioned that, at least from the orderer's perspective, there's nothing wrong with a channel with no MSPs defined for it. I know the same isn't true for the peer but I feel like we may as well check for this specific situation.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [msp/mspmgrimpl.go#L100](https://github.com/hyperledger-gerrit-archive/fabric/blob/b44e3900ea29c35f3b556dba9f4f207b3c2ff019/msp/mspmgrimpl.go#L100)<br><strong>Comment</strong>: <pre>This is possible, and, in fact, I strongly encourage any and all code to ensure that it can operate with an empty MSP manager.  But, this check seems redundant.  The map is not nil, and looking up the MSP by ID will return an accurate message that, the MSP is not known by the channel (as there are none).

It's actually tremendously useful to be able to support a channel with no MSPs.  Set your policies to require 0 out of 0 signatures, and you may effectively configure the system to operate entirely without crypto.  It's useless from a production perspective, but from a development and testing perspective, it's very useful.</pre><strong>Commenter</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>CommentLine</strong>: [msp/mspmgrimpl.go#L100](https://github.com/hyperledger-gerrit-archive/fabric/blob/b44e3900ea29c35f3b556dba9f4f207b3c2ff019/msp/mspmgrimpl.go#L100)<br><strong>Comment</strong>: <pre>not sure these checks are</pre></blockquote><h3>PatchSet Number: 7</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Uploader</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Created</strong>: 2/15/2018, 12:56:50 PM<br><strong>UnmergedRevision</strong>: [fe2fde8deb29aa457dce781477f0bc74b28c0694](https://github.com/hyperledger-gerrit-archive/fabric/commit/fe2fde8deb29aa457dce781477f0bc74b28c0694)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/15/2018, 1:22:07 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 8</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Uploader</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Created</strong>: 2/20/2018, 5:48:02 PM<br><strong>UnmergedRevision</strong>: [74a874e384a13b6df9dcecdb5f7b1bea6eeb8947](https://github.com/hyperledger-gerrit-archive/fabric/commit/74a874e384a13b6df9dcecdb5f7b1bea6eeb8947)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/21/2018, 10:04:27 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 9</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Uploader</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Created</strong>: 2/22/2018, 10:13:58 PM<br><strong>GitHubMergedRevision</strong>: [2fee96bed89388adcbcc4d6d6ac718e75ec9ee2f](https://github.com/hyperledger-gerrit-archive/fabric/commit/2fee96bed89388adcbcc4d6d6ac718e75ec9ee2f)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/22/2018, 10:42:41 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Approved</strong>: 2/23/2018, 11:33:12 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Approved</strong>: 2/23/2018, 5:00:50 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Artem Barger<br><strong>Merged</strong>: 2/23/2018, 5:00:54 PM<br><br><h2>Comments</h2><strong>Commenter</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>CommentLine</strong>: [msp/msp_test.go#L403](https://github.com/hyperledger-gerrit-archive/fabric/blob/2fee96bed89388adcbcc4d6d6ac718e75ec9ee2f/msp/msp_test.go#L403)<br><strong>Comment</strong>: <pre>This additional test coverage is now only related in topic to this CR but still adds some robustness to the MSP test cases. I can remove these if desired but I personally see no harm leaving them in here.</pre></blockquote>