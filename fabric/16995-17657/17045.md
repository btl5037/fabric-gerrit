<strong>Project</strong>: fabric<br><strong>Branch</strong>: master<br><strong>ID</strong>: 17045<br><strong>Subject</strong>: [FAB-7715] Handle invalid couchdb index defs<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 1/22/2018, 7:52:34 AM<br><strong>LastUpdated</strong>: 1/24/2018, 3:53:27 PM<br><strong>CommitMessage</strong>:<br><pre>[FAB-7715] Handle invalid couchdb index defs

Invalid CouchDB index definitions may be packaged into chaincode
installation, causing runtime problems when the chaincode is
installed/instantiated.

This change
- Adds metadata validation for golang and node.js chaincode packaging
- Adds index JSON validation for files in META-INF/statedb/couchdb/indexes.
- Ensures no metadata files are packaged from other META-INF directories.

Change-Id: I6dc5f7cbb0ae48edfc29824813bf9f5ccaf17b1c
Signed-off-by: David Enyeart <enyeart@us.ibm.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 1/22/2018, 7:52:34 AM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/22/2018, 7:54:34 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12134/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/22/2018, 7:55:36 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20419/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/22/2018, 7:55:42 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/862/ (3/3)</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 1/22/2018, 7:58:48 AM<br><strong>Message</strong>: <pre>Uploaded patch set 2.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/22/2018, 8:00:42 AM<br><strong>Message</strong>: <pre>Patch Set 1: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12134/ : ABORTED

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12134/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/12134

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20419/ : ABORTED

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20419/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/20419

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/862/ : Build WIP

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/862</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/22/2018, 8:03:23 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12135/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/22/2018, 8:03:25 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20420/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/22/2018, 8:04:38 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/863/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/22/2018, 8:25:33 AM<br><strong>Message</strong>: <pre>Patch Set 2: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20420/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20420/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/20420

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12135/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/12135

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/863/ : Build WIP

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/863</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 1/22/2018, 9:30:10 AM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/22/2018, 9:32:21 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12137/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/22/2018, 9:32:26 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20421/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/22/2018, 9:32:55 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/864/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/22/2018, 9:58:41 AM<br><strong>Message</strong>: <pre>Patch Set 3: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12137/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/12137

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20421/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/20421

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/864/ : Build WIP

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/864</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 1/22/2018, 9:39:28 PM<br><strong>Message</strong>: <pre>Uploaded patch set 4.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/22/2018, 9:41:21 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12144/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/22/2018, 9:41:44 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20428/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/22/2018, 9:45:23 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/871/ (3/3)</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 1/22/2018, 9:51:01 PM<br><strong>Message</strong>: <pre>Uploaded patch set 5.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/22/2018, 9:51:37 PM<br><strong>Message</strong>: <pre>Patch Set 4: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12144/ : ABORTED

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12144/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/12144

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20428/ : ABORTED

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20428/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/20428

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/871/ : Build WIP

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/871</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/22/2018, 9:52:50 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12145/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/22/2018, 9:54:00 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/872/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/22/2018, 9:54:00 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20429/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/22/2018, 10:08:22 PM<br><strong>Message</strong>: <pre>Patch Set 5: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20429/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20429/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/20429

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12145/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/12145

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/872/ : Build WIP

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/872</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 1/22/2018, 10:33:43 PM<br><strong>Message</strong>: <pre>Patch Set 5:

rebuild-x</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/22/2018, 10:36:16 PM<br><strong>Message</strong>: <pre>Patch Set 5: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20431/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/22/2018, 10:49:36 PM<br><strong>Message</strong>: <pre>Patch Set 5: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20431/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20431/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/20431</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 1/22/2018, 10:58:29 PM<br><strong>Message</strong>: <pre>Patch Set 5:

rebuild-x</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/22/2018, 11:02:07 PM<br><strong>Message</strong>: <pre>Patch Set 5: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20433/</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 1/22/2018, 11:11:35 PM<br><strong>Message</strong>: <pre>Patch Set 5:

(2 comments)

Not sure if core/chaincode/metadata would be a good pkgname for this because most of the pkgs directly under core/chaincode maintain more of the runtime state of chaincodes. This metadata is likely to be seen in that light. If there is no other place, better to name this packagemetadata?</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/22/2018, 11:24:13 PM<br><strong>Message</strong>: <pre>Patch Set 5: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20433/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/20433</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 1/22/2018, 11:41:45 PM<br><strong>Message</strong>: <pre>Uploaded patch set 6.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/22/2018, 11:43:25 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12148/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/22/2018, 11:44:18 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20434/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/22/2018, 11:44:28 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/875/ (3/3)</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 1/22/2018, 11:48:27 PM<br><strong>Message</strong>: <pre>Patch Set 6:

(2 comments)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/23/2018, 12:09:52 AM<br><strong>Message</strong>: <pre>Patch Set 6: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12148/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/12148

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20434/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/20434

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/875/ : Build WIP

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/875</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 1/23/2018, 8:10:50 AM<br><strong>Message</strong>: <pre>Uploaded patch set 7.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/23/2018, 8:12:53 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12149/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/23/2018, 8:13:52 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20435/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/23/2018, 8:14:06 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/876/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/23/2018, 8:44:34 AM<br><strong>Message</strong>: <pre>Patch Set 7: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12149/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/12149

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20435/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/20435

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/876/ : Build SMOKE

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/876</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 1/23/2018, 9:55:30 AM<br><strong>Message</strong>: <pre>Patch Set 7: Code-Review+2

(2 comments)</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 1/23/2018, 9:55:56 AM<br><strong>Message</strong>: <pre>Patch Set 7:

LGTM except a couple of minor comments.</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 1/23/2018, 10:58:08 AM<br><strong>Message</strong>: <pre>Patch Set 7:

(2 comments)</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 1/23/2018, 10:58:40 AM<br><strong>Message</strong>: <pre>Uploaded patch set 8.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/23/2018, 11:00:56 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12154/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/23/2018, 11:01:14 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20440/ (2/3)</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 1/23/2018, 11:01:36 AM<br><strong>Message</strong>: <pre>Patch Set 8: Code-Review+2</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/23/2018, 11:02:38 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/881/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/23/2018, 11:41:16 AM<br><strong>Message</strong>: <pre>Patch Set 8: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12154/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/12154

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20440/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/20440

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/881/ : Build SMOKE

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/881</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 1/23/2018, 1:27:48 PM<br><strong>Message</strong>: <pre>Patch Set 8: Code-Review-1

(4 comments)</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 1/23/2018, 4:58:55 PM<br><strong>Message</strong>: <pre>Patch Set 8:

(1 comment)</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 1/23/2018, 7:59:40 PM<br><strong>Message</strong>: <pre>Patch Set 8:

(1 comment)</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 1/23/2018, 9:55:30 PM<br><strong>Message</strong>: <pre>Patch Set 8:

(3 comments)</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 1/23/2018, 9:59:10 PM<br><strong>Message</strong>: <pre>Patch Set 8:

(1 comment)</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 1/23/2018, 10:36:56 PM<br><strong>Message</strong>: <pre>Patch Set 8:

(1 comment)</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 1/24/2018, 1:15:49 AM<br><strong>Message</strong>: <pre>Patch Set 8:

(1 comment)</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 1/24/2018, 8:45:47 AM<br><strong>Message</strong>: <pre>Patch Set 8:

(1 comment)</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 1/24/2018, 9:01:00 AM<br><strong>Message</strong>: <pre>Uploaded patch set 9.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/24/2018, 9:03:26 AM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12169/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/24/2018, 9:03:27 AM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20457/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/24/2018, 9:04:58 AM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/896/ (3/3)</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 1/24/2018, 9:21:51 AM<br><strong>Message</strong>: <pre>Patch Set 9:

(4 comments)</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 1/24/2018, 9:48:11 AM<br><strong>Message</strong>: <pre>Patch Set 8:

(1 comment)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/24/2018, 10:03:44 AM<br><strong>Message</strong>: <pre>Patch Set 9: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20457/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20457/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/20457

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/896/ : FAILURE (skipped)

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/896/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/896

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12169/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/12169</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 1/24/2018, 10:25:41 AM<br><strong>Message</strong>: <pre>Patch Set 9:

rebuild-x</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/24/2018, 10:30:54 AM<br><strong>Message</strong>: <pre>Patch Set 9: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20461/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/24/2018, 11:11:52 AM<br><strong>Message</strong>: <pre>Patch Set 9: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20461/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/20461</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 1/24/2018, 12:29:55 PM<br><strong>Message</strong>: <pre>Patch Set 9:

(2 comments)</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 1/24/2018, 12:40:55 PM<br><strong>Message</strong>: <pre>Patch Set 9:

(2 comments)</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 1/24/2018, 12:46:36 PM<br><strong>Message</strong>: <pre>Patch Set 9: Code-Review+2</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 1/24/2018, 1:42:59 PM<br><strong>Message</strong>: <pre>Patch Set 9:

(2 comments)</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 1/24/2018, 1:51:17 PM<br><strong>Message</strong>: <pre>Patch Set 9:

(1 comment)</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 1/24/2018, 1:58:45 PM<br><strong>Message</strong>: <pre>Patch Set 9:

(1 comment)</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 1/24/2018, 2:27:30 PM<br><strong>Message</strong>: <pre>Patch Set 9:

(1 comment)</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 1/24/2018, 2:47:04 PM<br><strong>Message</strong>: <pre>Patch Set 9:

(2 comments)</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 1/24/2018, 3:12:32 PM<br><strong>Message</strong>: <pre>Patch Set 9:

(2 comments)</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 1/24/2018, 3:26:17 PM<br><strong>Message</strong>: <pre>Patch Set 9: Code-Review+2

Thanks for the clarification Dave, there was definitely a fundamental misunderstanding on the code flow here on my part.  As this is all on the packaging side (none on the processing side) it makes much more sense.</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 1/24/2018, 3:26:21 PM<br><strong>Message</strong>: <pre>Change has been successfully merged by Jason Yellick</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/24/2018, 3:53:27 PM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-merge-x86_64/3098/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-merge-x86_64/3098/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-x86_64/3098

https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/1771/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-end-2-end-x86_64/1771</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Uploader</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Created</strong>: 1/22/2018, 7:52:34 AM<br><strong>UnmergedRevision</strong>: [9ddc46ac8281967c034cc4abd3f6f04ac3bd7e8d](https://github.com/hyperledger-gerrit-archive/fabric/commit/9ddc46ac8281967c034cc4abd3f6f04ac3bd7e8d)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/22/2018, 8:00:42 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Uploader</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Created</strong>: 1/22/2018, 7:58:48 AM<br><strong>UnmergedRevision</strong>: [658bf77e9a7050cffd2cfbe19e77c060e0381394](https://github.com/hyperledger-gerrit-archive/fabric/commit/658bf77e9a7050cffd2cfbe19e77c060e0381394)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/22/2018, 8:25:33 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Uploader</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Created</strong>: 1/22/2018, 9:30:10 AM<br><strong>UnmergedRevision</strong>: [b4483d933b85649493b61fe3068ebecd8ef6138a](https://github.com/hyperledger-gerrit-archive/fabric/commit/b4483d933b85649493b61fe3068ebecd8ef6138a)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/22/2018, 9:58:41 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Uploader</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Created</strong>: 1/22/2018, 9:39:28 PM<br><strong>UnmergedRevision</strong>: [8130dff851eecc08f7404efd19564f0d30f890d0](https://github.com/hyperledger-gerrit-archive/fabric/commit/8130dff851eecc08f7404efd19564f0d30f890d0)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/22/2018, 9:51:37 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 5</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Uploader</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Created</strong>: 1/22/2018, 9:51:01 PM<br><strong>UnmergedRevision</strong>: [9c8ebef25300fc9192d09580625ba899e702815d](https://github.com/hyperledger-gerrit-archive/fabric/commit/9c8ebef25300fc9192d09580625ba899e702815d)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/22/2018, 11:24:13 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/metadata/ccmetadata.go#L1](https://github.com/hyperledger-gerrit-archive/fabric/blob/9c8ebef25300fc9192d09580625ba899e702815d/core/chaincode/metadata/ccmetadata.go#L1)<br><strong>Comment</strong>: <pre>validators.go would be a more meaningful name for this file.</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/metadata/ccmetadata.go#L1](https://github.com/hyperledger-gerrit-archive/fabric/blob/9c8ebef25300fc9192d09580625ba899e702815d/core/chaincode/metadata/ccmetadata.go#L1)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/metadata/ccmetadata.go#L49](https://github.com/hyperledger-gerrit-archive/fabric/blob/9c8ebef25300fc9192d09580625ba899e702815d/core/chaincode/metadata/ccmetadata.go#L49)<br><strong>Comment</strong>: <pre>can we call this metadataType and let the caller pass the exact type (such as META-INF/statedb/couchdb/indexes) instead of inherent assumption that the caller will pass a path and we derive type from that.</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/metadata/ccmetadata.go#L49](https://github.com/hyperledger-gerrit-archive/fabric/blob/9c8ebef25300fc9192d09580625ba899e702815d/core/chaincode/metadata/ccmetadata.go#L49)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 6</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Uploader</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Created</strong>: 1/22/2018, 11:41:45 PM<br><strong>UnmergedRevision</strong>: [574465e2f89c7d51eb8a3ac839fc409c9926e1ad](https://github.com/hyperledger-gerrit-archive/fabric/commit/574465e2f89c7d51eb8a3ac839fc409c9926e1ad)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/23/2018, 12:09:52 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 7</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Uploader</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Created</strong>: 1/23/2018, 8:10:50 AM<br><strong>UnmergedRevision</strong>: [6378c8d2226a96c954e7525437099da4b98c2dac](https://github.com/hyperledger-gerrit-archive/fabric/commit/6378c8d2226a96c954e7525437099da4b98c2dac)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/23/2018, 8:44:34 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Approved</strong>: 1/23/2018, 9:55:30 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/common/ccprovider/metadata/validators.go#L60](https://github.com/hyperledger-gerrit-archive/fabric/blob/6378c8d2226a96c954e7525437099da4b98c2dac/core/common/ccprovider/metadata/validators.go#L60)<br><strong>Comment</strong>: <pre>move last %s here as '[%s]'?</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/common/ccprovider/metadata/validators.go#L60](https://github.com/hyperledger-gerrit-archive/fabric/blob/6378c8d2226a96c954e7525437099da4b98c2dac/core/common/ccprovider/metadata/validators.go#L60)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/common/ccprovider/metadata/validators_test.go#L79](https://github.com/hyperledger-gerrit-archive/fabric/blob/6378c8d2226a96c954e7525437099da4b98c2dac/core/common/ccprovider/metadata/validators_test.go#L79)<br><strong>Comment</strong>: <pre>does this test add any value over the previous one?</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/common/ccprovider/metadata/validators_test.go#L79](https://github.com/hyperledger-gerrit-archive/fabric/blob/6378c8d2226a96c954e7525437099da4b98c2dac/core/common/ccprovider/metadata/validators_test.go#L79)<br><strong>Comment</strong>: <pre>It tests for metadata type not in the format of "META-INF/*".  But you are right, it has marginal value as no new code path is hit.</pre></blockquote><h3>PatchSet Number: 8</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Uploader</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Created</strong>: 1/23/2018, 10:58:40 AM<br><strong>UnmergedRevision</strong>: [f1677f320d438fbe7c13b6cde9192e70256f5ba7](https://github.com/hyperledger-gerrit-archive/fabric/commit/f1677f320d438fbe7c13b6cde9192e70256f5ba7)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/23/2018, 11:41:16 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Approved</strong>: 1/23/2018, 1:27:48 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Approved</strong>: 1/23/2018, 11:01:36 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/platforms/golang/platform.go#L447](https://github.com/hyperledger-gerrit-archive/fabric/blob/f1677f320d438fbe7c13b6cde9192e70256f5ba7/core/chaincode/platforms/golang/platform.go#L447)<br><strong>Comment</strong>: <pre>I think it's the wrong approach to statically reference this here.  The Platform struct should store a reference to an interface which does validation.  Then, when the Platform is constructed, it should be constructed with an instance of the implementation.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/platforms/golang/platform.go#L447](https://github.com/hyperledger-gerrit-archive/fabric/blob/f1677f320d438fbe7c13b6cde9192e70256f5ba7/core/chaincode/platforms/golang/platform.go#L447)<br><strong>Comment</strong>: <pre>Jason, as this validation is not stateful at all, what is the motivation for a separate instance?</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/platforms/golang/platform.go#L447](https://github.com/hyperledger-gerrit-archive/fabric/blob/f1677f320d438fbe7c13b6cde9192e70256f5ba7/core/chaincode/platforms/golang/platform.go#L447)<br><strong>Comment</strong>: <pre>In general, any time I see a source level coupling it raises a red flag to me.

In this case, this code path becomes effectively impossible to test without reaching into the implementation of ValidateMetadataFile and forcing it to fail.

Implemented as an interface, a simple mock structure can be used to exercise the logic of this code, without any knowledge of the underlying implementation.

In this particular case, since this function is a receiver for a pointer to a struct, breaking the dependency seems like it would be relatively easy.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/platforms/golang/platform.go#L447](https://github.com/hyperledger-gerrit-archive/fabric/blob/f1677f320d438fbe7c13b6cde9192e70256f5ba7/core/chaincode/platforms/golang/platform.go#L447)<br><strong>Comment</strong>: <pre>Jason, in my opinion, this takes the mocking and mock based testing to that extreme where it starts creating more overheads than adding value. For instance, in the vary same function golang's functions are also being called (e.g., `string.HasPrefix`, `filePath.Rel`)... would you ever suggest mocking them or is there a fundamental difference between this function call and such as filepath.Rel that I am missing?</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/platforms/golang/platform.go#L447](https://github.com/hyperledger-gerrit-archive/fabric/blob/f1677f320d438fbe7c13b6cde9192e70256f5ba7/core/chaincode/platforms/golang/platform.go#L447)<br><strong>Comment</strong>: <pre>I would point out, that this file is changed, but there are no accompanying tests for this change.  And, I suspect the simple answer is, that the conventions and patterns we are following make writing unit tests difficult to the point that they are not worth doing.

I would challenge you to quickly write test for this method which covers these new lines of code.  Doing a quick check running the tests in this package with coverprofile enabled shows that none of the metadata error conditions are covered.  In fact, the code coverage seems to derive almost entirely from known-good test data.  I'll be the first to agree that code coverage isn't a terribly good metric for code quality, but I do think one our goals should be to write testable code.

> For instance, in the vary same function golang's functions are also being called (e.g., `string.HasPrefix`, `filePath.Rel`)... would you ever suggest mocking them or is there a fundamental difference between this function call and such as filepath.Rel that I am missing?

Obviously there is some point where functions are simple enough and stable enough, that indirection and mocking is counterproductive.  However, since you asked for a difference, I would point out that `string.HasPrefix` has a fixed contract which cannot ever change.  If we update to go 1.10, there is no chance that that update will break our test because the same input produces a different output.  On the other hand, ccmetadata.ValidateMetadataFile is deliberately open ended.  This CR is structured explicitly to allow new metadata types to be added in the future, and so a change in ccmetadata.ValidateMetadataFile may end up breaking this test, which clearly violates principles of encapsulation.

With all that being said, this is hardly a new pattern for this file.  My initial reaction was that this CR was injecting a new un-mockable and therefore difficult to test dependency into this package, which also looked fairly simple do decouple, which led to my original comment.  Maybe this is fine, as it is in code which is already generally difficult to mock, but it seems like we may be saying "it's already that way" as a way to excuse questionable code patterns a little too often.</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/platforms/golang/platform.go#L447](https://github.com/hyperledger-gerrit-archive/fabric/blob/f1677f320d438fbe7c13b6cde9192e70256f5ba7/core/chaincode/platforms/golang/platform.go#L447)<br><strong>Comment</strong>: <pre>I looked into making this an interface and mocking out the implementation for the unit tests.  But this would have been confusing, as the rest of the file uses static functions and integration tests of the real implementations rather than the mocking approach.  In this case, I think it is better to follow the precedent than have a mix of styles in the same file.  I've extended the integration tests to cover the new scenarios.  This ensures full coverage, and has the benefit of testing the real implementations rather than testing mock implementations.

The larger question of whether we should follow a pure unit test approach or a combination of unit test and integration test (where it makes sense) to get coverage, is better taken up outside an individual CR that is adding incremental improvements.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/platforms/golang/platform.go#L447](https://github.com/hyperledger-gerrit-archive/fabric/blob/f1677f320d438fbe7c13b6cde9192e70256f5ba7/core/chaincode/platforms/golang/platform.go#L447)<br><strong>Comment</strong>: <pre>I agree with testability part and in this case as far testing the error path from this function is concerned, this function should be considered vary stable to throw error on the input of 'META-INF/SomeJunkFolder'. All we want here is two guaranteed inputs one that cause this function to return an error and one that doesn't. 

My concern with mocking as a general rule of thumb is that we end up having too much of interfaces with a single real implementation at the back.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/platforms/golang/platform.go#L447](https://github.com/hyperledger-gerrit-archive/fabric/blob/f1677f320d438fbe7c13b6cde9192e70256f5ba7/core/chaincode/platforms/golang/platform.go#L447)<br><strong>Comment</strong>: <pre>> I agree with testability part and in this case as far testing the error path from this function is concerned, this function should be considered vary stable to throw error on the input of 'META-INF/SomeJunkFolder'. All we want here is two guaranteed inputs one that cause this function to return an error and one that doesn't. 

But this is not what the function contract lays out.  According to the godoc:

 // ValidateMetadataFile checks that metadata files are valid
 // according to the validation rules of the metadata directory (metadataType)

To me, this is obviously a candidate for abstraction behind an interface because the rules are opaque to the caller.  You can argue that no one will ever add a new metadata type named "SomeJunkFolder", but there's nothing in the function description which would lead me to believe that this folder name is somehow invalid if someone where so included to add it as a metadata type.

> My concern with mocking as a general rule of thumb is that we end up having too much of interfaces with a single real implementation at the back.

Of course, this is how mocking interfaces works.  You usually have one, complex implementation hidden behind an interface which defines a contract for that implementation.  Code leveraging that interface makes sure that their behavior and tests only depend upon the contract as defined by the interface.

If the function being hidden behind the interface is too simple and the mocking seems pointless, then perhaps it's time to examine the code structure and see if more complexity from the caller couldn't be pushed into the interface.  In the case of this chaincode package processing code, I'm sure that the metadata parsing is not the only commonality it shares with the code which creates the package, so perhaps the interface should do more general processing than just handling metadata only.  

To me, this is much less about the ability to write mocked tests and much more about the fact that it forces you to write modular code.  If it's easy to mock your tests, then this is a good indication that your code does not depend upon undocumented side effects of the underlying implementation.  Most importantly, it means that the underlying implementation may be modified, or swapped out, without worrying about components which depend upon it breaking.

I have said it before in other CRs, and the issue is outside the scope of this one as well, but much of the code in peer is entirely untestable outside of integration tests.  IMO, we need to stop writing so much procedural, source level coupled code and bring true encapsulation into our packages.  As we introduce more and more un-mockable, un-unit-testable code, we are only digging the hole deeper with our technical debt and maintenance burden.

But, like in other CRs, I suppose there is no option but to ignore it in the interest of locking v1.1.0 down.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/platforms/golang/platform.go#L453](https://github.com/hyperledger-gerrit-archive/fabric/blob/f1677f320d438fbe7c13b6cde9192e70256f5ba7/core/chaincode/platforms/golang/platform.go#L453)<br><strong>Comment</strong>: <pre>Why wouldn't this be fatal? If we do not understand the chaincode package, I don't see why we should install it?</pre><strong>Commenter</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/platforms/golang/platform.go#L453](https://github.com/hyperledger-gerrit-archive/fabric/blob/f1677f320d438fbe7c13b6cde9192e70256f5ba7/core/chaincode/platforms/golang/platform.go#L453)<br><strong>Comment</strong>: <pre>I can see this.... though the dir is not included in the chaincode, it is still in the package and the signature computed from it. Though harmless,  can't think of a good reason to ignore this as opposed to returning an error.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/platforms/golang/platform.go#L453](https://github.com/hyperledger-gerrit-archive/fabric/blob/f1677f320d438fbe7c13b6cde9192e70256f5ba7/core/chaincode/platforms/golang/platform.go#L453)<br><strong>Comment</strong>: <pre>Since we do not know what other types of metadata there might be, it seems like we cannot conclusively say whether ignoring some of it might affect the behavior of a chaincode?

For instance, if the couchdb indices are not present, there may be calls in the chaincode which fail?  Since indices are generally used in queries and not invocations, this is probably safe, but I'm not quite willing to conclude it is entirely harmless.</pre><strong>Commenter</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/platforms/golang/platform.go#L453](https://github.com/hyperledger-gerrit-archive/fabric/blob/f1677f320d438fbe7c13b6cde9192e70256f5ba7/core/chaincode/platforms/golang/platform.go#L453)<br><strong>Comment</strong>: <pre>To be clear, I meant harmless to mean that this directory is skipped and wont find its way into the chaincode and cause other damage. Its just sitting in the package.</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/platforms/golang/platform.go#L453](https://github.com/hyperledger-gerrit-archive/fabric/blob/f1677f320d438fbe7c13b6cde9192e70256f5ba7/core/chaincode/platforms/golang/platform.go#L453)<br><strong>Comment</strong>: <pre>Agreed, I've updated the code to error out if metadata is found at an unexpected location under META-INF, and added tests for this scenario.

I still think hidden files that get picked up from user's META-INF directory should be ignored with a warning.  The user often doesn't know these hidden files exist in their META-INF directory, and they may not be able to delete them (e.g. the unwelcome and hidden .DS_Store file on mac that often appears), therefore I think warning the user of their existence is the best option.  I've added test for this scenario as well.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/common/ccprovider/metadata/validators.go#L48](https://github.com/hyperledger-gerrit-archive/fabric/blob/f1677f320d438fbe7c13b6cde9192e70256f5ba7/core/common/ccprovider/metadata/validators.go#L48)<br><strong>Comment</strong>: <pre>As noted in the other file, I see no reason this should be a static function.  Let's define an interface instead?</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/common/ccprovider/metadata/validators.go#L48](https://github.com/hyperledger-gerrit-archive/fabric/blob/f1677f320d438fbe7c13b6cde9192e70256f5ba7/core/common/ccprovider/metadata/validators.go#L48)<br><strong>Comment</strong>: <pre>I looked into making this an interface and mocking out the implementation for the unit tests.  But this would have been confusing, as the rest of the file uses static functions and integration tests of the real implementations rather than the mocking approach.  In this case, I think it is better to follow the precedent than have a mix of styles in the same file.  I've extended the integration tests to cover the new scenarios.  This ensures full coverage, and has the benefit of testing the real implementations rather than testing mock implementations.

The larger question of whether we should follow a pure unit test approach or a combination of unit test and integration test (where it makes sense) to get coverage, is better taken up outside an individual CR that is adding incremental improvements.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/container/util/writer.go#L103](https://github.com/hyperledger-gerrit-archive/fabric/blob/f1677f320d438fbe7c13b6cde9192e70256f5ba7/core/container/util/writer.go#L103)<br><strong>Comment</strong>: <pre>Why would we not want this to be a fatal error? Seems like if the package structure is wrong, we should fail?</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/container/util/writer.go#L103](https://github.com/hyperledger-gerrit-archive/fabric/blob/f1677f320d438fbe7c13b6cde9192e70256f5ba7/core/container/util/writer.go#L103)<br><strong>Comment</strong>: <pre>And, on second glance, why are we returning nil here? The chaincode package was not written, but we are not returning a failure?</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/container/util/writer.go#L103](https://github.com/hyperledger-gerrit-archive/fabric/blob/f1677f320d438fbe7c13b6cde9192e70256f5ba7/core/container/util/writer.go#L103)<br><strong>Comment</strong>: <pre>My mistake, I see now why it returns nil even though nothing is written.  My original question about this error being non-fatal stands though.</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/container/util/writer.go#L103](https://github.com/hyperledger-gerrit-archive/fabric/blob/f1677f320d438fbe7c13b6cde9192e70256f5ba7/core/container/util/writer.go#L103)<br><strong>Comment</strong>: <pre>Agreed, I've updated the code to error out if metadata is found at an unexpected location under META-INF, and added tests for this scenario.

I still think hidden files that get picked up from user's META-INF directory should be ignored with a warning.  The user often doesn't know these hidden files exist in their META-INF directory, and they may not be able to delete them (e.g. the unwelcome and hidden .DS_Store file on mac that often appears), therefore I think warning the user of their existence is the best option.  I've added test for this scenario as well.</pre></blockquote><h3>PatchSet Number: 9</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Uploader</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Created</strong>: 1/24/2018, 9:01:00 AM<br><strong>GitHubMergedRevision</strong>: [bb2bd7de22c80a61ba0ef66b89a42587991c9e94](https://github.com/hyperledger-gerrit-archive/fabric/commit/bb2bd7de22c80a61ba0ef66b89a42587991c9e94)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/24/2018, 11:11:52 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Approved</strong>: 1/24/2018, 3:26:17 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Jason Yellick<br><strong>Merged</strong>: 1/24/2018, 3:26:21 PM<br><br><strong>Approver</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Approved</strong>: 1/24/2018, 12:46:36 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/platforms/golang/platform.go#L453](https://github.com/hyperledger-gerrit-archive/fabric/blob/bb2bd7de22c80a61ba0ef66b89a42587991c9e94/core/chaincode/platforms/golang/platform.go#L453)<br><strong>Comment</strong>: <pre>I think that this code should be moved outside this function and should belong to the other file that prepares fileMap at line 363. Because, this won;t be a consistent behavior if someone finds the hidden files in the source code but gone from the META-INF folder.</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/platforms/golang/platform.go#L453](https://github.com/hyperledger-gerrit-archive/fabric/blob/bb2bd7de22c80a61ba0ef66b89a42587991c9e94/core/chaincode/platforms/golang/platform.go#L453)<br><strong>Comment</strong>: <pre>The go packaging does have pre-processing of all the files.  But that code appears quite brittle, therefore I didn't want to change anything there that applies to all files.  The hidden files are not causing a problem for the go source packaging.  The hidden files are only causing a problem for the metadata directories , therefore I have scoped the hidden file ignoring to metadata files only here.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/platforms/golang/platform.go#L453](https://github.com/hyperledger-gerrit-archive/fabric/blob/bb2bd7de22c80a61ba0ef66b89a42587991c9e94/core/chaincode/platforms/golang/platform.go#L453)<br><strong>Comment</strong>: <pre>As a link to the other comment, if the packaging should never include packages with dot files in the metadata, then why do we skip them here? I would expect this to simply be an error?</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/platforms/golang/platform.go#L453](https://github.com/hyperledger-gerrit-archive/fabric/blob/bb2bd7de22c80a61ba0ef66b89a42587991c9e94/core/chaincode/platforms/golang/platform.go#L453)<br><strong>Comment</strong>: <pre>This is the golang chaincode packaging.  The other file that we are commenting on is for node js chaincode packaging.

They both have identical metadata handling.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/container/util/writer.go#L103](https://github.com/hyperledger-gerrit-archive/fabric/blob/bb2bd7de22c80a61ba0ef66b89a42587991c9e94/core/container/util/writer.go#L103)<br><strong>Comment</strong>: <pre>same as in other file.</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/container/util/writer.go#L103](https://github.com/hyperledger-gerrit-archive/fabric/blob/bb2bd7de22c80a61ba0ef66b89a42587991c9e94/core/container/util/writer.go#L103)<br><strong>Comment</strong>: <pre>same response.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/container/util/writer.go#L103](https://github.com/hyperledger-gerrit-archive/fabric/blob/bb2bd7de22c80a61ba0ef66b89a42587991c9e94/core/container/util/writer.go#L103)<br><strong>Comment</strong>: <pre>We're working with two halves of the problem in this CR, right?

1. How to package up ccmetadata into a chaincode package
2. How to validate packaged ccmetadata

My first instinct would have been to:

1. During packaging, strip out anything which should be excluded, like dot files in this case.  Which I believe this portion does.
2. During package validation, error if there is unexpected garbage, like the dot files.

But it seems like instead, we are doing both filtering on packaging, and on validation.  Why would we do both?</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/container/util/writer.go#L103](https://github.com/hyperledger-gerrit-archive/fabric/blob/bb2bd7de22c80a61ba0ef66b89a42587991c9e94/core/container/util/writer.go#L103)<br><strong>Comment</strong>: <pre>I guess I am not following.  We are doing filtering of files only above, and validation of the filtered files within ValidateMetadataFiles().</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/container/util/writer.go#L103](https://github.com/hyperledger-gerrit-archive/fabric/blob/bb2bd7de22c80a61ba0ef66b89a42587991c9e94/core/container/util/writer.go#L103)<br><strong>Comment</strong>: <pre>Maybe I am misunderstanding the flow:

1. Is it possible that the code which produces the chaincode package includes these dot files in the metadata dir?
2. If there are dot files in the metadata dir when a chaincode package is parsed, will they be ignored?</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/container/util/writer.go#L103](https://github.com/hyperledger-gerrit-archive/fabric/blob/bb2bd7de22c80a61ba0ef66b89a42587991c9e94/core/container/util/writer.go#L103)<br><strong>Comment</strong>: <pre>This is the code that produces the chaincode package, hence the chaincode package will always have these hidden files stripped out of META_INF directory.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/container/util/writer.go#L103](https://github.com/hyperledger-gerrit-archive/fabric/blob/bb2bd7de22c80a61ba0ef66b89a42587991c9e94/core/container/util/writer.go#L103)<br><strong>Comment</strong>: <pre>But there is also code when consuming the package which skips the dot files as well?  It seems like there should be no need to do so if they should not be present in the package?</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/container/util/writer.go#L103](https://github.com/hyperledger-gerrit-archive/fabric/blob/bb2bd7de22c80a61ba0ef66b89a42587991c9e94/core/container/util/writer.go#L103)<br><strong>Comment</strong>: <pre>This code is for node.js chaincode packaging.  The other file is for go chaincode packaging (this is not intuitive, and therefore I added a comment at the top of this function to indicate as such).  Both files have identical metadata handling.

The code that consumes the package tar at runtime to create the statedb tar is:
https://github.com/hyperledger/fabric/blob/master/core/common/ccprovider/cc_statedb_artifacts_provider.go#L54-L79

It does not do any additional metadata filtering/validation.  It expects that filtering/validation has been done upon packaging here.

Then the statedb tar is consumed and indexes are created here:
https://github.com/hyperledger/fabric/blob/master/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L93-L132

Again, it does not do any additional metadata filtering/validation.  It expects that filtering/validation has been done upon packaging here.

We prefer to do this filtering(code above)/validation(code below) only once here at packaging time, so that we can give feedback to the administrator who is doing the packaging.</pre></blockquote>