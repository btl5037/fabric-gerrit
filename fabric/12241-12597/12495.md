<strong>Project</strong>: fabric<br><strong>Branch</strong>: release<br><strong>ID</strong>: 12495<br><strong>Subject</strong>: [FAB-5793] Block deliver if payload buffer is too full<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 8/15/2017, 3:37:08 PM<br><strong>LastUpdated</strong>: 8/28/2017, 4:19:16 PM<br><strong>CommitMessage</strong>:<br><pre>[FAB-5793] Block deliver if payload buffer is too full

This commit tunes the state AddPayload to have the following
effect:

- If the block is received from gossip,
  and the ledger height is too low in comparison to the block's
  sequence - it is discarded (like previously - no change).
  The delta that triggers the discard is set to 100 blocks.
- If the block is received from the orderer, and the payload
  buffer is too full (over 200 blocks) - the operation is
  blocked until it isn't full.

Change-Id: Ieedbc728e0ec25031c5a09cf55071ae11061f5b8
Signed-off-by: yacovm <yacovm@il.ibm.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 8/15/2017, 3:37:08 PM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/15/2017, 3:37:55 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/11326/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/15/2017, 3:38:39 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/15696/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/15/2017, 3:39:25 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7225/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/15/2017, 3:39:25 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/9713/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/15/2017, 4:45:29 PM<br><strong>Message</strong>: <pre>Patch Set 1: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-z/11326/ : FAILURE

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/11326

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/15696/ : FAILURE

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/15696

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7225/ : FAILURE

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/7225

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/9713/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/9713</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 8/15/2017, 4:53:38 PM<br><strong>Message</strong>: <pre>Uploaded patch set 2.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/15/2017, 4:53:45 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/11328/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/15/2017, 4:54:28 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/15698/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/15/2017, 4:54:59 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/9715/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/15/2017, 4:55:30 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7227/ (4/4)</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 8/15/2017, 5:04:59 PM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/15/2017, 5:05:06 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/11329/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/15/2017, 5:05:56 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/15699/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/15/2017, 5:06:18 PM<br><strong>Message</strong>: <pre>Patch Set 2: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-z/11328/ : ABORTED

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/11328

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7227/ : ABORTED

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/7227

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/15698/ : FAILURE

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/15698

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/9715/ : FAILURE

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/9715</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/15/2017, 5:06:26 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/9716/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/15/2017, 5:06:33 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7228/ (4/4)</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 8/15/2017, 5:07:56 PM<br><strong>Message</strong>: <pre>Uploaded patch set 4.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/15/2017, 5:08:13 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/9717/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/15/2017, 5:08:14 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/15700/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/15/2017, 5:08:14 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/11330/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/15/2017, 5:09:11 PM<br><strong>Message</strong>: <pre>Patch Set 3: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/15699/ : ABORTED

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/15699

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/9716/ : ABORTED

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/9716

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7228/ : ABORTED

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/7228

https://jenkins.hyperledger.org/job/fabric-verify-z/11329/ : FAILURE

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/11329</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/15/2017, 5:11:48 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7229/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/15/2017, 6:13:33 PM<br><strong>Message</strong>: <pre>Patch Set 4: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-z/11330/ : FAILURE

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/11330

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/15700/ : FAILURE

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/15700

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/9717/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/9717

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7229/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/7229</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 8/15/2017, 6:21:33 PM<br><strong>Message</strong>: <pre>Uploaded patch set 5.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/15/2017, 6:21:41 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/11335/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/15/2017, 6:22:49 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/15705/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/15/2017, 6:23:15 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/9722/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/15/2017, 6:23:50 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7234/ (4/4)</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 8/15/2017, 6:40:11 PM<br><strong>Message</strong>: <pre>Uploaded patch set 6.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/15/2017, 6:40:21 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/11336/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/15/2017, 6:41:14 PM<br><strong>Message</strong>: <pre>Patch Set 5: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-z/11335/ : ABORTED

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/11335

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/15705/ : ABORTED

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/15705

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7234/ : ABORTED

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/7234

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/9722/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/9722</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/15/2017, 6:41:45 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/15706/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/15/2017, 6:42:15 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/9723/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/15/2017, 6:42:45 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7235/ (4/4)</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 8/15/2017, 6:45:28 PM<br><strong>Message</strong>: <pre>Uploaded patch set 7: Commit message was updated.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/15/2017, 6:45:37 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/11337/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/15/2017, 6:46:24 PM<br><strong>Message</strong>: <pre>Patch Set 6: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-z/11336/ : FAILURE

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/11336

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/15706/ : FAILURE

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/15706

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/9723/ : FAILURE

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/9723

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7235/ : FAILURE

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/7235</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/15/2017, 6:46:36 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/15707/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/15/2017, 6:46:48 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/9724/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/15/2017, 6:47:22 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7236/ (4/4)</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 8/15/2017, 7:16:21 PM<br><strong>Message</strong>: <pre>Uploaded patch set 8.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/15/2017, 7:16:27 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/11340/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/15/2017, 7:17:13 PM<br><strong>Message</strong>: <pre>Patch Set 7: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-z/11337/ : ABORTED

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/11337

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/15707/ : ABORTED

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/15707

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/9724/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/9724

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7236/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/7236</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/15/2017, 7:18:15 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/15710/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/15/2017, 7:18:46 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/9727/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/15/2017, 7:24:22 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7239/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/15/2017, 8:38:31 PM<br><strong>Message</strong>: <pre>Patch Set 8: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7239/ : FAILURE

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/7239

https://jenkins.hyperledger.org/job/fabric-verify-z/11340/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/11340

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/15710/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/15710

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/9727/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/9727</pre><strong>Reviewer</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>Reviewed</strong>: 8/15/2017, 9:55:42 PM<br><strong>Message</strong>: <pre>Patch Set 8:

reverify</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/15/2017, 9:55:53 PM<br><strong>Message</strong>: <pre>Patch Set 8: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/11348/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/15/2017, 9:56:59 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/15717/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/15/2017, 9:57:25 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/9734/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/15/2017, 9:58:02 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7246/ (4/4)</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 8/15/2017, 10:55:17 PM<br><strong>Message</strong>: <pre>Patch Set 8: Code-Review-1

(2 comments)

not yet convinced this will totally solve the problem in all test scenarios with very high numbers of blocks - but hoping some answers from the experts will clear things up  :)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/15/2017, 11:21:55 PM<br><strong>Message</strong>: <pre>Patch Set 8: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7246/ : FAILURE

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/7246

https://jenkins.hyperledger.org/job/fabric-verify-z/11348/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/11348

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/15717/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/15717

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/9734/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/9734</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 8/16/2017, 9:35:53 AM<br><strong>Message</strong>: <pre>Patch Set 8:

reverify</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/16/2017, 9:36:00 AM<br><strong>Message</strong>: <pre>Patch Set 8: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/11360/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/16/2017, 9:36:58 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/15728/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/16/2017, 9:37:37 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/9745/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/16/2017, 9:38:14 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7258/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/16/2017, 10:20:11 AM<br><strong>Message</strong>: <pre>Patch Set 8: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/15728/ : FAILURE

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/15728

https://jenkins.hyperledger.org/job/fabric-verify-z/11360/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/11360

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/9745/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/9745

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7258/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/7258</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 8/16/2017, 10:50:15 AM<br><strong>Message</strong>: <pre>Patch Set 8:

reverify</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/16/2017, 10:50:25 AM<br><strong>Message</strong>: <pre>Patch Set 8: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/11364/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/16/2017, 10:51:39 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/15732/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/16/2017, 10:52:05 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/9749/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/16/2017, 10:52:35 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7262/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/16/2017, 11:42:43 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/9754/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/16/2017, 12:18:21 PM<br><strong>Message</strong>: <pre>Patch Set 8: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/9754/ : ABORTED

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/9754

https://jenkins.hyperledger.org/job/fabric-verify-z/11364/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/11364

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/15732/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/15732

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7262/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/7262</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/16/2017, 12:22:32 PM<br><strong>Message</strong>: <pre>Patch Set 8: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/9756/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/16/2017, 12:38:30 PM<br><strong>Message</strong>: <pre>Patch Set 8: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-z/11364/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/11364

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/15732/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/15732

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7262/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/7262

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/9756/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/9756</pre><strong>Reviewer</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>Reviewed</strong>: 8/16/2017, 1:11:49 PM<br><strong>Message</strong>: <pre>Patch Set 8: Code-Review+1

(2 comments)

Waiting for testing but the code LGTM</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 8/16/2017, 4:28:44 PM<br><strong>Message</strong>: <pre>Patch Set 8: Code-Review+1

OK. Explanations make sense. And we can verify with testing.

Aside: we thought we saw a similar problem with peer-to-peer blocks (nonLeader scenario), when testing without this fix; however, we can open up a different bug (assuming we can reproduce it, using this fix).</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 8/19/2017, 9:40:18 AM<br><strong>Message</strong>: <pre>Patch Set 8: Code-Review+1</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 8/21/2017, 4:09:23 PM<br><strong>Message</strong>: <pre>Patch Set 8: Code-Review+1

A candidate for 1.0.2</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 8/21/2017, 5:18:48 PM<br><strong>Message</strong>: <pre>Patch Set 8: -Code-Review

I see that AddPayload() reads the new config variable "peer.gossip.nonBlockingCommitMode" every time. Could we also add "CORE_PEER_GOSSIP_NONBLOCKINGCOMMITMODE" to a core.yaml config file inside the examples or sampleconfig directories? And maybe mention it the Commit Message and/or the documentation and/or the release notes somewhere? Otherwise, support teams would not be aware or be able to find it, should they desire to disable this "blocking mechanism" flow-control capability.</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 8/21/2017, 6:43:33 PM<br><strong>Message</strong>: <pre>Patch Set 8:

I don't think disabling this capability is a good idea, as this would simply reproduce the behavior of the bug.

Furthermore - I think we should remove this entirely for v1.1</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 8/21/2017, 6:44:16 PM<br><strong>Message</strong>: <pre>Patch Set 8:

I am referencing the viper config, of course.</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 8/25/2017, 8:09:25 AM<br><strong>Message</strong>: <pre>Patch Set 8: Code-Review+2</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 8/28/2017, 10:25:24 AM<br><strong>Message</strong>: <pre>Uploaded patch set 9: Patch Set 8 was rebased.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/28/2017, 10:25:35 AM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/11802/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/28/2017, 10:26:58 AM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16171/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/28/2017, 10:27:46 AM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7737/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/28/2017, 10:27:50 AM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10185/ (4/4)</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 8/28/2017, 10:29:24 AM<br><strong>Message</strong>: <pre>Patch Set 9: Code-Review+1</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/28/2017, 11:22:38 AM<br><strong>Message</strong>: <pre>Patch Set 9: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16171/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16171/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/16171

https://jenkins.hyperledger.org/job/fabric-verify-z/11802/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/11802

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7737/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/7737

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10185/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/10185</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 8/28/2017, 11:52:40 AM<br><strong>Message</strong>: <pre>Patch Set 9:

rebuild-x</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/28/2017, 11:54:21 AM<br><strong>Message</strong>: <pre>Patch Set 9: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16186/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/28/2017, 1:02:04 PM<br><strong>Message</strong>: <pre>Patch Set 9: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16186/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/16186</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 8/28/2017, 2:48:33 PM<br><strong>Message</strong>: <pre>Patch Set 9: Code-Review+2</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 8/28/2017, 4:18:53 PM<br><strong>Message</strong>: <pre>Patch Set 9: Code-Review+2</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 8/28/2017, 4:19:16 PM<br><strong>Message</strong>: <pre>Change has been successfully merged by Srinivasan Muralidharan</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Uploader</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Created</strong>: 8/15/2017, 3:37:08 PM<br><strong>UnmergedRevision</strong>: [b8211dfa3a6b9ff8d4798b693454e8aba8ac7994](https://github.com/hyperledger-gerrit-archive/fabric/commit/b8211dfa3a6b9ff8d4798b693454e8aba8ac7994)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/15/2017, 4:45:29 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Uploader</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Created</strong>: 8/15/2017, 4:53:38 PM<br><strong>UnmergedRevision</strong>: [405181d194019c85fd64be9de252e10a23b2cbbb](https://github.com/hyperledger-gerrit-archive/fabric/commit/405181d194019c85fd64be9de252e10a23b2cbbb)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/15/2017, 5:06:18 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Uploader</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Created</strong>: 8/15/2017, 5:04:59 PM<br><strong>UnmergedRevision</strong>: [94ab6e21ade3568290e825c62840e5829cd15a20](https://github.com/hyperledger-gerrit-archive/fabric/commit/94ab6e21ade3568290e825c62840e5829cd15a20)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/15/2017, 5:09:11 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Uploader</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Created</strong>: 8/15/2017, 5:07:56 PM<br><strong>UnmergedRevision</strong>: [0e0028f9dabed29e018862d416a2a86e17d97e63](https://github.com/hyperledger-gerrit-archive/fabric/commit/0e0028f9dabed29e018862d416a2a86e17d97e63)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/15/2017, 6:13:33 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 5</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Uploader</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Created</strong>: 8/15/2017, 6:21:33 PM<br><strong>UnmergedRevision</strong>: [f4241260f266cf7e6d532532b6827ad1f8ac8d09](https://github.com/hyperledger-gerrit-archive/fabric/commit/f4241260f266cf7e6d532532b6827ad1f8ac8d09)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/15/2017, 6:41:14 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 6</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Uploader</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Created</strong>: 8/15/2017, 6:40:11 PM<br><strong>UnmergedRevision</strong>: [9c71f9405fd83872004b36ca43d7b2a68eb35a42](https://github.com/hyperledger-gerrit-archive/fabric/commit/9c71f9405fd83872004b36ca43d7b2a68eb35a42)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/15/2017, 6:46:24 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 7</h3><blockquote><strong>Type</strong>: NO_CODE_CHANGE<br><strong>Author</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Uploader</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Created</strong>: 8/15/2017, 6:45:28 PM<br><strong>UnmergedRevision</strong>: [50db79d721b114263c7bcce3289343fa35253921](https://github.com/hyperledger-gerrit-archive/fabric/commit/50db79d721b114263c7bcce3289343fa35253921)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/15/2017, 7:17:13 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 8</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Uploader</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Created</strong>: 8/15/2017, 7:16:21 PM<br><strong>UnmergedRevision</strong>: [09c6103e5ccdee24992a712e0e7676dbaa3ee5b6](https://github.com/hyperledger-gerrit-archive/fabric/commit/09c6103e5ccdee24992a712e0e7676dbaa3ee5b6)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/16/2017, 12:38:30 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>Approved</strong>: 8/16/2017, 1:11:49 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Approved</strong>: 8/19/2017, 9:40:18 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Approved</strong>: 8/25/2017, 8:09:25 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [/COMMIT_MSG#L14](https://github.com/hyperledger-gerrit-archive/fabric/blob/09c6103e5ccdee24992a712e0e7676dbaa3ee5b6//COMMIT_MSG#L14)<br><strong>Comment</strong>: <pre>What triggers the peer to subsequently request the discarded blocks again from another peer via gossip? When stopping a peer for a long time and restarting it (or when joining a new peer to a channel in an old long-running network), the peer would be a nonLeader, and we would hit this path.</pre><strong>Commenter</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>CommentLine</strong>: [/COMMIT_MSG#L14](https://github.com/hyperledger-gerrit-archive/fabric/blob/09c6103e5ccdee24992a712e0e7676dbaa3ee5b6//COMMIT_MSG#L14)<br><strong>Comment</strong>: <pre>The peer's committer does this as part of processing block since blocks have to be contiguous. It knows the next block sequence number.</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [/COMMIT_MSG#L18](https://github.com/hyperledger-gerrit-archive/fabric/blob/09c6103e5ccdee24992a712e0e7676dbaa3ee5b6//COMMIT_MSG#L18)<br><strong>Comment</strong>: <pre>I would think this simply pushes the problem back upstream, so it is important to explain why this seems to work, and how the peer slows down the incoming blocks from the orderer. Can we add another sentence?

Also, are we failing to recognize another problem? The bug seems to be that gossip fails to eventually retrieve the dropped blocks from other peers. If it works in some cases (first bullet, above), then why not this one?</pre><strong>Commenter</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>CommentLine</strong>: [/COMMIT_MSG#L18](https://github.com/hyperledger-gerrit-archive/fabric/blob/09c6103e5ccdee24992a712e0e7676dbaa3ee5b6//COMMIT_MSG#L18)<br><strong>Comment</strong>: <pre>Note that the orderer keeps the blocks in its datastore and it would not send if not consumed (GRPC properties). So when we block/wait for the buffer to go down, orderer stop sending, and eventually the buffer is available again, and we release the block in waiting and get the next block, which enables the orderer to send again, and so on until we catch up or never depending on the block producing rate on the ordering service.</pre></blockquote><h3>PatchSet Number: 9</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Uploader</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Created</strong>: 8/28/2017, 10:25:24 AM<br><strong>GitHubMergedRevision</strong>: [bc6420d9f4e19004a453754dfe06ea2aa2e5d4f4](https://github.com/hyperledger-gerrit-archive/fabric/commit/bc6420d9f4e19004a453754dfe06ea2aa2e5d4f4)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/28/2017, 1:02:04 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Approved</strong>: 8/28/2017, 2:48:33 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Approved</strong>: 8/28/2017, 4:18:53 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Srinivasan Muralidharan<br><strong>Merged</strong>: 8/28/2017, 4:19:16 PM<br><br><strong>Approver</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Approved</strong>: 8/28/2017, 10:29:24 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br></blockquote>