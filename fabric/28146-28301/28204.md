<strong>Project</strong>: fabric<br><strong>Branch</strong>: master<br><strong>ID</strong>: 28204<br><strong>Subject</strong>: [FAB-13178] Refactor etcdraft chain to avoid sync<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 12/16/2018, 3:46:07 PM<br><strong>LastUpdated</strong>: 1/17/2019, 4:13:50 AM<br><strong>CommitMessage</strong>:<br><pre>[FAB-13178] Refactor etcdraft chain to avoid sync

This CR moves the logics that applies raft data to state machine
from `serveRaft` to `serveRequest` go routine to avoid some
coordinations between them.

Change-Id: I7331976d0f0c256c853f09e15ca8682dd9a0322d
Signed-off-by: Jay Guo <guojiannan1101@gmail.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 12/16/2018, 3:46:07 PM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 12/16/2018, 3:47:19 PM<br><strong>Message</strong>: <pre>Removed reviewer Kostas Christidis.</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 12/16/2018, 3:47:20 PM<br><strong>Message</strong>: <pre>Removed reviewer Adarsh Saraf.</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 12/16/2018, 3:49:10 PM<br><strong>Message</strong>: <pre>Uploaded patch set 2: Commit message was updated.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/16/2018, 3:51:34 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/8265/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/16/2018, 3:52:01 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/16/2018, 3:55:59 PM<br><strong>Message</strong>: <pre>Patch Set 1: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/16/2018, 3:56:42 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/8265/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/8265</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/16/2018, 3:57:27 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7177/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/16/2018, 3:57:50 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/16/2018, 3:58:24 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/4133/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/16/2018, 3:59:11 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/16/2018, 4:21:52 PM<br><strong>Message</strong>: <pre>Patch Set 1: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/16/2018, 4:24:50 PM<br><strong>Message</strong>: <pre>Patch Set 1: F3-IntegrationTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/16/2018, 4:25:33 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/4133/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/4133

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7177/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/7177</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 12/21/2018, 7:34:48 AM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/21/2018, 7:36:55 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/8464/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/21/2018, 7:37:23 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/21/2018, 7:44:12 AM<br><strong>Message</strong>: <pre>Patch Set 3: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/21/2018, 7:45:01 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/8464/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/8464</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/21/2018, 7:46:44 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7439/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/21/2018, 7:46:53 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/4305/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/21/2018, 7:47:32 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/21/2018, 7:47:47 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/21/2018, 8:16:21 AM<br><strong>Message</strong>: <pre>Patch Set 3: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/21/2018, 8:17:11 AM<br><strong>Message</strong>: <pre>Patch Set 3: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/21/2018, 8:17:59 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7439/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/7439

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/4305/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/4305</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 12/21/2018, 9:40:14 AM<br><strong>Message</strong>: <pre>Uploaded patch set 4: Patch Set 3 was rebased.</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 12/21/2018, 11:03:14 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Run VerifyBuild</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/21/2018, 11:07:32 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/8474/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/21/2018, 11:08:12 AM<br><strong>Message</strong>: <pre>Patch Set 4: -F2-DocBuild -F1-VerifyBuild -F3-IntegrationTest -F3-UnitTest

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/21/2018, 11:14:12 AM<br><strong>Message</strong>: <pre>Patch Set 4: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/21/2018, 11:17:33 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7449/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/21/2018, 11:18:05 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/21/2018, 11:22:32 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/4314/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/21/2018, 11:23:19 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/21/2018, 11:49:39 AM<br><strong>Message</strong>: <pre>Patch Set 4: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/21/2018, 11:54:55 AM<br><strong>Message</strong>: <pre>Patch Set 4: F3-IntegrationTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/21/2018, 11:55:54 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/4314/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/4314

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/8474/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/8474

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7449/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/7449</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 12/23/2018, 7:30:15 AM<br><strong>Message</strong>: <pre>Uploaded patch set 5.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/23/2018, 7:33:01 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/8491/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/23/2018, 7:33:31 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/23/2018, 7:39:22 AM<br><strong>Message</strong>: <pre>Patch Set 5: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/23/2018, 7:40:17 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/8491/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/8491</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/23/2018, 7:41:37 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7474/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/23/2018, 7:42:02 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/23/2018, 7:42:20 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/4328/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/23/2018, 7:43:09 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/23/2018, 8:10:34 AM<br><strong>Message</strong>: <pre>Patch Set 5: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/23/2018, 8:10:58 AM<br><strong>Message</strong>: <pre>Patch Set 5: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/23/2018, 8:11:41 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7474/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/7474

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/4328/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/4328</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 12/30/2018, 11:16:18 AM<br><strong>Message</strong>: <pre>Uploaded patch set 6: Patch Set 5 was rebased.</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 12/30/2018, 6:42:02 PM<br><strong>Message</strong>: <pre>Patch Set 6:

(2 comments)</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 1/2/2019, 5:13:52 AM<br><strong>Message</strong>: <pre>Uploaded patch set 7: Patch Set 6 was rebased.</pre><strong>Reviewer</strong>: Adarsh Saraf - adarshsaraf123@gmail.com<br><strong>Reviewed</strong>: 1/3/2019, 4:29:22 AM<br><strong>Message</strong>: <pre>Patch Set 7:

(2 comments)</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 1/4/2019, 3:37:17 AM<br><strong>Message</strong>: <pre>Uploaded patch set 8: Patch Set 7 was rebased.</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 1/6/2019, 5:24:03 PM<br><strong>Message</strong>: <pre>Patch Set 8: Code-Review-1

(2 comments)</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 1/6/2019, 10:29:07 PM<br><strong>Message</strong>: <pre>Uploaded patch set 9.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/6/2019, 10:31:09 PM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/8652/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/6/2019, 10:31:41 PM<br><strong>Message</strong>: <pre>Patch Set 9:

Starting verify build</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 1/6/2019, 10:34:08 PM<br><strong>Message</strong>: <pre>Uploaded patch set 10: Patch Set 9 was rebased.</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 1/6/2019, 10:34:36 PM<br><strong>Message</strong>: <pre>Patch Set 10:

(5 comments)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/6/2019, 10:38:13 PM<br><strong>Message</strong>: <pre>Patch Set 9: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/6/2019, 10:38:58 PM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/8652/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/8652</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/6/2019, 10:40:28 PM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7623/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/6/2019, 10:40:58 PM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/4440/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/6/2019, 10:40:58 PM<br><strong>Message</strong>: <pre>Patch Set 9:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/6/2019, 10:41:44 PM<br><strong>Message</strong>: <pre>Patch Set 9:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/6/2019, 11:11:27 PM<br><strong>Message</strong>: <pre>Patch Set 9: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/6/2019, 11:19:51 PM<br><strong>Message</strong>: <pre>Patch Set 9: F3-IntegrationTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/6/2019, 11:20:39 PM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/4440/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/4440

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7623/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/7623</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 1/7/2019, 9:55:11 PM<br><strong>Message</strong>: <pre>Uploaded patch set 11: Patch Set 10 was rebased.</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 1/8/2019, 12:51:43 AM<br><strong>Message</strong>: <pre>Patch Set 11:

Run IntegrationTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/8/2019, 12:56:42 AM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/4492/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/8/2019, 12:57:19 AM<br><strong>Message</strong>: <pre>Patch Set 11: -F3-IntegrationTest

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/8/2019, 1:29:45 AM<br><strong>Message</strong>: <pre>Patch Set 11: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/8/2019, 1:30:33 AM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/4492/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/4492</pre><strong>Reviewer</strong>: Adarsh Saraf - adarshsaraf123@gmail.com<br><strong>Reviewed</strong>: 1/8/2019, 11:48:40 AM<br><strong>Message</strong>: <pre>Patch Set 11: Code-Review+1

(3 comments)

Minor code readability related comments that Jay would address in the next patch set. Otherwise looks good to go.</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 1/9/2019, 11:36:22 AM<br><strong>Message</strong>: <pre>Uploaded patch set 12.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/9/2019, 11:38:44 AM<br><strong>Message</strong>: <pre>Patch Set 12:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/8783/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/9/2019, 11:39:15 AM<br><strong>Message</strong>: <pre>Patch Set 12:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/9/2019, 11:44:27 AM<br><strong>Message</strong>: <pre>Patch Set 12: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/9/2019, 11:45:01 AM<br><strong>Message</strong>: <pre>Patch Set 12:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/8783/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/8783</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/9/2019, 11:46:34 AM<br><strong>Message</strong>: <pre>Patch Set 12:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7731/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/9/2019, 11:47:01 AM<br><strong>Message</strong>: <pre>Patch Set 12:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/9/2019, 11:47:10 AM<br><strong>Message</strong>: <pre>Patch Set 12:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/4538/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/9/2019, 11:47:50 AM<br><strong>Message</strong>: <pre>Patch Set 12:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/9/2019, 12:03:27 PM<br><strong>Message</strong>: <pre>Patch Set 12: F3-UnitTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/9/2019, 12:21:56 PM<br><strong>Message</strong>: <pre>Patch Set 12: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/9/2019, 12:22:39 PM<br><strong>Message</strong>: <pre>Patch Set 12:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7731/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/7731

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/4538/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/4538</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 1/9/2019, 1:07:35 PM<br><strong>Message</strong>: <pre>Patch Set 12:

Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/9/2019, 1:09:39 PM<br><strong>Message</strong>: <pre>Patch Set 12:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7740/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/9/2019, 1:10:14 PM<br><strong>Message</strong>: <pre>Patch Set 12: -F3-UnitTest

Starting unit tests</pre><strong>Reviewer</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Reviewed</strong>: 1/9/2019, 1:30:34 PM<br><strong>Message</strong>: <pre>Patch Set 12:

> Patch Set 12:
> 
> Run Unit Test

Did we create or locate an existing bug for the flake you hit and update accordingly? We have to get out of the habit of just re-running a flaky build without due diligence.</pre><strong>Reviewer</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Reviewed</strong>: 1/9/2019, 1:31:54 PM<br><strong>Message</strong>: <pre>Patch Set 12:

> Patch Set 12:
> 
> > Patch Set 12:
> > 
> > Run Unit Test
> 
> Did we create or locate an existing bug for the flake you hit and update accordingly? We have to get out of the habit of just re-running a flaky build without due diligence.

FAB-12067</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/9/2019, 1:40:58 PM<br><strong>Message</strong>: <pre>Patch Set 12: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/9/2019, 1:41:49 PM<br><strong>Message</strong>: <pre>Patch Set 12:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7740/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/7740</pre><strong>Reviewer</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Reviewed</strong>: 1/9/2019, 1:42:47 PM<br><strong>Message</strong>: <pre>Removed reviewer Matthew Sykes.</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 1/10/2019, 2:00:32 AM<br><strong>Message</strong>: <pre>Uploaded patch set 13: Patch Set 12 was rebased.</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 1/10/2019, 4:05:42 AM<br><strong>Message</strong>: <pre>Uploaded patch set 14: Patch Set 13 was rebased.</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 1/11/2019, 10:16:14 PM<br><strong>Message</strong>: <pre>Uploaded patch set 15: Patch Set 14 was rebased.</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 1/12/2019, 7:34:21 AM<br><strong>Message</strong>: <pre>Uploaded patch set 16: Patch Set 15 was rebased.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/12/2019, 8:53:51 AM<br><strong>Message</strong>: <pre>Patch Set 16:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/8938/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/12/2019, 8:54:28 AM<br><strong>Message</strong>: <pre>Patch Set 16: -F2-DocBuild -F1-VerifyBuild -F3-IntegrationTest -F3-UnitTest

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/12/2019, 9:00:54 AM<br><strong>Message</strong>: <pre>Patch Set 16: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/12/2019, 9:01:47 AM<br><strong>Message</strong>: <pre>Patch Set 16:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/8938/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/8938</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/12/2019, 9:02:58 AM<br><strong>Message</strong>: <pre>Patch Set 16:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7876/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/12/2019, 9:03:08 AM<br><strong>Message</strong>: <pre>Patch Set 16:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/4667/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/12/2019, 9:03:32 AM<br><strong>Message</strong>: <pre>Patch Set 16:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/12/2019, 9:03:46 AM<br><strong>Message</strong>: <pre>Patch Set 16:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/12/2019, 9:33:06 AM<br><strong>Message</strong>: <pre>Patch Set 16: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/12/2019, 9:41:23 AM<br><strong>Message</strong>: <pre>Patch Set 16: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/12/2019, 9:42:13 AM<br><strong>Message</strong>: <pre>Patch Set 16:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/7876/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/7876

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/4667/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/4667</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 1/13/2019, 5:26:25 PM<br><strong>Message</strong>: <pre>Patch Set 16: Code-Review-1

(1 comment)</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 1/13/2019, 5:36:11 PM<br><strong>Message</strong>: <pre>Patch Set 16:

(1 comment)</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 1/13/2019, 5:41:38 PM<br><strong>Message</strong>: <pre>Patch Set 16:

(1 comment)</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 1/13/2019, 5:41:54 PM<br><strong>Message</strong>: <pre>Patch Set 16:

(1 comment)</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 1/13/2019, 5:44:00 PM<br><strong>Message</strong>: <pre>Patch Set 16: -Code-Review</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 1/13/2019, 8:55:45 PM<br><strong>Message</strong>: <pre>Patch Set 16:

(1 comment)</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 1/14/2019, 1:18:22 AM<br><strong>Message</strong>: <pre>Uploaded patch set 17: Patch Set 16 was rebased.</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 1/14/2019, 9:40:12 AM<br><strong>Message</strong>: <pre>Patch Set 17: Code-Review+2</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 1/17/2019, 12:41:36 AM<br><strong>Message</strong>: <pre>Patch Set 17: Code-Review+2

(9 comments)

This is a *great* set of changes. The code is much clearer.

I have some mostly decorative comments* that can be tackled later on, given that the CR is so deep in the stack.

(*And some comments which are unrelated to your code here, mostly to serve as a pointer to what we should be refactoring next, when you free up cycles.)</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 1/17/2019, 12:41:38 AM<br><strong>Message</strong>: <pre>Change has been successfully merged by Kostas Christidis</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/17/2019, 12:44:17 AM<br><strong>Message</strong>: <pre>Patch Set 17:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/4135/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/17/2019, 12:44:54 AM<br><strong>Message</strong>: <pre>Patch Set 17:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-x86_64/5451/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/17/2019, 1:21:38 AM<br><strong>Message</strong>: <pre>Patch Set 17:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-merge-x86_64/5451/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-x86_64/5451

https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/4135/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-end-2-end-x86_64/4135</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 1/17/2019, 4:13:50 AM<br><strong>Message</strong>: <pre>Patch Set 17:

(6 comments)

thanks for review!

https://gerrit.hyperledger.org/r/c/28581/ should be able to solve part of your comments, and the rest is being tracked in FAB-13725</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Uploader</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Created</strong>: 12/16/2018, 3:46:07 PM<br><strong>UnmergedRevision</strong>: [2eb7aac8963dbe77b3719230d8438dc75c6ed935](https://github.com/hyperledger-gerrit-archive/fabric/commit/2eb7aac8963dbe77b3719230d8438dc75c6ed935)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/16/2018, 3:55:59 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/16/2018, 3:55:59 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/16/2018, 4:24:50 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/16/2018, 4:21:52 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: NO_CODE_CHANGE<br><strong>Author</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Uploader</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Created</strong>: 12/16/2018, 3:49:10 PM<br><strong>UnmergedRevision</strong>: [c7846ff10639a664c1c4b52b8f49224ec01f31b1](https://github.com/hyperledger-gerrit-archive/fabric/commit/c7846ff10639a664c1c4b52b8f49224ec01f31b1)<br><br></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Uploader</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Created</strong>: 12/21/2018, 7:34:48 AM<br><strong>UnmergedRevision</strong>: [d85e4663f906670551b4bbb29504ebba8559f224](https://github.com/hyperledger-gerrit-archive/fabric/commit/d85e4663f906670551b4bbb29504ebba8559f224)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/21/2018, 7:44:12 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/21/2018, 7:44:12 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/21/2018, 8:16:21 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/21/2018, 8:17:11 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Uploader</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Created</strong>: 12/21/2018, 9:40:14 AM<br><strong>UnmergedRevision</strong>: [22d2454f26aa3b3309748de9d79c52033d080084](https://github.com/hyperledger-gerrit-archive/fabric/commit/22d2454f26aa3b3309748de9d79c52033d080084)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/21/2018, 11:14:12 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/21/2018, 11:14:12 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/21/2018, 11:54:55 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/21/2018, 11:49:39 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 5</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Uploader</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Created</strong>: 12/23/2018, 7:30:15 AM<br><strong>UnmergedRevision</strong>: [aca3635de63b7514edd880e1484e42a5898dfc92](https://github.com/hyperledger-gerrit-archive/fabric/commit/aca3635de63b7514edd880e1484e42a5898dfc92)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/23/2018, 7:39:22 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/23/2018, 7:39:22 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/23/2018, 8:10:58 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/23/2018, 8:10:34 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 6</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Uploader</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Created</strong>: 12/30/2018, 11:16:18 AM<br><strong>UnmergedRevision</strong>: [326f8d838772eee770819807e15817aed07f6531](https://github.com/hyperledger-gerrit-archive/fabric/commit/326f8d838772eee770819807e15817aed07f6531)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/23/2018, 7:39:22 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/23/2018, 7:39:22 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/23/2018, 8:10:58 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/23/2018, 8:10:34 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L712](https://github.com/hyperledger-gerrit-archive/fabric/blob/326f8d838772eee770819807e15817aed07f6531/orderer/consensus/etcdraft/chain.go#L712)<br><strong>Comment</strong>: <pre>configuration block</pre><strong>Commenter</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L712](https://github.com/hyperledger-gerrit-archive/fabric/blob/326f8d838772eee770819807e15817aed07f6531/orderer/consensus/etcdraft/chain.go#L712)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L879](https://github.com/hyperledger-gerrit-archive/fabric/blob/326f8d838772eee770819807e15817aed07f6531/orderer/consensus/etcdraft/chain.go#L879)<br><strong>Comment</strong>: <pre>now when config update treated in same go routine, I do not think there is a need to guard access to opts.RaftMetadata.</pre><strong>Commenter</strong>: Adarsh Saraf - adarshsaraf123@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L879](https://github.com/hyperledger-gerrit-archive/fabric/blob/326f8d838772eee770819807e15817aed07f6531/orderer/consensus/etcdraft/chain.go#L879)<br><strong>Comment</strong>: <pre>I think the access needs to still be guarded since there is a read access to opts.RaftMetadata from chain.Configure (through checkConsentersSet at line 841) which will potentially be from multiple goroutines. However the read lock acquired in the newRaftMetadata (line 940) method does not seem necessary and can be removed.</pre><strong>Commenter</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L879](https://github.com/hyperledger-gerrit-archive/fabric/blob/326f8d838772eee770819807e15817aed07f6531/orderer/consensus/etcdraft/chain.go#L879)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 7</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Uploader</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Created</strong>: 1/2/2019, 5:13:52 AM<br><strong>UnmergedRevision</strong>: [c59d1188b5c3f6d5bdfa880b9dc49c7837dd21f9](https://github.com/hyperledger-gerrit-archive/fabric/commit/c59d1188b5c3f6d5bdfa880b9dc49c7837dd21f9)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/23/2018, 7:39:22 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/23/2018, 7:39:22 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/23/2018, 8:10:58 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/23/2018, 8:10:34 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Adarsh Saraf - adarshsaraf123@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L716](https://github.com/hyperledger-gerrit-archive/fabric/blob/c59d1188b5c3f6d5bdfa880b9dc49c7837dd21f9/orderer/consensus/etcdraft/chain.go#L716)<br><strong>Comment</strong>: <pre>These two checks ensure that the incoming ConfChange is indeed the ConfChange that is in progress. What happens if the incoming ConfChange differs from the in progress one? If that cannot happen should we convert this conditional check to an Assert?</pre><strong>Commenter</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L716](https://github.com/hyperledger-gerrit-archive/fabric/blob/c59d1188b5c3f6d5bdfa880b9dc49c7837dd21f9/orderer/consensus/etcdraft/chain.go#L716)<br><strong>Comment</strong>: <pre>if incoming ConfChange differs from in-progress one, we simply apply them. This happens when node is bootstrapping and applying initial set of node IDs.</pre><strong>Commenter</strong>: Adarsh Saraf - adarshsaraf123@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L716](https://github.com/hyperledger-gerrit-archive/fabric/blob/c59d1188b5c3f6d5bdfa880b9dc49c7837dd21f9/orderer/consensus/etcdraft/chain.go#L716)<br><strong>Comment</strong>: <pre>Okay. Thanks!</pre></blockquote><h3>PatchSet Number: 8</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Uploader</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Created</strong>: 1/4/2019, 3:37:17 AM<br><strong>UnmergedRevision</strong>: [395aad5c392693a83565f726fa84b4a84b8731a8](https://github.com/hyperledger-gerrit-archive/fabric/commit/395aad5c392693a83565f726fa84b4a84b8731a8)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/23/2018, 7:39:22 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/23/2018, 7:39:22 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/23/2018, 8:10:58 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/23/2018, 8:10:34 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Approved</strong>: 1/6/2019, 5:24:03 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L718](https://github.com/hyperledger-gerrit-archive/fabric/blob/395aad5c392693a83565f726fa84b4a84b8731a8/orderer/consensus/etcdraft/chain.go#L718)<br><strong>Comment</strong>: <pre>don't you need to unblock only after you succeeded to reconfigure the communication layer?</pre><strong>Commenter</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L718](https://github.com/hyperledger-gerrit-archive/fabric/blob/395aad5c392693a83565f726fa84b4a84b8731a8/orderer/consensus/etcdraft/chain.go#L718)<br><strong>Comment</strong>: <pre>setting `unblocking` to true doesn't really effectively unblock yet. And if reconfigure comm is failed, it panics anyway. But I agree it reads better to move these lines after that.</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L875](https://github.com/hyperledger-gerrit-archive/fabric/blob/395aad5c392693a83565f726fa84b4a84b8731a8/orderer/consensus/etcdraft/chain.go#L875)<br><strong>Comment</strong>: <pre>I might be missing something, but doesn't this code now executed by all members?</pre><strong>Commenter</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L875](https://github.com/hyperledger-gerrit-archive/fabric/blob/395aad5c392693a83565f726fa84b4a84b8731a8/orderer/consensus/etcdraft/chain.go#L875)<br><strong>Comment</strong>: <pre>Yes, and executions on followers will be ignored since we turn on `DisableProposalForwarding`. I'm trying to avoid relying on global var `leader` here.</pre></blockquote><h3>PatchSet Number: 9</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Uploader</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Created</strong>: 1/6/2019, 10:29:07 PM<br><strong>UnmergedRevision</strong>: [4e8d3050f9c773b73fbb220114b49752b16211d5](https://github.com/hyperledger-gerrit-archive/fabric/commit/4e8d3050f9c773b73fbb220114b49752b16211d5)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/6/2019, 10:38:13 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/6/2019, 10:38:13 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/6/2019, 11:19:51 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/6/2019, 11:11:27 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 10</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Uploader</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Created</strong>: 1/6/2019, 10:34:08 PM<br><strong>UnmergedRevision</strong>: [59a1b3e53acce8cdb284378cec8e69edbaad7637](https://github.com/hyperledger-gerrit-archive/fabric/commit/59a1b3e53acce8cdb284378cec8e69edbaad7637)<br><br></blockquote><h3>PatchSet Number: 11</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Uploader</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Created</strong>: 1/7/2019, 9:55:11 PM<br><strong>UnmergedRevision</strong>: [29ba05a5b215e0f9040c7300e237fdb1836a04fa](https://github.com/hyperledger-gerrit-archive/fabric/commit/29ba05a5b215e0f9040c7300e237fdb1836a04fa)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/6/2019, 10:38:13 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/6/2019, 10:38:13 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/8/2019, 1:29:45 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/6/2019, 11:11:27 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Adarsh Saraf - adarshsaraf123@gmail.com<br><strong>Approved</strong>: 1/8/2019, 11:48:40 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Adarsh Saraf - adarshsaraf123@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L454](https://github.com/hyperledger-gerrit-archive/fabric/blob/29ba05a5b215e0f9040c7300e237fdb1836a04fa/orderer/consensus/etcdraft/chain.go#L454)<br><strong>Comment</strong>: <pre>Discussed this with Jay offline wrt improving code readability. Noting it here so that it can be tracked.</pre><strong>Commenter</strong>: Adarsh Saraf - adarshsaraf123@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L459](https://github.com/hyperledger-gerrit-archive/fabric/blob/29ba05a5b215e0f9040c7300e237fdb1836a04fa/orderer/consensus/etcdraft/chain.go#L459)<br><strong>Comment</strong>: <pre>Discussed this with Jay offline wrt improving code readability. Noting it here so that it can be tracked.</pre></blockquote><h3>PatchSet Number: 12</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Uploader</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Created</strong>: 1/9/2019, 11:36:22 AM<br><strong>UnmergedRevision</strong>: [d2a221542f3de4dbb7d215e59cbf3cc2b89b6002](https://github.com/hyperledger-gerrit-archive/fabric/commit/d2a221542f3de4dbb7d215e59cbf3cc2b89b6002)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/9/2019, 11:44:27 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/9/2019, 11:44:27 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/9/2019, 12:21:56 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/9/2019, 1:40:58 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 13</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Uploader</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Created</strong>: 1/10/2019, 2:00:32 AM<br><strong>UnmergedRevision</strong>: [eb549ef584b3a2cc32899fa9fb9ea43a8a8701c6](https://github.com/hyperledger-gerrit-archive/fabric/commit/eb549ef584b3a2cc32899fa9fb9ea43a8a8701c6)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/9/2019, 11:44:27 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/9/2019, 11:44:27 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/9/2019, 12:21:56 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/9/2019, 1:40:58 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 14</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Uploader</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Created</strong>: 1/10/2019, 4:05:42 AM<br><strong>UnmergedRevision</strong>: [7dd58648849a465acbacde574f5d8e68fd8c888c](https://github.com/hyperledger-gerrit-archive/fabric/commit/7dd58648849a465acbacde574f5d8e68fd8c888c)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/9/2019, 11:44:27 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/9/2019, 11:44:27 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/9/2019, 12:21:56 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/9/2019, 1:40:58 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 15</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Uploader</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Created</strong>: 1/11/2019, 10:16:14 PM<br><strong>UnmergedRevision</strong>: [d30b7e90a4fe5f2885807de9c633146aa2b09463](https://github.com/hyperledger-gerrit-archive/fabric/commit/d30b7e90a4fe5f2885807de9c633146aa2b09463)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/9/2019, 11:44:27 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/9/2019, 11:44:27 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/9/2019, 12:21:56 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/9/2019, 1:40:58 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 16</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Uploader</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Created</strong>: 1/12/2019, 7:34:21 AM<br><strong>UnmergedRevision</strong>: [10415390a3d42f7507998b8d9f28e430355d3774](https://github.com/hyperledger-gerrit-archive/fabric/commit/10415390a3d42f7507998b8d9f28e430355d3774)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/12/2019, 9:00:54 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/12/2019, 9:00:54 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/12/2019, 9:41:23 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/12/2019, 9:33:06 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L721](https://github.com/hyperledger-gerrit-archive/fabric/blob/10415390a3d42f7507998b8d9f28e430355d3774/orderer/consensus/etcdraft/chain.go#L721)<br><strong>Comment</strong>: <pre>unrelated to this CR, but - can we Halt() instead of panicking? we have more chains, and if a chain is messed up due to bad config change i don't think we should devastate all the cluster because of it.</pre><strong>Commenter</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L721](https://github.com/hyperledger-gerrit-archive/fabric/blob/10415390a3d42f7507998b8d9f28e430355d3774/orderer/consensus/etcdraft/chain.go#L721)<br><strong>Comment</strong>: <pre>>  we have more chains, and if a chain is messed up due to bad config change i don't think we should devastate all the cluster because of it.

This is true, although i'm not sure it should be guarded at this level. If we halt a chain here, do we have a means to resurrect it? currently we don't, do we? i'd say we should prevent bad config from happening during validation, wdyt?</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L878](https://github.com/hyperledger-gerrit-archive/fabric/blob/10415390a3d42f7507998b8d9f28e430355d3774/orderer/consensus/etcdraft/chain.go#L878)<br><strong>Comment</strong>: <pre>if you failed to propose you should return, no?</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L878](https://github.com/hyperledger-gerrit-archive/fabric/blob/10415390a3d42f7507998b8d9f28e430355d3774/orderer/consensus/etcdraft/chain.go#L878)<br><strong>Comment</strong>: <pre>you fail to propose only if node is taken shutdown</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L878](https://github.com/hyperledger-gerrit-archive/fabric/blob/10415390a3d42f7507998b8d9f28e430355d3774/orderer/consensus/etcdraft/chain.go#L878)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 17</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Uploader</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Created</strong>: 1/14/2019, 1:18:22 AM<br><strong>GitHubMergedRevision</strong>: [9e31d16f964e7694ddc9efeb8c5ecebfa356ade7](https://github.com/hyperledger-gerrit-archive/fabric/commit/9e31d16f964e7694ddc9efeb8c5ecebfa356ade7)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/12/2019, 9:00:54 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/12/2019, 9:00:54 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/12/2019, 9:41:23 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/12/2019, 9:33:06 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Approved</strong>: 1/17/2019, 12:41:36 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Kostas Christidis<br><strong>Merged</strong>: 1/17/2019, 12:41:38 AM<br><br><strong>Approver</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Approved</strong>: 1/14/2019, 9:40:12 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L499](https://github.com/hyperledger-gerrit-archive/fabric/blob/9e31d16f964e7694ddc9efeb8c5ecebfa356ade7/orderer/consensus/etcdraft/chain.go#L499)<br><strong>Comment</strong>: <pre>This comment only makes sense within the context of how writeBlock is actually used in the code (which is a great use BTW).

The comment itself however should be somewhat decoupled from that, or at least identify the coupling. How about:

> writeBlock persists a block to disk. It returns true it persists a config block. This is used by the caller to unblock the submitC and accept new envelopes for ordering.</pre><strong>Commenter</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L499](https://github.com/hyperledger-gerrit-archive/fabric/blob/9e31d16f964e7694ddc9efeb8c5ecebfa356ade7/orderer/consensus/etcdraft/chain.go#L499)<br><strong>Comment</strong>: <pre>yep, this reads much better. Although this return value is refactored out in a later CR in the stack. Pls revisit this comment when you start reviewing that one. https://gerrit.hyperledger.org/r/c/28581/</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L552](https://github.com/hyperledger-gerrit-archive/fabric/blob/9e31d16f964e7694ddc9efeb8c5ecebfa356ade7/orderer/consensus/etcdraft/chain.go#L552)<br><strong>Comment</strong>: <pre>I don't think this is the best phrasing. It hides what's actually happening, and incorrectly refers to env (singular) since the function always deals with slices of envelopes (i.e. batches).

Perhaps this is better?

> propose proposes envelope batches to the Raft FSM. It returns true if a config block is part of those batches, in which case the caller should block until the config block is committed, before proposing again.</pre><strong>Commenter</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L552](https://github.com/hyperledger-gerrit-archive/fabric/blob/9e31d16f964e7694ddc9efeb8c5ecebfa356ade7/orderer/consensus/etcdraft/chain.go#L552)<br><strong>Comment</strong>: <pre>similar to previous comment, https://gerrit.hyperledger.org/r/c/28581/ should solve this</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L676](https://github.com/hyperledger-gerrit-archive/fabric/blob/9e31d16f964e7694ddc9efeb8c5ecebfa356ade7/orderer/consensus/etcdraft/chain.go#L676)<br><strong>Comment</strong>: <pre>returns</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L857](https://github.com/hyperledger-gerrit-archive/fabric/blob/9e31d16f964e7694ddc9efeb8c5ecebfa356ade7/orderer/consensus/etcdraft/chain.go#L857)<br><strong>Comment</strong>: <pre>This cannot possibly be a single sentence. Let's break down.</pre><strong>Commenter</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L857](https://github.com/hyperledger-gerrit-archive/fabric/blob/9e31d16f964e7694ddc9efeb8c5ecebfa356ade7/orderer/consensus/etcdraft/chain.go#L857)<br><strong>Comment</strong>: <pre>again, https://gerrit.hyperledger.org/r/c/28581/</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L858](https://github.com/hyperledger-gerrit-archive/fabric/blob/9e31d16f964e7694ddc9efeb8c5ecebfa356ade7/orderer/consensus/etcdraft/chain.go#L858)<br><strong>Comment</strong>: <pre>Why don't we name the boolean so that the reader can figure out what it stands for, simply by scanning the function signature?

> noNodeAddedRemoved bool

Or something along these lines.</pre><strong>Commenter</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L858](https://github.com/hyperledger-gerrit-archive/fabric/blob/9e31d16f964e7694ddc9efeb8c5ecebfa356ade7/orderer/consensus/etcdraft/chain.go#L858)<br><strong>Comment</strong>: <pre>same as before</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L863](https://github.com/hyperledger-gerrit-archive/fabric/blob/9e31d16f964e7694ddc9efeb8c5ecebfa356ade7/orderer/consensus/etcdraft/chain.go#L863)<br><strong>Comment</strong>: <pre>Why do we reverse the order of the arguments as returned by newRaftMetadata? Let's have newRaftMetadata return the arguments in the right order. But newRaftMetadata in general needs to die, see comments later on.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L875](https://github.com/hyperledger-gerrit-archive/fabric/blob/9e31d16f964e7694ddc9efeb8c5ecebfa356ade7/orderer/consensus/etcdraft/chain.go#L875)<br><strong>Comment</strong>: <pre>is being</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L938](https://github.com/hyperledger-gerrit-archive/fabric/blob/9e31d16f964e7694ddc9efeb8c5ecebfa356ade7/orderer/consensus/etcdraft/chain.go#L938)<br><strong>Comment</strong>: <pre>This function either needs to die, be rewritten, or renamed. (The comment as well.)

Notice how the argument suggests that we're only operating on the passed in block, but we, oh, also work with c.opts.RaftMetadata as well.</pre><strong>Commenter</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L938](https://github.com/hyperledger-gerrit-archive/fabric/blob/9e31d16f964e7694ddc9efeb8c5ecebfa356ade7/orderer/consensus/etcdraft/chain.go#L938)<br><strong>Comment</strong>: <pre>created FAB-13725 to track this</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L945](https://github.com/hyperledger-gerrit-archive/fabric/blob/9e31d16f964e7694ddc9efeb8c5ecebfa356ade7/orderer/consensus/etcdraft/chain.go#L945)<br><strong>Comment</strong>: <pre>we need</pre><strong>Commenter</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L945](https://github.com/hyperledger-gerrit-archive/fabric/blob/9e31d16f964e7694ddc9efeb8c5ecebfa356ade7/orderer/consensus/etcdraft/chain.go#L945)<br><strong>Comment</strong>: <pre>FAB-13725</pre></blockquote>