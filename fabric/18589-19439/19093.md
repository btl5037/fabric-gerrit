<strong>Project</strong>: fabric<br><strong>Branch</strong>: master<br><strong>ID</strong>: 19093<br><strong>Subject</strong>: [FAB-7692] Refactor statecouchdb impl<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 3/12/2018, 5:05:54 PM<br><strong>LastUpdated</strong>: 4/19/2018, 4:54:57 PM<br><strong>CommitMessage</strong>:<br><pre>[FAB-7692] Refactor statecouchdb impl

This CR refactors the code for statecouchdb implementation.
This includes splitting the code into different files and
making the code more modular by spliting it into high level structures and functions
so to make the code more readble and maintainable

The unit tests are not changed in this CR so as to make sure
that things are not lost in the refactoring

Change-Id: I5c937f7d3c541be0b89591175b6946ae32c5833f
Signed-off-by: manish <manish.sethi@gmail.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 3/12/2018, 5:05:54 PM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/12/2018, 5:08:04 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/13192/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/12/2018, 5:08:18 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/21499/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/12/2018, 5:37:02 PM<br><strong>Message</strong>: <pre>Patch Set 1: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/13192/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/13192

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/21499/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/21499</pre><strong>Reviewer</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Reviewed</strong>: 3/14/2018, 2:04:52 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Merging the queryScanner and kvScanner may be premature with the paging CR coming up.  The needs for scanning and bookmarking will be very different for query and range result sets.</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 3/14/2018, 3:14:28 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Chris, can we see the difference in the paging CR and take a call in that CR on need basis. My hunch is that you may finally devise a common structure and extend that for one of the cases.</pre><strong>Reviewer</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Reviewed</strong>: 3/27/2018, 9:09:25 AM<br><strong>Message</strong>: <pre>Patch Set 1: Code-Review+1</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 4/2/2018, 6:25:44 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(5 comments)</pre><strong>Reviewer</strong>: Ry Jones - ry@linux.com<br><strong>Reviewed</strong>: 4/3/2018, 1:42:53 PM<br><strong>Message</strong>: <pre>Removed Verified+1 by Hyperledger Jobbuilder <jobbuilder@jenkins.hyperledger.org>
</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/3/2018, 1:46:42 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/181/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/3/2018, 1:48:41 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting...</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/3/2018, 1:53:43 PM<br><strong>Message</strong>: <pre>Patch Set 1: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run SmokeTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/3/2018, 1:54:10 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/181/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/181</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/3/2018, 1:56:06 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-smoke-tests-x86_64/135/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/3/2018, 1:57:09 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting...</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/3/2018, 2:01:59 PM<br><strong>Message</strong>: <pre>Patch Set 1: F2-SmokeTest+1

Succeeded, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/3/2018, 2:05:25 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/725/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/3/2018, 2:06:26 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting...</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/3/2018, 2:16:41 PM<br><strong>Message</strong>: <pre>Patch Set 1: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/3/2018, 2:17:05 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-smoke-tests-x86_64/135/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-smoke-tests-x86_64/135

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/725/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/725</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 4/11/2018, 2:44:28 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(5 comments)

Reviewed Partially.</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 4/12/2018, 10:43:46 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(1 comment)</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 4/13/2018, 12:24:54 AM<br><strong>Message</strong>: <pre>Uploaded patch set 2.</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 4/13/2018, 12:25:21 AM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/13/2018, 12:25:22 AM<br><strong>Message</strong>: <pre>Patch Set 2:

No Builds Executed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/13/2018, 12:28:58 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/395/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/13/2018, 12:29:47 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/13/2018, 12:36:31 AM<br><strong>Message</strong>: <pre>Patch Set 3: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run SmokeTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/13/2018, 12:37:05 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/395/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/395</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/13/2018, 12:42:45 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-smoke-tests-x86_64/285/</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 4/13/2018, 12:43:32 AM<br><strong>Message</strong>: <pre>Uploaded patch set 4.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/13/2018, 12:43:37 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Starting smoke tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/13/2018, 12:46:19 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/396/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/13/2018, 12:47:13 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/13/2018, 12:50:32 AM<br><strong>Message</strong>: <pre>Patch Set 3: F2-SmokeTest+1

Succeeded, Run UnitTest</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 4/13/2018, 12:52:58 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(11 comments)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/13/2018, 12:54:56 AM<br><strong>Message</strong>: <pre>Patch Set 4: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run SmokeTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/13/2018, 12:55:05 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/894/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/13/2018, 12:55:46 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/396/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/396</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/13/2018, 12:55:48 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/13/2018, 12:56:30 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-smoke-tests-x86_64/286/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/13/2018, 12:57:27 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Starting smoke tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/13/2018, 1:03:01 AM<br><strong>Message</strong>: <pre>Patch Set 4: F2-SmokeTest+1

Succeeded, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/13/2018, 1:03:23 AM<br><strong>Message</strong>: <pre>Patch Set 3: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/894/ : ABORTED

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/894/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/894

https://jenkins.hyperledger.org/job/fabric-smoke-tests-x86_64/285/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-smoke-tests-x86_64/285</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/13/2018, 1:06:30 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/895/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/13/2018, 1:07:25 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/13/2018, 1:19:00 AM<br><strong>Message</strong>: <pre>Patch Set 4: F3-UnitTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/13/2018, 1:19:37 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/895/ : FAILURE (skipped)

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/895/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/895

https://jenkins.hyperledger.org/job/fabric-smoke-tests-x86_64/286/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-smoke-tests-x86_64/286</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 4/13/2018, 2:32:19 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/13/2018, 2:34:54 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/896/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/13/2018, 2:37:52 AM<br><strong>Message</strong>: <pre>Patch Set 4: -F3-UnitTest

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/13/2018, 2:49:10 AM<br><strong>Message</strong>: <pre>Patch Set 4: F3-UnitTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/13/2018, 2:49:35 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/896/ : FAILURE (skipped)

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/896/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/896</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 4/13/2018, 2:58:30 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/13/2018, 3:00:56 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/899/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/13/2018, 3:02:01 AM<br><strong>Message</strong>: <pre>Patch Set 4: -F3-UnitTest

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/13/2018, 3:13:21 AM<br><strong>Message</strong>: <pre>Patch Set 4: F3-UnitTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/13/2018, 3:13:49 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/899/ : FAILURE (skipped)

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/899/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/899</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 4/13/2018, 9:51:49 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/13/2018, 9:54:55 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/903/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/13/2018, 9:56:12 AM<br><strong>Message</strong>: <pre>Patch Set 4: -F3-UnitTest

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/13/2018, 10:07:21 AM<br><strong>Message</strong>: <pre>Patch Set 4: F3-UnitTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/13/2018, 10:07:50 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/903/ : FAILURE (skipped)

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/903/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/903</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 4/13/2018, 11:25:56 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/13/2018, 11:28:17 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/907/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/13/2018, 11:29:52 AM<br><strong>Message</strong>: <pre>Patch Set 4: -F3-UnitTest

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/13/2018, 11:41:52 AM<br><strong>Message</strong>: <pre>Patch Set 4: F3-UnitTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/13/2018, 11:42:30 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/907/ : FAILURE (skipped)

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/907/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/907</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 4/13/2018, 4:33:12 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/13/2018, 4:56:56 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/920/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/13/2018, 4:58:09 PM<br><strong>Message</strong>: <pre>Patch Set 4: -F3-UnitTest

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/13/2018, 5:09:09 PM<br><strong>Message</strong>: <pre>Patch Set 4: F3-UnitTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/13/2018, 5:09:34 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/920/ : FAILURE (skipped)

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/920/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/920</pre><strong>Reviewer</strong>: Ry Jones - ry@linux.com<br><strong>Reviewed</strong>: 4/14/2018, 11:51:41 AM<br><strong>Message</strong>: <pre>Patch Set 5: Patch Set 4 was rebased</pre><strong>Reviewer</strong>: Ry Jones - ry@linux.com<br><strong>Reviewed</strong>: 4/14/2018, 11:51:45 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Run UnitTest</pre><strong>Reviewer</strong>: Ry Jones - ry@linux.com<br><strong>Reviewed</strong>: 4/14/2018, 11:51:48 AM<br><strong>Message</strong>: <pre>Removed reviewer Ry Jones.</pre><strong>Reviewer</strong>: Ry Jones - ry@linux.com<br><strong>Reviewed</strong>: 4/14/2018, 11:51:49 AM<br><strong>Message</strong>: <pre>Removed F3-UnitTest-1 by Hyperledger Jobbuilder <jobbuilder@jenkins.hyperledger.org>
</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/14/2018, 11:55:01 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/940/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/14/2018, 11:55:39 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/14/2018, 12:12:21 PM<br><strong>Message</strong>: <pre>Patch Set 5: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/14/2018, 12:12:45 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/940/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/940</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 4/15/2018, 11:27:05 PM<br><strong>Message</strong>: <pre>Patch Set 5: Code-Review+1

(1 comment)</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 4/17/2018, 4:30:53 PM<br><strong>Message</strong>: <pre>Patch Set 5:

(1 comment)

Functionally, e2e batch testing is successful.  Still reviewing the code...</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 4/17/2018, 6:09:28 PM<br><strong>Message</strong>: <pre>Patch Set 5:

(1 comment)</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 4/18/2018, 9:29:42 AM<br><strong>Message</strong>: <pre>Patch Set 5: Code-Review+2

(4 comments)

Tested e2e with small maxBatchUpdateSize to ensure batching still works correctly.  All good. Also confirmed good unit test coverage.

Since all my comments relate to improved debug, I will go ahead and +2.  I've created FAB-9573 to improve the debug later.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/18/2018, 7:41:02 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/552/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/18/2018, 7:41:22 PM<br><strong>Message</strong>: <pre>Patch Set 5: -F2-DocBuild -F1-VerifyBuild -F2-SmokeTest -F3-UnitTest

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/18/2018, 7:45:41 PM<br><strong>Message</strong>: <pre>Patch Set 5: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run SmokeTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/18/2018, 7:46:03 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/552/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/552</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/18/2018, 7:49:28 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-smoke-tests-x86_64/383/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/18/2018, 7:49:53 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Starting smoke tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/18/2018, 7:53:39 PM<br><strong>Message</strong>: <pre>Patch Set 5: F2-SmokeTest+1

Succeeded, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/18/2018, 7:57:20 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/1031/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/18/2018, 7:57:47 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/18/2018, 8:12:26 PM<br><strong>Message</strong>: <pre>Patch Set 5: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/18/2018, 8:12:54 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-smoke-tests-x86_64/383/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-smoke-tests-x86_64/383

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/1031/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/1031</pre><strong>Reviewer</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>Reviewed</strong>: 4/19/2018, 4:26:19 PM<br><strong>Message</strong>: <pre>Patch Set 5: Code-Review+1

Dave, are you happy to go ahead with a "+2" here, with not having the 'ns' value set, the debug formatting, etc.?

I would also document the functions in a more standardized way.

But if you are fine, I OK with letting this one in. Just checking.</pre><strong>Reviewer</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>Reviewed</strong>: 4/19/2018, 4:34:00 PM<br><strong>Message</strong>: <pre>Patch Set 5: Code-Review+2</pre><strong>Reviewer</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>Reviewed</strong>: 4/19/2018, 4:34:04 PM<br><strong>Message</strong>: <pre>Change has been successfully merged by Jonathan Levi (HACERA)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/19/2018, 4:34:11 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/2225/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/19/2018, 4:38:25 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-x86_64/3556/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/19/2018, 4:54:57 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/2225/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-end-2-end-x86_64/2225

https://jenkins.hyperledger.org/job/fabric-merge-x86_64/3556/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-x86_64/3556</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Uploader</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Created</strong>: 3/12/2018, 5:05:54 PM<br><strong>UnmergedRevision</strong>: [04ab4269bff64c01f6a7fb2b7d90a63f39019e1c](https://github.com/hyperledger-gerrit-archive/fabric/commit/04ab4269bff64c01f6a7fb2b7d90a63f39019e1c)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/3/2018, 1:53:43 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/3/2018, 1:53:43 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/3/2018, 2:01:59 PM<br><strong>Type</strong>: F2-SmokeTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/3/2018, 2:16:41 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Approved</strong>: 3/27/2018, 9:09:25 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/commit_handling.go#L76](https://github.com/hyperledger-gerrit-archive/fabric/blob/04ab4269bff64c01f6a7fb2b7d90a63f39019e1c/core/ledger/kvledger/txmgmt/statedb/statecouchdb/commit_handling.go#L76)<br><strong>Comment</strong>: <pre>builder.executionResults -- when I read it the first time, it confused me. May be subBatchUpdateMap or updateMaps or something like that?</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/commit_handling.go#L76](https://github.com/hyperledger-gerrit-archive/fabric/blob/04ab4269bff64c01f6a7fb2b7d90a63f39019e1c/core/ledger/kvledger/txmgmt/statedb/statecouchdb/commit_handling.go#L76)<br><strong>Comment</strong>: <pre>Have changed the variable name to avoid confusion</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/couchdoc_conv.go#L177](https://github.com/hyperledger-gerrit-archive/fabric/blob/04ab4269bff64c01f6a7fb2b7d90a63f39019e1c/core/ledger/kvledger/txmgmt/statedb/statecouchdb/couchdoc_conv.go#L177)<br><strong>Comment</strong>: <pre>jsonValue?</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/couchdoc_conv.go#L177](https://github.com/hyperledger-gerrit-archive/fabric/blob/04ab4269bff64c01f6a7fb2b7d90a63f39019e1c/core/ledger/kvledger/txmgmt/statedb/statecouchdb/couchdoc_conv.go#L177)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/couchdoc_conv.go#L182](https://github.com/hyperledger-gerrit-archive/fabric/blob/04ab4269bff64c01f6a7fb2b7d90a63f39019e1c/core/ledger/kvledger/txmgmt/statedb/statecouchdb/couchdoc_conv.go#L182)<br><strong>Comment</strong>: <pre>if you make jsonMap to of type jsonValue, then you can jsonMap.checkReservedFieldsNotPresent(), no?</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/couchdoc_conv.go#L182](https://github.com/hyperledger-gerrit-archive/fabric/blob/04ab4269bff64c01f6a7fb2b7d90a63f39019e1c/core/ledger/kvledger/txmgmt/statedb/statecouchdb/couchdoc_conv.go#L182)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/couchdoc_conv.go#L195](https://github.com/hyperledger-gerrit-archive/fabric/blob/04ab4269bff64c01f6a7fb2b7d90a63f39019e1c/core/ledger/kvledger/txmgmt/statedb/statecouchdb/couchdoc_conv.go#L195)<br><strong>Comment</strong>: <pre>isn't this duplicate of function at lines 37-44</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/couchdoc_conv.go#L195](https://github.com/hyperledger-gerrit-archive/fabric/blob/04ab4269bff64c01f6a7fb2b7d90a63f39019e1c/core/ledger/kvledger/txmgmt/statedb/statecouchdb/couchdoc_conv.go#L195)<br><strong>Comment</strong>: <pre>Good catch :-) Fixed</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/couchdoc_conv.go#L199](https://github.com/hyperledger-gerrit-archive/fabric/blob/04ab4269bff64c01f6a7fb2b7d90a63f39019e1c/core/ledger/kvledger/txmgmt/statedb/statecouchdb/couchdoc_conv.go#L199)<br><strong>Comment</strong>: <pre>IMO you can use here `jsonValue`</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/couchdoc_conv.go#L199](https://github.com/hyperledger-gerrit-archive/fabric/blob/04ab4269bff64c01f6a7fb2b7d90a63f39019e1c/core/ledger/kvledger/txmgmt/statedb/statecouchdb/couchdoc_conv.go#L199)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/couchdoc_conv.go#L209](https://github.com/hyperledger-gerrit-archive/fabric/blob/04ab4269bff64c01f6a7fb2b7d90a63f39019e1c/core/ledger/kvledger/txmgmt/statedb/statecouchdb/couchdoc_conv.go#L209)<br><strong>Comment</strong>: <pre>and then jsonMap.toBytes()</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/couchdoc_conv.go#L209](https://github.com/hyperledger-gerrit-archive/fabric/blob/04ab4269bff64c01f6a7fb2b7d90a63f39019e1c/core/ledger/kvledger/txmgmt/statedb/statecouchdb/couchdoc_conv.go#L209)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/metadata_retrieval.go#L59](https://github.com/hyperledger-gerrit-archive/fabric/blob/04ab4269bff64c01f6a7fb2b7d90a63f39019e1c/core/ledger/kvledger/txmgmt/statedb/statecouchdb/metadata_retrieval.go#L59)<br><strong>Comment</strong>: <pre>Again a minor one. We can also use min() in math package. As it returns float64, we need to cast the output like int(min(x,y)).</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/metadata_retrieval.go#L59](https://github.com/hyperledger-gerrit-archive/fabric/blob/04ab4269bff64c01f6a7fb2b7d90a63f39019e1c/core/ledger/kvledger/txmgmt/statedb/statecouchdb/metadata_retrieval.go#L59)<br><strong>Comment</strong>: <pre>I considered this but problem is that golang wants you to cast int to float64 as well. So, the expression actullat looked like following :-) 

`numKeys := int(math.Min(float64(maxBacthSize), float64(len(remainingKeys))))`

which cause the most significant portion of the piece (math.Min) buried in between..</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/metadata_retrieval.go#L59](https://github.com/hyperledger-gerrit-archive/fabric/blob/04ab4269bff64c01f6a7fb2b7d90a63f39019e1c/core/ledger/kvledger/txmgmt/statedb/statecouchdb/metadata_retrieval.go#L59)<br><strong>Comment</strong>: <pre>Yeah, it looks complicated. I was wondering why they do not implement for integer type and found this article -- https://mrekucci.blogspot.in/2015/07/dont-abuse-mathmax-mathmin.html</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/metadata_retrieval.go#L67](https://github.com/hyperledger-gerrit-archive/fabric/blob/04ab4269bff64c01f6a7fb2b7d90a63f39019e1c/core/ledger/kvledger/txmgmt/statedb/statecouchdb/metadata_retrieval.go#L67)<br><strong>Comment</strong>: <pre>I like the re-usage of executeBatches to parallely load each maxbatchsize keys (i.e, subNs). The only drawback is that when the number of keys per ns is lesser than the maxBatchUpdateSize, we would end up calling executeBatches twice and create 2 goroutines in total. Again, it is a minor one. 

when the len(batches) is one, is it make sense to directly call batches[0].execute()? Anyway, hard-coding [0] looks wired.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/metadata_retrieval.go#L67](https://github.com/hyperledger-gerrit-archive/fabric/blob/04ab4269bff64c01f6a7fb2b7d90a63f39019e1c/core/ledger/kvledger/txmgmt/statedb/statecouchdb/metadata_retrieval.go#L67)<br><strong>Comment</strong>: <pre>"executeBatches twice and create 2 goroutines in total".... 
I had this in mind and checked with Dave whether it is possible to issue a batch that wants to load data across couch databases but it appears that it's not.

About len(batch) == 1 - good suggestion and I have made this change in batch_util.go.</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L188](https://github.com/hyperledger-gerrit-archive/fabric/blob/04ab4269bff64c01f6a7fb2b7d90a63f39019e1c/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L188)<br><strong>Comment</strong>: <pre>May not be possible to remove as of now. We are using GetKeyHashVersion() in https://github.com/hyperledger/fabric/blob/master/core/ledger/kvledger/txmgmt/txmgr/lockbasedtxmgr/helper.go#L117 which is called during simulation. GetKeyHashVersion() in turn calls GetVersion(). If possible, we could change this behavior which might help us to trim GetVersion() and also remove GetCachedVersion() from IsBulkOptimizable.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L188](https://github.com/hyperledger-gerrit-archive/fabric/blob/04ab4269bff64c01f6a7fb2b7d90a63f39019e1c/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L188)<br><strong>Comment</strong>: <pre>Yes, you are right. I have updated the comments to make it clear here. Though, I wish we could make is cleaner than just having comments but may be can do that some other time as it spans out to other packages as well.</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L201](https://github.com/hyperledger-gerrit-archive/fabric/blob/04ab4269bff64c01f6a7fb2b7d90a63f39019e1c/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L201)<br><strong>Comment</strong>: <pre>It must be a public function -- GetCachedVersion(). I am wondering how unit-test did not catch this. 

Found out why test got passed. In https://github.com/hyperledger/fabric/blob/master/core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator_test.go#L112 we check whether the db implements IsBulkOptimizable()-- https://github.com/hyperledger/fabric/blob/master/core/ledger/kvledger/txmgmt/statedb/statedb.go#L59 

In this case, CouchDB is not implementing the IsBulkOptimizable() due to getCachedVersion() instead of GetXXX() and hence all test passed. How can we ensure that the CouchDB implements IsBulkOptimizable()?

Note that we need GetCachedVersion() just to test a part of validator logic.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L201](https://github.com/hyperledger-gerrit-archive/fabric/blob/04ab4269bff64c01f6a7fb2b7d90a63f39019e1c/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L201)<br><strong>Comment</strong>: <pre>Yes, good catch. I have added a unit test explicitly for checking that couchdb impl implements `BulkOptimizable`</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/version_cache.go#L39](https://github.com/hyperledger-gerrit-archive/fabric/blob/04ab4269bff64c01f6a7fb2b7d90a63f39019e1c/core/ledger/kvledger/txmgmt/statedb/statecouchdb/version_cache.go#L39)<br><strong>Comment</strong>: <pre>very minor one. Having two separate functions is good for readability. Is there any other reason like extendability? It is also possible to implement the required functionality within setVerAndRev() (only if vers[ns] exists, there would be a revs[ns]) and maintain less number of functions/code.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/version_cache.go#L39](https://github.com/hyperledger-gerrit-archive/fabric/blob/04ab4269bff64c01f6a7fb2b7d90a63f39019e1c/core/ledger/kvledger/txmgmt/statedb/statecouchdb/version_cache.go#L39)<br><strong>Comment</strong>: <pre>I am fine either way. However, the intention was not readability but I was trying to organize this cache little differently originally in that context the separate functions made sense but in the final shape, they could have been merged. Merged them now within "setVerAndRev"</pre></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Uploader</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Created</strong>: 4/13/2018, 12:24:54 AM<br><strong>UnmergedRevision</strong>: [5a971dae3826c1d0fb91be7e273671a7c3380862](https://github.com/hyperledger-gerrit-archive/fabric/commit/5a971dae3826c1d0fb91be7e273671a7c3380862)<br><br></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Uploader</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Created</strong>: 4/13/2018, 12:25:21 AM<br><strong>UnmergedRevision</strong>: [9cb2b0ff5a4aa3ace8d84619e522dbd601613179](https://github.com/hyperledger-gerrit-archive/fabric/commit/9cb2b0ff5a4aa3ace8d84619e522dbd601613179)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/13/2018, 12:36:31 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/13/2018, 12:36:31 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/13/2018, 12:50:32 AM<br><strong>Type</strong>: F2-SmokeTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/13/2018, 1:03:23 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Uploader</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Created</strong>: 4/13/2018, 12:43:32 AM<br><strong>UnmergedRevision</strong>: [bb1e58aa62bec4555fbf521f8d9915ead825e162](https://github.com/hyperledger-gerrit-archive/fabric/commit/bb1e58aa62bec4555fbf521f8d9915ead825e162)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/13/2018, 12:54:56 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/13/2018, 12:54:56 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/13/2018, 1:03:01 AM<br><strong>Type</strong>: F2-SmokeTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/13/2018, 5:09:09 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 5</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Uploader</strong>: Ry Jones - ry@linux.com<br><strong>Created</strong>: 4/14/2018, 11:51:41 AM<br><strong>GitHubMergedRevision</strong>: [4aba4a8190949172caecb8ba7840efed6460b7dc](https://github.com/hyperledger-gerrit-archive/fabric/commit/4aba4a8190949172caecb8ba7840efed6460b7dc)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/18/2018, 7:45:41 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/18/2018, 7:45:41 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/18/2018, 7:53:39 PM<br><strong>Type</strong>: F2-SmokeTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/18/2018, 8:12:26 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>Approved</strong>: 4/19/2018, 4:34:00 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Jonathan Levi (HACERA)<br><strong>Merged</strong>: 4/19/2018, 4:34:04 PM<br><br><strong>Approver</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Approved</strong>: 4/18/2018, 9:29:42 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Approved</strong>: 4/15/2018, 11:27:05 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/batch_util.go#L20](https://github.com/hyperledger-gerrit-archive/fabric/blob/4aba4a8190949172caecb8ba7840efed6460b7dc/core/ledger/kvledger/txmgmt/statedb/statecouchdb/batch_util.go#L20)<br><strong>Comment</strong>: <pre>batches doesn't always print pretty, for example for nsCommittersBuilder we get:

Executing batches = [%!s(*statecouchdb.nsCommittersBuilder=&{map[color~namebluemarble11:0xc421b038e0 marble11:0xc421b03900 color~namebluemarble12:0xc421b03960 marble12:0xc421b03980] 0xc421666700 map[marble11: marble12:] []})]

I'd suggest move debug into the individual execute() statements for better debug info with pretty printing.</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/commit_handling.go#L165](https://github.com/hyperledger-gerrit-archive/fabric/blob/4aba4a8190949172caecb8ba7840efed6460b7dc/core/ledger/kvledger/txmgmt/statedb/statecouchdb/commit_handling.go#L165)<br><strong>Comment</strong>: <pre>err not propagated up.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/commit_handling.go#L165](https://github.com/hyperledger-gerrit-archive/fabric/blob/4aba4a8190949172caecb8ba7840efed6460b7dc/core/ledger/kvledger/txmgmt/statedb/statecouchdb/commit_handling.go#L165)<br><strong>Comment</strong>: <pre>I guess that some portions of the code, I simply copied from the existing code - https://github.com/hyperledger/fabric/blob/release-1.1/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L1074

But good to fix these here. Will wait for your other comments and then will fix in next patch</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/metadata_retrieval.go#L99](https://github.com/hyperledger-gerrit-archive/fabric/blob/4aba4a8190949172caecb8ba7840efed6460b7dc/core/ledger/kvledger/txmgmt/statedb/statecouchdb/metadata_retrieval.go#L99)<br><strong>Comment</strong>: <pre>ns is never set in subNsMetadataRetriever, therefore the ns doesn't get printed here.  Need to set ns above when subNsMetadataRetriever is created.</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L172](https://github.com/hyperledger-gerrit-archive/fabric/blob/4aba4a8190949172caecb8ba7840efed6460b7dc/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L172)<br><strong>Comment</strong>: <pre>This one prints well:
nsKeysMap=map[marbles:[marble11 marble12] lscc:[marbles]]</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L173](https://github.com/hyperledger-gerrit-archive/fabric/blob/4aba4a8190949172caecb8ba7840efed6460b7dc/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L173)<br><strong>Comment</strong>: <pre>This one does not print as well (not sure if it's worth improving...):
nsMetadataMap=map[lscc:[%!s(*couchdb.DocMetadata=&{marbles 1-d34dbdb4370ad7d1d50497fea71ec0c8 1:0 []})] marbles:[%!s(*couchdb.DocMetadata=&{   []}) %!s(*couchdb.DocMetadata=&{   []})]]</pre></blockquote>