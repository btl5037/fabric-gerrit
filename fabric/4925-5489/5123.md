<strong>Project</strong>: fabric<br><strong>Branch</strong>: master<br><strong>ID</strong>: 5123<br><strong>Subject</strong>: Get ID for local MSP from core.yaml<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Assignee</strong>:<br><strong>Created</strong>: 1/31/2017, 6:47:59 AM<br><strong>LastUpdated</strong>: 2/13/2017, 4:54:44 PM<br><strong>CommitMessage</strong>:<br><pre>Get ID for local MSP from core.yaml

This change-set removes the hardcoded ID of the local MSP and reads it from
core.yaml instead. Additionally, the code that sets up the MSPs for the test
chain has been cleaned up - the test setup is now only used in testing and
the peer always sets up chain MSPs from the config block (whether it's the
test chain or a chain it is asked to join).

Change-Id: Ife55c9be831172e603b4495bdfa37982a571d3a9
Signed-off-by: Alessandro Sorniotti <ale.linux@sopit.net>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 1/31/2017, 6:47:59 AM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/31/2017, 6:50:56 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/6000/</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 1/31/2017, 6:51:24 AM<br><strong>Message</strong>: <pre>Uploaded patch set 2.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/31/2017, 6:54:09 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/6001/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/31/2017, 8:01:43 AM<br><strong>Message</strong>: <pre>Patch Set 1: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/6000/ : SUCCESS</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/31/2017, 8:03:02 AM<br><strong>Message</strong>: <pre>Patch Set 2: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/6001/ : SUCCESS</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 1/31/2017, 10:54:11 AM<br><strong>Message</strong>: <pre>Patch Set 2:

When anchor peers are constructed for a genesis block, the identity's MSP id is DEFAULT:
https://github.com/hyperledger/fabric/blob/master/peer/common/anchors.go#L119

Won't this change break something?
Will the peer be able to validate an anchor peer's identity this way?</pre><strong>Reviewer</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>Reviewed</strong>: 1/31/2017, 11:01:20 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Yacov, you might submit a change-set to allow the MSP-ID to be specified in the anchor peer file. Another option would be to have in the anchor peer file, directly a serialized MSP identity.</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 1/31/2017, 11:06:08 AM<br><strong>Message</strong>: <pre>Patch Set 2:

So, I think that having the msp-id in the file is better than having the serialized identity, since it's so much easier to create the former than the latter (just need to use openssl instead of a protobuf generator), but I think that a change set that alters something and breaks a functionality, also needs to include a fix/modification that ensures that the functionality isn't broken. 

Therefore, I think this needs to be in *this* changeset and not in a future one.</pre><strong>Reviewer</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>Reviewed</strong>: 1/31/2017, 11:13:24 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Yacov, I think you should submit the change-set that modify your code and this 5123 should be merged after yours is in.</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 1/31/2017, 11:26:51 AM<br><strong>Message</strong>: <pre>Patch Set 2: Code-Review-1

I agree with Angelo and putting -1 here, just to make sure it won't come before required changes will be added to the anchor peers.</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 2/12/2017, 6:29:38 AM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/12/2017, 6:32:22 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/6782/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/12/2017, 6:34:49 AM<br><strong>Message</strong>: <pre>Patch Set 3: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/6782/ : FAILURE</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 2/12/2017, 6:51:56 AM<br><strong>Message</strong>: <pre>Uploaded patch set 4.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/12/2017, 6:52:57 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/6783/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/12/2017, 6:58:12 AM<br><strong>Message</strong>: <pre>Patch Set 4: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/6783/ : FAILURE</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 2/12/2017, 6:59:12 AM<br><strong>Message</strong>: <pre>Uploaded patch set 5.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/12/2017, 7:00:11 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/6784/</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 2/12/2017, 7:22:09 AM<br><strong>Message</strong>: <pre>Patch Set 5: Code-Review+2

(1 comment)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/12/2017, 7:59:08 AM<br><strong>Message</strong>: <pre>Patch Set 5: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/6784/ : SUCCESS</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 2/12/2017, 8:04:42 AM<br><strong>Message</strong>: <pre>Patch Set 5:

(1 comment)

Thx Jacov!</pre><strong>Reviewer</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>Reviewed</strong>: 2/12/2017, 10:09:32 AM<br><strong>Message</strong>: <pre>Patch Set 5: Code-Review-1

(7 comments)

i see a lot of instances that we hardcoded "DEFAULT" instead of getting it from the yaml file.</pre><strong>Reviewer</strong>: Elli Androulaki - lli@zurich.ibm.com<br><strong>Reviewed</strong>: 2/13/2017, 4:53:19 AM<br><strong>Message</strong>: <pre>Patch Set 5:

(2 comments)

Hi Ale,
Thanks much. Just one minor comment below. 
With kind regards,
Elli</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 2/13/2017, 4:57:46 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Thanks Elli, both great questions, I think we'll have to discuss them further because two things are not clear at this stage:
1) the format of the MSP ID (e.g. which characters are legal etc.)
2) the default name of the local MSP of a peer (it's currently "DEFAULT" in the current version in core.yaml, but Binh was suggesting we pick a different name)</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 2/13/2017, 5:25:46 AM<br><strong>Message</strong>: <pre>Patch Set 5: -Code-Review

You cannot pick a different name in this change set.
That would break gossip.</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 2/13/2017, 6:28:39 AM<br><strong>Message</strong>: <pre>Patch Set 5: Code-Review+2

(1 comment)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 2/13/2017, 10:03:41 AM<br><strong>Message</strong>: <pre>Patch Set 5: Code-Review-1

We need a decision on this and I can't proceed until one is made</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 2/13/2017, 11:01:56 AM<br><strong>Message</strong>: <pre>Uploaded patch set 6.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/13/2017, 11:05:06 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/6852/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/13/2017, 12:03:01 PM<br><strong>Message</strong>: <pre>Patch Set 6: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/6852/ : SUCCESS</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 2/13/2017, 12:35:45 PM<br><strong>Message</strong>: <pre>Uploaded patch set 7.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/13/2017, 12:44:46 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/6874/</pre><strong>Reviewer</strong>: Elli Androulaki - lli@zurich.ibm.com<br><strong>Reviewed</strong>: 2/13/2017, 1:22:23 PM<br><strong>Message</strong>: <pre>Patch Set 7:

(1 comment)

Hi, Ale

Thanks for your response! I understand the issue (1), and makes sense that this is added later (if at all). For (2) I think we may need a longer discussion (expanding on the discussion in today's scrum) so  opening it up to all :)

What I understood is that we would need to set a default MSP identifier for the peer local MSP. 

What I am not clear on is why do we need to have a default identifier for a peer's (local) MSP. Can't we enforce that an MSPIdentifier is passed to the peer at setup time for the peer to be successfully setup or otherwise the reboot would fail? 

It seems to me that the choice of such an identifier is sort of an application's decision to take, as it will need to match a verifier MSP on a chain/ultimately used in policies etc. 

If we decide we need defaults, cant we later apply this at the configuration level (no?)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/13/2017, 1:43:14 PM<br><strong>Message</strong>: <pre>Patch Set 7: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/6874/ : SUCCESS</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 2/13/2017, 1:59:28 PM<br><strong>Message</strong>: <pre>Uploaded patch set 8.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/13/2017, 2:29:51 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/6896/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/13/2017, 3:26:46 PM<br><strong>Message</strong>: <pre>Patch Set 8: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/6896/ : SUCCESS</pre><strong>Reviewer</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>Reviewed</strong>: 2/13/2017, 3:52:04 PM<br><strong>Message</strong>: <pre>Patch Set 8: Code-Review+2</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 2/13/2017, 3:53:02 PM<br><strong>Message</strong>: <pre>Patch Set 8: Code-Review+2</pre><strong>Reviewer</strong>: Gerrit Code Review - gerrit@hyperledger.org<br><strong>Reviewed</strong>: 2/13/2017, 3:53:19 PM<br><strong>Message</strong>: <pre>Change has been successfully merged by Yacov Manevich</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/13/2017, 3:57:11 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-x86_64/1051/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/13/2017, 4:54:44 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-merge-x86_64/1051/ : SUCCESS</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 1/31/2017, 6:47:59 AM<br><strong>UnmergedRevision</strong>: 78ae5a2e1d9d1845a84f88de4f826bf394c024a4<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/31/2017, 8:01:43 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 1/31/2017, 6:51:24 AM<br><strong>UnmergedRevision</strong>: 3220689edf167d0e031918ead45d2bb5dd17dc3c<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/31/2017, 8:03:02 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Approved</strong>: 1/31/2017, 11:26:51 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 2/12/2017, 6:29:38 AM<br><strong>UnmergedRevision</strong>: 092dd89b12d3649f04476af89cc23e5ed9341022<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/12/2017, 6:34:49 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 2/12/2017, 6:51:56 AM<br><strong>UnmergedRevision</strong>: c30062873cf7b6840af6a808bc7da467a6f2b73d<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/12/2017, 6:58:12 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 5</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 2/12/2017, 6:59:12 AM<br><strong>UnmergedRevision</strong>: 8567a5b679e84c71cedf50716003146c4f474943<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/12/2017, 7:59:08 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>Approved</strong>: 2/12/2017, 10:09:32 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Approved</strong>: 2/13/2017, 6:28:39 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Approved</strong>: 2/13/2017, 10:03:41 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 6</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 2/13/2017, 11:01:56 AM<br><strong>UnmergedRevision</strong>: ce6c96e9aaee3f13c54fd08d727d6825e8594d2e<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/13/2017, 12:03:01 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 7</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 2/13/2017, 12:35:45 PM<br><strong>UnmergedRevision</strong>: 228b727da47349e3fe5462b616750833bd4cc438<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/13/2017, 1:43:14 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 8</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 2/13/2017, 1:59:28 PM<br><strong>GitHubMergedRevision</strong>: [f30e1b64f3ae32ebf56f8fba5f136fa090452480](https://github.com/hyperledger/fabric/commit/f30e1b64f3ae32ebf56f8fba5f136fa090452480)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/13/2017, 3:26:46 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>Approved</strong>: 2/13/2017, 3:52:04 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Approved</strong>: 2/13/2017, 3:53:02 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Yacov Manevich<br><strong>Merged</strong>: 2/13/2017, 3:53:19 PM<br><br></blockquote>