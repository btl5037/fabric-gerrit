<strong>Project</strong>: fabric<br><strong>Branch</strong>: master<br><strong>ID</strong>: 27227<br><strong>Subject</strong>: WIP - Squashed stack for review<br><strong>Status</strong>: ABANDONED<br><strong>Owner</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 10/26/2018, 11:08:25 AM<br><strong>LastUpdated</strong>: 12/22/2018, 7:49:28 PM<br><strong>CommitMessage</strong>:<br><pre>WIP - Squashed stack for review

[FAB-12155] PolicyValidator

This change-set does the following:
1. Implementes the PolicyValidator interface
in the following way: The IsIssuer method checks if
the passed credential correspond to that of a valid
member of a Fabric channel the validator is bound to.
The Fabric channel is representetd by an MSP manager that collects
all the MSPs registered in that channel.
2. It modify the manager.Manager to use the
implementation introduced in point 1.
3. Refactor the interfaces to avoid circual package dependecy

[FAB-12006] Add FabToken capability

- Add FabToken() to ApplicationCapabilities interface
- Introduce V1_4_FABTOKEN_EXPERIMENTAL to enable FabToken

[FAB-11940] Enable Token-tx validation path

This CR adds a simple validation path for token transactions that
does not make any checks outside the correctness and uniqueness of
of the transaction identifier. If these two checks succeed, the
token transaction is considered valid, and it proceeds to the commit
process.

[FAB-11941] Commit token tx via custom processor

- Register token tx Processor with customtx
- Correct the method name in FabricIdentityDeserializerManager

[FAB-11300] Token tx client and e2e test - issue tokens

- Implement TxSubmitter to send transaction
- Support both blocking and nonblocking calls to applications
- Implement client to send tx to orderer broadcast service
- Implement client to receive commit response from peer deliver service
- Add unit tests and e2e test

[FAB-11354] Process issue request with a plain issuer

- Implement TMSManager to return a plain issuer
- Implement tests to issue tokens with a plain issuer
- Implement tests to simulate a client calling prover grpc service

[FAB-11294] Prover Service - List Tokens

This change-set does the following:
- Update prover.proto to support ListUnspentTokens command
- Implement ListUnspentTokens for Prover service
- Add transactor interface to reduce dependency on TMS

[FAB-11359] tms transactor: list tokens

- add GetStateRangeScanIterator() to the LedgerReader interface
- implement tms ListTokens
- add proto messages for unspent tokens
- test

[FAB-11360] Prover Server: ListTokens using tms

- add transactor method ListTokens
- update marshaler to parse listokens command
- implement TMSManager using plain.Transactor
- add test

[FAB-11526] Prover: Request Transfer

This change-set does the following:
- Impliments support for the SignedCommand related to
a request trasnfer
- Local interfaces have been introduces to reduce
dependency from TMS

[FAB-11371] TMS transactor to transfer tokens

Adding a transactor that can be used to create token transfer requests.
The pool is also enhanced to remove entries from the pool as they are
transferred (spent). The validation and commit functions of the
verifier are enhanced to verify transfer requests.

[FAB-11372] Prover Server: Transfer using TMS

- test Prover RequestTransfer
- test ProcessCommand with transfer command
- test grpc connection

[FAB-11679] Prover: RedeemRequest

- Add proto messages for redeem to prover and token transaction
- Add RequestRedeem method to prover.go
- Update transactor local interface
- Unit tests with mocked transactor

[FAB-11680] TMS transactor: RequestRedeem

- implement RequestRedeem method in transactor.go
- move common code for transfer and redeem to a seperate method
- add unit tests

[FAB-11678] TX processor/verifier: redeem tokens

- Add tx support to redeem tokens in verifier.go
- Share code with transfer outputs

[FAB-12563] Prover Server: Approve

-- add RequestApprove method to prover
-- add RequestApprove method to the transactor interface
-- add unit tests

[FAB-12460] transactor/verifier: ApproveRequest

- add approve request method to the transactor
- add methods to verify approve request txs
- add tests for transactor and verifier

[FAB-12458] ProverServer: Approve with TMS

-- add test file that tests the prover with a tms transactor

Change-Id: I5f07a01b357c179bcc720262fdef7c1db7243cad
Signed-off-by: Matthew Sykes <sykesmat@us.ibm.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Reviewed</strong>: 10/26/2018, 11:08:25 AM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Reviewed</strong>: 10/29/2018, 3:17:05 PM<br><strong>Message</strong>: <pre>Patch Set 1: Code-Review-2

(136 comments)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/29/2018, 3:22:13 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/6562/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/29/2018, 3:22:53 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/29/2018, 3:22:55 PM<br><strong>Message</strong>: <pre>Patch Set 1:

WIP - No Build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/29/2018, 3:24:06 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/6562/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/6562</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 10/29/2018, 4:08:07 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(2 comments)</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 10/29/2018, 4:56:25 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(9 comments)</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 10/30/2018, 1:25:16 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(3 comments)</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 10/31/2018, 2:26:55 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(2 comments)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 11/1/2018, 1:26:50 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(21 comments)

First batch of comments from my side - almost done :) Thanks so much for this huge amount of work!</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 11/2/2018, 7:01:23 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(1 comment)</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 11/2/2018, 7:09:41 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(2 comments)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 11/2/2018, 1:02:26 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(4 comments)

2nd batch</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 11/2/2018, 1:14:13 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(1 comment)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 11/2/2018, 1:18:18 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(1 comment)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 11/3/2018, 4:29:55 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(1 comment)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 11/3/2018, 6:21:43 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(2 comments)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 11/5/2018, 5:44:16 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(9 comments)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 11/5/2018, 12:58:31 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(9 comments)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 11/6/2018, 3:58:49 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(3 comments)</pre><strong>Reviewer</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Reviewed</strong>: 11/19/2018, 2:34:04 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(74 comments)</pre><strong>Reviewer</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Reviewed</strong>: 11/20/2018, 9:33:37 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(3 comments)

Thank you for your review. Below comments are address in https://gerrit.hyperledger.org/r/#/c/27664/</pre><strong>Reviewer</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Reviewed</strong>: 11/20/2018, 11:29:30 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(5 comments)

Thanks for code review. Below comments are addressed in https://gerrit.hyperledger.org/r/#/c/26646/14</pre><strong>Reviewer</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>Reviewed</strong>: 11/21/2018, 5:44:35 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(1 comment)</pre><strong>Reviewer</strong>: Kaoutar Elkhiyaoui - kao@zurich.ibm.com<br><strong>Reviewed</strong>: 11/21/2018, 7:40:29 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(40 comments)</pre><strong>Reviewer</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>Reviewed</strong>: 11/29/2018, 7:43:31 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(1 comment)</pre><strong>Reviewer</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Reviewed</strong>: 11/29/2018, 9:24:26 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(16 comments)

Thank you for code review. The following comments have been addressed.</pre><strong>Reviewer</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Reviewed</strong>: 11/30/2018, 11:32:08 AM<br><strong>Message</strong>: <pre>Abandoned</pre><strong>Reviewer</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Reviewed</strong>: 12/4/2018, 1:59:55 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(6 comments)

Due to CR split, the following comments are addressed in CR https://gerrit.hyperledger.org/r/#/c/27926/</pre><strong>Reviewer</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Reviewed</strong>: 12/5/2018, 3:25:48 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(13 comments)

Addressed below comments for tx_submitter.go in https://gerrit.hyperledger.org/r/#/c/27956/</pre><strong>Reviewer</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Reviewed</strong>: 12/18/2018, 1:39:24 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(4 comments)

Below comments are addressed.</pre><strong>Reviewer</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Reviewed</strong>: 12/18/2018, 2:09:16 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(13 comments)

Below comments are addressed.</pre><strong>Reviewer</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Reviewed</strong>: 12/22/2018, 7:41:40 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(16 comments)</pre><strong>Reviewer</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>Reviewed</strong>: 12/22/2018, 7:49:28 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(11 comments)</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>Uploader</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Created</strong>: 10/26/2018, 11:08:25 AM<br><strong>UnmergedRevision</strong>: [5f159c528c9a0f4ab67c964c8c51228adcc79173](https://github.com/hyperledger-gerrit-archive/fabric/commit/5f159c528c9a0f4ab67c964c8c51228adcc79173)<br><br><strong>Approver</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Approved</strong>: 10/29/2018, 3:17:05 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L197](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/core/committer/txvalidator/validator.go#L197)<br><strong>Comment</strong>: <pre>Was this accidentally left behind? Looks like a debug statement.

If it's actually something that should be logged as an error, the message needs to be rewritten.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L197](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/core/committer/txvalidator/validator.go#L197)<br><strong>Comment</strong>: <pre>Removed in FAB-12814</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L254](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/core/committer/txvalidator/validator.go#L254)<br><strong>Comment</strong>: <pre>Same as above. Was this accidentally left behind?</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L254](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/core/committer/txvalidator/validator.go#L254)<br><strong>Comment</strong>: <pre>Removed in FAB-12814</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L390](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/core/committer/txvalidator/validator.go#L390)<br><strong>Comment</strong>: <pre>Suggestion: Unsupported transaction type [%s] in block number [%d] transaction index [%d]: FabToken capability is not enabled

This is symmetric with the message below on line 435 and provides the reason after the error - which is conventional.</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L390](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/core/committer/txvalidator/validator.go#L390)<br><strong>Comment</strong>: <pre>this should not be an error.... it should be debug.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L390](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/core/committer/txvalidator/validator.go#L390)<br><strong>Comment</strong>: <pre>Done
https://gerrit.hyperledger.org/r/#/c/27793/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L390](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/core/committer/txvalidator/validator.go#L390)<br><strong>Comment</strong>: <pre>Done
https://gerrit.hyperledger.org/r/#/c/27793/</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L410](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/core/committer/txvalidator/validator.go#L410)<br><strong>Comment</strong>: <pre>should be a constant</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L410](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/core/committer/txvalidator/validator.go#L410)<br><strong>Comment</strong>: <pre>Removed because the setting is not needed for token transactions.
https://gerrit.hyperledger.org/r/#/c/27793/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L411](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/core/committer/txvalidator/validator.go#L411)<br><strong>Comment</strong>: <pre>nit: dangling brace goes on new line  - like pretty much every other literal in this file</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L411](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/core/committer/txvalidator/validator.go#L411)<br><strong>Comment</strong>: <pre>Is setting this necessary? I think it only matters for endorser transactions.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L411](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/core/committer/txvalidator/validator.go#L411)<br><strong>Comment</strong>: <pre>Agree, the setting is not needed for token transactions.
https://gerrit.hyperledger.org/r/#/c/27793/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L411](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/core/committer/txvalidator/validator.go#L411)<br><strong>Comment</strong>: <pre>Removed because the setting is not needed for token transactions.
https://gerrit.hyperledger.org/r/#/c/27793/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L476](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/core/committer/txvalidator/validator.go#L476)<br><strong>Comment</strong>: <pre>Why the named return?</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L476](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/core/committer/txvalidator/validator.go#L476)<br><strong>Comment</strong>: <pre>Removed.
https://gerrit.hyperledger.org/r/#/c/27793/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L498](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/core/committer/txvalidator/validator.go#L498)<br><strong>Comment</strong>: <pre>Does "Aborting" mean something specific here?</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L498](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/core/committer/txvalidator/validator.go#L498)<br><strong>Comment</strong>: <pre>Why did we break a perfectly readable line into two parts when we moved this?</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L498](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/core/committer/txvalidator/validator.go#L498)<br><strong>Comment</strong>: <pre>Done.
https://gerrit.hyperledger.org/r/#/c/27793/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L498](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/core/committer/txvalidator/validator.go#L498)<br><strong>Comment</strong>: <pre>Removed "Aborting".
https://gerrit.hyperledger.org/r/#/c/27793/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L507](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/core/committer/txvalidator/validator.go#L507)<br><strong>Comment</strong>: <pre>This block is logically a type switch. In many ways it would be clearer (and consistent with other type checks in this file) f it were implemented as such:

switch err.(type) {
case nil:
    // Duplicate transaction
case ledger.NotFoundInIndexErr:
    // Ledger failure attempting to detect
default:
    // happy return
}</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L507](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/core/committer/txvalidator/validator.go#L507)<br><strong>Comment</strong>: <pre>Done.
https://gerrit.hyperledger.org/r/#/c/27793/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/common/validation/msgvalidation.go#L226](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/core/common/validation/msgvalidation.go#L226)<br><strong>Comment</strong>: <pre>this is crying out for a switch</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/common/validation/msgvalidation.go#L226](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/core/common/validation/msgvalidation.go#L226)<br><strong>Comment</strong>: <pre>Done.
https://gerrit.hyperledger.org/r/#/c/27793/</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/common/validation/msgvalidation.go#L445](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/core/common/validation/msgvalidation.go#L445)<br><strong>Comment</strong>: <pre>You may want to add some basic sanity checks (like expected fields in your protomessage do not contain 0-length slices), like we do in validateConfigTransaction.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/common/validation/msgvalidation.go#L445](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/core/common/validation/msgvalidation.go#L445)<br><strong>Comment</strong>: <pre>Added validateTokenTransaction.
https://gerrit.hyperledger.org/r/#/c/27793/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/common/validation/msgvalidation.go#L459](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/core/common/validation/msgvalidation.go#L459)<br><strong>Comment</strong>: <pre>This is untested; we should have tests for these blocks.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/common/validation/msgvalidation.go#L459](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/core/common/validation/msgvalidation.go#L459)<br><strong>Comment</strong>: <pre>Added unit tests.
https://gerrit.hyperledger.org/r/#/c/27793/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/handlers/validation/builtin/v12/mocks/capabilities.go#L51](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/core/handlers/validation/builtin/v12/mocks/capabilities.go#L51)<br><strong>Comment</strong>: <pre>This is probably just how it's done but it feels a little odd to have these accessors in 1.2 and 1.3. I understand this is generated because we're embedding the Capabilities interface but is that really how this is supposed to work?</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/handlers/validation/builtin/v12/mocks/capabilities.go#L51](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/core/handlers/validation/builtin/v12/mocks/capabilities.go#L51)<br><strong>Comment</strong>: <pre>This is needed. Otherwise got build error:
core/handlers/validation/builtin/default_validation_test.go:46:3: cannot use capabilities (type *"github.com/hyperledger/fabric/core/handlers/validation/builtin/v12/mocks".Capabilities) as type "github.com/hyperledger/fabric/core/handlers/validation/api/capabilities".Capabilities in field value:
	*"github.com/hyperledger/fabric/core/handlers/validation/builtin/v12/mocks".Capabilities does not implement "github.com/hyperledger/fabric/core/handlers/validation/api/capabilities".Capabilities (missing FabToken method)</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/peer/configtx_test.go#L144](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/core/peer/configtx_test.go#L144)<br><strong>Comment</strong>: <pre>For the token transaction processor, for better or worse, these tests are in the same package as the instance were expecting. Can we change the assertion to validate that what we get back equals the peer.tokenTxProcessor? Alternatively, the expected literal?

We want to use stronger assertions where we can.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/peer/configtx_test.go#L144](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/core/peer/configtx_test.go#L144)<br><strong>Comment</strong>: <pre>Done.
https://gerrit.hyperledger.org/r/#/c/27793/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/peer/peer.go#L56](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/core/peer/peer.go#L56)<br><strong>Comment</strong>: <pre>nit: please put closing brace of multi-line struct literals on their own lines - just like the map declaration below this.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [core/peer/peer.go#L56](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/core/peer/peer.go#L56)<br><strong>Comment</strong>: <pre>Done.
https://gerrit.hyperledger.org/r/#/c/27793/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [integration/nwo/configtx_template.go#L119](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/integration/nwo/configtx_template.go#L119)<br><strong>Comment</strong>: <pre>This shouldn't be here. If this is something we want to generate in some cases, it needs to be templated.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [integration/nwo/configtx_template.go#L119](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/integration/nwo/configtx_template.go#L119)<br><strong>Comment</strong>: <pre>Added V1_4_FABTOKEN_EXPERIMENTAL to configtx template in https://gerrit.hyperledger.org/r/#/c/27664/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [integration/token/token_test.go#L55](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/integration/token/token_test.go#L55)<br><strong>Comment</strong>: <pre>Since we don't need to deal with multiple consensus implementations, this describe can be dropped and the before each that follows can be merged into the top.

Basically, this test is describe "Token EndToEnd"/BeforeEach/AfterEach/It executes...  The rest of the boilerplate can be dropped.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [integration/token/token_test.go#L55](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/integration/token/token_test.go#L55)<br><strong>Comment</strong>: <pre>Fixed in https://gerrit.hyperledger.org/r/#/c/27664/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [integration/token/token_test.go#L156](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/integration/token/token_test.go#L156)<br><strong>Comment</strong>: <pre>This isn't how we should be modifying the configuration. If we want the capabilities to be configurable at the time the network is created, they should be exposed on the configuration object and setup in the template.

That means, by extension, that config is extended to hold maps of additional application and orderer capabilities. The templates Then get updated to range over those key value pairs to add them to the correct stanzas.

We really don't want a pattern of text file manipulation to find its way into the integration tests.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [integration/token/token_test.go#L156](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/integration/token/token_test.go#L156)<br><strong>Comment</strong>: <pre>Fixed in https://gerrit.hyperledger.org/r/#/c/27664/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [protos/token/prover.proto#L0](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/protos/token/prover.proto#L0)<br><strong>Comment</strong>: <pre>For the documentation/comments, we should try to be consistent with respect to capitalization and whether or not we end sentences with a period. We're missing that consistency right now.</pre><strong>Commenter</strong>: Kaoutar Elkhiyaoui - kao@zurich.ibm.com<br><strong>CommentLine</strong>: [protos/token/prover.proto#L0](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/protos/token/prover.proto#L0)<br><strong>Comment</strong>: <pre>To be fixed throughout the code</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [protos/token/prover.proto#L50](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/protos/token/prover.proto#L50)<br><strong>Comment</strong>: <pre>listRequest here and ListRequest on line 38. They should probably be the same.</pre><strong>Commenter</strong>: Kaoutar Elkhiyaoui - kao@zurich.ibm.com<br><strong>CommentLine</strong>: [protos/token/prover.proto#L50](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/protos/token/prover.proto#L50)<br><strong>Comment</strong>: <pre>Done
https://gerrit.hyperledger.org/r/#/c/27660/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [protos/token/prover.proto#L57](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/protos/token/prover.proto#L57)<br><strong>Comment</strong>: <pre>Can we extend the documentation for this element? Does it mirror the doc from RedeemRequest's credential?</pre><strong>Commenter</strong>: Kaoutar Elkhiyaoui - kao@zurich.ibm.com<br><strong>CommentLine</strong>: [protos/token/prover.proto#L57](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/protos/token/prover.proto#L57)<br><strong>Comment</strong>: <pre>Done
https://gerrit.hyperledger.org/r/#/c/27660/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [protos/token/prover.proto#L76](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/protos/token/prover.proto#L76)<br><strong>Comment</strong>: <pre>Should we add field documentation? This is our API.</pre><strong>Commenter</strong>: Kaoutar Elkhiyaoui - kao@zurich.ibm.com<br><strong>CommentLine</strong>: [protos/token/prover.proto#L76](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/protos/token/prover.proto#L76)<br><strong>Comment</strong>: <pre>Done
https://gerrit.hyperledger.org/r/#/c/27660/</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [protos/token/prover.proto#L79](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/protos/token/prover.proto#L79)<br><strong>Comment</strong>: <pre>I think it would be useful to clarify what this implies - is it the opposite of issue?</pre><strong>Commenter</strong>: Kaoutar Elkhiyaoui - kao@zurich.ibm.com<br><strong>CommentLine</strong>: [protos/token/prover.proto#L79](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/protos/token/prover.proto#L79)<br><strong>Comment</strong>: <pre>Done
https://gerrit.hyperledger.org/r/#/c/27660/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [protos/token/prover.proto#L85](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/protos/token/prover.proto#L85)<br><strong>Comment</strong>: <pre>All other field documentation seems to upper case the field name in the doc. Probably should be consistent.</pre><strong>Commenter</strong>: Kaoutar Elkhiyaoui - kao@zurich.ibm.com<br><strong>CommentLine</strong>: [protos/token/prover.proto#L85](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/protos/token/prover.proto#L85)<br><strong>Comment</strong>: <pre>Done
https://gerrit.hyperledger.org/r/#/c/27660/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [protos/token/prover.proto#L88](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/protos/token/prover.proto#L88)<br><strong>Comment</strong>: <pre>This isn't the name of the field and, unlike most names in the field documentation, it's not upper cased.</pre><strong>Commenter</strong>: Kaoutar Elkhiyaoui - kao@zurich.ibm.com<br><strong>CommentLine</strong>: [protos/token/prover.proto#L88](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/protos/token/prover.proto#L88)<br><strong>Comment</strong>: <pre>Done
https://gerrit.hyperledger.org/r/#/c/27660/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [protos/token/prover.proto#L89](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/protos/token/prover.proto#L89)<br><strong>Comment</strong>: <pre>should this simply be "quantity?"</pre><strong>Commenter</strong>: Kaoutar Elkhiyaoui - kao@zurich.ibm.com<br><strong>CommentLine</strong>: [protos/token/prover.proto#L89](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/protos/token/prover.proto#L89)<br><strong>Comment</strong>: <pre>Done
https://gerrit.hyperledger.org/r/#/c/27660/</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [protos/token/prover.proto#L92](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/protos/token/prover.proto#L92)<br><strong>Comment</strong>: <pre>Looks like a capitalized L got away there. Plus, I'd keep this word in sync with the name of the protobuf message</pre><strong>Commenter</strong>: Kaoutar Elkhiyaoui - kao@zurich.ibm.com<br><strong>CommentLine</strong>: [protos/token/prover.proto#L92](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/protos/token/prover.proto#L92)<br><strong>Comment</strong>: <pre>Done
https://gerrit.hyperledger.org/r/#/c/27660/</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [protos/token/prover.proto#L93](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/protos/token/prover.proto#L93)<br><strong>Comment</strong>: <pre>This message is called AllowanceRecipientShare, and we have RecipientTransferShare. Do we want to uniform the wording? RecipientAllowanceShare and RecipientTransferShare, or AllowanceRecipientShare and TransferRecipientShare - wdyt? Alternatively, given that the two messages are identical, can we just go for a single message called TransferShare or Share?</pre><strong>Commenter</strong>: Kaoutar Elkhiyaoui - kao@zurich.ibm.com<br><strong>CommentLine</strong>: [protos/token/prover.proto#L93](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/protos/token/prover.proto#L93)<br><strong>Comment</strong>: <pre>Done
https://gerrit.hyperledger.org/r/#/c/27660/</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [protos/token/prover.proto#L102](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/protos/token/prover.proto#L102)<br><strong>Comment</strong>: <pre>iiuc this message is tightly coupled with allowances. How about we reflect this fact in the name of the message? Like "ApproveAllowanceRequest"?</pre><strong>Commenter</strong>: Kaoutar Elkhiyaoui - kao@zurich.ibm.com<br><strong>CommentLine</strong>: [protos/token/prover.proto#L102](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/protos/token/prover.proto#L102)<br><strong>Comment</strong>: <pre>Done
https://gerrit.hyperledger.org/r/#/c/27660/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [protos/token/transaction.proto#L0](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/protos/token/transaction.proto#L0)<br><strong>Comment</strong>: <pre>The style of documentation (and whitespace et al) of the .protos in this folder should be similar. Might be worthwhile to see where there are differences, choose. a pattern, and go with it.

Examples: periods at the end of doc sentences, white space as first line of message definition</pre><strong>Commenter</strong>: Kaoutar Elkhiyaoui - kao@zurich.ibm.com<br><strong>CommentLine</strong>: [protos/token/transaction.proto#L0](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/protos/token/transaction.proto#L0)<br><strong>Comment</strong>: <pre>To be fixed</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [protos/token/transaction.proto#L57](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/protos/token/transaction.proto#L57)<br><strong>Comment</strong>: <pre>Endorser transaction messages support >1 action (even though the current version of fabric won't process that). Should we make this field repeated to mirror that choice?</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [protos/token/transaction.proto#L105](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/protos/token/transaction.proto#L105)<br><strong>Comment</strong>: <pre>missing space between operator and number</pre><strong>Commenter</strong>: Kaoutar Elkhiyaoui - kao@zurich.ibm.com<br><strong>CommentLine</strong>: [protos/token/transaction.proto#L105](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/protos/token/transaction.proto#L105)<br><strong>Comment</strong>: <pre>Done
https://gerrit.hyperledger.org/r/#/c/27660/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/config.go#L6](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/config.go#L6)<br><strong>Comment</strong>: <pre>Nit - we should have a blank line between the copyright and the package declaration. True for most of the files in this package.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/config.go#L6](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/config.go#L6)<br><strong>Comment</strong>: <pre>Fixed in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/config.go#L6](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/config.go#L6)<br><strong>Comment</strong>: <pre>Change CR to https://gerrit.hyperledger.org/r/#/c/27926/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/config.go#L26](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/config.go#L26)<br><strong>Comment</strong>: <pre>Nit - names

ID instead of Id: https://github.com/golang/go/wiki/CodeReviewComments#initialisms
TLS instead of Tls
MSP instead of Msp

Also, Cfg is a good shorthand for a function variable but we should spell it out as Config when it's a dependency injection point.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/config.go#L26](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/config.go#L26)<br><strong>Comment</strong>: <pre>Fixed in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/config.go#L26](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/config.go#L26)<br><strong>Comment</strong>: <pre>Change CR to https://gerrit.hyperledger.org/r/#/c/27926/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/config.go#L29](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/config.go#L29)<br><strong>Comment</strong>: <pre>This should be by value, not by reference.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/config.go#L29](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/config.go#L29)<br><strong>Comment</strong>: <pre>Fixed in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/config.go#L29](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/config.go#L29)<br><strong>Comment</strong>: <pre>Change CR to https://gerrit.hyperledger.org/r/#/c/27926/</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [token/client/config.go#L53](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/config.go#L53)<br><strong>Comment</strong>: <pre>JIRA? And I'm curious, what kind of validation are we talking about? I'm trying to focus on understanding the threat model and so this kind of information is interesting - thanks!</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/config.go#L53](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/config.go#L53)<br><strong>Comment</strong>: <pre>Added in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/config.go#L53](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/config.go#L53)<br><strong>Comment</strong>: <pre>Change CR to https://gerrit.hyperledger.org/r/#/c/27926/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/config.go#L54](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/config.go#L54)<br><strong>Comment</strong>: <pre>none of this is tested. The only caller is in another function that's untested: NewTxSubmitter</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/config.go#L54](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/config.go#L54)<br><strong>Comment</strong>: <pre>Test added in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/config.go#L54](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/config.go#L54)<br><strong>Comment</strong>: <pre>Change CR to https://gerrit.hyperledger.org/r/#/c/27926/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L18](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L18)<br><strong>Comment</strong>: <pre>These are binding this code to the fabric implementation; the implication is that it won't be easily extractable for general purpose use.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L18](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L18)<br><strong>Comment</strong>: <pre>Currently token/client package is used for integration e2e tests. If SDK will be extended to support tokens, we probably don't need to extract this package.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L26](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L26)<br><strong>Comment</strong>: <pre>We have a 'mock' folder here and a 'mocks' folder; we should choose one.

ok  	github.com/hyperledger/fabric/token/client	1.128s	coverage: 63.6% of statements
?   	github.com/hyperledger/fabric/token/client/mock	[no test files]
?   	github.com/hyperledger/fabric/token/client/mocks	[no test files]

Also, pretty low test coverage for a new component that uses dependency injection. Raises a flag for me.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L26](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L26)<br><strong>Comment</strong>: <pre>The 2 directories were due to parallel development - both mockery and counterfeiter were used. Have consolidated to a single mock directory in https://gerrit.hyperledger.org/r/#/c/27278/</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L43](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L43)<br><strong>Comment</strong>: <pre>we don't need the TLS certificate object... we need only the raw DER bytes. So please just pass them and that's it.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L43](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L43)<br><strong>Comment</strong>: <pre>Updated in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L44](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L44)<br><strong>Comment</strong>: <pre>Based on the constructor below, it looks like we're defining an interface we implement instead of one we consume. While this makes sense in some contexts, why are we doing it here? What does this offer that exported methods on the implementation don't?

This is one of the patterns we're trying to avoid unless there's a really good reason for it.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L44](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L44)<br><strong>Comment</strong>: <pre>The local interface was introduced for unit tests so that we can mock the grpc calls.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L47](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L47)<br><strong>Comment</strong>: <pre>Why isn't the struct exported?</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L47](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L47)<br><strong>Comment</strong>: <pre>Fixed in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L47](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L47)<br><strong>Comment</strong>: <pre>Fixed in https://gerrit.hyperledger.org/r/#/c/28302/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L54](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L54)<br><strong>Comment</strong>: <pre>This function is completely untested; why has it been implemented?</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L54](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L54)<br><strong>Comment</strong>: <pre>Why is a constructor returning an interface?</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L54](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L54)<br><strong>Comment</strong>: <pre>Fixed in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L54](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L54)<br><strong>Comment</strong>: <pre>Refactored and added tests in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L54](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L54)<br><strong>Comment</strong>: <pre>Fxied in https://gerrit.hyperledger.org/r/#/c/28302/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L57](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L57)<br><strong>Comment</strong>: <pre>aka WithMessagef

https://godoc.org/github.com/pkg/errors#WithMessagef</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L57](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L57)<br><strong>Comment</strong>: <pre>Got compilation error if changed to WithMessagef. The errors package in fabric/vendor is not the latest version.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L63](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L63)<br><strong>Comment</strong>: <pre>aka WithMessagef</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L63](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L63)<br><strong>Comment</strong>: <pre>Got compilation error if changed to WithMessagef. The errors package in fabric/vendor is not the latest version.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L75](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L75)<br><strong>Comment</strong>: <pre>This method is completely untested; why has it been implemented?</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L75](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L75)<br><strong>Comment</strong>: <pre>Added tests in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L75](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L75)<br><strong>Comment</strong>: <pre>This method has been tested in e2e tests because it depends on a grpc server. Agree should also have a unit tests, added in https://gerrit.hyperledger.org/r/#/c/28302/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L79](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L79)<br><strong>Comment</strong>: <pre>Can you explain what this means? This, to me, is a side effect with very unexpected behavior.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L79](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L79)<br><strong>Comment</strong>: <pre>Fixed in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L79](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L79)<br><strong>Comment</strong>: <pre>Fxied in https://gerrit.hyperledger.org/r/#/c/28302/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L92](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L92)<br><strong>Comment</strong>: <pre>why a value fill-in instead of just calling Message on the status?</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L92](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L92)<br><strong>Comment</strong>: <pre>Fixed in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L92](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L92)<br><strong>Comment</strong>: <pre>Got linter error if %+v is changed to %s. Cannot simply call rpcStatus.Message() because rpcStatus may be nil.

We can remove rpcStatus because the wrapped err should already contain rpcStatus. 
https://gerrit.hyperledger.org/r/#/c/28302/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L113](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L113)<br><strong>Comment</strong>: <pre>Untested block. Needs some test.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L113](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L113)<br><strong>Comment</strong>: <pre>This block is removed in https://gerrit.hyperledger.org/r/#/c/27447/ because it is premature to have code for mutual TLS. Will add mutual TLS support when needed.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L113](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L113)<br><strong>Comment</strong>: <pre>Done, https://gerrit.hyperledger.org/r/#/c/28302</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L154](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L154)<br><strong>Comment</strong>: <pre>These functions confuse me. We have:

DeliverSend
DeliverReceive
DeliverWaitForResponse

Those, in turn, use:

df.Send
df.Receive

I don't understand why we don't return something (DeliverFiltered) that doesn't do what we want; Instead, we should return something that uses DeliverFiltered to do what we want. ie. an object that submits a transaction and waits for it to commit or timeout. All in one.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L154](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L154)<br><strong>Comment</strong>: <pre>These methods communicate with a stream grpc service to request for transaction completion response. In TxSubmitter.Submit method, the flow is: (1) call Send&Recv first (i.e., listen to the tx completion based on txid); (2) broadcast the tx is broadcasted to the orderer (orderer will send the tx block to committer peers). (3) read the TxEvent from the channel to know if tx is committed or not.

Moved the methods to an object in https://gerrit.hyperledger.org/r/#/c/27447/, but still need 2 methods: ListenToTxEvent and WaitForTxEvent.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L154](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L154)<br><strong>Comment</strong>: <pre>DeliverFiltered is a stream grpc service. We have to call df.Recv multiple times until either the tx event is received or context is timed out. Plus df.Recv has to be called in a different thread. So we need 3 methods to complete the flow:
1. DeliverSend - call df.Send request
2. DeliverReceive - call "go df.Recv" to loop through until receiving response
3. DeliverWaitForResponse - wait until the channel has tx event or context is done</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L163](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L163)<br><strong>Comment</strong>: <pre>This needs a direction; you want a channel that you can send to so it should be expliicit by using eventCh chan<- TxEvent.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L163](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L163)<br><strong>Comment</strong>: <pre>Fixed in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L163](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L163)<br><strong>Comment</strong>: <pre>Done in https://gerrit.hyperledger.org/r/#/c/27956/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L186](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L186)<br><strong>Comment</strong>: <pre>Untested.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L186](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L186)<br><strong>Comment</strong>: <pre>Added test in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L186](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L186)<br><strong>Comment</strong>: <pre>Done in https://gerrit.hyperledger.org/r/#/c/28302/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L196](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L196)<br><strong>Comment</strong>: <pre>Untested</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L196](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L196)<br><strong>Comment</strong>: <pre>please extract method.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L196](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L196)<br><strong>Comment</strong>: <pre>Added test in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L196](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L196)<br><strong>Comment</strong>: <pre>Done in https://gerrit.hyperledger.org/r/#/c/28302/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L196](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L196)<br><strong>Comment</strong>: <pre>Done in https://gerrit.hyperledger.org/r/#/c/28302/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L205](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L205)<br><strong>Comment</strong>: <pre>Logging in clients through without a providing a means for users to plug in their own logger is probably not a good idea. They get coupled to the fabric implementation and we get stuck supporting things we want to move away from.

So, let's remove the logging. It's not generally useful anyway; we should be using interceptors when we need to.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L205](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L205)<br><strong>Comment</strong>: <pre>Removed in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L218](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L218)<br><strong>Comment</strong>: <pre>if we don't care if the channel is still open, simply omit this</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L218](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L218)<br><strong>Comment</strong>: <pre>Fixed in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L218](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L218)<br><strong>Comment</strong>: <pre>Done, https://gerrit.hyperledger.org/r/#/c/28302/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L226](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L226)<br><strong>Comment</strong>: <pre>You need to get the error from the context; it isn't guaranteed to be a timeout.

ctx.Error()</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L226](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L226)<br><strong>Comment</strong>: <pre>Fixed in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/deliver_client.go#L226](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/deliver_client.go#L226)<br><strong>Comment</strong>: <pre>Done, https://gerrit.hyperledger.org/r/#/c/28302/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/msp.go#L0](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/msp.go#L0)<br><strong>Comment</strong>: <pre>Why is this file called msp? There's nothing at all in here about "membership" or "providers" - it's about a "signer";
Why is this defined here instead of where consumed?
Why do we care about Signer when we only consume SignerIdentity?</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/msp.go#L0](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/msp.go#L0)<br><strong>Comment</strong>: <pre>It was copied from token/server. However, this file is removed in https://gerrit.hyperledger.org/r/#/c/27447/ because client already defines token/identity.go.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/msp.go#L0](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/msp.go#L0)<br><strong>Comment</strong>: <pre>Due to CR split, removed in https://gerrit.hyperledger.org/r/#/c/27956/</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [token/client/orderer_client.go#L23](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/orderer_client.go#L23)<br><strong>Comment</strong>: <pre>There are a few mocks generated by counterfeiter and some generated by mockery, and I suppose that's why we have token/client/mocks and token/client/mock. Any chance you can merge this into one directory?</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/orderer_client.go#L23](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/orderer_client.go#L23)<br><strong>Comment</strong>: <pre>Due to parallel development, both counterfeiter and mockery were used for unit tests. We have consolidated to use counterfeiter only since then. Fixed in https://gerrit.hyperledger.org/r/#/c/27278/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/orderer_client.go#L41](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/orderer_client.go#L41)<br><strong>Comment</strong>: <pre>Why are defining the interface here? Who is the consumer?</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/orderer_client.go#L41](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/orderer_client.go#L41)<br><strong>Comment</strong>: <pre>The interface is introduced for unit tests so that we can create mocked type.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/orderer_client.go#L44](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/orderer_client.go#L44)<br><strong>Comment</strong>: <pre>Why isn't this exported?</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/orderer_client.go#L44](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/orderer_client.go#L44)<br><strong>Comment</strong>: <pre>Exported in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/orderer_client.go#L44](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/orderer_client.go#L44)<br><strong>Comment</strong>: <pre>Exported, https://gerrit.hyperledger.org/r/#/c/28287/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/orderer_client.go#L51](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/orderer_client.go#L51)<br><strong>Comment</strong>: <pre>This is untested. Only caller is NewTxSubmitter - which is also untested.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/orderer_client.go#L51](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/orderer_client.go#L51)<br><strong>Comment</strong>: <pre>Returning an interface instead of the object from a constructor.</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [token/client/orderer_client.go#L51](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/orderer_client.go#L51)<br><strong>Comment</strong>: <pre>why not return the *orderereClient ? + export it like Matt said</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/orderer_client.go#L51](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/orderer_client.go#L51)<br><strong>Comment</strong>: <pre>Refactored and added unit tests in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/orderer_client.go#L51](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/orderer_client.go#L51)<br><strong>Comment</strong>: <pre>Fixed in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/orderer_client.go#L51](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/orderer_client.go#L51)<br><strong>Comment</strong>: <pre>Fixed in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/orderer_client.go#L51](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/orderer_client.go#L51)<br><strong>Comment</strong>: <pre>Done, https://gerrit.hyperledger.org/r/#/c/28287/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/orderer_client.go#L51](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/orderer_client.go#L51)<br><strong>Comment</strong>: <pre>Done, https://gerrit.hyperledger.org/r/#/c/28287/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/orderer_client.go#L51](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/orderer_client.go#L51)<br><strong>Comment</strong>: <pre>Done, https://gerrit.hyperledger.org/r/#/c/28287/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/orderer_client.go#L72](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/orderer_client.go#L72)<br><strong>Comment</strong>: <pre>This is untested. It's also named line a constructor except it's not really - it makes a request for a handle to a grpc stream that is associated with the context that's been provided. This is not a 'New' but a 'Get'.</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [token/client/orderer_client.go#L72](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/orderer_client.go#L72)<br><strong>Comment</strong>: <pre>why not return the *ordererClient ?</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/orderer_client.go#L72](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/orderer_client.go#L72)<br><strong>Comment</strong>: <pre>This function returns an object that was create by ab.NewAtomicBroadcastClient(oc.conn).Broadcast(ctx) so that we can invoke grpc calls such as Send and Recv.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/orderer_client.go#L72](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/orderer_client.go#L72)<br><strong>Comment</strong>: <pre>Refactored and tested in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/orderer_client.go#L72](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/orderer_client.go#L72)<br><strong>Comment</strong>: <pre>Done, https://gerrit.hyperledger.org/r/#/c/28287/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/orderer_client.go#L111](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/orderer_client.go#L111)<br><strong>Comment</strong>: <pre>You need to provide a direction.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/orderer_client.go#L111](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/orderer_client.go#L111)<br><strong>Comment</strong>: <pre>Added direction  in https://gerrit.hyperledger.org/r/#/c/27447/.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/orderer_client.go#L111](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/orderer_client.go#L111)<br><strong>Comment</strong>: <pre>Simplify the logic by merging receive and wait into a single method, no channel is needed any more. 
https://gerrit.hyperledger.org/r/#/c/28287/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/orderer_client.go#L130](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/orderer_client.go#L130)<br><strong>Comment</strong>: <pre>This is untested</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/orderer_client.go#L130](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/orderer_client.go#L130)<br><strong>Comment</strong>: <pre>Test added in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/orderer_client.go#L130](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/orderer_client.go#L130)<br><strong>Comment</strong>: <pre>Added test,https://gerrit.hyperledger.org/r/#/c/28287/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/orderer_client.go#L136](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/orderer_client.go#L136)<br><strong>Comment</strong>: <pre>You need to provide a direction on a channel that you take as a dependency</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/orderer_client.go#L136](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/orderer_client.go#L136)<br><strong>Comment</strong>: <pre>Fixed in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/orderer_client.go#L136](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/orderer_client.go#L136)<br><strong>Comment</strong>: <pre>Simplified the logic by merging receive and wait into a single method, no channel is needed any more. 
https://gerrit.hyperledger.org/r/#/c/28287/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/orderer_client.go#L150](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/orderer_client.go#L150)<br><strong>Comment</strong>: <pre>If the caller closes errs, you're going to be be spinning in a tight loop.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/orderer_client.go#L150](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/orderer_client.go#L150)<br><strong>Comment</strong>: <pre>Refactored in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/orderer_client.go#L150](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/orderer_client.go#L150)<br><strong>Comment</strong>: <pre>Simplified the logic by merging receive and wait into a single method, no channel is needed any more. 
https://gerrit.hyperledger.org/r/#/c/28287/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/orderer_client.go#L159](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/orderer_client.go#L159)<br><strong>Comment</strong>: <pre>You don't close receive channels that are provided to you. When this method returns, the caller is responsible for closing it.

If the channel were properly typed on the signature, the compiler wouldn't even have allowed this.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/orderer_client.go#L159](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/orderer_client.go#L159)<br><strong>Comment</strong>: <pre>Fixed in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/orderer_client.go#L159](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/orderer_client.go#L159)<br><strong>Comment</strong>: <pre>Simplify the logic by merging receive and wait into a single method, no channel is needed any more. 
https://gerrit.hyperledger.org/r/#/c/28287/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/orderer_client.go#L176](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/orderer_client.go#L176)<br><strong>Comment</strong>: <pre>This is untested and I don't understand why we have this.

If we want to preserve and present multiple errors, we need to use a pattern like the one implemented in the multierr package where we surface the original errors.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/orderer_client.go#L176](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/orderer_client.go#L176)<br><strong>Comment</strong>: <pre>Refactored to simply return the error in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/orderer_client.go#L176](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/orderer_client.go#L176)<br><strong>Comment</strong>: <pre>No need to have multi errors.
https://gerrit.hyperledger.org/r/#/c/28287/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/prover.go#L60](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/prover.go#L60)<br><strong>Comment</strong>: <pre>Don't know why this change was made. Reminder: https://github.com/golang/go/wiki/CodeReviewComments#initialisms

quote:
Words in names that are initialisms or acronyms (e.g. "URL" or "NATO") have a consistent case. For example, "URL" should appear as "URL" or "url" (as in "urlPony", or "URLPony"), never as "Url". As an example: ServeHTTP not ServeHttp. For identifiers with multiple initialized "words", use for example "xmlHTTPRequest" or "XMLHTTPRequest".

This rule also applies to "ID" when it is short for "Identity Document" (which is pretty much all cases when it's not the "id" as in "ego", "superego"), so write "appID" instead of "appId".</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/prover.go#L60](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/prover.go#L60)<br><strong>Comment</strong>: <pre>This is based on generated prover.pb.go that uses TokenIds.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/prover.go#L99](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/prover.go#L99)<br><strong>Comment</strong>: <pre>You need a new line here.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/prover.go#L99](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/prover.go#L99)<br><strong>Comment</strong>: <pre>Fixed in https://gerrit.hyperledger.org/r/#/c/26646</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/prover.go#L99](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/prover.go#L99)<br><strong>Comment</strong>: <pre>Change CR to https://gerrit.hyperledger.org/r/#/c/28093/</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [token/client/prover.go#L104](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/prover.go#L104)<br><strong>Comment</strong>: <pre>Why the extra variable? Why not assign directly?</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/prover.go#L104](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/prover.go#L104)<br><strong>Comment</strong>: <pre>Fixed in https://gerrit.hyperledger.org/r/#/c/26646</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/prover.go#L104](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/prover.go#L104)<br><strong>Comment</strong>: <pre>Change CR to https://gerrit.hyperledger.org/r/#/c/28093/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/prover.go#L130](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/prover.go#L130)<br><strong>Comment</strong>: <pre>Untested; can be easily tested by passing in garbage to CreateSignedCommand</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/prover.go#L130](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/prover.go#L130)<br><strong>Comment</strong>: <pre>Fixed in https://gerrit.hyperledger.org/r/#/c/26646</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/prover.go#L130](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/prover.go#L130)<br><strong>Comment</strong>: <pre>Added test in https://gerrit.hyperledger.org/r/#/c/28093/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/prover_test.go#L200](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/prover_test.go#L200)<br><strong>Comment</strong>: <pre>I don't know why this change was made; please see comment in production code.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/prover_test.go#L200](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/prover_test.go#L200)<br><strong>Comment</strong>: <pre>This is based on generated prover.pb.go that uses TokenIds.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L30](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L30)<br><strong>Comment</strong>: <pre>token/client/client.go uses the FabricTxSubmitter interface to invoke a Submit function. I was expecting to find such function implemented by this struct - I'm probably missing something?</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L30](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L30)<br><strong>Comment</strong>: <pre>Fixed in https://gerrit.hyperledger.org/r/#/c/27447</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L30](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L30)<br><strong>Comment</strong>: <pre>Done, https://gerrit.hyperledger.org/r/#/c/27956/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L52](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L52)<br><strong>Comment</strong>: <pre>This is completed untested and calls other functions that are completely untested. Why has it been implemented?</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L52](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L52)<br><strong>Comment</strong>: <pre>Unit tests added in https://gerrit.hyperledger.org/r/#/c/27447</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L52](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L52)<br><strong>Comment</strong>: <pre>Done, https://gerrit.hyperledger.org/r/#/c/27956/</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L58](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L58)<br><strong>Comment</strong>: <pre>Is there a jira to track this work? If not please create it and link it here</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L58](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L58)<br><strong>Comment</strong>: <pre>Add in https://gerrit.hyperledger.org/r/#/c/27447</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L58](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L58)<br><strong>Comment</strong>: <pre>Done, https://gerrit.hyperledger.org/r/#/c/27956/</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L60](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L60)<br><strong>Comment</strong>: <pre>why do we need this? can you please not use this?</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L60](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L60)<br><strong>Comment</strong>: <pre>This is token client API that must initialize the SigningIdentity. I understand that calling peercommon.InitCryto introduces dependency on fabric. Do you have an alternative in this case? It seems redundant to copy similar code for token client.</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L62](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L62)<br><strong>Comment</strong>: <pre>please don't reference mspmgmt.... inject it as an interface instead :(</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L62](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L62)<br><strong>Comment</strong>: <pre>Passed an interface in https://gerrit.hyperledger.org/r/#/c/27447/. However, still need to get SigningIdentity in client.go.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L91](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L91)<br><strong>Comment</strong>: <pre>That doesn't seem to be the case - could you pls correct?</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L91](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L91)<br><strong>Comment</strong>: <pre>Fixed in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L91](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L91)<br><strong>Comment</strong>: <pre>Done, https://gerrit.hyperledger.org/r/#/c/27956/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L95](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L95)<br><strong>Comment</strong>: <pre>No. The context needs to provided as the first augment of this method. If a timeout is desired, the caller will need to decorate it.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L95](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L95)<br><strong>Comment</strong>: <pre>Named return variables are frowned upon in implementations because it allows programmers to omit what's being returned and that can be dangerous during refactors. It also makes it harder to see when a var is shadowed unintentionally.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L95](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L95)<br><strong>Comment</strong>: <pre>Fixed in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L95](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L95)<br><strong>Comment</strong>: <pre>This is token client library. It creates the context inside the method. Changed timeout to be time.Duration in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L95](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L95)<br><strong>Comment</strong>: <pre>Done, https://gerrit.hyperledger.org/r/#/c/27956/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L103](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L103)<br><strong>Comment</strong>: <pre>Please explicitly return what's supposed to be returned and don't rely on named return values.

Here and below...</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L103](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L103)<br><strong>Comment</strong>: <pre>Fixed in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L103](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L103)<br><strong>Comment</strong>: <pre>Done, https://gerrit.hyperledger.org/r/#/c/27956/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L115](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L115)<br><strong>Comment</strong>: <pre>Channels have directions - when they're passed to something, the direction should be specified.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L115](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L115)<br><strong>Comment</strong>: <pre>Fixed in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L115](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L115)<br><strong>Comment</strong>: <pre>The method is removed in https://gerrit.hyperledger.org/r/#/c/27956/.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L120](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L120)<br><strong>Comment</strong>: <pre>Channel direction needs to be specified.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L120](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L120)<br><strong>Comment</strong>: <pre>The context is, by convention, always the first argument.  It really does matter.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L120](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L120)<br><strong>Comment</strong>: <pre>I don't understand the logic of this as opposed to always returning a recv channel that can be used to retrieve the result; if the caller doesn't want it, it can discard it.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L120](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L120)<br><strong>Comment</strong>: <pre>Fixed in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L120](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L120)<br><strong>Comment</strong>: <pre>It makes sense to return a recv channel. Will use a separate CR to make the change.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L120](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L120)<br><strong>Comment</strong>: <pre>Good point. Fixed in https://gerrit.hyperledger.org/r/#/c/27447/.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L120](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L120)<br><strong>Comment</strong>: <pre>Update - have simplified token client API with "waitTimeout". Applications do not need to pass in channel any more. https://gerrit.hyperledger.org/r/#/c/27956/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L121](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L121)<br><strong>Comment</strong>: <pre>This needs to be removed. We can require a channel but wither or not it's buffered, and whether or not it's full have nothing to do with this code and in no way should we be policing it.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L121](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L121)<br><strong>Comment</strong>: <pre>Remvoved in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L121](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L121)<br><strong>Comment</strong>: <pre>Done, https://gerrit.hyperledger.org/r/#/c/27956/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L126](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L126)<br><strong>Comment</strong>: <pre>This needs to be removed. This code *should not* be policing what the caller provides. If it provides a full channel, it's full; we will block writing to it. This is why a context is provided - so we can select on the write and on the done method for the context.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L126](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L126)<br><strong>Comment</strong>: <pre>Removed in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L126](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L126)<br><strong>Comment</strong>: <pre>Done, https://gerrit.hyperledger.org/r/#/c/27956/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L148](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L148)<br><strong>Comment</strong>: <pre>Where's the context wiring?</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L148](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L148)<br><strong>Comment</strong>: <pre>This is grpc stream service. The context has been passed and stored in client deliverFiltered.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L152](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L152)<br><strong>Comment</strong>: <pre>Where the context wiring?</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L152](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L152)<br><strong>Comment</strong>: <pre>This is grpc stream service. The context has been passed and stored in client deliverFiltered.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L155](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L155)<br><strong>Comment</strong>: <pre>Where is the context wiring?</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L155](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L155)<br><strong>Comment</strong>: <pre>This is grpc stream service. The context has been passed and stored in broadcast client.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L163](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L163)<br><strong>Comment</strong>: <pre>Where is the context wiring?</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L163](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L163)<br><strong>Comment</strong>: <pre>This is grpc stream service. The context has been passed and stored in broadcast client.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L164](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L164)<br><strong>Comment</strong>: <pre>Where's the select for context cancelation vs getting a response?</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L164](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L164)<br><strong>Comment</strong>: <pre>Refactored in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L174](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L174)<br><strong>Comment</strong>: <pre>Some comment for this function if it's exported please (or unexport if unnecessary?) - thanks!</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L174](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L174)<br><strong>Comment</strong>: <pre>Fixed in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L174](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L174)<br><strong>Comment</strong>: <pre>Done, https://gerrit.hyperledger.org/r/#/c/27956/</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L176](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L176)<br><strong>Comment</strong>: <pre>Is it a leftover from some internal comment that was partially deleted? If not, could you pls make it consumable? thx!</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L176](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L176)<br><strong>Comment</strong>: <pre>Removed in https://gerrit.hyperledger.org/r/#/c/27447/.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L176](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L176)<br><strong>Comment</strong>: <pre>Done, https://gerrit.hyperledger.org/r/#/c/27956/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L181](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L181)<br><strong>Comment</strong>: <pre>If this equals nil, since it can never happen with the client. Might be part of why this block is untested.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L181](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L181)<br><strong>Comment</strong>: <pre>This block is removed in https://gerrit.hyperledger.org/r/#/c/27956/ because mutual-TLS is not supported for token yet.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L181](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L181)<br><strong>Comment</strong>: <pre>Update. This block is moved to a common method in https://gerrit.hyperledger.org/r/#/c/28228/ and unit tests are added.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L188](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L188)<br><strong>Comment</strong>: <pre>This block is untested.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L188](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L188)<br><strong>Comment</strong>: <pre>This block is removed in https://gerrit.hyperledger.org/r/#/c/27447/ as we do not support mutual TLS.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L188](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L188)<br><strong>Comment</strong>: <pre>This block is removed in https://gerrit.hyperledger.org/r/#/c/27956/ because mutual TLS is not supported for token.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L188](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L188)<br><strong>Comment</strong>: <pre>Update. This block is moved to a common method in https://gerrit.hyperledger.org/r/#/c/28228/ and unit tests are added.</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L201](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L201)<br><strong>Comment</strong>: <pre>honestly these kind of stuff belong in some other package that is shared. 
If I want to create a header, i shouldn't need to import the client stuff.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L201](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L201)<br><strong>Comment</strong>: <pre>This is token client library, so try to minimize dependency on other components. In https://gerrit.hyperledger.org/r/#/c/27447/, this method is moved to message_helper.go.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L221](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L221)<br><strong>Comment</strong>: <pre>Why the cast? Constants don't need casts.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L221](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L221)<br><strong>Comment</strong>: <pre>Fixed in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L221](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L221)<br><strong>Comment</strong>: <pre>Done, https://gerrit.hyperledger.org/r/#/c/27956/</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L299](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L299)<br><strong>Comment</strong>: <pre>please don't use file system reads so deep in the code. Instead you can IMO inject this PEM file all the way from the client initialization - in the NewTxSubmitter, and ripple it all the way here.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L299](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L299)<br><strong>Comment</strong>: <pre>It is The function is called by NewTxSubmitter, not really deep in the code. If file read fails, the error is propagated to NewTxSubmitter that will fail with same error.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L309](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L309)<br><strong>Comment</strong>: <pre>This is used by all clients; might be worth pulling this into a grpc.go or comm.go file.

That said, I don't think we really want to pull in the fabric comm layer to create a simple grpc client. It binds us to fabric and prevents the easy extraction of this package from the fabric repo.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L309](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L309)<br><strong>Comment</strong>: <pre>Moved to grpc.go in https://gerrit.hyperledger.org/r/#/c/27447/. Will use another CR to implement grpc client and remove dependency on fabric/core/comm package.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter.go#L309](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter.go#L309)<br><strong>Comment</strong>: <pre>Update: moved to grpc.go in CR https://gerrit.hyperledger.org/r/#/c/27926/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/tx_submitter_test.go#L24](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter_test.go#L24)<br><strong>Comment</strong>: <pre>These tests need to use the async matchers for channel operations. If they don't, these things are going hang and have other issues when working in the code base.

Channels that are expected to receive should do
Eventually(ch).Should(Receive(&receiver))
Eventually(ch).Should(Receive(Equal(MyStruct{Field: "foo"}))

Channels that should be closed need:
Eventually(ch).Should(BeClosed())

Channels that are to remain open need:
Consistently(ch).ShouldNot(BeClosed())

When sending to a channel in a test
Eventually(ch).Should(BeSent(theThingIAmSending))</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter_test.go#L24](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter_test.go#L24)<br><strong>Comment</strong>: <pre>Fixed in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter_test.go#L24](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter_test.go#L24)<br><strong>Comment</strong>: <pre>Done in https://gerrit.hyperledger.org/r/#/c/27956/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/tx_submitter_test.go#L142](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter_test.go#L142)<br><strong>Comment</strong>: <pre>Eventually should receive ...</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter_test.go#L142](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter_test.go#L142)<br><strong>Comment</strong>: <pre>Fixed in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter_test.go#L142](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter_test.go#L142)<br><strong>Comment</strong>: <pre>Simplified API in CR https://gerrit.hyperledger.org/r/#/c/27956/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/tx_submitter_test.go#L159](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter_test.go#L159)<br><strong>Comment</strong>: <pre>This test and corresponding production code need to go.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter_test.go#L159](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter_test.go#L159)<br><strong>Comment</strong>: <pre>Removed in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter_test.go#L159](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter_test.go#L159)<br><strong>Comment</strong>: <pre>Removed in https://gerrit.hyperledger.org/r/#/c/27956/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/tx_submitter_test.go#L168](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter_test.go#L168)<br><strong>Comment</strong>: <pre>If the behavior is to drop events on the floor, the test and the production code should be updated to make the appropriate assertions but the existing behavior and tests need to change or be removed.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter_test.go#L168](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter_test.go#L168)<br><strong>Comment</strong>: <pre>Removed in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter_test.go#L168](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter_test.go#L168)<br><strong>Comment</strong>: <pre>Removed in https://gerrit.hyperledger.org/r/#/c/27956/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/tx_submitter_test.go#L190](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter_test.go#L190)<br><strong>Comment</strong>: <pre>Please see production comments; we use durations, not number of seconds. Also, timeouts should be expressed as deadlines/timeouts on contexts for these clients.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter_test.go#L190](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter_test.go#L190)<br><strong>Comment</strong>: <pre>Fixed in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter_test.go#L190](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter_test.go#L190)<br><strong>Comment</strong>: <pre>Fixed in https://gerrit.hyperledger.org/r/#/c/27956/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/tx_submitter_test.go#L249](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter_test.go#L249)<br><strong>Comment</strong>: <pre>Eventually should receive ...</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter_test.go#L249](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter_test.go#L249)<br><strong>Comment</strong>: <pre>Fixed in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter_test.go#L249](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter_test.go#L249)<br><strong>Comment</strong>: <pre>Fixed in https://gerrit.hyperledger.org/r/#/c/27956/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/tx_submitter_test.go#L305](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter_test.go#L305)<br><strong>Comment</strong>: <pre>Please don't use multiple top level describes. This is just a Describe("CreateEnvelope".

If you feel like it doesn't belong in the top level of the test, that's a sign that the current function to file breakdown isn't right.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter_test.go#L305](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter_test.go#L305)<br><strong>Comment</strong>: <pre>Moved this function to message_helper.go in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/tx_submitter_test.go#L356](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter_test.go#L356)<br><strong>Comment</strong>: <pre>And here</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter_test.go#L356](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter_test.go#L356)<br><strong>Comment</strong>: <pre>Moved this function to message_helper.go https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/tx_submitter_test.go#L419](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter_test.go#L419)<br><strong>Comment</strong>: <pre>This appears to be shared across multiple files; if it is, it should be defined in the file that holds the suite.</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter_test.go#L419](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter_test.go#L419)<br><strong>Comment</strong>: <pre>Moved to client_suite_test.go in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter_test.go#L419](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter_test.go#L419)<br><strong>Comment</strong>: <pre>Moved in https://gerrit.hyperledger.org/r/#/c/27956/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/client/tx_submitter_test.go#L423](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter_test.go#L423)<br><strong>Comment</strong>: <pre>And what is this?</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter_test.go#L423](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter_test.go#L423)<br><strong>Comment</strong>: <pre>Removed in https://gerrit.hyperledger.org/r/#/c/27447/</pre><strong>Commenter</strong>: Wenjian Qiao - wenjianq@gmail.com<br><strong>CommentLine</strong>: [token/client/tx_submitter_test.go#L423](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/client/tx_submitter_test.go#L423)<br><strong>Comment</strong>: <pre>Removed in CR https://gerrit.hyperledger.org/r/#/c/27956/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/identity/identity.go#L0](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/identity/identity.go#L0)<br><strong>Comment</strong>: <pre>There are no implementations in this package so I really don't understand why we have interfaces - there's nothing we're consuming.

There aren't even any sub-packages except mocks.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [token/identity/identity.go#L6](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/identity/identity.go#L6)<br><strong>Comment</strong>: <pre>There's token/identity.go and token/identity/identity.go - are both required, can we merge them otherwise?</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/identity/identity.go#L38](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/identity/identity.go#L38)<br><strong>Comment</strong>: <pre>We should not be traversing *up* the tree. If we need an interface from another package and we want to be consistent with it, it needs to be embedded.

But, frankly, I don't understand why this is here at all.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/ledger/ledger.go#L0](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/ledger/ledger.go#L0)<br><strong>Comment</strong>: <pre>As with identity, I have no idea why we have this. There are no implementations in this package and no dependencies to consume.

Basically, I don't know why they're here. I'd understand it if they were close to things that used them but it seems like this another place where we're trying to share interfaces and bind things together. As far as I'm aware, we still only have one implementation that uses these.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/ledger/ledger.go#L15](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/ledger/ledger.go#L15)<br><strong>Comment</strong>: <pre>What is this managing? I see a getter. I see a single getter for a LedgerReader.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/server/manager.go#L11](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/server/manager.go#L11)<br><strong>Comment</strong>: <pre>So, this looks like an encapsulation issue to me. We have a "server" that's not in plain but we reference the plain implementation. That raises a flag. The factoring doesn't look right.

Is the server tms agnostic or coupled to plain? What's the abstraction? What is is this? It only wraps a LedgerManager (which is ledger getter).</pre><strong>Commenter</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>CommentLine</strong>: [token/server/manager.go#L11](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/server/manager.go#L11)<br><strong>Comment</strong>: <pre>So, Manager is an implementation of TMSManager interface based on plain TMS. The Server needs a TMSManager, so it is agnostic We can definitely either rename Manager or to move it under the plain package. What do you recommend?</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [token/server/manager.go#L16](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/server/manager.go#L16)<br><strong>Comment</strong>: <pre>based</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [token/server/manager.go#L21](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/server/manager.go#L21)<br><strong>Comment</strong>: <pre>needs to start from "GetIssuer"</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/server/manager.go#L24](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/server/manager.go#L24)<br><strong>Comment</strong>: <pre>use simple identifiers for the self reference, like: 'm'</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [token/server/manager.go#L30](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/server/manager.go#L30)<br><strong>Comment</strong>: <pre>why not return the *plain.Transactor instead of an interface?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [token/server/prover.go#L38](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/server/prover.go#L38)<br><strong>Comment</strong>: <pre>It took me a bit to figure out that this is the entry point to the grpc service - any chance you could add a comment here to clarify that?</pre><strong>Commenter</strong>: Kaoutar Elkhiyaoui - kao@zurich.ibm.com<br><strong>CommentLine</strong>: [token/server/prover.go#L38](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/server/prover.go#L38)<br><strong>Comment</strong>: <pre>Done
https://gerrit.hyperledger.org/r/#/c/27660/</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [token/server/prover.go#L49](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/server/prover.go#L49)<br><strong>Comment</strong>: <pre>The squashed CRs have introduced support for additional commands (Command_TransferRequest, Command_RedeemRequest...) but the policychecker implementation in token/server/accesscontrol.go still only knows about Command_ImportRequest. Where do we add support for those?</pre><strong>Commenter</strong>: Kaoutar Elkhiyaoui - kao@zurich.ibm.com<br><strong>CommentLine</strong>: [token/server/prover.go#L49](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/server/prover.go#L49)<br><strong>Comment</strong>: <pre>Done
https://gerrit.hyperledger.org/r/#/c/27660/</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [token/server/prover.go#L85](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/server/prover.go#L85)<br><strong>Comment</strong>: <pre>Can we pass the whole requestImport variable in here as well, as we do for RequestTransfer, RequestRedeem and RequestApprove? It's easier to understand and we might find out that we need it later - wdyt?</pre><strong>Commenter</strong>: Kaoutar Elkhiyaoui - kao@zurich.ibm.com<br><strong>CommentLine</strong>: [token/server/prover.go#L85](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/server/prover.go#L85)<br><strong>Comment</strong>: <pre>Done
https://gerrit.hyperledger.org/r/#/c/27660/</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [token/server/prover.go#L121](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/server/prover.go#L121)<br><strong>Comment</strong>: <pre>All other function names match the corresponding function of the transactor (e.g. RequestRedeem -> transactor.RequestRedeem) except for this one - any reason why? If not can we align the names?</pre><strong>Commenter</strong>: Kaoutar Elkhiyaoui - kao@zurich.ibm.com<br><strong>CommentLine</strong>: [token/server/prover.go#L121](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/server/prover.go#L121)<br><strong>Comment</strong>: <pre>Done
https://gerrit.hyperledger.org/r/#/c/27660/</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [token/server/prover.go#L153](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/server/prover.go#L153)<br><strong>Comment</strong>: <pre>Does it make sense here to do some filtering beyond this basic validation? Thinking aloud, we could check that the channel exists, that TMS is enabled on it or that the channel is capable of that operation. It would be "neat" to assume that if ValidateHeader doesn't complain, we can bank on the proper channel infrastructure being available. It would also ensure that any and all errors related to a channel mismatch would be identically handled. Just a thought</pre><strong>Commenter</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>CommentLine</strong>: [token/server/prover.go#L153](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/server/prover.go#L153)<br><strong>Comment</strong>: <pre>Ale, thanks for noticing this. So, we can definitely add a check for the existence of the channel. For the proper toke infrastructure on that channel, this will come once we have the lifecycle for TMS. We are waiting the work of that to proceed. Would that be okay if we postpone this to the time we work on TMS lifecycle?</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/server/prover_test.go#L554](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/server/prover_test.go#L554)<br><strong>Comment</strong>: <pre>returns</pre><strong>Commenter</strong>: Kaoutar Elkhiyaoui - kao@zurich.ibm.com<br><strong>CommentLine</strong>: [token/server/prover_test.go#L554](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/server/prover_test.go#L554)<br><strong>Comment</strong>: <pre>Done
https://gerrit.hyperledger.org/r/#/c/27660/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/server/prover_test.go#L565](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/server/prover_test.go#L565)<br><strong>Comment</strong>: <pre>returns</pre><strong>Commenter</strong>: Kaoutar Elkhiyaoui - kao@zurich.ibm.com<br><strong>CommentLine</strong>: [token/server/prover_test.go#L565](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/server/prover_test.go#L565)<br><strong>Comment</strong>: <pre>Done
https://gerrit.hyperledger.org/r/#/c/27660/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/server/prover_test.go#L601](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/server/prover_test.go#L601)<br><strong>Comment</strong>: <pre>returns</pre><strong>Commenter</strong>: Kaoutar Elkhiyaoui - kao@zurich.ibm.com<br><strong>CommentLine</strong>: [token/server/prover_test.go#L601](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/server/prover_test.go#L601)<br><strong>Comment</strong>: <pre>Done
https://gerrit.hyperledger.org/r/#/c/27660/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/server/prover_test.go#L612](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/server/prover_test.go#L612)<br><strong>Comment</strong>: <pre>returns</pre><strong>Commenter</strong>: Kaoutar Elkhiyaoui - kao@zurich.ibm.com<br><strong>CommentLine</strong>: [token/server/prover_test.go#L612](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/server/prover_test.go#L612)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/server/prover_test.go#L1213](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/server/prover_test.go#L1213)<br><strong>Comment</strong>: <pre>returns</pre><strong>Commenter</strong>: Kaoutar Elkhiyaoui - kao@zurich.ibm.com<br><strong>CommentLine</strong>: [token/server/prover_test.go#L1213](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/server/prover_test.go#L1213)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/server/prover_test.go#L1221](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/server/prover_test.go#L1221)<br><strong>Comment</strong>: <pre>returns</pre><strong>Commenter</strong>: Kaoutar Elkhiyaoui - kao@zurich.ibm.com<br><strong>CommentLine</strong>: [token/server/prover_test.go#L1221](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/server/prover_test.go#L1221)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [token/server/tms.go#L0](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/server/tms.go#L0)<br><strong>Comment</strong>: <pre>These interfaces seem to be used exclusively by token/server/prover.go - any chance they could be moved there?</pre><strong>Commenter</strong>: Kaoutar Elkhiyaoui - kao@zurich.ibm.com<br><strong>CommentLine</strong>: [token/server/tms.go#L0](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/server/tms.go#L0)<br><strong>Comment</strong>: <pre>Done

https://gerrit.hyperledger.org/r/#/c/27667/</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [token/server/tms.go#L25](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/server/tms.go#L25)<br><strong>Comment</strong>: <pre>what's this?</pre><strong>Commenter</strong>: Kaoutar Elkhiyaoui - kao@zurich.ibm.com<br><strong>CommentLine</strong>: [token/server/tms.go#L25](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/server/tms.go#L25)<br><strong>Comment</strong>: <pre>This was an outdated comment. It is now fixed.
https://gerrit.hyperledger.org/r/#/c/27660/</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [token/server/tms.go#L26](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/server/tms.go#L26)<br><strong>Comment</strong>: <pre>what does it mean "assuming an application-level identity" ? 

and what is the inTokens bytes?</pre><strong>Commenter</strong>: Kaoutar Elkhiyaoui - kao@zurich.ibm.com<br><strong>CommentLine</strong>: [token/server/tms.go#L26](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/server/tms.go#L26)<br><strong>Comment</strong>: <pre>This is an outdated comment, it has been fixed.
https://gerrit.hyperledger.org/r/#/c/27660/</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [token/tms/manager/manager.go#L26](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/manager/manager.go#L26)<br><strong>Comment</strong>: <pre>let's please get rid of referencing the mgmt package... inject the GetDeserializers instead.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/tms/manager/manager.go#L29](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/manager/manager.go#L29)<br><strong>Comment</strong>: <pre>This appears to be untested.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/tms/manager/manager.go#L30](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/manager/manager.go#L30)<br><strong>Comment</strong>: <pre>Why are we creating so many "GetXXX" factory methods? Why do we have so many "manager" implementations?

An implementation exists in MSP that provides all of the serializers; Instead of creating this stuff over here, the MSP should get be changed to provide proper implementations (instead of functions) that do what are necessary. Then, we just wire it in when we construct it.

This doesn't belong in token; it's an artifact of a bad dependency.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/tms/manager/manager_test.go#L54](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/manager/manager_test.go#L54)<br><strong>Comment</strong>: <pre>redundant with next line</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/tms/manager/manager_test.go#L55](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/manager/manager_test.go#L55)<br><strong>Comment</strong>: <pre>This would be easier to read with line breaks.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/tms/manager/manager_test.go#L57](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/manager/manager_test.go#L57)<br><strong>Comment</strong>: <pre>We want happy paths first; in general, happy paths don't need a context.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/tms/manager/manager_test.go#L73](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/manager/manager_test.go#L73)<br><strong>Comment</strong>: <pre>It("retrieves the appropriate deserializer for the provided channel"...

Context("when the channel isn't found...
    It("returns an error"...

So, Where's the happy path? Where's the positive test that asserts you got back what you should have?</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/tms/manager/policy.go#L24](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/manager/policy.go#L24)<br><strong>Comment</strong>: <pre>Please review the documentation on format strings for the fmt package. Please look at the alternate format specifier ('#') in particular and use it as appropriate. Also, I'm assuming that these identities can be more than 4 or 5 bytes long; that will make this message almost impossible to read (although easier than when logging them as byte slices with flogging).

"identity [0xadf129addade38337798379078377acc3838383973497497049797084040404040404aaaaaabbbbbbcccdddee4564523828284674648383754759709877589750978490789042707894507892340789237890] cannot be deserialized: something terrible and horrible happened and things went terribly wrong"

Or, in the case where we're fuzzing and send really long strings, we'll create really big messages.

Do we need to have the identity logged?</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/tms/manager/policy.go#L29](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/manager/policy.go#L29)<br><strong>Comment</strong>: <pre>And here</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/tms/manager/policy_test.go#L35](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/manager/policy_test.go#L35)<br><strong>Comment</strong>: <pre>This is better structured than some of the other tests in the package.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/tms/manager/policy_test.go#L75](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/manager/policy_test.go#L75)<br><strong>Comment</strong>: <pre>nit: blank line to delete</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/tms/manager/policy_test.go#L77](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/manager/policy_test.go#L77)<br><strong>Comment</strong>: <pre>nit: blank line to delete</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/tms/plain/ledger.go#L0](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/ledger.go#L0)<br><strong>Comment</strong>: <pre>This just seems like a test asset. If it's a test asset, it needs to be in a package that clearly indicates it's for test. We also want to avoid lots of unit test for test code since it's kind of cyclic.

So, with that, is this for tests or something else?</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [token/tms/plain/transactor.go#L31](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/transactor.go#L31)<br><strong>Comment</strong>: <pre>this is left out :(</pre><strong>Commenter</strong>: Kaoutar Elkhiyaoui - kao@zurich.ibm.com<br><strong>CommentLine</strong>: [token/tms/plain/transactor.go#L31](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/transactor.go#L31)<br><strong>Comment</strong>: <pre>Done

https://gerrit.hyperledger.org/r/#/c/27667/</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [token/tms/plain/transactor.go#L32](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/transactor.go#L32)<br><strong>Comment</strong>: <pre>This is not a comment on the code as such but a sanity-check on the security model of the token server: clients can connect to it; there is one policy check in https://gerrit.hyperledger.org/r/#/c/27227/1/token/server/prover.go@49 to ensure that the client that requests the command complies with some policy. When we get to this function there are no more function-specific access control checks - for instance to ensure that the requester is indeed the owner of those tokens and can thus transfer them. Let me try to capture the rationale: it is acceptable to skip the latter check because any attempt to spend coins that are not owned by the transactor will later be marked as invalid at validation/commit time - correct?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [token/tms/plain/transactor.go#L32](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/transactor.go#L32)<br><strong>Comment</strong>: <pre>On second thought, while reviewing RequestRedeem, the input validation approach seems to be different: here we don't seem to perform input validation and correctness checks, whereas in RequestRedeem we do. I think the code would benefit from a clear choice and a consistent approach, wdyt?</pre><strong>Commenter</strong>: Kaoutar Elkhiyaoui - kao@zurich.ibm.com<br><strong>CommentLine</strong>: [token/tms/plain/transactor.go#L32](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/transactor.go#L32)<br><strong>Comment</strong>: <pre>yes</pre><strong>Commenter</strong>: Kaoutar Elkhiyaoui - kao@zurich.ibm.com<br><strong>CommentLine</strong>: [token/tms/plain/transactor.go#L32](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/transactor.go#L32)<br><strong>Comment</strong>: <pre>We added some sanity checks as in redeem. Checking that the inputs are not empty and that the quantity is not negative and the recipients are not empty bytes.

https://gerrit.hyperledger.org/r/#/c/27667/</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [token/tms/plain/transactor.go#L72](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/transactor.go#L72)<br><strong>Comment</strong>: <pre>We don't seem to perform these sanity checks in the transfer case - is that intentional? Ideally all of the functions exposed here would have a similar input validation strategy - wdyt?</pre><strong>Commenter</strong>: Kaoutar Elkhiyaoui - kao@zurich.ibm.com<br><strong>CommentLine</strong>: [token/tms/plain/transactor.go#L72](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/transactor.go#L72)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [token/tms/plain/transactor.go#L88](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/transactor.go#L88)<br><strong>Comment</strong>: <pre>Could you add a little comment to explain the meaning of an output with nil owner? I think the convention you are setting is that nil owner implies a token which is out of the system, right?</pre><strong>Commenter</strong>: Kaoutar Elkhiyaoui - kao@zurich.ibm.com<br><strong>CommentLine</strong>: [token/tms/plain/transactor.go#L88](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/transactor.go#L88)<br><strong>Comment</strong>: <pre>Done
https://gerrit.hyperledger.org/r/#/c/27667/</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [token/tms/plain/transactor.go#L95](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/transactor.go#L95)<br><strong>Comment</strong>: <pre>Should we check for underflow?</pre><strong>Commenter</strong>: Kaoutar Elkhiyaoui - kao@zurich.ibm.com<br><strong>CommentLine</strong>: [token/tms/plain/transactor.go#L95](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/transactor.go#L95)<br><strong>Comment</strong>: <pre>I am afraid I am not sure what you mean by underflow here.</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [token/tms/plain/transactor.go#L144](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/transactor.go#L144)<br><strong>Comment</strong>: <pre>this can return nil, nil, no?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [token/tms/plain/transactor.go#L144](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/transactor.go#L144)<br><strong>Comment</strong>: <pre>Good catch, in general we should always beware of the fact that protobufs will successfully unmarshal zero-length byte arrays. I don't think it's a problem because we check it where it matters (https://gerrit.hyperledger.org/r/#/c/27227/1/token/tms/plain/verifier.go@472).</pre><strong>Commenter</strong>: Kaoutar Elkhiyaoui - kao@zurich.ibm.com<br><strong>CommentLine</strong>: [token/tms/plain/transactor.go#L144](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/transactor.go#L144)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kaoutar Elkhiyaoui - kao@zurich.ibm.com<br><strong>CommentLine</strong>: [token/tms/plain/transactor.go#L144](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/transactor.go#L144)<br><strong>Comment</strong>: <pre>Done
https://gerrit.hyperledger.org/r/#/c/25775/</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [token/tms/plain/transactor.go#L156](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/transactor.go#L156)<br><strong>Comment</strong>: <pre>if the inBytes is nil then this would be ""</pre><strong>Commenter</strong>: Kaoutar Elkhiyaoui - kao@zurich.ibm.com<br><strong>CommentLine</strong>: [token/tms/plain/transactor.go#L156](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/transactor.go#L156)<br><strong>Comment</strong>: <pre>Done

https://gerrit.hyperledger.org/r/#/c/27667/</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [token/tms/plain/transactor.go#L171](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/transactor.go#L171)<br><strong>Comment</strong>: <pre>We don't seem to be creating a TokenTransaction though - could we either change that or fix the comment? Thx</pre><strong>Commenter</strong>: Kaoutar Elkhiyaoui - kao@zurich.ibm.com<br><strong>CommentLine</strong>: [token/tms/plain/transactor.go#L171](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/transactor.go#L171)<br><strong>Comment</strong>: <pre>Done

https://gerrit.hyperledger.org/r/#/c/27667/</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [token/tms/plain/transactor.go#L172](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/transactor.go#L172)<br><strong>Comment</strong>: <pre>You've probably considered that, but just in case: in order to make this step more performant, we could do the following: whenever a token is created, two PutState operations are issued: one to save the token, and one to just create the key "tokensbyowner" + serializedOwner + txID + index. This way, one could simply scan the range "tokensbyowner" + serializedOwner to immediately retrieve the tokens for the specified owner. That would be a lot faster.</pre><strong>Commenter</strong>: Kaoutar Elkhiyaoui - kao@zurich.ibm.com<br><strong>CommentLine</strong>: [token/tms/plain/transactor.go#L172](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/transactor.go#L172)<br><strong>Comment</strong>: <pre>To be added once the verifier code adds the key "tokensbyowner" + serializedOwner + txID + index.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [token/tms/plain/transactor.go#L203](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/transactor.go#L203)<br><strong>Comment</strong>: <pre>This error message is identical to the one at line 197, but the two errors are different in nature - could we change one of them?</pre><strong>Commenter</strong>: Kaoutar Elkhiyaoui - kao@zurich.ibm.com<br><strong>CommentLine</strong>: [token/tms/plain/transactor.go#L203](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/transactor.go#L203)<br><strong>Comment</strong>: <pre>Done

https://gerrit.hyperledger.org/r/#/c/27667/</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [token/tms/plain/transactor.go#L250](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/transactor.go#L250)<br><strong>Comment</strong>: <pre>This bit of logic seems to be used in a number of places - could you pls bubble it into its own function?</pre><strong>Commenter</strong>: Kaoutar Elkhiyaoui - kao@zurich.ibm.com<br><strong>CommentLine</strong>: [token/tms/plain/transactor.go#L250](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/transactor.go#L250)<br><strong>Comment</strong>: <pre>Done
https://gerrit.hyperledger.org/r/#/c/27667/</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [token/tms/plain/transactor.go#L330](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/transactor.go#L330)<br><strong>Comment</strong>: <pre>I would go again for len(result) == 0 as a general rule for nonexistence testing on the ledger.</pre><strong>Commenter</strong>: Kaoutar Elkhiyaoui - kao@zurich.ibm.com<br><strong>CommentLine</strong>: [token/tms/plain/transactor.go#L330](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/transactor.go#L330)<br><strong>Comment</strong>: <pre>Done
https://gerrit.hyperledger.org/r/#/c/27667/</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [token/tms/plain/verifier.go#L108](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/verifier.go#L108)<br><strong>Comment</strong>: <pre>Do we want support tokens with types equal to the empty string? If not, then I would recommend we introduce a check here.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [token/tms/plain/verifier.go#L117](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/verifier.go#L117)<br><strong>Comment</strong>: <pre>Do we want to do some sanity checks on at least one input/at least one output?</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/tms/plain/verifier.go#L146](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/verifier.go#L146)<br><strong>Comment</strong>: <pre>untested</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/tms/plain/verifier.go#L151](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/verifier.go#L151)<br><strong>Comment</strong>: <pre>untested</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [token/tms/plain/verifier.go#L156](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/verifier.go#L156)<br><strong>Comment</strong>: <pre>Leftover? ;)</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [token/tms/plain/verifier.go#L157](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/verifier.go#L157)<br><strong>Comment</strong>: <pre>If these fields end up hosting serialized certs or public keys, they might not be printable. Should we rather go for %x?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [token/tms/plain/verifier.go#L169](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/verifier.go#L169)<br><strong>Comment</strong>: <pre>Just a thought: in order to avoid having to always supply the same namespace argument to all ledger calls, couldn't you just pass a TokenLedgerReader that implicitly always does puts/gets from the same namespace?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [token/tms/plain/verifier.go#L174](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/verifier.go#L174)<br><strong>Comment</strong>: <pre>I'd go for len(existingOutputBytes) == 0</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/tms/plain/verifier.go#L212](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/verifier.go#L212)<br><strong>Comment</strong>: <pre>untested</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/tms/plain/verifier.go#L217](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/verifier.go#L217)<br><strong>Comment</strong>: <pre>untested</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [token/tms/plain/verifier.go#L219](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/verifier.go#L219)<br><strong>Comment</strong>: <pre>The code checks whether the creator is exactly the second owner, and not one of them - maybe we can reflect this in the comment.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/tms/plain/verifier.go#L221](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/verifier.go#L221)<br><strong>Comment</strong>: <pre>untested</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/tms/plain/verifier.go#L225](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/verifier.go#L225)<br><strong>Comment</strong>: <pre>untested</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [token/tms/plain/verifier.go#L227](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/verifier.go#L227)<br><strong>Comment</strong>: <pre>Any risk of integer overflow?</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [token/tms/plain/verifier.go#L227](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/verifier.go#L227)<br><strong>Comment</strong>: <pre>isn't that... a Quintillion of coins or something?
no one has so much money.
Then again, maybe it's a token that is backed by methane emissions in livestock in New-Zealand so we'd want to return an error here?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [token/tms/plain/verifier.go#L227](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/verifier.go#L227)<br><strong>Comment</strong>: <pre>Whether it would take too many coins is irrelevant, the point is one of correctness: if we have a field and operations over it, we must always either return the correct value or an error - and that may not be the case here?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [token/tms/plain/verifier.go#L227](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/verifier.go#L227)<br><strong>Comment</strong>: <pre>I did a little bit of googling and it sounds like bitcoin already had this problem and solved it https://en.bitcoin.it/wiki/Value_overflow_incident</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [token/tms/plain/verifier.go#L246](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/verifier.go#L246)<br><strong>Comment</strong>: <pre>Just to double-check: here we only check that the owner is also the creator of this tx, but we don't check that the creator has signed the tx - is this because we expect the signature check to have been performed previously by the non-tx-specific portion of the tx validator?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [token/tms/plain/verifier.go#L259](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/verifier.go#L259)<br><strong>Comment</strong>: <pre>Should we check that the quantity is strictly positive?</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/tms/plain/verifier.go#L266](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/verifier.go#L266)<br><strong>Comment</strong>: <pre>untested - and seems kind of important</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [token/tms/plain/verifier.go#L338](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/verifier.go#L338)<br><strong>Comment</strong>: <pre>Would you be okay with removing this return and add a default to the above switch?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [token/tms/plain/verifier.go#L348](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/verifier.go#L348)<br><strong>Comment</strong>: <pre>Do we want to enforce that output.Quantity is positive?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [token/tms/plain/verifier.go#L371](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/verifier.go#L371)<br><strong>Comment</strong>: <pre>Do we want to enforce that output.Quantity is positive?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [token/tms/plain/verifier.go#L411](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/verifier.go#L411)<br><strong>Comment</strong>: <pre>Can the owner of a shared output actually transfer it? The "original" token is destroyed, but the one created here is ignored by the transfer function. Perhaps another operation can transfer it?</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/tms/plain/verifier.go#L450](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/verifier.go#L450)<br><strong>Comment</strong>: <pre>This looks very strange to me

1. Why is this an exported var instead of a detail of markInputsSpent?
2. What is the rationale behind using a single byte with the value 0x01?  There should be a comment with the rationale.

I'm assuming the rationale can be clearly expressed in terms of the structure of protobuf encoding and how this can't possibly be valid because it's too short and how it couldn't possibly become the value in the ledger without having gone through some other trusted path.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [token/tms/plain/verifier.go#L472](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/verifier.go#L472)<br><strong>Comment</strong>: <pre>I would check for len(outputBytes) == 0 instead. For example: []byte{} wouldn't be nil (and so it won't err out here), and it will successfully unmarshal to any protobuf message (and so won't err out on the Unmarshal either).</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/tms/plain/verifier.go#L506](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/verifier.go#L506)<br><strong>Comment</strong>: <pre>so, all of the other createXXX method used a constant defined at the top but this doesn't. Has gots to be reasons, right?</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/tms/plain/verifier_test.go#L0](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/verifier_test.go#L0)<br><strong>Comment</strong>: <pre>Please look at the high level structure of these tests. When I look, I see everything is related to ProcessTx (except of the odd Output GetState error scenarios). That makes sense as Validator only exposes ProcessTx. Also, we're in the "plain" package so everything should pretty much be assumed to be in the "plain" context. With that (Jump to bottom)

var _ = Describe("Verifier", func() {
	Describe("ProcessTx PlainImport", func() {
		It("evaluates policy for each output", func() {
		It("checks the fake ledger", func() {
		Context("when policy validation fails", func() {
			It("returns an error and does not write to the ledger", func() {
		Context("when the ledger write check fails", func() {
			It("returns an error", func() {
		Context("when transaction does not contain any outputs", func() {
			It("returns an error", func() {
		Context("when the output of a transaction has quantity of 0", func() {
			It("returns an error", func() {
		Context("when an output already exists", func() {
			It("returns an error", func() {
	Describe("Output GetState error scenarios", func() {
		It("retrieves the PlainOutput associated with the entry ID", func() {
		Context("when the output does not exist", func() {
			It("returns a nil and no error", func() {
	Describe("ProcessTx empty or invalid input", func() {
		Context("when a plain action is not provided", func() {
			It("returns an error", func() {
		Context("when an unknown plain token action is provided", func() {
			It("returns an error", func() {
		Context("when a transaction has invalid characters in key", func() {
			It("fails when creating the ledger key for the output", func() {
		Context("when a transaction has invalid characters in key", func() {
			It("fails when creating the ledger key for the first output", func() {
		Context("when a transaction key is an invalid utf8 string", func() {
			It("fails when creating the ledger key for the output", func() {
		Context("when the ledger read of an output fails", func() {
			It("returns an error", func() {
		Context("when the ledger read of a transaction fails", func() {
			It("returns an error", func() {
		Context("when a tx with the same txID already exists", func() {
			It("returns an error", func() {
	Describe("Test ProcessTx PlainTransfer with memory ledger", func() {
		Context("when a valid transfer is provided", func() {
			It("is processed successfully", func() {
		Context("when a non-existent input is referenced", func() {
			It("returns an InvalidTxError", func() {
		Context("when the creator of the transfer transaction is not the owner of the input", func() {
			It("returns an InvalidTxError", func() {
		Context("when the same input is spent twice", func() {
			It("returns an InvalidTxError", func() {
		Context("when the input type does not match the output type", func() {
			It("returns an InvalidTxError", func() {
		Context("when the input sum does not match the output sum", func() {
			It("returns an InvalidTxError", func() {
		Context("when the input contains multiple token types", func() {
			It("returns an InvalidTxError", func() {
		Context("when the output contains multiple token types", func() {
			It("returns an InvalidTxError", func() {
		Context("when an input has already been spent", func() {
			It("returns an InvalidTxError", func() {
		Context("when an output already exists", func() {
			It("returns an error", func() {
	Describe("Test ProcessTx PlainRedeem with memory ledger", func() {
		It("processes a redeem transaction with all tokens redeemed", func() {
		It("processes a redeem transaction with some tokens redeemed", func() {
		Context("when an input has already been spent", func() {
			It("returns an InvalidTxError", func() {
		Context("when token sum mismatches in inputs and outputs", func() {
			It("returns an error", func() {
		Context("when inputs have more than one type", func() {
			It("returns an error", func() {
		Context("when output for remaining tokens has wrong owner", func() {
			It("returns an error", func() {
	Describe("Test ProcessTx PlainApprove", func() {
		Context("when a valid approve is provided", func() {
			It("is processed successfully", func() {
		Context("when the inputs are already spent", func() {
			It("returns an InvalidTxError", func() {
		Context("when a non-existent input is referenced", func() {
			It("returns an InvalidTxError", func() {
		Context("when the creator of the transfer transaction is not the owner of the input", func() {
			It("returns an InvalidTxError", func() {
		Context("when the same input is spent twice within the same tx", func() {
			It("returns an InvalidTxError", func() {
		Context("when the input type does not match the output type", func() {
			It("returns an InvalidTxError", func() {
		Context("when the input sum does not match the output sum", func() {
			It("returns an InvalidTxError", func() {
		Context("when the input contains multiple token types", func() {
			It("returns an InvalidTxError", func() {
		Context("when the shared outputs contain multiple token types", func() {
			It("returns an InvalidTxError", func() {
		Context("when the shared outputs and output contain multiple token types", func() {
			It("returns an InvalidTxError", func() {
		Context("when an output already exists", func() {
			It("returns an error", func() {
		Context("when a transaction already exists", func() {
			It("returns an error", func() {

Why do we constantly have ProcessTx in the describe blocks?
Why can't we just describe Import, Transfer, Redeem, and Approve?
Why do we include "memory ledger" in descriptions? The idea is we focus on *behavior* not the kind of dependency we've injected. This is unit test, not integration test.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/tms/plain/verifier_test.go#L30](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/verifier_test.go#L30)<br><strong>Comment</strong>: <pre>I'm not sure why we've decided to use this instead of a straight up call-based mock. The call based mock provides complete control and allow you to remove the map based implementation from the test base.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/tms/plain/verifier_test.go#L44](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/verifier_test.go#L44)<br><strong>Comment</strong>: <pre>To make the tests easier to understand, since this is a string, can we make this something more distinctive than a literal zero?  From the code, it looks like we can do "import-tx-id" (or similar) since it's just used when creating the ledger key.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/tms/plain/verifier_test.go#L79](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/verifier_test.go#L79)<br><strong>Comment</strong>: <pre>This can't possibly be what we're testing. Why would we want our code to check a fake ledger?</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/tms/plain/verifier_test.go#L357](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/verifier_test.go#L357)<br><strong>Comment</strong>: <pre>That's not what we're testing. It can't be since a memory ledger isn't something we care about.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/tms/plain/verifier_test.go#L364](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/verifier_test.go#L364)<br><strong>Comment</strong>: <pre>Can this be more descriptive?</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/tms/plain/verifier_test.go#L392](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/verifier_test.go#L392)<br><strong>Comment</strong>: <pre>This is a very bad habit to get into. The subject needs to be driven at the start of the assertion - not in the before each.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/tms/plain/verifier_test.go#L395](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/verifier_test.go#L395)<br><strong>Comment</strong>: <pre>When I first started seeing these strings in CRs, I commented that they're nearly impossible to read. I you look at the tests earlier in the file, you'll see that they use string.Join to create the key with the appropriate separators. It's clear what the segments are.

All of these tests and assertions should consistently use that pattern.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/tms/plain/verifier_test.go#L395](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/tms/plain/verifier_test.go#L395)<br><strong>Comment</strong>: <pre>Instead of verifying that the ledger was  called, this is verifying a side effect of the mock. This strategy will inevitably end up with people building a bunch of paths in the mock to create scenarios for test. Maybe we can avoid the drama and just use a generated call-based mock for the assertions?</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [token/transaction/tms.go#L12](https://github.com/hyperledger-gerrit-archive/fabric/blob/5f159c528c9a0f4ab67c964c8c51228adcc79173/token/transaction/tms.go#L12)<br><strong>Comment</strong>: <pre>I'm still really struggling with why we're spreading *interfaces only* across multiple packages. I'm actually struggling with the proliferation of packages in general right now.

Given this list:

token
token/transaction
token/ledger
token/identity
token/tms
token/tms/plain
token/tms/manager
token/server
token/client

It would be interesting to see descriptions of what belongs in each package and what does not. Then, given those descriptions, does the structure make sense?</pre></blockquote>