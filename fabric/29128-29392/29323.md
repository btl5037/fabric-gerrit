<strong>Project</strong>: fabric<br><strong>Branch</strong>: master<br><strong>ID</strong>: 29323<br><strong>Subject</strong>: [FAB-14192] Fix deadlock in etcdraft chain<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 2/15/2019, 12:53:52 AM<br><strong>LastUpdated</strong>: 2/20/2019, 10:23:31 AM<br><strong>CommitMessage</strong>:<br><pre>[FAB-14192] Fix deadlock in etcdraft chain

`Propose` and `ProposeConfChagen` block when node is leaderless.
However they are currently invoked by the same go routine that
consumes data from applyC, which processes SoftState to reflect
leader change.

This may lead to deadlock:
- block is created on leader and about to be `Propose`ed,
- leader steps down due to loss of quorum
- `Propose` is called and blocks
- SoftState is passed on applyC
- `serveRequest` is not able to consume applyC
- deadlock

Change-Id: If4dc048f82983862b5f253231dafd513b442bf53
Signed-off-by: Jay Guo <guojiannan1101@gmail.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 2/15/2019, 12:53:52 AM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 2/15/2019, 12:54:25 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2019, 12:57:09 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/10137/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2019, 12:57:37 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2019, 12:57:38 AM<br><strong>Message</strong>: <pre>Patch Set 1:

WIP - No Build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2019, 12:58:01 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/8947/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2019, 12:58:32 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2019, 12:58:44 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/10137/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/10137</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2019, 1:26:47 AM<br><strong>Message</strong>: <pre>Patch Set 1: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2019, 1:27:32 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/8947/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/8947</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 2/15/2019, 5:53:31 AM<br><strong>Message</strong>: <pre>Uploaded patch set 2.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2019, 5:55:18 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/10140/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2019, 5:55:58 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Starting verify build</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 2/15/2019, 6:00:18 AM<br><strong>Message</strong>: <pre>Uploaded patch set 3: Patch Set 2 was rebased.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2019, 6:01:57 AM<br><strong>Message</strong>: <pre>Patch Set 2: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2019, 6:02:53 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/10140/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/10140</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2019, 6:03:58 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/8949/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2019, 6:04:25 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2019, 6:04:38 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/5693/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2019, 6:05:05 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2019, 6:16:41 AM<br><strong>Message</strong>: <pre>Patch Set 2: F3-UnitTest-1

Failed</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 2/15/2019, 6:39:41 AM<br><strong>Message</strong>: <pre>Uploaded patch set 4.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2019, 6:42:30 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/10141/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2019, 6:42:38 AM<br><strong>Message</strong>: <pre>Patch Set 2: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2019, 6:43:02 AM<br><strong>Message</strong>: <pre>Patch Set 4: -F2-DocBuild -F1-VerifyBuild -F3-UnitTest

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2019, 6:43:03 AM<br><strong>Message</strong>: <pre>Patch Set 4:

WIP - No Build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2019, 6:43:16 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/8949/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/8949

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/5693/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/5693</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2019, 6:43:39 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/10141/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/10141</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 2/15/2019, 9:22:38 AM<br><strong>Message</strong>: <pre>Uploaded patch set 5.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2019, 9:27:54 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/10147/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2019, 9:28:33 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2019, 9:34:44 AM<br><strong>Message</strong>: <pre>Patch Set 5: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2019, 9:35:41 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/10147/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/10147</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2019, 9:36:50 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/8957/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2019, 9:36:59 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/5703/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2019, 9:37:24 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2019, 9:37:31 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2019, 10:00:31 AM<br><strong>Message</strong>: <pre>Patch Set 5: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2019, 10:15:46 AM<br><strong>Message</strong>: <pre>Patch Set 5: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/15/2019, 10:16:44 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/8957/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/8957

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/5703/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/5703</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 2/15/2019, 6:03:28 PM<br><strong>Message</strong>: <pre>Patch Set 5:

(2 comments)</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 2/16/2019, 4:22:48 AM<br><strong>Message</strong>: <pre>Uploaded patch set 6.</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 2/16/2019, 4:22:59 AM<br><strong>Message</strong>: <pre>Patch Set 6:

(2 comments)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/16/2019, 4:24:54 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/10246/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/16/2019, 4:25:24 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/16/2019, 4:31:17 AM<br><strong>Message</strong>: <pre>Patch Set 6: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/16/2019, 4:32:09 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/10246/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/10246</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/16/2019, 4:32:37 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/9029/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/16/2019, 4:33:04 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/16/2019, 4:33:52 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/5783/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/16/2019, 4:34:15 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Starting Integration tests</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 2/16/2019, 4:55:28 AM<br><strong>Message</strong>: <pre>Patch Set 5:

(1 comment)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/16/2019, 5:00:08 AM<br><strong>Message</strong>: <pre>Patch Set 6: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/16/2019, 5:15:48 AM<br><strong>Message</strong>: <pre>Patch Set 6: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/16/2019, 5:16:41 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/9029/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/9029

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/5783/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/5783</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 2/16/2019, 9:54:00 AM<br><strong>Message</strong>: <pre>Patch Set 6:

(1 comment)</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 2/16/2019, 11:20:52 AM<br><strong>Message</strong>: <pre>Patch Set 5:

(1 comment)</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 2/16/2019, 11:20:57 AM<br><strong>Message</strong>: <pre>Patch Set 6: Code-Review+2</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 2/16/2019, 3:19:52 PM<br><strong>Message</strong>: <pre>Patch Set 6: Code-Review+2</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 2/17/2019, 8:13:58 AM<br><strong>Message</strong>: <pre>Uploaded patch set 7.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/17/2019, 8:15:45 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/10258/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/17/2019, 8:16:09 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/17/2019, 8:20:40 AM<br><strong>Message</strong>: <pre>Patch Set 7: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/17/2019, 8:21:19 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/10258/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/10258</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/17/2019, 8:25:12 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/9040/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/17/2019, 8:25:42 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/17/2019, 8:27:44 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/5799/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/17/2019, 8:28:10 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Starting Integration tests</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 2/17/2019, 8:38:51 AM<br><strong>Message</strong>: <pre>Patch Set 7:

(2 comments)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/17/2019, 8:54:37 AM<br><strong>Message</strong>: <pre>Patch Set 7: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/17/2019, 9:05:44 AM<br><strong>Message</strong>: <pre>Patch Set 7: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/17/2019, 9:06:21 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/9040/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/9040

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/5799/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/5799</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 2/17/2019, 6:40:18 PM<br><strong>Message</strong>: <pre>Patch Set 7:

(1 comment)

Thanks for review! pls see my reply in line.</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 2/18/2019, 12:21:20 AM<br><strong>Message</strong>: <pre>Patch Set 7: Code-Review+2</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 2/18/2019, 6:30:39 AM<br><strong>Message</strong>: <pre>Patch Set 7:

(2 comments)</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 2/18/2019, 8:34:46 AM<br><strong>Message</strong>: <pre>Patch Set 7:

(2 comments)</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 2/18/2019, 9:56:10 AM<br><strong>Message</strong>: <pre>Uploaded patch set 8.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/18/2019, 9:58:19 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/10278/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/18/2019, 9:58:59 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/18/2019, 10:04:24 AM<br><strong>Message</strong>: <pre>Patch Set 8: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/18/2019, 10:05:02 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/10278/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/10278</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/18/2019, 10:07:29 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/9067/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/18/2019, 10:08:01 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/18/2019, 10:08:12 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/5819/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/18/2019, 10:08:53 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/18/2019, 10:34:21 AM<br><strong>Message</strong>: <pre>Patch Set 8: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/18/2019, 10:45:45 AM<br><strong>Message</strong>: <pre>Patch Set 8: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/18/2019, 10:46:35 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/9067/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/9067

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/5819/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/5819</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 2/18/2019, 4:23:53 PM<br><strong>Message</strong>: <pre>Patch Set 7:

(1 comment)</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 2/18/2019, 9:24:07 PM<br><strong>Message</strong>: <pre>Patch Set 8:

(1 comment)</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 2/19/2019, 9:18:32 AM<br><strong>Message</strong>: <pre>Patch Set 7:

(1 comment)</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 2/19/2019, 9:43:15 AM<br><strong>Message</strong>: <pre>Uploaded patch set 9: Patch Set 8 was rebased.</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 2/19/2019, 10:42:16 AM<br><strong>Message</strong>: <pre>Patch Set 9: Code-Review+2</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 2/19/2019, 11:08:00 AM<br><strong>Message</strong>: <pre>Uploaded patch set 10.</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 2/19/2019, 11:09:35 AM<br><strong>Message</strong>: <pre>Patch Set 10:

(1 comment)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/19/2019, 11:10:50 AM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/10327/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/19/2019, 11:11:22 AM<br><strong>Message</strong>: <pre>Patch Set 10:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/19/2019, 11:16:42 AM<br><strong>Message</strong>: <pre>Patch Set 10: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/19/2019, 11:17:23 AM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/10327/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/10327</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/19/2019, 11:18:59 AM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/9112/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/19/2019, 11:19:29 AM<br><strong>Message</strong>: <pre>Patch Set 10:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/19/2019, 11:20:25 AM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/5860/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/19/2019, 11:20:57 AM<br><strong>Message</strong>: <pre>Patch Set 10:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/19/2019, 11:52:40 AM<br><strong>Message</strong>: <pre>Patch Set 10: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 2/19/2019, 11:59:03 AM<br><strong>Message</strong>: <pre>Patch Set 10: Code-Review+2</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/19/2019, 12:05:45 PM<br><strong>Message</strong>: <pre>Patch Set 10: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/19/2019, 12:06:30 PM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/9112/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/9112

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/5860/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/5860</pre><strong>Reviewer</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Reviewed</strong>: 2/20/2019, 4:18:53 AM<br><strong>Message</strong>: <pre>Uploaded patch set 11: Patch Set 10 was rebased.</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 2/20/2019, 9:26:44 AM<br><strong>Message</strong>: <pre>Patch Set 11: Code-Review+2</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 2/20/2019, 9:38:46 AM<br><strong>Message</strong>: <pre>Change has been successfully merged by Kostas Christidis</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/20/2019, 9:41:57 AM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-x86_64/5704/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/20/2019, 9:44:22 AM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/4389/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/20/2019, 10:23:31 AM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-merge-x86_64/5704/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-x86_64/5704

https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/4389/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-end-2-end-x86_64/4389</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Uploader</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Created</strong>: 2/15/2019, 12:53:52 AM<br><strong>UnmergedRevision</strong>: [bebadfe6a72b762c73005ad7aa179e7a8701f431](https://github.com/hyperledger-gerrit-archive/fabric/commit/bebadfe6a72b762c73005ad7aa179e7a8701f431)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/15/2019, 1:26:47 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Uploader</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Created</strong>: 2/15/2019, 5:53:31 AM<br><strong>UnmergedRevision</strong>: [07e8c1b2e365e5eb7f53a98ccc02692c36d50dd0](https://github.com/hyperledger-gerrit-archive/fabric/commit/07e8c1b2e365e5eb7f53a98ccc02692c36d50dd0)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/15/2019, 6:01:57 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/15/2019, 6:01:57 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/15/2019, 6:42:38 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/15/2019, 6:16:41 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Uploader</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Created</strong>: 2/15/2019, 6:00:18 AM<br><strong>UnmergedRevision</strong>: [a65b4d09030886b30c77712425d91f04ad87cc6f](https://github.com/hyperledger-gerrit-archive/fabric/commit/a65b4d09030886b30c77712425d91f04ad87cc6f)<br><br></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Uploader</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Created</strong>: 2/15/2019, 6:39:41 AM<br><strong>UnmergedRevision</strong>: [c746028dec504b424c37286d723d95689fed635e](https://github.com/hyperledger-gerrit-archive/fabric/commit/c746028dec504b424c37286d723d95689fed635e)<br><br></blockquote><h3>PatchSet Number: 5</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Uploader</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Created</strong>: 2/15/2019, 9:22:38 AM<br><strong>UnmergedRevision</strong>: [6f61f1aba0190239ea949ac73344b8f01d888e64](https://github.com/hyperledger-gerrit-archive/fabric/commit/6f61f1aba0190239ea949ac73344b8f01d888e64)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/15/2019, 9:34:44 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/15/2019, 9:34:44 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/15/2019, 10:15:46 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/15/2019, 10:00:31 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L480](https://github.com/hyperledger-gerrit-archive/fabric/blob/6f61f1aba0190239ea949ac73344b8f01d888e64/orderer/consensus/etcdraft/chain.go#L480)<br><strong>Comment</strong>: <pre>shouldn't this also be async?</pre><strong>Commenter</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L480](https://github.com/hyperledger-gerrit-archive/fabric/blob/6f61f1aba0190239ea949ac73344b8f01d888e64/orderer/consensus/etcdraft/chain.go#L480)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L492](https://github.com/hyperledger-gerrit-archive/fabric/blob/6f61f1aba0190239ea949ac73344b8f01d888e64/orderer/consensus/etcdraft/chain.go#L492)<br><strong>Comment</strong>: <pre>what ensures us that we won't get 2 proposals out of order? in theory - the go func() can be scheduled too late, and proposals that have fired in the order p1, p2 might be scheduled as p2, p1 - no?</pre><strong>Commenter</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L492](https://github.com/hyperledger-gerrit-archive/fabric/blob/6f61f1aba0190239ea949ac73344b8f01d888e64/orderer/consensus/etcdraft/chain.go#L492)<br><strong>Comment</strong>: <pre>Proposals are enqued into propC channel, and `Propose`ed one after another, so I think the sequence is still retained.</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L492](https://github.com/hyperledger-gerrit-archive/fabric/blob/6f61f1aba0190239ea949ac73344b8f01d888e64/orderer/consensus/etcdraft/chain.go#L492)<br><strong>Comment</strong>: <pre>can't we have 2 goroutines launched that dequeue the proposals in the right order, and enqueue them in the opposite order?</pre><strong>Commenter</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L492](https://github.com/hyperledger-gerrit-archive/fabric/blob/6f61f1aba0190239ea949ac73344b8f01d888e64/orderer/consensus/etcdraft/chain.go#L492)<br><strong>Comment</strong>: <pre>I suppose you meant `Propose` them in the opposite order?

there's only one goroutine and one propC at a time, which are created when a node becomes leader. So we won't be `Propose`ing tx from multiple go routines.</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L492](https://github.com/hyperledger-gerrit-archive/fabric/blob/6f61f1aba0190239ea949ac73344b8f01d888e64/orderer/consensus/etcdraft/chain.go#L492)<br><strong>Comment</strong>: <pre>got it.</pre></blockquote><h3>PatchSet Number: 6</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Uploader</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Created</strong>: 2/16/2019, 4:22:48 AM<br><strong>UnmergedRevision</strong>: [e4ff737ffce04d0c393721d834f43294376b6f53](https://github.com/hyperledger-gerrit-archive/fabric/commit/e4ff737ffce04d0c393721d834f43294376b6f53)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/16/2019, 4:31:17 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/16/2019, 4:31:17 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/16/2019, 5:15:48 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/16/2019, 5:00:08 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Approved</strong>: 2/16/2019, 3:19:52 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Approved</strong>: 2/16/2019, 11:20:57 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 7</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Uploader</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Created</strong>: 2/17/2019, 8:13:58 AM<br><strong>UnmergedRevision</strong>: [7c06a9b72012c39e057cdd95eb3dcd2c67dc9a95](https://github.com/hyperledger-gerrit-archive/fabric/commit/7c06a9b72012c39e057cdd95eb3dcd2c67dc9a95)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/17/2019, 8:20:40 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/17/2019, 8:20:40 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/17/2019, 9:05:44 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/17/2019, 8:54:37 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Approved</strong>: 2/18/2019, 12:21:20 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [/COMMIT_MSG#L9](https://github.com/hyperledger-gerrit-archive/fabric/blob/7c06a9b72012c39e057cdd95eb3dcd2c67dc9a95//COMMIT_MSG#L9)<br><strong>Comment</strong>: <pre>ProposeConfChange</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L507](https://github.com/hyperledger-gerrit-archive/fabric/blob/7c06a9b72012c39e057cdd95eb3dcd2c67dc9a95/orderer/consensus/etcdraft/chain.go#L507)<br><strong>Comment</strong>: <pre>I'm might be overlooking something, but now when this is async, what guards from proposing/processing new block before configuration is actually applied?</pre><strong>Commenter</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L507](https://github.com/hyperledger-gerrit-archive/fabric/blob/7c06a9b72012c39e057cdd95eb3dcd2c67dc9a95/orderer/consensus/etcdraft/chain.go#L507)<br><strong>Comment</strong>: <pre>we set `c.configInflight = true` here, which signals `serveRequest` to set `submitC` to nil, so that no new tx will be processed</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L507](https://github.com/hyperledger-gerrit-archive/fabric/blob/7c06a9b72012c39e057cdd95eb3dcd2c67dc9a95/orderer/consensus/etcdraft/chain.go#L507)<br><strong>Comment</strong>: <pre>but you nullify `submitC` after you calling for propose, no?</pre><strong>Commenter</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L507](https://github.com/hyperledger-gerrit-archive/fabric/blob/7c06a9b72012c39e057cdd95eb3dcd2c67dc9a95/orderer/consensus/etcdraft/chain.go#L507)<br><strong>Comment</strong>: <pre>yes, why is that a problem?</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L507](https://github.com/hyperledger-gerrit-archive/fabric/blob/7c06a9b72012c39e057cdd95eb3dcd2c67dc9a95/orderer/consensus/etcdraft/chain.go#L507)<br><strong>Comment</strong>: <pre>isn't it a race with configuration proposal?</pre><strong>Commenter</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L507](https://github.com/hyperledger-gerrit-archive/fabric/blob/7c06a9b72012c39e057cdd95eb3dcd2c67dc9a95/orderer/consensus/etcdraft/chain.go#L507)<br><strong>Comment</strong>: <pre>i'm not following... the work flow is basically this (let's call `serveRequest` go routine A, to save some typing):
- A consumes `SoftState`, finds out it becomes a leader
- A looks up the latest block, finds out it's a config block that contains membership change
- A spawns a go routine to `ProposeConfChange`
- A sets the flag to block incoming tx
- A nulls `submitC`
- A keeps running for loop, although *no* tx can be accepted because of null channel
- A consumes the `ConfChange` being proposed and apply it, as well as configureComm
- A resets `submitC` to point to member var `c.submitC`, to start accepting new tx

all of these are done on A</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L507](https://github.com/hyperledger-gerrit-archive/fabric/blob/7c06a9b72012c39e057cdd95eb3dcd2c67dc9a95/orderer/consensus/etcdraft/chain.go#L507)<br><strong>Comment</strong>: <pre>thanks for explanations, I think we are good, now it's much clear. Though, I think taking this inline function out will improve readability, but as you suggested we can take care of this in following up CRs.</pre><strong>Commenter</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L507](https://github.com/hyperledger-gerrit-archive/fabric/blob/7c06a9b72012c39e057cdd95eb3dcd2c67dc9a95/orderer/consensus/etcdraft/chain.go#L507)<br><strong>Comment</strong>: <pre>Agreed, will do, thx! Done</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L536](https://github.com/hyperledger-gerrit-archive/fabric/blob/7c06a9b72012c39e057cdd95eb3dcd2c67dc9a95/orderer/consensus/etcdraft/chain.go#L536)<br><strong>Comment</strong>: <pre>I would feel more comfortable with this CR if this function would have been extracted and not implemented in form of ad hoc inline variable. But I could understand the time constraint limitations.</pre><strong>Commenter</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/etcdraft/chain.go#L536](https://github.com/hyperledger-gerrit-archive/fabric/blob/7c06a9b72012c39e057cdd95eb3dcd2c67dc9a95/orderer/consensus/etcdraft/chain.go#L536)<br><strong>Comment</strong>: <pre>good suggestion. this func was tiny so i just defined as lambda. Although it does get bigger and deserves a separate method. will do in a follow-up though</pre></blockquote><h3>PatchSet Number: 8</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Uploader</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Created</strong>: 2/18/2019, 9:56:10 AM<br><strong>UnmergedRevision</strong>: [8c0ffe38e041116e737599127d68ffe6046d2cd0](https://github.com/hyperledger-gerrit-archive/fabric/commit/8c0ffe38e041116e737599127d68ffe6046d2cd0)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/18/2019, 10:04:24 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/18/2019, 10:04:24 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/18/2019, 10:45:45 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/18/2019, 10:34:21 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 9</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Uploader</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Created</strong>: 2/19/2019, 9:43:15 AM<br><strong>UnmergedRevision</strong>: [ddd49028e0a4da30ee992912ebb0953ed795c7a8](https://github.com/hyperledger-gerrit-archive/fabric/commit/ddd49028e0a4da30ee992912ebb0953ed795c7a8)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/18/2019, 10:04:24 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/18/2019, 10:04:24 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/18/2019, 10:45:45 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/18/2019, 10:34:21 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Approved</strong>: 2/19/2019, 10:42:16 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 10</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Uploader</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Created</strong>: 2/19/2019, 11:08:00 AM<br><strong>UnmergedRevision</strong>: [6b5a191545c21978af663f56b5994a5036b493ae](https://github.com/hyperledger-gerrit-archive/fabric/commit/6b5a191545c21978af663f56b5994a5036b493ae)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/19/2019, 11:16:42 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/19/2019, 11:16:42 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/19/2019, 12:05:45 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/19/2019, 11:52:40 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Approved</strong>: 2/19/2019, 11:59:03 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 11</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Uploader</strong>: Jay Guo - guojiannan1101@gmail.com<br><strong>Created</strong>: 2/20/2019, 4:18:53 AM<br><strong>GitHubMergedRevision</strong>: [df25c4429da0a36dd95856e00a52fae5117d0dae](https://github.com/hyperledger-gerrit-archive/fabric/commit/df25c4429da0a36dd95856e00a52fae5117d0dae)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/19/2019, 11:16:42 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/19/2019, 11:16:42 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/19/2019, 12:05:45 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/19/2019, 11:52:40 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Approved</strong>: 2/19/2019, 11:59:03 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Kostas Christidis<br><strong>Merged</strong>: 2/20/2019, 9:38:46 AM<br><br><strong>Approver</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Approved</strong>: 2/20/2019, 9:26:44 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br></blockquote>