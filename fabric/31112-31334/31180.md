<strong>Project</strong>: fabric<br><strong>Branch</strong>: master<br><strong>ID</strong>: 31180<br><strong>Subject</strong>: FAB-15299 Consensus migration: Raft start sequence<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 5/1/2019, 8:49:12 AM<br><strong>LastUpdated</strong>: 5/8/2019, 7:15:44 PM<br><strong>CommitMessage</strong>:<br><pre>FAB-15299 Consensus migration: Raft start sequence

Detect restart after consensus-type migration by:

1. The last block and the block before it carry a config-tx
2. In both config txs we have ConsensusType.State == MAINTENANCE
3. The ConsensusType.Type is different in these two blocks
4. The last block (orderer) metadata is empty

This part is implemented in multichannel/chainsupport.go in order
to be reusable.

In the etcdraft chain we have to change the start method.
Change the etcdraft chain.start() such that:

  isJoin = height >0 && not-migration

(instead of isJoin=height>0). "not-migration" is computed by
calling the respective method in chainsupport that detects
restart after migration. We do that in order to change the way
chain.node.start(fresh, join) is starting (vs. restarting).

Change-Id: I816ad4476955f679baaa9c0a2621399ca77a5d01
Signed-off-by: Yoav Tock <tock@il.ibm.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 5/1/2019, 8:49:12 AM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/1/2019, 8:50:58 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13417/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/1/2019, 8:51:26 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/1/2019, 8:56:24 AM<br><strong>Message</strong>: <pre>Patch Set 1: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/1/2019, 8:57:07 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13417/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/13417</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/1/2019, 8:58:14 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8482/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/1/2019, 8:58:38 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/1/2019, 8:58:42 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/11810/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/1/2019, 8:59:05 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/1/2019, 9:25:27 AM<br><strong>Message</strong>: <pre>Patch Set 1: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/1/2019, 9:32:29 AM<br><strong>Message</strong>: <pre>Patch Set 1: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/1/2019, 9:33:08 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8482/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/8482

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/11810/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/11810</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 5/2/2019, 11:05:53 AM<br><strong>Message</strong>: <pre>Uploaded patch set 2: Patch Set 1 was rebased.</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 5/5/2019, 3:14:20 AM<br><strong>Message</strong>: <pre>Uploaded patch set 3: Patch Set 2 was rebased.</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 5/6/2019, 5:51:03 AM<br><strong>Message</strong>: <pre>Patch Set 3: Code-Review+1

(4 comments)</pre><strong>Reviewer</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Reviewed</strong>: 5/6/2019, 9:33:17 AM<br><strong>Message</strong>: <pre>Patch Set 3: Code-Review+1

(12 comments)

mostly LGTM. I'd like to see

- casting inverted (cast on switch, not values)
- extraction of the main implementation to a function
- extraction of the function that gets the channel header from a config block
- rename of ctx to something more appropriate

don't bother with formatting changes unless you want to make them. The switch to a table driven test would be good but not required.</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 5/8/2019, 11:00:47 AM<br><strong>Message</strong>: <pre>Uploaded patch set 4.</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 5/8/2019, 11:01:50 AM<br><strong>Message</strong>: <pre>Patch Set 4:

(12 comments)

@Matt, @Yacov, Thanks for the review!</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/8/2019, 11:06:51 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13634/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/8/2019, 11:07:17 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/8/2019, 11:12:15 AM<br><strong>Message</strong>: <pre>Patch Set 4: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/8/2019, 11:12:57 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13634/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/13634</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/8/2019, 11:14:38 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8680/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/8/2019, 11:15:01 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/8/2019, 11:15:35 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12009/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/8/2019, 11:16:02 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/8/2019, 11:46:08 AM<br><strong>Message</strong>: <pre>Patch Set 4: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/8/2019, 11:47:22 AM<br><strong>Message</strong>: <pre>Patch Set 4: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/8/2019, 11:47:59 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8680/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/8680

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12009/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/12009</pre><strong>Reviewer</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Reviewed</strong>: 5/8/2019, 12:16:10 PM<br><strong>Message</strong>: <pre>Patch Set 4: Code-Review+2

(2 comments)</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 5/8/2019, 6:09:03 PM<br><strong>Message</strong>: <pre>Patch Set 4: Code-Review+2</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 5/8/2019, 6:09:06 PM<br><strong>Message</strong>: <pre>Change has been successfully merged by Gari Singh</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/8/2019, 6:10:38 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-x86_64/6642/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/8/2019, 6:11:43 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/5327/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/8/2019, 7:15:44 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-merge-x86_64/6642/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-x86_64/6642

https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/5327/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-end-2-end-x86_64/5327</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Uploader</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Created</strong>: 5/1/2019, 8:49:12 AM<br><strong>UnmergedRevision</strong>: [6219260ca3184b18dfaed168e3cf63d955836172](https://github.com/hyperledger-gerrit-archive/fabric/commit/6219260ca3184b18dfaed168e3cf63d955836172)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/1/2019, 8:56:24 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/1/2019, 8:56:24 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/1/2019, 9:32:29 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/1/2019, 9:25:27 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Uploader</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Created</strong>: 5/2/2019, 11:05:53 AM<br><strong>UnmergedRevision</strong>: [bc910d626e09743e4548461060fa056f2b13c160](https://github.com/hyperledger-gerrit-archive/fabric/commit/bc910d626e09743e4548461060fa056f2b13c160)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/1/2019, 8:56:24 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/1/2019, 8:56:24 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/1/2019, 9:32:29 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/1/2019, 9:25:27 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Uploader</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Created</strong>: 5/5/2019, 3:14:20 AM<br><strong>UnmergedRevision</strong>: [657bd0520fc85793e9afa75894668b03c57806bd](https://github.com/hyperledger-gerrit-archive/fabric/commit/657bd0520fc85793e9afa75894668b03c57806bd)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/1/2019, 8:56:24 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/1/2019, 8:56:24 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/1/2019, 9:32:29 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/1/2019, 9:25:27 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Approved</strong>: 5/6/2019, 5:51:03 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Approved</strong>: 5/6/2019, 9:33:17 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L32](https://github.com/hyperledger-gerrit-archive/fabric/blob/657bd0520fc85793e9afa75894668b03c57806bd/orderer/common/multichannel/chainsupport.go#L32)<br><strong>Comment</strong>: <pre>This isn't you but i want to point out that this is an anti-pattern. Smashing all of the dependencies into one struct just binds everything together.

When possible, we should avoid adding to the mess.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L32](https://github.com/hyperledger-gerrit-archive/fabric/blob/657bd0520fc85793e9afa75894668b03c57806bd/orderer/common/multichannel/chainsupport.go#L32)<br><strong>Comment</strong>: <pre>Noted</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L93](https://github.com/hyperledger-gerrit-archive/fabric/blob/657bd0520fc85793e9afa75894668b03c57806bd/orderer/common/multichannel/chainsupport.go#L93)<br><strong>Comment</strong>: <pre>could be nice if this line was tested</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L93](https://github.com/hyperledger-gerrit-archive/fabric/blob/657bd0520fc85793e9afa75894668b03c57806bd/orderer/common/multichannel/chainsupport.go#L93)<br><strong>Comment</strong>: <pre>+1</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L93](https://github.com/hyperledger-gerrit-archive/fabric/blob/657bd0520fc85793e9afa75894668b03c57806bd/orderer/common/multichannel/chainsupport.go#L93)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L107](https://github.com/hyperledger-gerrit-archive/fabric/blob/657bd0520fc85793e9afa75894668b03c57806bd/orderer/common/multichannel/chainsupport.go#L107)<br><strong>Comment</strong>: <pre>so as this line</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L107](https://github.com/hyperledger-gerrit-archive/fabric/blob/657bd0520fc85793e9afa75894668b03c57806bd/orderer/common/multichannel/chainsupport.go#L107)<br><strong>Comment</strong>: <pre>+1</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L107](https://github.com/hyperledger-gerrit-archive/fabric/blob/657bd0520fc85793e9afa75894668b03c57806bd/orderer/common/multichannel/chainsupport.go#L107)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L134](https://github.com/hyperledger-gerrit-archive/fabric/blob/657bd0520fc85793e9afa75894668b03c57806bd/orderer/common/multichannel/chainsupport.go#L134)<br><strong>Comment</strong>: <pre>and this.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L134](https://github.com/hyperledger-gerrit-archive/fabric/blob/657bd0520fc85793e9afa75894668b03c57806bd/orderer/common/multichannel/chainsupport.go#L134)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L137](https://github.com/hyperledger-gerrit-archive/fabric/blob/657bd0520fc85793e9afa75894668b03c57806bd/orderer/common/multichannel/chainsupport.go#L137)<br><strong>Comment</strong>: <pre>ctx is usually associated with context.Context instances and is a bit confusing. What we're getting back is an envelope so I'd expect the var to reflect that.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L137](https://github.com/hyperledger-gerrit-archive/fabric/blob/657bd0520fc85793e9afa75894668b03c57806bd/orderer/common/multichannel/chainsupport.go#L137)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L157](https://github.com/hyperledger-gerrit-archive/fabric/blob/657bd0520fc85793e9afa75894668b03c57806bd/orderer/common/multichannel/chainsupport.go#L157)<br><strong>Comment</strong>: <pre>this is a function - you're getting the channel header from a block</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L157](https://github.com/hyperledger-gerrit-archive/fabric/blob/657bd0520fc85793e9afa75894668b03c57806bd/orderer/common/multichannel/chainsupport.go#L157)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L159](https://github.com/hyperledger-gerrit-archive/fabric/blob/657bd0520fc85793e9afa75894668b03c57806bd/orderer/common/multichannel/chainsupport.go#L159)<br><strong>Comment</strong>: <pre>Please cast this type to common.HeaderType instead of casting all of the typed values to int32.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L159](https://github.com/hyperledger-gerrit-archive/fabric/blob/657bd0520fc85793e9afa75894668b03c57806bd/orderer/common/multichannel/chainsupport.go#L159)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L163](https://github.com/hyperledger-gerrit-archive/fabric/blob/657bd0520fc85793e9afa75894668b03c57806bd/orderer/common/multichannel/chainsupport.go#L163)<br><strong>Comment</strong>: <pre>can you export this into a function?</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L163](https://github.com/hyperledger-gerrit-archive/fabric/blob/657bd0520fc85793e9afa75894668b03c57806bd/orderer/common/multichannel/chainsupport.go#L163)<br><strong>Comment</strong>: <pre>agreed - the body should probably be extracted and this case should simply return the result. When that's done, the default block can also simply return true and then we don't need the dangling return at the end of the method.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport.go#L163](https://github.com/hyperledger-gerrit-archive/fabric/blob/657bd0520fc85793e9afa75894668b03c57806bd/orderer/common/multichannel/chainsupport.go#L163)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport_test.go#L168](https://github.com/hyperledger-gerrit-archive/fabric/blob/657bd0520fc85793e9afa75894668b03c57806bd/orderer/common/multichannel/chainsupport_test.go#L168)<br><strong>Comment</strong>: <pre>Most of this code is duplicated. It's probably not work rewriting but this could easily be a table test. There's a small function that runs between setup, creation of support, and assertions. That func would be passed lf and rl and each impl attached to a struct.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport_test.go#L168](https://github.com/hyperledger-gerrit-archive/fabric/blob/657bd0520fc85793e9afa75894668b03c57806bd/orderer/common/multichannel/chainsupport_test.go#L168)<br><strong>Comment</strong>: <pre>Noted</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport_test.go#L174](https://github.com/hyperledger-gerrit-archive/fabric/blob/657bd0520fc85793e9afa75894668b03c57806bd/orderer/common/multichannel/chainsupport_test.go#L174)<br><strong>Comment</strong>: <pre>nit: closing brace and paren on its own line please - like you do on the metadata assignment</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport_test.go#L174](https://github.com/hyperledger-gerrit-archive/fabric/blob/657bd0520fc85793e9afa75894668b03c57806bd/orderer/common/multichannel/chainsupport_test.go#L174)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport_test.go#L181](https://github.com/hyperledger-gerrit-archive/fabric/blob/657bd0520fc85793e9afa75894668b03c57806bd/orderer/common/multichannel/chainsupport_test.go#L181)<br><strong>Comment</strong>: <pre>unnecessary</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport_test.go#L229](https://github.com/hyperledger-gerrit-archive/fabric/blob/657bd0520fc85793e9afa75894668b03c57806bd/orderer/common/multichannel/chainsupport_test.go#L229)<br><strong>Comment</strong>: <pre>this call is really hard to grok in reviews. If this were an arg per line it would be much easier to read.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport_test.go#L229](https://github.com/hyperledger-gerrit-archive/fabric/blob/657bd0520fc85793e9afa75894668b03c57806bd/orderer/common/multichannel/chainsupport_test.go#L229)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/consensus.go#L119](https://github.com/hyperledger-gerrit-archive/fabric/blob/657bd0520fc85793e9afa75894668b03c57806bd/orderer/consensus/consensus.go#L119)<br><strong>Comment</strong>: <pre>this could (probably should) have been done as an optional interface that we checked. If not implemented, then clearly consensus migration is false.

If we ever start caring about semantic versioning, this is a breaking change. There are no compatible interface changes in go.

Please don't change it at this time; I'm highlighting this for your awareness.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/consensus.go#L119](https://github.com/hyperledger-gerrit-archive/fabric/blob/657bd0520fc85793e9afa75894668b03c57806bd/orderer/consensus/consensus.go#L119)<br><strong>Comment</strong>: <pre>Noted</pre></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Uploader</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Created</strong>: 5/8/2019, 11:00:47 AM<br><strong>GitHubMergedRevision</strong>: [504304590cbe1df73c75ff39899839b0fc90a734](https://github.com/hyperledger-gerrit-archive/fabric/commit/504304590cbe1df73c75ff39899839b0fc90a734)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/8/2019, 11:12:15 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/8/2019, 11:12:15 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/8/2019, 11:47:22 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/8/2019, 11:46:08 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Approved</strong>: 5/8/2019, 6:09:03 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Gari Singh<br><strong>Merged</strong>: 5/8/2019, 6:09:06 PM<br><br><strong>Approver</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Approved</strong>: 5/8/2019, 12:16:10 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport_test.go#L225](https://github.com/hyperledger-gerrit-archive/fabric/blob/504304590cbe1df73c75ff39899839b0fc90a734/orderer/common/multichannel/chainsupport_test.go#L225)<br><strong>Comment</strong>: <pre>nit: with these multi-line calls. please put closing paren/brace/whatever on its own line to align with the start of the call.

no action needed here - consider this a general style request for the future</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [orderer/common/multichannel/chainsupport_test.go#L287](https://github.com/hyperledger-gerrit-archive/fabric/blob/504304590cbe1df73c75ff39899839b0fc90a734/orderer/common/multichannel/chainsupport_test.go#L287)<br><strong>Comment</strong>: <pre>nit: with these multi-line calls. please put closing paren/brace/whatever on its own line.

no action needed here - consider this a general style request for the future</pre></blockquote>