<strong>Project</strong>: fabric<br><strong>Branch</strong>: master<br><strong>ID</strong>: 4827<br><strong>Subject</strong>: [FAB-187] VSCC uses policies specified upon deploy<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Assignee</strong>:<br><strong>Created</strong>: 1/25/2017, 12:31:24 PM<br><strong>LastUpdated</strong>: 2/1/2017, 4:26:22 AM<br><strong>CommitMessage</strong>:<br><pre>[FAB-187] VSCC uses policies specified upon deploy

This change-set provides support for endorsement policies. At chaincode deploy
time, the deployer can specify the endorsement policy it requires from command
line. The cc deploy tx is sent to lccc which stores the policy. Later, the
validator can extract the policy and send it to VSCC.

Change-Id: Ic1bc0e492a9070a355cfba83dfa56d121902c543
Signed-off-by: Alessandro Sorniotti <ale.linux@sopit.net>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 1/25/2017, 12:31:24 PM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/25/2017, 12:35:51 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5654/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/25/2017, 1:15:49 PM<br><strong>Message</strong>: <pre>Patch Set 1: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5654/ : FAILURE</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 1/25/2017, 2:40:04 PM<br><strong>Message</strong>: <pre>Uploaded patch set 2.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/25/2017, 2:44:17 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5668/</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 1/25/2017, 3:09:33 PM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/25/2017, 3:12:28 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5674/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/25/2017, 3:15:40 PM<br><strong>Message</strong>: <pre>Patch Set 3: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5674/ : FAILURE</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 1/25/2017, 3:16:03 PM<br><strong>Message</strong>: <pre>Uploaded patch set 4.</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 1/25/2017, 3:17:42 PM<br><strong>Message</strong>: <pre>Uploaded patch set 5.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/25/2017, 3:18:29 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5675/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/25/2017, 3:19:58 PM<br><strong>Message</strong>: <pre>Patch Set 2: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5668/ : SUCCESS</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/25/2017, 3:21:42 PM<br><strong>Message</strong>: <pre>Patch Set 4: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5675/ : FAILURE</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/25/2017, 3:22:29 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5677/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/25/2017, 4:20:01 PM<br><strong>Message</strong>: <pre>Patch Set 5: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5677/ : SUCCESS</pre><strong>Reviewer</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>Reviewed</strong>: 1/25/2017, 4:59:42 PM<br><strong>Message</strong>: <pre>Patch Set 5: Code-Review+2

Update: there is no problem with repacking the MIT License. I will work (later on) to formalize this.</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 1/25/2017, 6:02:54 PM<br><strong>Message</strong>: <pre>Patch Set 5: Code-Review-1

(3 comments)

a few questions/comments, Ale...</pre><strong>Reviewer</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>Reviewed</strong>: 1/25/2017, 10:28:23 PM<br><strong>Message</strong>: <pre>Patch Set 5:

(2 comments)

A couple of minor additional comments, but I am ok either way baring Murali's</pre><strong>Reviewer</strong>: Jonathan Levi (HACERA) - jonathan@hacera.com<br><strong>Reviewed</strong>: 1/25/2017, 11:19:46 PM<br><strong>Message</strong>: <pre>Patch Set 5: -Code-Review</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 1/26/2017, 12:29:24 AM<br><strong>Message</strong>: <pre>Patch Set 5:

(1 comment)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 1/26/2017, 5:47:55 AM<br><strong>Message</strong>: <pre>Patch Set 5:

(5 comments)

Thanks, gents! Please see below and see my new push</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 1/26/2017, 5:49:40 AM<br><strong>Message</strong>: <pre>Uploaded patch set 6.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/26/2017, 5:52:30 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5717/</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 1/26/2017, 6:30:41 AM<br><strong>Message</strong>: <pre>Uploaded patch set 7.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/26/2017, 6:33:30 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5719/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/26/2017, 7:04:29 AM<br><strong>Message</strong>: <pre>Patch Set 6: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5717/ : SUCCESS</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/26/2017, 7:43:56 AM<br><strong>Message</strong>: <pre>Patch Set 7: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5719/ : SUCCESS</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 1/26/2017, 8:27:29 AM<br><strong>Message</strong>: <pre>Patch Set 7:

(1 comment)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 1/26/2017, 8:33:33 AM<br><strong>Message</strong>: <pre>Patch Set 7:

(1 comment)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 1/26/2017, 4:32:09 PM<br><strong>Message</strong>: <pre>Uploaded patch set 8.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/26/2017, 4:35:43 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5758/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/26/2017, 4:38:17 PM<br><strong>Message</strong>: <pre>Patch Set 8: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5758/ : FAILURE</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 1/26/2017, 4:44:42 PM<br><strong>Message</strong>: <pre>Uploaded patch set 9.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/26/2017, 4:47:30 PM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5759/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/26/2017, 4:50:41 PM<br><strong>Message</strong>: <pre>Patch Set 9: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5759/ : FAILURE</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 1/26/2017, 5:23:43 PM<br><strong>Message</strong>: <pre>Uploaded patch set 10.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/26/2017, 5:28:03 PM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5763/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/26/2017, 5:41:22 PM<br><strong>Message</strong>: <pre>Patch Set 10: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5763/ : FAILURE</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 1/26/2017, 6:27:46 PM<br><strong>Message</strong>: <pre>Uploaded patch set 11.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/26/2017, 6:30:03 PM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5766/</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 1/26/2017, 7:04:54 PM<br><strong>Message</strong>: <pre>Uploaded patch set 12.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/26/2017, 7:08:14 PM<br><strong>Message</strong>: <pre>Patch Set 12:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5769/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/26/2017, 7:11:45 PM<br><strong>Message</strong>: <pre>Patch Set 11: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5766/ : FAILURE</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 1/26/2017, 7:33:02 PM<br><strong>Message</strong>: <pre>Uploaded patch set 13.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/26/2017, 7:36:36 PM<br><strong>Message</strong>: <pre>Patch Set 13:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5770/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/26/2017, 7:38:19 PM<br><strong>Message</strong>: <pre>Patch Set 12: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5769/ : FAILURE</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/26/2017, 8:22:24 PM<br><strong>Message</strong>: <pre>Patch Set 13: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5770/ : SUCCESS</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 1/27/2017, 9:50:34 AM<br><strong>Message</strong>: <pre>Patch Set 13:

(1 comment)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 1/28/2017, 3:59:06 AM<br><strong>Message</strong>: <pre>Uploaded patch set 14.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/28/2017, 3:59:57 AM<br><strong>Message</strong>: <pre>Patch Set 14:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5847/</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 1/28/2017, 4:03:01 AM<br><strong>Message</strong>: <pre>Patch Set 14:

(1 comment)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/28/2017, 4:42:05 AM<br><strong>Message</strong>: <pre>Patch Set 14: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5847/ : FAILURE</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 1/28/2017, 8:42:20 AM<br><strong>Message</strong>: <pre>Patch Set 14:

I have seen this failure recently in another CR and thought it was some transient CI thing. Seeing it twice makes me wonder. 

Going to reverify but open a JIRA for investigation of the failing CI.</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 1/28/2017, 8:42:29 AM<br><strong>Message</strong>: <pre>Patch Set 14:

reverify</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/28/2017, 8:43:04 AM<br><strong>Message</strong>: <pre>Patch Set 14: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5848/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/28/2017, 9:32:53 AM<br><strong>Message</strong>: <pre>Patch Set 14: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5848/ : SUCCESS</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 1/28/2017, 9:39:39 AM<br><strong>Message</strong>: <pre>Uploaded patch set 15.</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 1/28/2017, 9:41:18 AM<br><strong>Message</strong>: <pre>Patch Set 15:

Thanks Jason, I've changed the approach as you suggested, please have a look and see if it's better now. Also, due to an import cycle, I had to move the definition of the Support interface away from the txvalidator into commons - hope that makes sense.

@Murali: I had to revert back to -V for vscc, -v already existed.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/28/2017, 9:43:08 AM<br><strong>Message</strong>: <pre>Patch Set 15:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5851/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/28/2017, 10:33:49 AM<br><strong>Message</strong>: <pre>Patch Set 15: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5851/ : SUCCESS</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 1/28/2017, 10:39:24 AM<br><strong>Message</strong>: <pre>Patch Set 15:

> Thanks Jason, I've changed the approach as you suggested, please
 > have a look and see if it's better now. Also, due to an import
 > cycle, I had to move the definition of the Support interface away
 > from the txvalidator into commons - hope that makes sense.
 > 
 > @Murali: I had to revert back to -V for vscc, -v already existed.

That's fine...  I had to use "-C" for chaincode CLI commands for the same reason.</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 1/28/2017, 11:46:31 AM<br><strong>Message</strong>: <pre>Patch Set 15:

(6 comments)

The "getDefaultPolicy" in ccproviderimpl.go worries a little bit, Ale.</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 1/28/2017, 12:58:53 PM<br><strong>Message</strong>: <pre>Patch Set 15: Code-Review-1

(6 comments)

Thx for the great comments! It's clear that this CR needs more design work, and can't go in until some other pieces have been consolidated. In particular, it's clear that 
1) we need to wait till a proper design of the lifecycle policies is available
2) we need to wait till lifecycle policies are deployed upon chain creation so that we can provide a proper implementation of the function that retrieves validation policies for system chaincodes
3) we need to find a good name for the Support interface</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 1/28/2017, 1:00:25 PM<br><strong>Message</strong>: <pre>Uploaded patch set 16: Commit message was updated.</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 1/28/2017, 1:01:04 PM<br><strong>Message</strong>: <pre>Patch Set 16: Code-Review-1

Thx for the great comments! It's clear that this CR needs more design work, and can't go in until some other pieces have been consolidated. In particular, it's clear that 
1) we need to wait till a proper design of the lifecycle policies is available
2) we need to wait till lifecycle policies are deployed upon chain creation so that we can provide a proper implementation of the function that retrieves validation policies for system chaincodes
3) we need to find a good name for the Support interface</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/28/2017, 1:02:58 PM<br><strong>Message</strong>: <pre>Patch Set 16:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5859/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/28/2017, 2:04:21 PM<br><strong>Message</strong>: <pre>Patch Set 16: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5859/ : SUCCESS</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 1/28/2017, 4:36:51 PM<br><strong>Message</strong>: <pre>Patch Set 16:

So Ale, policy for validating LCCC is the only thing that's a bit iffy about this CR. Taking a step back though, this is mainly about user chaincode VSCC validation. LCCC get's caught in the crossfire as it is also a chaincode and needs to be validate. Using the same "VSCC" based validation is not correct - I think we agree on that  ? - but we should use chain creation config policy. That is really a separate CR.

Rather than having this CR held hostage to that, what do you think of getting rid of "getDefaultPolicy" and allowing "lccc" requests to just go through ? ... and follow it up with a CR for doing LCCC validation ?</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 1/29/2017, 11:23:04 AM<br><strong>Message</strong>: <pre>Patch Set 16:

Let me see if I understood correctly what you are suggesting: for now, if it's an invocation of LCCC that we are being asked to validate in VSCCValidateTx, we just return right away with no error. If so, I suppose we would add some comment to that end, and also perhaps open a JIRA?</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 1/29/2017, 11:31:43 AM<br><strong>Message</strong>: <pre>Patch Set 15:

(1 comment)</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 1/29/2017, 9:51:42 PM<br><strong>Message</strong>: <pre>Patch Set 16:

> Let me see if I understood correctly what you are suggesting: for
 > now, if it's an invocation of LCCC that we are being asked to
 > validate in VSCCValidateTx, we just return right away with no
 > error. If so, I suppose we would add some comment to that end, and
 > also perhaps open a JIRA?

Correct. 
Assumptions -(1)  LCCC check is a "different" type of check that's not VSCC based (but config policy based at channel create time), and (2)  this CR is for VSCC for user chaincode. Given the above, I think that LSCC check belongs in a separate CR and so for this one we can just return true - if we follow up with a new CR soon after.</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 1/30/2017, 4:35:39 AM<br><strong>Message</strong>: <pre>Uploaded patch set 17.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/30/2017, 4:36:36 AM<br><strong>Message</strong>: <pre>Patch Set 17:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5904/</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 1/30/2017, 4:42:17 AM<br><strong>Message</strong>: <pre>Patch Set 17:

Thanks, Jason and Murali.

@Murali: I've created FAB-1934 to keep track of the fact that we should validate LCCC invocations in a way that is different from the one we use to validate normal cc.

@Jason: the change above has made the point moot - although your comment was well received and I'll handle future import cycles in the way you suggest.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/30/2017, 5:42:47 AM<br><strong>Message</strong>: <pre>Patch Set 17: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5904/ : SUCCESS</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 1/30/2017, 5:52:26 AM<br><strong>Message</strong>: <pre>Uploaded patch set 18.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/30/2017, 5:55:18 AM<br><strong>Message</strong>: <pre>Patch Set 18:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5905/</pre><strong>Reviewer</strong>: Elli Androulaki - lli@zurich.ibm.com<br><strong>Reviewed</strong>: 1/30/2017, 6:53:32 AM<br><strong>Message</strong>: <pre>Patch Set 18:

(2 comments)

Hi Ale, Thanks! Just a few minor comments. It otherwise looks good to me.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/30/2017, 7:06:20 AM<br><strong>Message</strong>: <pre>Patch Set 18: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5905/ : SUCCESS</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 1/30/2017, 7:12:10 AM<br><strong>Message</strong>: <pre>Patch Set 18:

(2 comments)

Thanks for your comments, Elli - see below! :)</pre><strong>Reviewer</strong>: Elli Androulaki - lli@zurich.ibm.com<br><strong>Reviewed</strong>: 1/30/2017, 7:32:40 AM<br><strong>Message</strong>: <pre>Patch Set 18:

(2 comments)

Hi Ale, 

Thanks! Please find below my comments.</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 1/30/2017, 8:07:42 AM<br><strong>Message</strong>: <pre>Patch Set 18:

(2 comments)

Thanks Elli, see below!</pre><strong>Reviewer</strong>: Elli Androulaki - lli@zurich.ibm.com<br><strong>Reviewed</strong>: 1/30/2017, 8:52:48 AM<br><strong>Message</strong>: <pre>Patch Set 18: Code-Review+1

(2 comments)

Thanks Ale! 
So as discussed, I will open two jira items as the comments on the two points below are not strongly related to this CR.
For now the CR looks good to me :)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 1/30/2017, 8:57:20 AM<br><strong>Message</strong>: <pre>Patch Set 18:

(2 comments)

Thx, Elli!</pre><strong>Reviewer</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>Reviewed</strong>: 1/30/2017, 3:19:25 PM<br><strong>Message</strong>: <pre>Patch Set 18: Code-Review+1

Thanks :)</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 1/31/2017, 8:42:15 AM<br><strong>Message</strong>: <pre>Patch Set 18:

(1 comment)</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 1/31/2017, 8:44:07 AM<br><strong>Message</strong>: <pre>Patch Set 18: Code-Review+1

+1 pending Jason's review.</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 1/31/2017, 9:21:57 AM<br><strong>Message</strong>: <pre>Patch Set 18:

(1 comment)</pre><strong>Reviewer</strong>: Elli Androulaki - lli@zurich.ibm.com<br><strong>Reviewed</strong>: 1/31/2017, 9:27:25 AM<br><strong>Message</strong>: <pre>Patch Set 18:

(1 comment)

Hi Murali,
A clarification question on your statement :)
With thanks,
Elli</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 1/31/2017, 9:47:31 AM<br><strong>Message</strong>: <pre>Patch Set 18:

(1 comment)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 1/31/2017, 12:10:05 PM<br><strong>Message</strong>: <pre>Patch Set 18:

(1 comment)

Thanks, Jason! See below.

@Murali: thx, I'll push out a quick doc asap, together with the fix to what Jason caught.</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 1/31/2017, 9:27:08 PM<br><strong>Message</strong>: <pre>Patch Set 18:

Ale, were you going to add a doc ?</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 1/31/2017, 10:13:18 PM<br><strong>Message</strong>: <pre>Patch Set 18: Code-Review+2</pre><strong>Reviewer</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>Reviewed</strong>: 1/31/2017, 10:13:27 PM<br><strong>Message</strong>: <pre>Patch Set 18: Code-Review+2

Please create a cr to add a doc for chaincode deployment changes and endorsement policy language spec with some samples. Thanks.</pre><strong>Reviewer</strong>: Gerrit Code Review - gerrit@hyperledger.org<br><strong>Reviewed</strong>: 1/31/2017, 10:14:09 PM<br><strong>Message</strong>: <pre>Change has been successfully merged by Binh Nguyen</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/31/2017, 10:14:17 PM<br><strong>Message</strong>: <pre>Patch Set 18:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-power-ppc64le/298/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/31/2017, 10:14:18 PM<br><strong>Message</strong>: <pre>Patch Set 18:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-z/301/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/31/2017, 10:18:41 PM<br><strong>Message</strong>: <pre>Patch Set 18:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-x86_64/931/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/31/2017, 11:23:26 PM<br><strong>Message</strong>: <pre>Patch Set 18:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-merge-power-ppc64le/298/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-merge-x86_64/931/ : SUCCESS

https://jenkins.hyperledger.org/job/fabric-merge-z/301/ : SUCCESS</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 2/1/2017, 4:26:22 AM<br><strong>Message</strong>: <pre>Patch Set 18:

Sorry gents, I didn't get around it last night.. it's ready for your comments though, see here

https://gerrit.hyperledger.org/r/#/c/5181/</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 1/25/2017, 12:31:24 PM<br><strong>UnmergedRevision</strong>: [980e9e0fcebc350755e3cb404ae2091363a29e58](https://github.com/hyperledger-gerrit-archive/fabric/commit/980e9e0fcebc350755e3cb404ae2091363a29e58)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/25/2017, 1:15:49 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 1/25/2017, 2:40:04 PM<br><strong>UnmergedRevision</strong>: [234d74560c9f44965a5fa4157871e99cae7e3280](https://github.com/hyperledger-gerrit-archive/fabric/commit/234d74560c9f44965a5fa4157871e99cae7e3280)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/25/2017, 3:19:58 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 1/25/2017, 3:09:33 PM<br><strong>UnmergedRevision</strong>: [eb498e96f3d179ab664ab711c03d1bf39ebd7f1a](https://github.com/hyperledger-gerrit-archive/fabric/commit/eb498e96f3d179ab664ab711c03d1bf39ebd7f1a)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/25/2017, 3:15:40 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 1/25/2017, 3:16:03 PM<br><strong>UnmergedRevision</strong>: [0e294195f3775d0d6419e32cef91db8bc298791e](https://github.com/hyperledger-gerrit-archive/fabric/commit/0e294195f3775d0d6419e32cef91db8bc298791e)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/25/2017, 3:21:42 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 5</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 1/25/2017, 3:17:42 PM<br><strong>UnmergedRevision</strong>: [b61251ab5ef83ed4e543aec6a375ba16c9ff0dbb](https://github.com/hyperledger-gerrit-archive/fabric/commit/b61251ab5ef83ed4e543aec6a375ba16c9ff0dbb)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/25/2017, 4:20:01 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Approved</strong>: 1/25/2017, 6:02:54 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/ccproviderimpl.go#L83](https://github.com/hyperledger-gerrit-archive/fabric/blob/b61251ab5ef83ed4e543aec6a375ba16c9ff0dbb/core/chaincode/ccproviderimpl.go#L83)<br><strong>Comment</strong>: <pre>would getDefaultPolicy a better name?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/ccproviderimpl.go#L83](https://github.com/hyperledger-gerrit-archive/fabric/blob/b61251ab5ef83ed4e543aec6a375ba16c9ff0dbb/core/chaincode/ccproviderimpl.go#L83)<br><strong>Comment</strong>: <pre>That's a good Q.. I'll rename it, but afaik, this method should disappear very soon. The config block should have a default policy for LCCC somewhere, and the method below (GetCCValidationInfoFromLCCC) should return that default policy from CSCC as opposed to fabricating one on the fly as we do now. I'll rename the method as you suggest and create a JIRA to track the fact that we need a default policy for the chain.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/ccproviderimpl.go#L86](https://github.com/hyperledger-gerrit-archive/fabric/blob/b61251ab5ef83ed4e543aec6a375ba16c9ff0dbb/core/chaincode/ccproviderimpl.go#L86)<br><strong>Comment</strong>: <pre>Maybe fine for this CR, but we should stop propagating this call.  We should be using the MSP manager instantiated in the createChain of peer.go.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/ccproviderimpl.go#L86](https://github.com/hyperledger-gerrit-archive/fabric/blob/b61251ab5ef83ed4e543aec6a375ba16c9ff0dbb/core/chaincode/ccproviderimpl.go#L86)<br><strong>Comment</strong>: <pre>You are absolutely right. Take a look at how I've fixed it and let me know if you think it's the right way. I could have passed down the support object but I thought it was adding unnecessary complexity</pre><strong>Commenter</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/ccproviderimpl.go#L95](https://github.com/hyperledger-gerrit-archive/fabric/blob/b61251ab5ef83ed4e543aec6a375ba16c9ff0dbb/core/chaincode/ccproviderimpl.go#L95)<br><strong>Comment</strong>: <pre>we could make this tighter :-) 
for _, msp = range msps {
   break
}</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/ccproviderimpl.go#L95](https://github.com/hyperledger-gerrit-archive/fabric/blob/b61251ab5ef83ed4e543aec6a375ba16c9ff0dbb/core/chaincode/ccproviderimpl.go#L95)<br><strong>Comment</strong>: <pre>:) good point, thx! Fixed</pre><strong>Commenter</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/ccproviderimpl.go#L119](https://github.com/hyperledger-gerrit-archive/fabric/blob/b61251ab5ef83ed4e543aec6a375ba16c9ff0dbb/core/chaincode/ccproviderimpl.go#L119)<br><strong>Comment</strong>: <pre>this should really be defined as the LifeCycle policy config item at the time of chain creation. So validation of lifecycle transactions are done using the config block (as opposed to normal transactions which use the lccc's policy for that chaincode).

If you agree (and validate) the above, this is OK as a temporary measure and that can be done as a separate CR (makes sense to separate it out too).</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/ccproviderimpl.go#L119](https://github.com/hyperledger-gerrit-archive/fabric/blob/b61251ab5ef83ed4e543aec6a375ba16c9ff0dbb/core/chaincode/ccproviderimpl.go#L119)<br><strong>Comment</strong>: <pre>I definitely agree - see my response to Binh's comment. I've created FAB-1863 to keep track of this todo.</pre><strong>Commenter</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lccc.go#L329](https://github.com/hyperledger-gerrit-archive/fabric/blob/b61251ab5ef83ed4e543aec6a375ba16c9ff0dbb/core/chaincode/lccc.go#L329)<br><strong>Comment</strong>: <pre>we have to check escc and vscc are valid system chaincodes (using ccprovider to provide an interface for that)</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/lccc.go#L329](https://github.com/hyperledger-gerrit-archive/fabric/blob/b61251ab5ef83ed4e543aec6a375ba16c9ff0dbb/core/chaincode/lccc.go#L329)<br><strong>Comment</strong>: <pre>I've done this without touching the ccprovider interface as we're in the same package (just basically to avoid this change snowballing). As soon as lccc moves into another package, we'll (have to) move IsSysCC in the interface. Do you think that's ok?</pre><strong>Commenter</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lccc.go#L329](https://github.com/hyperledger-gerrit-archive/fabric/blob/b61251ab5ef83ed4e543aec6a375ba16c9ff0dbb/core/chaincode/lccc.go#L329)<br><strong>Comment</strong>: <pre>change set https://gerrit.hyperledger.org/r/#/c/4859/ moves lccc and other sccs to their rightful packages under scc/... perhaps merge this and take care of escc , vscc checks ?
Also that change might give you room to do other things to without worrying about import cycles etc.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/lccc.go#L329](https://github.com/hyperledger-gerrit-archive/fabric/blob/b61251ab5ef83ed4e543aec6a375ba16c9ff0dbb/core/chaincode/lccc.go#L329)<br><strong>Comment</strong>: <pre>Whatever you think is more urgent... ;)</pre><strong>Commenter</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>CommentLine</strong>: [peer/chaincode/chaincode.go#L53](https://github.com/hyperledger-gerrit-archive/fabric/blob/b61251ab5ef83ed4e543aec6a375ba16c9ff0dbb/peer/chaincode/chaincode.go#L53)<br><strong>Comment</strong>: <pre>can we use lower case E and V please ?</pre></blockquote><h3>PatchSet Number: 6</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 1/26/2017, 5:49:40 AM<br><strong>UnmergedRevision</strong>: [9a0d07078f97214cbb84c7242cb97786c38b5211](https://github.com/hyperledger-gerrit-archive/fabric/commit/9a0d07078f97214cbb84c7242cb97786c38b5211)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/26/2017, 7:04:29 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 7</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 1/26/2017, 6:30:41 AM<br><strong>UnmergedRevision</strong>: [8cd58d47b71c64f66c370f198727b0ee162255c0](https://github.com/hyperledger-gerrit-archive/fabric/commit/8cd58d47b71c64f66c370f198727b0ee162255c0)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/26/2017, 7:43:56 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 8</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 1/26/2017, 4:32:09 PM<br><strong>UnmergedRevision</strong>: [e878ddea7432f524d5ef1afe008d47b9640f7701](https://github.com/hyperledger-gerrit-archive/fabric/commit/e878ddea7432f524d5ef1afe008d47b9640f7701)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/26/2017, 4:38:17 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 9</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 1/26/2017, 4:44:42 PM<br><strong>UnmergedRevision</strong>: [2148ee3592ee1a36946a51c8a873fa9bdbd41eb8](https://github.com/hyperledger-gerrit-archive/fabric/commit/2148ee3592ee1a36946a51c8a873fa9bdbd41eb8)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/26/2017, 4:50:41 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 10</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 1/26/2017, 5:23:43 PM<br><strong>UnmergedRevision</strong>: [ae26c04cc322bcebc05e9cc10fcfc9aa5bbde4cf](https://github.com/hyperledger-gerrit-archive/fabric/commit/ae26c04cc322bcebc05e9cc10fcfc9aa5bbde4cf)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/26/2017, 5:41:22 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 11</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 1/26/2017, 6:27:46 PM<br><strong>UnmergedRevision</strong>: [f0fc429a2c02990fcb394cecdac3ecf312c0a59d](https://github.com/hyperledger-gerrit-archive/fabric/commit/f0fc429a2c02990fcb394cecdac3ecf312c0a59d)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/26/2017, 7:11:45 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 12</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 1/26/2017, 7:04:54 PM<br><strong>UnmergedRevision</strong>: [1667888cdd15bbf4dc47cfd0387fe981f788d12e](https://github.com/hyperledger-gerrit-archive/fabric/commit/1667888cdd15bbf4dc47cfd0387fe981f788d12e)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/26/2017, 7:38:19 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 13</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 1/26/2017, 7:33:02 PM<br><strong>UnmergedRevision</strong>: [32eb4f3bd44cb58cfb3b2e9bb582c6fb779aa2ca](https://github.com/hyperledger-gerrit-archive/fabric/commit/32eb4f3bd44cb58cfb3b2e9bb582c6fb779aa2ca)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/26/2017, 8:22:24 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/peer/peer.go#L248](https://github.com/hyperledger-gerrit-archive/fabric/blob/32eb4f3bd44cb58cfb3b2e9bb582c6fb779aa2ca/core/peer/peer.go#L248)<br><strong>Comment</strong>: <pre>I realize you are just following a pattern here (and I don't spend as much time reviewing peer code) but this seems like the wrong approach to me.

Why are we passing around a chainID through all the flows, rather than the actual *chain (or some interface around it)?  This pattern causes us to essentially do the same map lookup every time the code needs to reference a chain, and further, since code is referencing a global singleton directly, it seems like this must be painful to mock.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/peer/peer.go#L248](https://github.com/hyperledger-gerrit-archive/fabric/blob/32eb4f3bd44cb58cfb3b2e9bb582c6fb779aa2ca/core/peer/peer.go#L248)<br><strong>Comment</strong>: <pre>Thanks, Jason, I agree with you - we should pass down the chain reference itself rather than its lookup key. I'll change the code accordingly.</pre></blockquote><h3>PatchSet Number: 14</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 1/28/2017, 3:59:06 AM<br><strong>UnmergedRevision</strong>: [7ccc498dda8d9c5d0f2a81b5b54e7550ff2662b1](https://github.com/hyperledger-gerrit-archive/fabric/commit/7ccc498dda8d9c5d0f2a81b5b54e7550ff2662b1)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/28/2017, 9:32:53 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 15</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 1/28/2017, 9:39:39 AM<br><strong>UnmergedRevision</strong>: [ba84831ef720be77538bb6f65ebd9998e4ffa966](https://github.com/hyperledger-gerrit-archive/fabric/commit/ba84831ef720be77538bb6f65ebd9998e4ffa966)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/28/2017, 10:33:49 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Approved</strong>: 1/28/2017, 12:58:53 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/ccproviderimpl.go#L94](https://github.com/hyperledger-gerrit-archive/fabric/blob/ba84831ef720be77538bb6f65ebd9998e4ffa966/core/chaincode/ccproviderimpl.go#L94)<br><strong>Comment</strong>: <pre>maps access is non-deterministic. A better name would be "getArbitraryPolicy"... are we taking an unwarranted short cut here ? ie, is there a default policy "mspid" we should know about so we can do msps[defaultPolicyMspID] ?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/ccproviderimpl.go#L94](https://github.com/hyperledger-gerrit-archive/fabric/blob/ba84831ef720be77538bb6f65ebd9998e4ffa966/core/chaincode/ccproviderimpl.go#L94)<br><strong>Comment</strong>: <pre>Good point, I think we need to take a step back and design this a little bit better. Where should we store the LCCC policy? How should the chain creator specify that?</pre><strong>Commenter</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/ccproviderimpl.go#L104](https://github.com/hyperledger-gerrit-archive/fabric/blob/ba84831ef720be77538bb6f65ebd9998e4ffa966/core/chaincode/ccproviderimpl.go#L104)<br><strong>Comment</strong>: <pre>As p can never be nil, this is ok (just for others looking at it).</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/ccproviderimpl.go#L104](https://github.com/hyperledger-gerrit-archive/fabric/blob/ba84831ef720be77538bb6f65ebd9998e4ffa966/core/chaincode/ccproviderimpl.go#L104)<br><strong>Comment</strong>: <pre>thx</pre><strong>Commenter</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/ccproviderimpl.go#L118](https://github.com/hyperledger-gerrit-archive/fabric/blob/ba84831ef720be77538bb6f65ebd9998e4ffa966/core/chaincode/ccproviderimpl.go#L118)<br><strong>Comment</strong>: <pre>policy for lccc access should be the "lifecycle" policy associated with the channel (provided at channel creation time) correct ? 

This may not be there today but if/when it is, we could get rid of "getDefaultPolicy" correct (and nicely accounts for the "grab the first policy from the MSPs" in there) ? 

Or if the above understanding is incorrect please do correct, Ale.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/ccproviderimpl.go#L118](https://github.com/hyperledger-gerrit-archive/fabric/blob/ba84831ef720be77538bb6f65ebd9998e4ffa966/core/chaincode/ccproviderimpl.go#L118)<br><strong>Comment</strong>: <pre>That's absolutely correct - thx for catching that. I think I agree with you, let's wait till the lifecycle policy associated with the channel is ready so that we can provide the right implementation of getDefaultPolicy - which as a matter of fact should be renamed to getLifecyclePolicy.</pre><strong>Commenter</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>CommentLine</strong>: [core/common/support/support.go#L26](https://github.com/hyperledger-gerrit-archive/fabric/blob/ba84831ef720be77538bb6f65ebd9998e4ffa966/core/common/support/support.go#L26)<br><strong>Comment</strong>: <pre>The name "Support" is very general. this can be  "VSCCSupport" or "VSCCProvider" ?   Another supporting point is it is in the same level as "ccprovider" directory. So "vsccprovider" ?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/common/support/support.go#L26](https://github.com/hyperledger-gerrit-archive/fabric/blob/ba84831ef720be77538bb6f65ebd9998e4ffa966/core/common/support/support.go#L26)<br><strong>Comment</strong>: <pre>Ah yes, let me get with Jason (who was the original author of this interface to figure out a proper name.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/common/support/support.go#L26](https://github.com/hyperledger-gerrit-archive/fabric/blob/ba84831ef720be77538bb6f65ebd9998e4ffa966/core/common/support/support.go#L26)<br><strong>Comment</strong>: <pre>When this interface was originally created, it was defined in core/committer/txvalidator/validator.go so that it read naturally in the golang way as txvalidtor.Support.  Which I think is fairly descriptive.

My opinion, is that we should _not_ be pushing this interface into a centralized position.  Instead, each consumer of the *chain object should define the subset of functionality which they require, via a local Support interface.  In this way, if the ChainCodeProvider needs channel information, it could add its own Support (or say, ChannelSupport if that is too generic) interface to its package.  Because it does not need to import anything, there is no import cycle, and go will do its static duck typing and make everything okay.</pre><strong>Commenter</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>CommentLine</strong>: [core/common/sysccprovider/sysccprovider.go#L24](https://github.com/hyperledger-gerrit-archive/fabric/blob/ba84831ef720be77538bb6f65ebd9998e4ffa966/core/common/sysccprovider/sysccprovider.go#L24)<br><strong>Comment</strong>: <pre>This is good stuff and will help will help with other future work to hang more syscc "provider" functions.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/common/sysccprovider/sysccprovider.go#L24](https://github.com/hyperledger-gerrit-archive/fabric/blob/ba84831ef720be77538bb6f65ebd9998e4ffa966/core/common/sysccprovider/sysccprovider.go#L24)<br><strong>Comment</strong>: <pre>thx!</pre><strong>Commenter</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>CommentLine</strong>: [core/scc/lccc/lccc.go#L79](https://github.com/hyperledger-gerrit-archive/fabric/blob/ba84831ef720be77538bb6f65ebd9998e4ffa966/core/scc/lccc/lccc.go#L79)<br><strong>Comment</strong>: <pre>Thanks again!</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/scc/lccc/lccc.go#L79](https://github.com/hyperledger-gerrit-archive/fabric/blob/ba84831ef720be77538bb6f65ebd9998e4ffa966/core/scc/lccc/lccc.go#L79)<br><strong>Comment</strong>: <pre>gotta love those import cycles :)</pre></blockquote><h3>PatchSet Number: 16</h3><blockquote><strong>Type</strong>: NO_CODE_CHANGE<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 1/28/2017, 1:00:25 PM<br><strong>UnmergedRevision</strong>: [2363efd886459c6f8dc0d4f26e230a726c62b6bd](https://github.com/hyperledger-gerrit-archive/fabric/commit/2363efd886459c6f8dc0d4f26e230a726c62b6bd)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/28/2017, 2:04:21 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Approved</strong>: 1/28/2017, 1:01:04 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 17</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 1/30/2017, 4:35:39 AM<br><strong>UnmergedRevision</strong>: [8ba6c5ae0b87308a681494d567c947a7e7a1db7b](https://github.com/hyperledger-gerrit-archive/fabric/commit/8ba6c5ae0b87308a681494d567c947a7e7a1db7b)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/30/2017, 5:42:47 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 18</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 1/30/2017, 5:52:26 AM<br><strong>GitHubMergedRevision</strong>: [b7fd9392c8c7168e86e4f5a75341c3e544b6ac12](https://github.com/hyperledger-gerrit-archive/fabric/commit/b7fd9392c8c7168e86e4f5a75341c3e544b6ac12)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/30/2017, 7:06:20 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>Approved</strong>: 1/31/2017, 10:13:27 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Binh Nguyen<br><strong>Merged</strong>: 1/31/2017, 10:14:09 PM<br><br><strong>Approver</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Approved</strong>: 1/31/2017, 10:13:18 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>Approved</strong>: 1/30/2017, 3:19:25 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Elli Androulaki - lli@zurich.ibm.com<br><strong>Approved</strong>: 1/30/2017, 8:52:48 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/peer/peer.go#L261](https://github.com/hyperledger-gerrit-archive/fabric/blob/b7fd9392c8c7168e86e4f5a75341c3e544b6ac12/core/peer/peer.go#L261)<br><strong>Comment</strong>: <pre>This is better than going to mspmgmt, but I'm still skeptical of this approach and would rather see the Support passed as a parameter rather than constantly looked up in a map.

I'm okay with this being merged as is, but this pattern of referencing the peer singleton is something that seems like it should be removed, rather than perpetuated.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/peer/peer.go#L261](https://github.com/hyperledger-gerrit-archive/fabric/blob/b7fd9392c8c7168e86e4f5a75341c3e544b6ac12/core/peer/peer.go#L261)<br><strong>Comment</strong>: <pre>Whoops! That's dead code now.. let me remove it! (that's what I meant when I said that the approach recommended by Murali made the point moot, we don't need to lookup the manager any longer). And, just to reiterate, I completely agree with your point that we should pass down a support interface instead of reaching out for the peer to fetch stuff. If the need arises in the future again to do that kind of lookup, I'll do it the way you recommend</pre><strong>Commenter</strong>: Elli Androulaki - lli@zurich.ibm.com<br><strong>CommentLine</strong>: [core/scc/lccc/lccc.go#L291](https://github.com/hyperledger-gerrit-archive/fabric/blob/b7fd9392c8c7168e86e4f5a75341c3e544b6ac12/core/scc/lccc/lccc.go#L291)<br><strong>Comment</strong>: <pre>Wondering if this method should have some version number in here to resolve cases where e.g., there are concurrent upgrades of the same chaincode from different admins (?)</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/scc/lccc/lccc.go#L291](https://github.com/hyperledger-gerrit-archive/fabric/blob/b7fd9392c8c7168e86e4f5a75341c3e544b6ac12/core/scc/lccc/lccc.go#L291)<br><strong>Comment</strong>: <pre>I think this is dealt with below

v, err := strconv.ParseInt(cd.Version, 10, 32)
newVersion := fmt.Sprintf("%d", (v + 1))
newCD, err := lccc.upgradeChaincode(stub, chainName, chaincodeName, newVersion, code, policy, escc, vscc)</pre><strong>Commenter</strong>: Elli Androulaki - lli@zurich.ibm.com<br><strong>CommentLine</strong>: [core/scc/lccc/lccc.go#L291](https://github.com/hyperledger-gerrit-archive/fabric/blob/b7fd9392c8c7168e86e4f5a75341c3e544b6ac12/core/scc/lccc/lccc.go#L291)<br><strong>Comment</strong>: <pre>Right, but if you have two upgrade proposals coming in almost at the same  time, you would apply the actual upgrade twice. There is no (application/lccc  level) replay detection as far as I understand.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/scc/lccc/lccc.go#L291](https://github.com/hyperledger-gerrit-archive/fabric/blob/b7fd9392c8c7168e86e4f5a75341c3e544b6ac12/core/scc/lccc/lccc.go#L291)<br><strong>Comment</strong>: <pre>Maybe I'm mistaken but wouldn't MVCC checks detect that kind of replay? If I follow the code, this function calls upgradeChaincode which calls putchaincodedata which does a shim key/value put, overwriting the existing key name. So if the same upgrade came twice, MVCC checks would invalidate one of the two.</pre><strong>Commenter</strong>: Elli Androulaki - lli@zurich.ibm.com<br><strong>CommentLine</strong>: [core/scc/lccc/lccc.go#L291](https://github.com/hyperledger-gerrit-archive/fabric/blob/b7fd9392c8c7168e86e4f5a75341c3e544b6ac12/core/scc/lccc/lccc.go#L291)<br><strong>Comment</strong>: <pre>So there could be a chance that MVCC would not check it cause the concurrency is only perceived at the application level, and not the fabric. So we would end up performing twice the same upgrade in some sense. I can open a jira item for that since i recognize this is not related to this CR :)</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/scc/lccc/lccc.go#L291](https://github.com/hyperledger-gerrit-archive/fabric/blob/b7fd9392c8c7168e86e4f5a75341c3e544b6ac12/core/scc/lccc/lccc.go#L291)<br><strong>Comment</strong>: <pre>Oh yes, I get it now: what you are saying is that while MVCC checks would indeed prevent 2 concurrent upgrades to go through, the two would both be accepted if they are not concurrent. Which may lead to this chaincode's version increasing twice when logically only a single modification was applied.

Understood and agreed, let's take this in a subsequent CR. Thx!

Done</pre><strong>Commenter</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>CommentLine</strong>: [core/scc/lccc/lccc.go#L291](https://github.com/hyperledger-gerrit-archive/fabric/blob/b7fd9392c8c7168e86e4f5a75341c3e544b6ac12/core/scc/lccc/lccc.go#L291)<br><strong>Comment</strong>: <pre>I don't think this can happen. When a block is processed, upgrade tx's will be processed first. In addition to invalidating other TXs belonging to a chaincode, we can enforce "only one upgrdrade per chaincode" rule.</pre><strong>Commenter</strong>: Elli Androulaki - lli@zurich.ibm.com<br><strong>CommentLine</strong>: [core/scc/lccc/lccc.go#L291](https://github.com/hyperledger-gerrit-archive/fabric/blob/b7fd9392c8c7168e86e4f5a75341c3e544b6ac12/core/scc/lccc/lccc.go#L291)<br><strong>Comment</strong>: <pre>Hm, you mean enforce it at the application side? That is, assuming that you have three members that can issue an valid chaincode upgrade proposal/tx for the same chaincode upgrade version, we assume there is a coordination among them to have only one upgrade taking place eventually?</pre><strong>Commenter</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>CommentLine</strong>: [core/scc/lccc/lccc.go#L291](https://github.com/hyperledger-gerrit-archive/fabric/blob/b7fd9392c8c7168e86e4f5a75341c3e544b6ac12/core/scc/lccc/lccc.go#L291)<br><strong>Comment</strong>: <pre>I meant on the committer side Elli. When a block is prcessed on the committer, we will be treating upgrades first. There is the opportunity for weeding out other transactions related to the chaincode. (for example, mark them as invalid).</pre><strong>Commenter</strong>: Elli Androulaki - lli@zurich.ibm.com<br><strong>CommentLine</strong>: [core/scc/lccc/lccc.go#L385](https://github.com/hyperledger-gerrit-archive/fabric/blob/b7fd9392c8c7168e86e4f5a75341c3e544b6ac12/core/scc/lccc/lccc.go#L385)<br><strong>Comment</strong>: <pre>Maybe admin would make more sense for the default policy(?)</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/scc/lccc/lccc.go#L385](https://github.com/hyperledger-gerrit-archive/fabric/blob/b7fd9392c8c7168e86e4f5a75341c3e544b6ac12/core/scc/lccc/lccc.go#L385)<br><strong>Comment</strong>: <pre>I think the case this else was dealing with is slightly different: we are addressing the situation of what to do if the deployer has not provided any policy. We can't fail, because it would break compatibility with all existing SDKs (other than the golang ref implementation). So we need to pick some policy. I thought the safest approach for now was to pick the policy that we need one signature from an MSP that we are certain to have. If we were to request a signature from an admin, I believe it would break stuff (since we don't handle admins yet). Does this make sense?</pre><strong>Commenter</strong>: Elli Androulaki - lli@zurich.ibm.com<br><strong>CommentLine</strong>: [core/scc/lccc/lccc.go#L385](https://github.com/hyperledger-gerrit-archive/fabric/blob/b7fd9392c8c7168e86e4f5a75341c3e544b6ac12/core/scc/lccc/lccc.go#L385)<br><strong>Comment</strong>: <pre>Ok, you are saying that MSP admin is not yet in, and for this the change is fine with me for now. 

I was suggesting to use sort of the local or chain MSP-admin principal instead of an MSP member as the default policy, as it makes sense that we at least default to an MSP admin for chaincode upgrade/deployment than a plain mSP member. But a TODO cpmment at this phase would work.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/scc/lccc/lccc.go#L385](https://github.com/hyperledger-gerrit-archive/fabric/blob/b7fd9392c8c7168e86e4f5a75341c3e544b6ac12/core/scc/lccc/lccc.go#L385)<br><strong>Comment</strong>: <pre>Chaincode upgrade/deployment would not follow this code path - the policy we are specifying here would only be applicable to "normal" chaincodes and not system chaincodes (such as LCCC). That's why I didn't think Admins were appropriate from this perspective.</pre><strong>Commenter</strong>: Elli Androulaki - lli@zurich.ibm.com<br><strong>CommentLine</strong>: [core/scc/lccc/lccc.go#L385](https://github.com/hyperledger-gerrit-archive/fabric/blob/b7fd9392c8c7168e86e4f5a75341c3e544b6ac12/core/scc/lccc/lccc.go#L385)<br><strong>Comment</strong>: <pre>Ah no i got this, apologies. You are saying that this is the default endorsement policy for application chaincodes. My bad. Ok, we may want to add a jira to see what default endorsement policy would make more sense. Perhaps this can be included in the chain genesis block. Can open a jira for that too:)</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/scc/lccc/lccc.go#L385](https://github.com/hyperledger-gerrit-archive/fabric/blob/b7fd9392c8c7168e86e4f5a75341c3e544b6ac12/core/scc/lccc/lccc.go#L385)<br><strong>Comment</strong>: <pre>:) thx! Done</pre></blockquote>