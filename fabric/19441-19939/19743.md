<strong>Project</strong>: fabric<br><strong>Branch</strong>: master<br><strong>ID</strong>: 19743<br><strong>Subject</strong>: [WIP] [FAB-9867] Add BDD test for Raft-based orderer<br><strong>Status</strong>: ABANDONED<br><strong>Owner</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 3/25/2018, 4:10:46 PM<br><strong>LastUpdated</strong>: 8/7/2018, 6:59:04 PM<br><strong>CommitMessage</strong>:<br><pre>[WIP] [FAB-9867] Add BDD test for Raft-based orderer

This changeset introduces:

1. A cluster runner construct for ordering service BDD tests
2. A simple replication BDD test for the Raft-based ordering service,
along with the associated test fixtures
3. The bare minimum Raft-OS code necessary to get the code to compile.
4. Imports the ifrit library

It can be simplified further  when the following JIRA items are
completed:

- FAB-9010
- FAB-9057
- FAB-9165
- FAB-9449

Note for reviewers: start with `suite_test.go`, then move on to
`basic_test.go`.

This is a WIP. Feel free to submit feedback or patchsets so as to
improve it.

Change-Id: I167c48388d0ba6917d448dbf92f223166a229797
Signed-off-by: Kostas Christidis <kostas@christidis.io>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 3/25/2018, 4:10:46 PM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 3/25/2018, 4:14:39 PM<br><strong>Message</strong>: <pre>Uploaded patch set 2: Commit message was updated.</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 3/25/2018, 4:21:07 PM<br><strong>Message</strong>: <pre>Uploaded patch set 3: Patch Set 2 was rebased.</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 3/25/2018, 4:21:39 PM<br><strong>Message</strong>: <pre>Patch Set 3: Code-Review-2

-2 to prevent accidental merging.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/25/2018, 4:23:19 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/13424/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/25/2018, 4:24:01 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/21840/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/25/2018, 4:40:15 PM<br><strong>Message</strong>: <pre>Patch Set 3: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/21840/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/21840/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/21840

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/13424/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/13424</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 3/25/2018, 5:43:29 PM<br><strong>Message</strong>: <pre>Patch Set 3:

reverify-x</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/25/2018, 5:46:04 PM<br><strong>Message</strong>: <pre>Patch Set 3: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/21844/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/25/2018, 6:02:44 PM<br><strong>Message</strong>: <pre>Patch Set 3: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/21844/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/21844</pre><strong>Reviewer</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Reviewed</strong>: 3/26/2018, 8:27:22 AM<br><strong>Message</strong>: <pre>Patch Set 3:

(16 comments)

Making progress but there are definitely some opportunities to simplify things and there are a few bugs that will bite us if the suite is ever started in parallel mode.</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 3/26/2018, 11:23:44 AM<br><strong>Message</strong>: <pre>Uploaded patch set 4.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/26/2018, 11:25:45 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/13430/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/26/2018, 11:26:38 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/21851/ (2/2)</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 3/26/2018, 11:30:40 AM<br><strong>Message</strong>: <pre>Patch Set 4:

(15 comments)

Thanks for the feedback. Keep it coming.</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 3/26/2018, 11:50:10 AM<br><strong>Message</strong>: <pre>Uploaded patch set 5: Patch Set 4 was rebased.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/26/2018, 11:50:52 AM<br><strong>Message</strong>: <pre>Patch Set 4: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/13430/ : ABORTED

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/13430/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/13430

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/21851/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/21851</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/26/2018, 11:52:44 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/13433/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/26/2018, 11:53:10 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/21854/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/26/2018, 12:11:04 PM<br><strong>Message</strong>: <pre>Patch Set 5: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/21854/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/21854/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/21854

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/13433/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/13433</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 3/26/2018, 4:11:16 PM<br><strong>Message</strong>: <pre>Patch Set 5:

(1 comment)</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 3/26/2018, 4:11:29 PM<br><strong>Message</strong>: <pre>Patch Set 5:

reverify-x</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/26/2018, 4:13:53 PM<br><strong>Message</strong>: <pre>Patch Set 5: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/21862/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/26/2018, 4:32:41 PM<br><strong>Message</strong>: <pre>Patch Set 5: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/21862/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/21862</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 4/11/2018, 3:42:37 PM<br><strong>Message</strong>: <pre>Uploaded patch set 6.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/11/2018, 3:42:45 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/356/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/11/2018, 3:43:15 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/11/2018, 3:43:17 PM<br><strong>Message</strong>: <pre>Patch Set 6:

WIP - No Build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/11/2018, 3:43:48 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/356/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/356</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 4/12/2018, 2:26:22 PM<br><strong>Message</strong>: <pre>Uploaded patch set 7.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/12/2018, 2:28:42 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/386/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/12/2018, 2:29:41 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/12/2018, 2:29:43 PM<br><strong>Message</strong>: <pre>Patch Set 7:

WIP - No Build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/12/2018, 2:30:13 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/386/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/386</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 4/12/2018, 2:43:25 PM<br><strong>Message</strong>: <pre>Uploaded patch set 8: Commit message was updated.</pre><strong>Reviewer</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Reviewed</strong>: 4/13/2018, 9:24:09 AM<br><strong>Message</strong>: <pre>Patch Set 8:

(11 comments)</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 4/14/2018, 12:47:28 AM<br><strong>Message</strong>: <pre>Uploaded patch set 9.</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 4/14/2018, 12:49:30 AM<br><strong>Message</strong>: <pre>Patch Set 9:

(11 comments)

Thanks for the feedback. See latest revision and inline comments for some outstanding items.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/14/2018, 12:50:22 AM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/428/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/14/2018, 12:50:53 AM<br><strong>Message</strong>: <pre>Patch Set 9:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/14/2018, 12:50:54 AM<br><strong>Message</strong>: <pre>Patch Set 9:

WIP - No Build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/14/2018, 12:51:42 AM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/428/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/428</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 4/23/2018, 7:42:33 PM<br><strong>Message</strong>: <pre>Uploaded patch set 10.</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 4/23/2018, 7:42:37 PM<br><strong>Message</strong>: <pre>Removed Code-Review-2 by Kostas Christidis <kostas@gmail.com>
</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/23/2018, 7:44:01 PM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/704/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/23/2018, 7:44:27 PM<br><strong>Message</strong>: <pre>Patch Set 10:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/23/2018, 7:44:29 PM<br><strong>Message</strong>: <pre>Patch Set 10:

WIP - No Build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/23/2018, 7:45:03 PM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/704/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/704</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 4/23/2018, 7:46:29 PM<br><strong>Message</strong>: <pre>Patch Set 10:

(2 comments)

Rebased to pick up the latest configuration changes.</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 4/23/2018, 7:47:44 PM<br><strong>Message</strong>: <pre>Uploaded patch set 11.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/23/2018, 7:49:45 PM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/705/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/23/2018, 7:50:06 PM<br><strong>Message</strong>: <pre>Patch Set 11:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/23/2018, 7:50:07 PM<br><strong>Message</strong>: <pre>Patch Set 11:

WIP - No Build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/23/2018, 7:50:35 PM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/705/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/705</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 4/24/2018, 10:54:18 AM<br><strong>Message</strong>: <pre>Uploaded patch set 12.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/24/2018, 10:54:28 AM<br><strong>Message</strong>: <pre>Patch Set 12:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/744/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/24/2018, 10:54:52 AM<br><strong>Message</strong>: <pre>Patch Set 12:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/24/2018, 10:54:54 AM<br><strong>Message</strong>: <pre>Patch Set 12:

WIP - No Build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/24/2018, 10:55:40 AM<br><strong>Message</strong>: <pre>Patch Set 12:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/744/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/744</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 4/25/2018, 7:39:26 AM<br><strong>Message</strong>: <pre>Uploaded patch set 13.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/25/2018, 7:42:27 AM<br><strong>Message</strong>: <pre>Patch Set 13:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/785/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/25/2018, 7:42:53 AM<br><strong>Message</strong>: <pre>Patch Set 13:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/25/2018, 7:42:54 AM<br><strong>Message</strong>: <pre>Patch Set 13:

WIP - No Build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/25/2018, 7:43:24 AM<br><strong>Message</strong>: <pre>Patch Set 13:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/785/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/785</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 4/26/2018, 2:49:13 PM<br><strong>Message</strong>: <pre>Uploaded patch set 14.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/26/2018, 2:52:04 PM<br><strong>Message</strong>: <pre>Patch Set 14:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/844/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/26/2018, 2:52:26 PM<br><strong>Message</strong>: <pre>Patch Set 14:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/26/2018, 2:52:27 PM<br><strong>Message</strong>: <pre>Patch Set 14:

WIP - No Build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/26/2018, 2:53:00 PM<br><strong>Message</strong>: <pre>Patch Set 14:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/844/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/844</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 5/7/2018, 4:50:16 PM<br><strong>Message</strong>: <pre>Uploaded patch set 15.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/7/2018, 4:52:28 PM<br><strong>Message</strong>: <pre>Patch Set 15:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/1408/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/7/2018, 4:52:44 PM<br><strong>Message</strong>: <pre>Patch Set 15:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/7/2018, 4:52:46 PM<br><strong>Message</strong>: <pre>Patch Set 15:

WIP - No Build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/7/2018, 4:53:20 PM<br><strong>Message</strong>: <pre>Patch Set 15:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/1408/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/1408</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 5/7/2018, 6:11:06 PM<br><strong>Message</strong>: <pre>Uploaded patch set 16.</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 5/7/2018, 6:11:24 PM<br><strong>Message</strong>: <pre>Removed reviewer Matthew Sykes.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/7/2018, 6:13:08 PM<br><strong>Message</strong>: <pre>Patch Set 16:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/1409/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/7/2018, 6:13:33 PM<br><strong>Message</strong>: <pre>Patch Set 16:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/7/2018, 6:13:35 PM<br><strong>Message</strong>: <pre>Patch Set 16:

WIP - No Build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/7/2018, 6:14:14 PM<br><strong>Message</strong>: <pre>Patch Set 16:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/1409/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/1409</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 5/8/2018, 11:45:53 AM<br><strong>Message</strong>: <pre>Uploaded patch set 17: Patch Set 16 was rebased.</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 8/7/2018, 6:59:04 PM<br><strong>Message</strong>: <pre>Abandoned</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Uploader</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Created</strong>: 3/25/2018, 4:10:46 PM<br><strong>UnmergedRevision</strong>: [69aba49261ac42561ec2f02c3c7f5214340dc31a](https://github.com/hyperledger-gerrit-archive/fabric/commit/69aba49261ac42561ec2f02c3c7f5214340dc31a)<br><br></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: NO_CODE_CHANGE<br><strong>Author</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Uploader</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Created</strong>: 3/25/2018, 4:14:39 PM<br><strong>UnmergedRevision</strong>: [2470ab9aecfda88c2276496d14bff65ad5cbd04a](https://github.com/hyperledger-gerrit-archive/fabric/commit/2470ab9aecfda88c2276496d14bff65ad5cbd04a)<br><br></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Uploader</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Created</strong>: 3/25/2018, 4:21:07 PM<br><strong>UnmergedRevision</strong>: [be8125205687d7c08568ccb9526ae9e2d48492d8](https://github.com/hyperledger-gerrit-archive/fabric/commit/be8125205687d7c08568ccb9526ae9e2d48492d8)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 3/25/2018, 6:02:44 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Approved</strong>: 3/25/2018, 4:21:39 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [common/tools/configtxgen/encoder/encoder.go#L45](https://github.com/hyperledger-gerrit-archive/fabric/blob/be8125205687d7c08568ccb9526ae9e2d48492d8/common/tools/configtxgen/encoder/encoder.go#L45)<br><strong>Comment</strong>: <pre>This is essentially an enum pattern. Might be good to open a task to make this a proper type instead of leaving it as a string.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [common/tools/configtxgen/encoder/encoder.go#L45](https://github.com/hyperledger-gerrit-archive/fabric/blob/be8125205687d7c08568ccb9526ae9e2d48492d8/common/tools/configtxgen/encoder/encoder.go#L45)<br><strong>Comment</strong>: <pre>Done. See: https://jira.hyperledger.org/browse/FAB-9165</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [integration/orderer/raft/basic_test.go#L20](https://github.com/hyperledger-gerrit-archive/fabric/blob/be8125205687d7c08568ccb9526ae9e2d48492d8/integration/orderer/raft/basic_test.go#L20)<br><strong>Comment</strong>: <pre>If this is separate because we're looking at a test dependency (instead of an import of production code), might be good to group it with other dependencies like ginkgo and gomega.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [integration/orderer/raft/basic_test.go#L41](https://github.com/hyperledger-gerrit-archive/fabric/blob/be8125205687d7c08568ccb9526ae9e2d48492d8/integration/orderer/raft/basic_test.go#L41)<br><strong>Comment</strong>: <pre>Since these variables are defined in the top-level of the context, they're probably going to be used a fair bit. Unlike names used inside small functions, I think these would benefit from names that are easier to understand. I'm assuming 'bc' is "broadcast" and I have no idea what 'dlv' means.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [integration/orderer/raft/basic_test.go#L41](https://github.com/hyperledger-gerrit-archive/fabric/blob/be8125205687d7c08568ccb9526ae9e2d48492d8/integration/orderer/raft/basic_test.go#L41)<br><strong>Comment</strong>: <pre>"dlv" stands for deliver. I'm with you on having names that are easier to understand, but perhaps I'm too involved in this codebase to be objective. Open to suggestions.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [integration/orderer/raft/basic_test.go#L48](https://github.com/hyperledger-gerrit-archive/fabric/blob/be8125205687d7c08568ccb9526ae9e2d48492d8/integration/orderer/raft/basic_test.go#L48)<br><strong>Comment</strong>: <pre>This line is not easily parsed by a human when doing a diff. While unnecessary, it would be helpful to see the paths setup before `LoadLocalMsp`</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [integration/orderer/raft/basic_test.go#L48](https://github.com/hyperledger-gerrit-archive/fabric/blob/be8125205687d7c08568ccb9526ae9e2d48492d8/integration/orderer/raft/basic_test.go#L48)<br><strong>Comment</strong>: <pre>Done.

Let me know if this one's better. If not, I will revise further.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [integration/orderer/raft/basic_test.go#L58](https://github.com/hyperledger-gerrit-archive/fabric/blob/be8125205687d7c08568ccb9526ae9e2d48492d8/integration/orderer/raft/basic_test.go#L58)<br><strong>Comment</strong>: <pre>Same basic comment. Hard to parse. Much easier on humans if broken apart.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [integration/orderer/raft/basic_test.go#L58](https://github.com/hyperledger-gerrit-archive/fabric/blob/be8125205687d7c08568ccb9526ae9e2d48492d8/integration/orderer/raft/basic_test.go#L58)<br><strong>Comment</strong>: <pre>You're right. Done, and see comment on line 48.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [integration/orderer/raft/basic_test.go#L67](https://github.com/hyperledger-gerrit-archive/fabric/blob/be8125205687d7c08568ccb9526ae9e2d48492d8/integration/orderer/raft/basic_test.go#L67)<br><strong>Comment</strong>: <pre>and here. Create the message before the call to newEnv so it's highlighted and not buried.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [integration/orderer/raft/basic_test.go#L67](https://github.com/hyperledger-gerrit-archive/fabric/blob/be8125205687d7c08568ccb9526ae9e2d48492d8/integration/orderer/raft/basic_test.go#L67)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [integration/orderer/raft/basic_test.go#L100](https://github.com/hyperledger-gerrit-archive/fabric/blob/be8125205687d7c08568ccb9526ae9e2d48492d8/integration/orderer/raft/basic_test.go#L100)<br><strong>Comment</strong>: <pre>"that transaction" - which transaction?
"the transactions?"
"transactions"?</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [integration/orderer/raft/basic_test.go#L100](https://github.com/hyperledger-gerrit-archive/fabric/blob/be8125205687d7c08568ccb9526ae9e2d48492d8/integration/orderer/raft/basic_test.go#L100)<br><strong>Comment</strong>: <pre>"That transaction" which is brought up in line 37 on the context description.

What am I missing?</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [integration/orderer/raft/basic_test.go#L112](https://github.com/hyperledger-gerrit-archive/fabric/blob/be8125205687d7c08568ccb9526ae9e2d48492d8/integration/orderer/raft/basic_test.go#L112)<br><strong>Comment</strong>: <pre>Why? Do we need additional complexity in the test to drive something out? Are there assertions we need to make?</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [integration/orderer/raft/basic_test.go#L112](https://github.com/hyperledger-gerrit-archive/fabric/blob/be8125205687d7c08568ccb9526ae9e2d48492d8/integration/orderer/raft/basic_test.go#L112)<br><strong>Comment</strong>: <pre>> Do we need additional complexity in the test to drive something out? Are there assertions we need to make?

Not really.

Testing in parallel seemed like a natural fit when I was thinking about this, but I didn't want the overhead of spawning and managing additional goroutines, which is why I left this as a potential TODO.

Removed.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [integration/orderer/raft/basic_test.go#L126](https://github.com/hyperledger-gerrit-archive/fabric/blob/be8125205687d7c08568ccb9526ae9e2d48492d8/integration/orderer/raft/basic_test.go#L126)<br><strong>Comment</strong>: <pre>Why a type switch instead of the assertion form?  With the assertion form, we can simplify:

```
block, ok := resp.Type.(*ab.DeliverResponse_Block)
Expect(ok).To(BeTrue())
Eventually(bChan).Should(BeSent(block.Block))
```</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [integration/orderer/raft/basic_test.go#L126](https://github.com/hyperledger-gerrit-archive/fabric/blob/be8125205687d7c08568ccb9526ae9e2d48492d8/integration/orderer/raft/basic_test.go#L126)<br><strong>Comment</strong>: <pre>Good suggestion, thanks. Fixed.

I'm hesitant on that last line, which just checks that a block is received -- versus the original implementation (lines 136-139) which checks that the *transaction* is received. What do you think?</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [integration/orderer/raft/suite_test.go#L46](https://github.com/hyperledger-gerrit-archive/fabric/blob/be8125205687d7c08568ccb9526ae9e2d48492d8/integration/orderer/raft/suite_test.go#L46)<br><strong>Comment</strong>: <pre>color me confused on this line.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [integration/orderer/raft/suite_test.go#L46](https://github.com/hyperledger-gerrit-archive/fabric/blob/be8125205687d7c08568ccb9526ae9e2d48492d8/integration/orderer/raft/suite_test.go#L46)<br><strong>Comment</strong>: <pre>You and me both. This is the result of an extra paste if I had to guess -- removed.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [integration/orderer/raft/suite_test.go#L49](https://github.com/hyperledger-gerrit-archive/fabric/blob/be8125205687d7c08568ccb9526ae9e2d48492d8/integration/orderer/raft/suite_test.go#L49)<br><strong>Comment</strong>: <pre>Please avoid hard-coded default timeouts in suites without some mechanism to override them.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [integration/orderer/raft/suite_test.go#L49](https://github.com/hyperledger-gerrit-archive/fabric/blob/be8125205687d7c08568ccb9526ae9e2d48492d8/integration/orderer/raft/suite_test.go#L49)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [integration/orderer/raft/suite_test.go#L51](https://github.com/hyperledger-gerrit-archive/fabric/blob/be8125205687d7c08568ccb9526ae9e2d48492d8/integration/orderer/raft/suite_test.go#L51)<br><strong>Comment</strong>: <pre>I don't see how this works. in a synchronized before suite. The package var you're setting will have still have the default (empty string) value in test processes that are spun up across nodes. The idea of the the SynchronizedBeforeSuite is that one-time setup is done and the values that are needed are propagated to the test processes by the byte slice returned from the first func. The second func will receive that slide and should setup the package level vars.

What you have here *may* work with a single process but it will not work if parallel execution is enabled.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [integration/orderer/raft/suite_test.go#L51](https://github.com/hyperledger-gerrit-archive/fabric/blob/be8125205687d7c08568ccb9526ae9e2d48492d8/integration/orderer/raft/suite_test.go#L51)<br><strong>Comment</strong>: <pre>You're right. See new patchset.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [integration/orderer/raft/suite_test.go#L58](https://github.com/hyperledger-gerrit-archive/fabric/blob/be8125205687d7c08568ccb9526ae9e2d48492d8/integration/orderer/raft/suite_test.go#L58)<br><strong>Comment</strong>: <pre>This needs to be in a SynchronizedAfterSuite or this will fall apart when trying to run in parallel.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [integration/orderer/raft/suite_test.go#L58](https://github.com/hyperledger-gerrit-archive/fabric/blob/be8125205687d7c08568ccb9526ae9e2d48492d8/integration/orderer/raft/suite_test.go#L58)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [integration/orderer/raft/suite_test.go#L92](https://github.com/hyperledger-gerrit-archive/fabric/blob/be8125205687d7c08568ccb9526ae9e2d48492d8/integration/orderer/raft/suite_test.go#L92)<br><strong>Comment</strong>: <pre>This block of env vars - unless they're changed by tests, they feel like they belong in the synhronized before suite instead of in the before each.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [integration/orderer/raft/suite_test.go#L92](https://github.com/hyperledger-gerrit-archive/fabric/blob/be8125205687d7c08568ccb9526ae9e2d48492d8/integration/orderer/raft/suite_test.go#L92)<br><strong>Comment</strong>: <pre>So, each spec picks its own temp directory, but this could be pushed back to the synchronized before part of the suite.

However, each spec also picks its own listening ports and then writes the corresponding genesis block (that records the listening ports).</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [integration/orderer/raft/suite_test.go#L112](https://github.com/hyperledger-gerrit-archive/fabric/blob/be8125205687d7c08568ccb9526ae9e2d48492d8/integration/orderer/raft/suite_test.go#L112)<br><strong>Comment</strong>: <pre>I'm interested to see this code...</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [integration/orderer/raft/suite_test.go#L112](https://github.com/hyperledger-gerrit-archive/fabric/blob/be8125205687d7c08568ccb9526ae9e2d48492d8/integration/orderer/raft/suite_test.go#L112)<br><strong>Comment</strong>: <pre>Did you have a look at `intergration/orderer/setup/orderer.go`?</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [integration/orderer/raft/testdata/crypto-config/ordererOrganizations/kate.example.com/ca/16ae1c23bef2f071f00b20ccc407b4bd0bdbad95b207810f92dfbde403f240c8_sk#L1](https://github.com/hyperledger-gerrit-archive/fabric/blob/be8125205687d7c08568ccb9526ae9e2d48492d8/integration/orderer/raft/testdata/crypto-config/ordererOrganizations/kate.example.com/ca/16ae1c23bef2f071f00b20ccc407b4bd0bdbad95b207810f92dfbde403f240c8_sk#L1)<br><strong>Comment</strong>: <pre>Feels like we have too many fixtures in here. Lots of keys and certs and I don't see anything that can update/refresh/repopulate them in the code.

How hard is it to generate these as part of the suite setup by executing cryptogen or whatever else is needed?</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [integration/orderer/raft/testdata/crypto-config/ordererOrganizations/kate.example.com/ca/16ae1c23bef2f071f00b20ccc407b4bd0bdbad95b207810f92dfbde403f240c8_sk#L1](https://github.com/hyperledger-gerrit-archive/fabric/blob/be8125205687d7c08568ccb9526ae9e2d48492d8/integration/orderer/raft/testdata/crypto-config/ordererOrganizations/kate.example.com/ca/16ae1c23bef2f071f00b20ccc407b4bd0bdbad95b207810f92dfbde403f240c8_sk#L1)<br><strong>Comment</strong>: <pre>> I don't see anything that can update/refresh/repopulate them in the code.

Have a look at `integration/orderer/raft/testdata/generate.go` which is a part of this changeset. The idea was that you would generate these fixtures via go generate.

This reminded though me of a comment I wanted to make on `generate.go`; the included generate directive is broken/bad because it has a dependency on the platform (that path would be different for, say, Windows).

So, as you suggested, I've now implemented the compilation and execution of cryptogen a part of the suite setup. Done.</pre></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Uploader</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Created</strong>: 3/26/2018, 11:23:44 AM<br><strong>UnmergedRevision</strong>: [34b0e77a9b921ddc8418ee7d75b6a82bfbd1a4d3](https://github.com/hyperledger-gerrit-archive/fabric/commit/34b0e77a9b921ddc8418ee7d75b6a82bfbd1a4d3)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 3/26/2018, 11:50:52 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Approved</strong>: 3/25/2018, 4:21:39 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 5</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Uploader</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Created</strong>: 3/26/2018, 11:50:10 AM<br><strong>UnmergedRevision</strong>: [74c09b5bea312ef99d63b3aaf8a1c4a36166b6a1](https://github.com/hyperledger-gerrit-archive/fabric/commit/74c09b5bea312ef99d63b3aaf8a1c4a36166b6a1)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 3/26/2018, 4:32:41 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Approved</strong>: 3/25/2018, 4:21:39 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [integration/orderer/raft/basic_test.go#L136](https://github.com/hyperledger-gerrit-archive/fabric/blob/74c09b5bea312ef99d63b3aaf8a1c4a36166b6a1/integration/orderer/raft/basic_test.go#L136)<br><strong>Comment</strong>: <pre>ATTN: Hard-coded constraint here. Wondering whether I should (a) expose this, (b) leave as is, or (c) remove altogether.</pre></blockquote><h3>PatchSet Number: 6</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Uploader</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Created</strong>: 4/11/2018, 3:42:37 PM<br><strong>UnmergedRevision</strong>: [65ffd2ae9b7b6d893820eb6973bb3894bc7116e8](https://github.com/hyperledger-gerrit-archive/fabric/commit/65ffd2ae9b7b6d893820eb6973bb3894bc7116e8)<br><br><strong>Approver</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Approved</strong>: 3/25/2018, 4:21:39 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 7</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Uploader</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Created</strong>: 4/12/2018, 2:26:22 PM<br><strong>UnmergedRevision</strong>: [144e9dd588856248d3114e08d7023fabf76d77d9](https://github.com/hyperledger-gerrit-archive/fabric/commit/144e9dd588856248d3114e08d7023fabf76d77d9)<br><br><strong>Approver</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Approved</strong>: 3/25/2018, 4:21:39 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 8</h3><blockquote><strong>Type</strong>: NO_CODE_CHANGE<br><strong>Author</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Uploader</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Created</strong>: 4/12/2018, 2:43:25 PM<br><strong>UnmergedRevision</strong>: [b37c20f7a2dac33e30c0ac50338407199474641a](https://github.com/hyperledger-gerrit-archive/fabric/commit/b37c20f7a2dac33e30c0ac50338407199474641a)<br><br><strong>Approver</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Approved</strong>: 3/25/2018, 4:21:39 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [integration/orderer/raft/basic_test.go#L22](https://github.com/hyperledger-gerrit-archive/fabric/blob/b37c20f7a2dac33e30c0ac50338407199474641a/integration/orderer/raft/basic_test.go#L22)<br><strong>Comment</strong>: <pre>I don't know what setup is but the references imply we're not dealing with test-scoped instances and that concerns me.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [integration/orderer/raft/basic_test.go#L22](https://github.com/hyperledger-gerrit-archive/fabric/blob/b37c20f7a2dac33e30c0ac50338407199474641a/integration/orderer/raft/basic_test.go#L22)<br><strong>Comment</strong>: <pre>I think I see what you're getting at.

Changes:
1. `integration/setup/*` (which is part of the changeset) has now been modified so as to include all the runner implementation. The thinking is that this _should_ be common across orderer implementations. (The package/folder has been renamed to `runner`.)
2. `genesis.go` has been moved to `integration/orderer/raft` since it contains raft-specific references.

LMK if you think this could be improved further.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [integration/orderer/raft/basic_test.go#L106](https://github.com/hyperledger-gerrit-archive/fabric/blob/b37c20f7a2dac33e30c0ac50338407199474641a/integration/orderer/raft/basic_test.go#L106)<br><strong>Comment</strong>: <pre>If receive can block, consider using an eventually construct to ensure the test doesn't hang when things aren't working.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [integration/orderer/raft/basic_test.go#L106](https://github.com/hyperledger-gerrit-archive/fabric/blob/b37c20f7a2dac33e30c0ac50338407199474641a/integration/orderer/raft/basic_test.go#L106)<br><strong>Comment</strong>: <pre>Indeed. Just doing `Eventually(bClient.Recv()).ShouldNot(BeNil())` however wouldn't allow me to evaluate the response's status. How do you suggest I proceed if I want to do an assertion similar to line 108?

This probably calls for a goroutine that pushes the response to a channel, and the `Eventually` check on the main thread polls that channel. Thoughts? (Also: I should do the same in line 122.)</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [integration/orderer/raft/basic_test.go#L106](https://github.com/hyperledger-gerrit-archive/fabric/blob/b37c20f7a2dac33e30c0ac50338407199474641a/integration/orderer/raft/basic_test.go#L106)<br><strong>Comment</strong>: <pre>Done for all blocking calls in this spec.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [integration/orderer/raft/basic_test.go#L126](https://github.com/hyperledger-gerrit-archive/fabric/blob/b37c20f7a2dac33e30c0ac50338407199474641a/integration/orderer/raft/basic_test.go#L126)<br><strong>Comment</strong>: <pre>Eventually(bChan).Shoul(BeSent(b.Block))</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [integration/orderer/raft/basic_test.go#L126](https://github.com/hyperledger-gerrit-archive/fabric/blob/b37c20f7a2dac33e30c0ac50338407199474641a/integration/orderer/raft/basic_test.go#L126)<br><strong>Comment</strong>: <pre>Keep forgetting to do this, thanks. Done.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [integration/orderer/raft/basic_test.go#L133](https://github.com/hyperledger-gerrit-archive/fabric/blob/b37c20f7a2dac33e30c0ac50338407199474641a/integration/orderer/raft/basic_test.go#L133)<br><strong>Comment</strong>: <pre>100ms is the default polling interval and can be omitted.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [integration/orderer/raft/basic_test.go#L133](https://github.com/hyperledger-gerrit-archive/fabric/blob/b37c20f7a2dac33e30c0ac50338407199474641a/integration/orderer/raft/basic_test.go#L133)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [integration/orderer/raft/suite_test.go#L43](https://github.com/hyperledger-gerrit-archive/fabric/blob/b37c20f7a2dac33e30c0ac50338407199474641a/integration/orderer/raft/suite_test.go#L43)<br><strong>Comment</strong>: <pre>If you want this to apply to all processes, it's in the wrong block.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [integration/orderer/raft/suite_test.go#L43](https://github.com/hyperledger-gerrit-archive/fabric/blob/b37c20f7a2dac33e30c0ac50338407199474641a/integration/orderer/raft/suite_test.go#L43)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [integration/orderer/raft/suite_test.go#L59](https://github.com/hyperledger-gerrit-archive/fabric/blob/b37c20f7a2dac33e30c0ac50338407199474641a/integration/orderer/raft/suite_test.go#L59)<br><strong>Comment</strong>: <pre>Eventually(session).Should(gexec.Exit(0))
Expect(session).To(gbytes.Say(setup.AppOrg0))</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [integration/orderer/raft/suite_test.go#L59](https://github.com/hyperledger-gerrit-archive/fabric/blob/b37c20f7a2dac33e30c0ac50338407199474641a/integration/orderer/raft/suite_test.go#L59)<br><strong>Comment</strong>: <pre>Functionally equivalent if I'm not mistaken, but I can see how your suggestion is clearer.

Thanks, fixed.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [integration/orderer/raft/suite_test.go#L76](https://github.com/hyperledger-gerrit-archive/fabric/blob/b37c20f7a2dac33e30c0ac50338407199474641a/integration/orderer/raft/suite_test.go#L76)<br><strong>Comment</strong>: <pre>Where is this cleaned up?</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [integration/orderer/raft/suite_test.go#L76](https://github.com/hyperledger-gerrit-archive/fabric/blob/b37c20f7a2dac33e30c0ac50338407199474641a/integration/orderer/raft/suite_test.go#L76)<br><strong>Comment</strong>: <pre>In `AfterEach` we invoke the `Stop` method on the cluster runner, which in turn invokes the `removeState` method.

See `setup/orderer.go` for more.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [integration/orderer/raft/suite_test.go#L83](https://github.com/hyperledger-gerrit-archive/fabric/blob/b37c20f7a2dac33e30c0ac50338407199474641a/integration/orderer/raft/suite_test.go#L83)<br><strong>Comment</strong>: <pre>In the grand scheme of things, this rarely works and the non-determinism just makes things harder to reason about. Use a fixed base port and use the ginkgo parallel node as multiplier to determine a port for this process.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [integration/orderer/raft/suite_test.go#L83](https://github.com/hyperledger-gerrit-archive/fabric/blob/b37c20f7a2dac33e30c0ac50338407199474641a/integration/orderer/raft/suite_test.go#L83)<br><strong>Comment</strong>: <pre>Understood. Had a suspicion I was being too clever here. Fixed.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [integration/orderer/raft/testdata/orderer.yml#L6](https://github.com/hyperledger-gerrit-archive/fabric/blob/b37c20f7a2dac33e30c0ac50338407199474641a/integration/orderer/raft/testdata/orderer.yml#L6)<br><strong>Comment</strong>: <pre>Do we really need all of the comments in the fixtures? The meat of the config gets lost.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [integration/orderer/raft/testdata/orderer.yml#L6](https://github.com/hyperledger-gerrit-archive/fabric/blob/b37c20f7a2dac33e30c0ac50338407199474641a/integration/orderer/raft/testdata/orderer.yml#L6)<br><strong>Comment</strong>: <pre>I hear you. Here's what's going on:

This file is  copied over from `sampleconfig` because the orderer binary needs to a YAML file to bootstrap, and I'd rather point it to a file that's part of the test's fixtures.

I choose not to any post-processing on this file and do all of the necessary edits in code by setting the respective ENV vars in `suite_test.go`.

So this comes down to whether I'm catering to the developer writing this (i.e. me) or the user who wants to figure out how things work.

The current approach definitely makes my life easier, but I can see how accessibility takes a hit.

Now that you have some context, LMK what you think. I can change course here, but I want to make sure the motivation and the tradeoffs are clear.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [integration/orderer/setup/genesis.go#L1](https://github.com/hyperledger-gerrit-archive/fabric/blob/b37c20f7a2dac33e30c0ac50338407199474641a/integration/orderer/setup/genesis.go#L1)<br><strong>Comment</strong>: <pre>This entire set of defaults should really be in a struct with accessors - not a collection of package methods and constants.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [integration/orderer/setup/genesis.go#L1](https://github.com/hyperledger-gerrit-archive/fabric/blob/b37c20f7a2dac33e30c0ac50338407199474641a/integration/orderer/setup/genesis.go#L1)<br><strong>Comment</strong>: <pre>RE: Accessors --

Should these defined on the original type (i.e. `*localonfing.Profile`)?
Should these be defined merely as package functions that access the exported variable?
Assuming all of the fields of the struct are exported -- what makes accessors necessary to begin with?

I took a stab at a revision, though I'm fairly certain this won't be the last one.

If you have a pointer to a reference implementation, please send it my way. It is easy for me to change things here to make them right, but I don't have a concrete idea of what is right yet.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [integration/orderer/setup/genesis.go#L1](https://github.com/hyperledger-gerrit-archive/fabric/blob/b37c20f7a2dac33e30c0ac50338407199474641a/integration/orderer/setup/genesis.go#L1)<br><strong>Comment</strong>: <pre>Can't see the reason for accessors if the struct's fields are exported. Removed.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [integration/orderer/setup/orderer.go#L24](https://github.com/hyperledger-gerrit-archive/fabric/blob/b37c20f7a2dac33e30c0ac50338407199474641a/integration/orderer/setup/orderer.go#L24)<br><strong>Comment</strong>: <pre>Unless you're testing this stuff or have a need to document the test code, this is a overkill. These can easily be moved into the start method as details.

You don't have to change anything, but keep in mind that this is for testing where we are writing code and should be able to easily investigate and modify things when needed.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [integration/orderer/setup/orderer.go#L24](https://github.com/hyperledger-gerrit-archive/fabric/blob/b37c20f7a2dac33e30c0ac50338407199474641a/integration/orderer/setup/orderer.go#L24)<br><strong>Comment</strong>: <pre>ACK, point taken. Fixed.</pre></blockquote><h3>PatchSet Number: 9</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Uploader</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Created</strong>: 4/14/2018, 12:47:28 AM<br><strong>UnmergedRevision</strong>: [357b493b3d3e60b04135f671e8e2bed100ae5595](https://github.com/hyperledger-gerrit-archive/fabric/commit/357b493b3d3e60b04135f671e8e2bed100ae5595)<br><br><strong>Approver</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Approved</strong>: 3/25/2018, 4:21:39 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 10</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Uploader</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Created</strong>: 4/23/2018, 7:42:33 PM<br><strong>UnmergedRevision</strong>: [837abe4fa09f465d8f164415a578193d27156e12](https://github.com/hyperledger-gerrit-archive/fabric/commit/837abe4fa09f465d8f164415a578193d27156e12)<br><br></blockquote><h3>PatchSet Number: 11</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Uploader</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Created</strong>: 4/23/2018, 7:47:44 PM<br><strong>UnmergedRevision</strong>: [998f2607090854287b83e0deb198a21aa3fa9c01](https://github.com/hyperledger-gerrit-archive/fabric/commit/998f2607090854287b83e0deb198a21aa3fa9c01)<br><br></blockquote><h3>PatchSet Number: 12</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Uploader</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Created</strong>: 4/24/2018, 10:54:18 AM<br><strong>UnmergedRevision</strong>: [3398f1d969a9f4e48d8f88dc520b7d289c8a3d7b](https://github.com/hyperledger-gerrit-archive/fabric/commit/3398f1d969a9f4e48d8f88dc520b7d289c8a3d7b)<br><br></blockquote><h3>PatchSet Number: 13</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Uploader</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Created</strong>: 4/25/2018, 7:39:26 AM<br><strong>UnmergedRevision</strong>: [e823ae6a25e2613355dfe47306234d1727e9535a](https://github.com/hyperledger-gerrit-archive/fabric/commit/e823ae6a25e2613355dfe47306234d1727e9535a)<br><br></blockquote><h3>PatchSet Number: 14</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Uploader</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Created</strong>: 4/26/2018, 2:49:13 PM<br><strong>UnmergedRevision</strong>: [ff97a8f5dfac958683535d6c6c8905ad23a77c30](https://github.com/hyperledger-gerrit-archive/fabric/commit/ff97a8f5dfac958683535d6c6c8905ad23a77c30)<br><br></blockquote><h3>PatchSet Number: 15</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Uploader</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Created</strong>: 5/7/2018, 4:50:16 PM<br><strong>UnmergedRevision</strong>: [dc7537dfaf1bc3473ee87ba8623264fa4827b465](https://github.com/hyperledger-gerrit-archive/fabric/commit/dc7537dfaf1bc3473ee87ba8623264fa4827b465)<br><br></blockquote><h3>PatchSet Number: 16</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Uploader</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Created</strong>: 5/7/2018, 6:11:06 PM<br><strong>UnmergedRevision</strong>: [0656219c9046be78223c23887c5a0d651825f4d5](https://github.com/hyperledger-gerrit-archive/fabric/commit/0656219c9046be78223c23887c5a0d651825f4d5)<br><br></blockquote><h3>PatchSet Number: 17</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Uploader</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Created</strong>: 5/8/2018, 11:45:53 AM<br><strong>UnmergedRevision</strong>: [41bb67e9ce2d6fd9f75bb7e6d428d0f2fc0967c2](https://github.com/hyperledger-gerrit-archive/fabric/commit/41bb67e9ce2d6fd9f75bb7e6d428d0f2fc0967c2)<br><br></blockquote>