<strong>Project</strong>: fabric<br><strong>Branch</strong>: master<br><strong>ID</strong>: 9711<br><strong>Subject</strong>: [FAB-3326] Implement TTL container gc<br><strong>Status</strong>: ABANDONED<br><strong>Owner</strong>: YAOGUO JIANG - jiangyaoguo@gmail.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 5/23/2017, 12:04:25 PM<br><strong>LastUpdated</strong>: 2/2/2019, 5:18:09 PM<br><strong>CommitMessage</strong>:<br><pre>[FAB-3326] Implement TTL container gc

Add GCManager to stop containers that havn't been
active for given duration.When launch container for
chaincode, add chaincode info to GCManager. And when
execute chaincode, update container active time in
GCManager.

Change-Id: Ia61070a17037b44c8c1c1047212d6339cdfb630a
Signed-off-by: jiangyaoguo <jiangyaoguo@gmail.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: YAOGUO JIANG - jiangyaoguo@gmail.com<br><strong>Reviewed</strong>: 5/23/2017, 12:04:25 PM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/23/2017, 12:04:36 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/7699/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/23/2017, 12:18:30 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/3576/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/23/2017, 12:19:13 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/6106/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/23/2017, 12:19:13 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/12048/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/23/2017, 1:28:54 PM<br><strong>Message</strong>: <pre>Patch Set 1: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-z/7699/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/12048/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/3576/ : SUCCESS

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/6106/ : SUCCESS</pre><strong>Reviewer</strong>: YAOGUO JIANG - jiangyaoguo@gmail.com<br><strong>Reviewed</strong>: 5/25/2017, 4:15:19 AM<br><strong>Message</strong>: <pre>Patch Set 2: Patch Set 1 was rebased</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/25/2017, 4:15:29 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/7824/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/25/2017, 4:17:38 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/3701/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/25/2017, 4:17:41 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/12172/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/25/2017, 4:17:58 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/6228/ (4/4)</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 5/25/2017, 4:30:37 AM<br><strong>Message</strong>: <pre>Patch Set 2: Code-Review-2

This needs review as it's a feature and not a bug.
Added the review-needed label.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/25/2017, 4:50:16 AM<br><strong>Message</strong>: <pre>Patch Set 2: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-z/7824/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/12172/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/3701/ : SUCCESS

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/6228/ : SUCCESS</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 5/25/2017, 7:58:09 AM<br><strong>Message</strong>: <pre>Patch Set 2: -Code-Review</pre><strong>Reviewer</strong>: YAOGUO JIANG - jiangyaoguo@gmail.com<br><strong>Reviewed</strong>: 8/24/2017, 10:56:49 AM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/24/2017, 10:57:00 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/11668/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/24/2017, 10:58:40 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16037/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/24/2017, 10:58:52 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10046/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/24/2017, 11:00:05 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7580/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/24/2017, 12:45:17 PM<br><strong>Message</strong>: <pre>Patch Set 3: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7580/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7580/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/7580

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16037/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/16037

https://jenkins.hyperledger.org/job/fabric-verify-z/11668/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/11668

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10046/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/10046</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 8/24/2017, 1:18:53 PM<br><strong>Message</strong>: <pre>Patch Set 3:

I am wondering - why can't we have the shim just suicide after it has no activity for a long period of time?</pre><strong>Reviewer</strong>: YAOGUO JIANG - jiangyaoguo@gmail.com<br><strong>Reviewed</strong>: 8/25/2017, 3:41:14 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Hi,Yacov Manevich. Thanks for your advice. The original purpose is cleaning up orphaned container produced by chaincode lifecycle operations. TTL is a middle way. Implementing TTL at shim side is OK, but at peer side, we could get expansibility for further complicated policy. What do you think?</pre><strong>Reviewer</strong>: YAOGUO JIANG - jiangyaoguo@gmail.com<br><strong>Reviewed</strong>: 8/25/2017, 3:47:18 AM<br><strong>Message</strong>: <pre>Uploaded patch set 4.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/25/2017, 3:47:29 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/11709/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/25/2017, 3:48:14 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10086/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/25/2017, 3:48:19 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16078/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/25/2017, 3:49:22 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7620/ (4/4)</pre><strong>Reviewer</strong>: Baohua Yang - yangbaohua@gmail.com<br><strong>Reviewed</strong>: 8/25/2017, 4:17:22 AM<br><strong>Message</strong>: <pre>Patch Set 4:

(3 comments)

Please help see my comments in line, thanks!</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/25/2017, 4:53:19 AM<br><strong>Message</strong>: <pre>Patch Set 4: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-z/11709/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/11709

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10086/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/10086

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7620/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/7620

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16078/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/16078</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 8/26/2017, 2:38:06 PM<br><strong>Message</strong>: <pre>Patch Set 4:

(1 comment)</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 8/26/2017, 3:34:50 PM<br><strong>Message</strong>: <pre>Patch Set 4:

(1 comment)

> Hi,Yacov Manevich. Thanks for your advice. The original purpose is cleaning up orphaned container produced by chaincode lifecycle operations

Right, but what you're doing here is not only cleanup - but also shutdown of them.
Why not just clean them up once they're down for a certain time period?</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 8/27/2017, 6:24:50 PM<br><strong>Message</strong>: <pre>Patch Set 4:

> Hi,Yacov Manevich. Thanks for your advice. The original purpose is
 > cleaning up orphaned container produced by chaincode lifecycle
 > operations. TTL is a middle way. Implementing TTL at shim side is
 > OK, but at peer side, we could get expansibility for further
 > complicated policy. What do you think?

In addition to possible future expansion mentioned above, doing it on the chaincode implies every chaincode platform would have to implement this (and implement correctly). Doing it on the peer side reduces to a single common implementation.</pre><strong>Reviewer</strong>: Baohua Yang - yangbaohua@gmail.com<br><strong>Reviewed</strong>: 8/29/2017, 8:19:35 PM<br><strong>Message</strong>: <pre>Patch Set 4:

> > Hi,Yacov Manevich. Thanks for your advice. The original purpose
 > is
 > > cleaning up orphaned container produced by chaincode lifecycle
 > > operations. TTL is a middle way. Implementing TTL at shim side is
 > > OK, but at peer side, we could get expansibility for further
 > > complicated policy. What do you think?
 > 
 > In addition to possible future expansion mentioned above, doing it
 > on the chaincode implies every chaincode platform would have to
 > implement this (and implement correctly). Doing it on the peer side
 > reduces to a single common implementation.

I'm also thinking that maybe we can first add some client cmd besides the peer action to trigger the cleanup operation. This is useful for testing and also manually operations.</pre><strong>Reviewer</strong>: Baohua Yang - yangbaohua@gmail.com<br><strong>Reviewed</strong>: 9/1/2017, 2:35:08 AM<br><strong>Message</strong>: <pre>Patch Set 4: Code-Review+1</pre><strong>Reviewer</strong>: YAOGUO JIANG - jiangyaoguo@gmail.com<br><strong>Reviewed</strong>: 9/6/2017, 4:30:01 AM<br><strong>Message</strong>: <pre>Patch Set 4:

(4 comments)</pre><strong>Reviewer</strong>: YAOGUO JIANG - jiangyaoguo@gmail.com<br><strong>Reviewed</strong>: 9/6/2017, 4:30:26 AM<br><strong>Message</strong>: <pre>Uploaded patch set 5.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/6/2017, 4:30:33 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/12119/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/6/2017, 4:31:48 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16464/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/6/2017, 4:32:38 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10473/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/6/2017, 4:33:03 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/8047/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/6/2017, 5:43:28 AM<br><strong>Message</strong>: <pre>Patch Set 5: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-z/12119/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/12119

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16464/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/16464

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10473/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/10473

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/8047/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/8047</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 9/6/2017, 7:47:59 AM<br><strong>Message</strong>: <pre>Patch Set 5:

(5 comments)

Thanks, Yaoguo. A few more comments after the lock change please.</pre><strong>Reviewer</strong>: YAOGUO JIANG - jiangyaoguo@gmail.com<br><strong>Reviewed</strong>: 9/6/2017, 11:30:56 PM<br><strong>Message</strong>: <pre>Uploaded patch set 6.</pre><strong>Reviewer</strong>: YAOGUO JIANG - jiangyaoguo@gmail.com<br><strong>Reviewed</strong>: 9/6/2017, 11:31:02 PM<br><strong>Message</strong>: <pre>Patch Set 5:

(4 comments)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/6/2017, 11:31:06 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/12144/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/6/2017, 11:32:37 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16487/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/6/2017, 11:32:57 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10494/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/6/2017, 11:33:02 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/8069/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/6/2017, 11:53:02 PM<br><strong>Message</strong>: <pre>Patch Set 6: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-z/12144/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-z/12144/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/12144

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16487/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16487/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/16487

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10494/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10494/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/10494

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/8069/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/8069/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/8069</pre><strong>Reviewer</strong>: YAOGUO JIANG - jiangyaoguo@gmail.com<br><strong>Reviewed</strong>: 9/7/2017, 3:09:54 AM<br><strong>Message</strong>: <pre>Uploaded patch set 7.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/7/2017, 3:10:01 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/12149/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/7/2017, 3:11:18 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16492/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/7/2017, 3:11:46 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10499/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/7/2017, 3:13:24 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/8074/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/7/2017, 4:42:49 AM<br><strong>Message</strong>: <pre>Patch Set 7: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-z/12149/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/12149

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16492/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/16492

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10499/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/10499

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/8074/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/8074</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 9/8/2017, 2:23:38 PM<br><strong>Message</strong>: <pre>Patch Set 7: Code-Review+1

+1 for now waiting for more reviews.</pre><strong>Reviewer</strong>: Baohua Yang - yangbaohua@gmail.com<br><strong>Reviewed</strong>: 9/13/2017, 10:22:37 PM<br><strong>Message</strong>: <pre>Patch Set 7:

(3 comments)

Please see my comments in line. Thanks!</pre><strong>Reviewer</strong>: YAOGUO JIANG - jiangyaoguo@gmail.com<br><strong>Reviewed</strong>: 9/14/2017, 3:21:34 AM<br><strong>Message</strong>: <pre>Patch Set 7:

(2 comments)</pre><strong>Reviewer</strong>: YAOGUO JIANG - jiangyaoguo@gmail.com<br><strong>Reviewed</strong>: 9/14/2017, 3:21:35 AM<br><strong>Message</strong>: <pre>Uploaded patch set 8.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/14/2017, 3:21:45 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/12424/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/14/2017, 3:22:50 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16766/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/14/2017, 3:23:14 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10766/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/14/2017, 3:23:42 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/8355/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/14/2017, 4:34:26 AM<br><strong>Message</strong>: <pre>Patch Set 8: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10766/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10766/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/10766

https://jenkins.hyperledger.org/job/fabric-verify-z/12424/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/12424

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16766/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/16766

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/8355/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/8355</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 9/14/2017, 7:47:35 AM<br><strong>Message</strong>: <pre>Patch Set 8:

rebuild-behave</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/14/2017, 7:49:52 AM<br><strong>Message</strong>: <pre>Patch Set 8: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10769/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/14/2017, 8:01:06 AM<br><strong>Message</strong>: <pre>Patch Set 8: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10769/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10769/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/10769</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 9/14/2017, 8:40:12 AM<br><strong>Message</strong>: <pre>Patch Set 8: Code-Review-2

I'm not really see the connection of current change set to the underlined JIRA item. JIRA describes the need to clean up containers upon update and install of the chaincode. I think adding containers GC is a bit risky and very preliminary as I would start from cleaning up orphaned containers according to JIRA description.

Adding containers GC IMO should be voted with review-needed tag.</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 9/14/2017, 9:18:31 AM<br><strong>Message</strong>: <pre>Patch Set 8:

> I'm not really see the connection of current change set to the
 > underlined JIRA item. JIRA describes the need to clean up
 > containers upon update and install of the chaincode. I think adding
 > containers GC is a bit risky and very preliminary as I would start
 > from cleaning up orphaned containers according to JIRA description.
 > 
 > Adding containers GC IMO should be voted with review-needed tag.

Artem, Given the chaincode could be serving multiple channels, we cannot just terminate the old one upon successful upgrade. Rather than invasive tracking of chaincode across channels, the idea was to terminate chaincodes if not used for some time. It also helps with a broader issue of freeing up chaincodes that are used sporadically - which is a good thing to do anyway. BTW, agreed it does sound disconected from the original JIRA, but the comments show the connection.  What do you think ?</pre><strong>Reviewer</strong>: Ramesh Babu Thoomu - rameshbabu.thoomu@gmail.com<br><strong>Reviewed</strong>: 9/14/2017, 12:04:44 PM<br><strong>Message</strong>: <pre>Patch Set 8:

rebuild-behave</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/14/2017, 12:07:36 PM<br><strong>Message</strong>: <pre>Patch Set 8: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10786/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/14/2017, 12:21:21 PM<br><strong>Message</strong>: <pre>Patch Set 8: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10786/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/10786</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 9/14/2017, 2:03:40 PM<br><strong>Message</strong>: <pre>Patch Set 8:

> Artem, Given the chaincode could be serving multiple channels, we cannot just terminate the old one upon successful upgrade. Rather than invasive tracking of chaincode across channels, the idea was to terminate chaincodes if not used for some time. It also helps with a broader issue of freeing up chaincodes that are used sporadically - which is a good thing to do anyway. BTW, agreed it does sound disconected from the original JIRA, but the comments show the connection. What do you think ?

I still think it's better to properly implement required logic rather than trying to provide some heuristic based solution aka inactivity timeout. Also how this going to be supported in distributed environments such as SWARM or Kubernetis where CC container executed on different host and different peers are using it? With the it currently implemented you might shutdown which in use by some peer, while your own peer triggers the timeout.</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 9/14/2017, 6:32:42 PM<br><strong>Message</strong>: <pre>Patch Set 8:

> > Artem, Given the chaincode could be serving multiple channels, we
 > cannot just terminate the old one upon successful upgrade. Rather
 > than invasive tracking of chaincode across channels, the idea was
 > to terminate chaincodes if not used for some time. It also helps
 > with a broader issue of freeing up chaincodes that are used
 > sporadically - which is a good thing to do anyway. BTW, agreed it
 > does sound disconected from the original JIRA, but the comments
 > show the connection. What do you think ?
 > 
 > I still think it's better to properly implement required logic
 > rather than trying to provide some heuristic based solution aka
 > inactivity timeout. Also how this going to be supported in
 > distributed environments such as SWARM or Kubernetis where CC
 > container executed on different host and different peers are using
 > it? With the it currently implemented you might shutdown which in
 > use by some peer, while your own peer triggers the timeout.

Note that regardless of this upgrade issue, timing out unused chaincodes is not a bad thing. Using it for upgrade just takes advantage of it as a side effect. Doing it properly for upgrade would not buy us a whole lot more IMO for the extra work it  would take. And as a bonus we also get to clean unused chaincodes. Regarding clusters, you are suggesting that chaincode would serve multiple peers ? How would that work - the chaincode is tied to a peer via a chat stream (maybe I'm missing something) ? Finally note that the timer should be a large one so it shouldn't affect the dynamics of individual chaincodes on the whole.</pre><strong>Reviewer</strong>: Christopher Ferris - chris.ferris@gmail.com<br><strong>Reviewed</strong>: 1/2/2018, 10:36:35 AM<br><strong>Message</strong>: <pre>Patch Set 8:

> Patch Set 8:
> 
> > > Artem, Given the chaincode could be serving multiple channels, we
>  > cannot just terminate the old one upon successful upgrade. Rather
>  > than invasive tracking of chaincode across channels, the idea was
>  > to terminate chaincodes if not used for some time. It also helps
>  > with a broader issue of freeing up chaincodes that are used
>  > sporadically - which is a good thing to do anyway. BTW, agreed it
>  > does sound disconected from the original JIRA, but the comments
>  > show the connection. What do you think ?
>  > 
>  > I still think it's better to properly implement required logic
>  > rather than trying to provide some heuristic based solution aka
>  > inactivity timeout. Also how this going to be supported in
>  > distributed environments such as SWARM or Kubernetis where CC
>  > container executed on different host and different peers are using
>  > it? With the it currently implemented you might shutdown which in
>  > use by some peer, while your own peer triggers the timeout.
> 
> Note that regardless of this upgrade issue, timing out unused chaincodes is not a bad thing. Using it for upgrade just takes advantage of it as a side effect. Doing it properly for upgrade would not buy us a whole lot more IMO for the extra work it  would take. And as a bonus we also get to clean unused chaincodes. Regarding clusters, you are suggesting that chaincode would serve multiple peers ? How would that work - the chaincode is tied to a peer via a chat stream (maybe I'm missing something) ? Finally note that the timer should be a large one so it shouldn't affect the dynamics of individual chaincodes on the whole.

What's the status of this? Should it be abandoned?</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 1/2/2018, 3:03:42 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Chris, IMO for the stated reasons in previous comment, this has value. Bottom line, peer side tears down container connections if they have not been in use for timeout period (default, infinite).  This  applies to all container technologies (docker, swarm, k8s). It also takes care of the upgrade case as a side effect when the chaincode is not used in other channels after upgrade.</pre><strong>Reviewer</strong>: Christopher Ferris - chris.ferris@gmail.com<br><strong>Reviewed</strong>: 3/29/2018, 1:53:28 PM<br><strong>Message</strong>: <pre>Patch Set 8: Code-Review-2

> Patch Set 8:
> 
> Chris, IMO for the stated reasons in previous comment, this has value. Bottom line, peer side tears down container connections if they have not been in use for timeout period (default, infinite).  This  applies to all container technologies (docker, swarm, k8s). It also takes care of the upgrade case as a side effect when the chaincode is not used in other channels after upgrade.

bringing this back to the top of the stack... if this is to be addressed in 1.2, suggest that the design doc be resurrected (it has gone missing) and this patch be associated with a more relevant JIRA (e.g. https://jira.hyperledger.org/browse/FAB-5781). We can schedule a playback of a design soon as there is one to discuss.</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 4/20/2018, 6:26:40 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Seems like the design doc has been updated.

Yaoguo, would you be up to hosting playback of the design next week? If the answer's yes, we'll put it in the calendar, and if a quorum agrees with the solution, you can rebase/fix merge conflicts, and we can get it in.</pre><strong>Reviewer</strong>: YAOGUO JIANG - jiangyaoguo@gmail.com<br><strong>Reviewed</strong>: 4/22/2018, 11:37:48 PM<br><strong>Message</strong>: <pre>Patch Set 8:

(1 comment)

@Kostas Christidis  Thanks for remind of design update.And yes, if this design is agreed, I'll update this pr.</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 5/1/2018, 1:20:17 PM<br><strong>Message</strong>: <pre>Patch Set 8:

My opinion is that the overall cc lifecycle is large enough to warrant a design review. But the cleanup of a container based on time to live (this CR) is somewhat orthogonal to the larger lifecycle story and could proceed in this CR without a design review.</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 7/19/2018, 5:33:49 PM<br><strong>Message</strong>: <pre>Removed reviewer Kostas Christidis.</pre><strong>Reviewer</strong>: Christopher Ferris - chris.ferris@gmail.com<br><strong>Reviewed</strong>: 2/2/2019, 5:09:17 PM<br><strong>Message</strong>: <pre>Abandoned

abandoning for non-response to comments</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 2/2/2019, 5:18:09 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Seems like the container garbage collection change set, has just been garbage collected by the change request garbage collection policy...</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: YAOGUO JIANG - jiangyaoguo@gmail.com<br><strong>Uploader</strong>: YAOGUO JIANG - jiangyaoguo@gmail.com<br><strong>Created</strong>: 5/23/2017, 12:04:25 PM<br><strong>UnmergedRevision</strong>: [60230ebf77d3f8aca12f08275eb5a4ad4c12c396](https://github.com/hyperledger-gerrit-archive/fabric/commit/60230ebf77d3f8aca12f08275eb5a4ad4c12c396)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/23/2017, 1:28:54 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: YAOGUO JIANG - jiangyaoguo@gmail.com<br><strong>Uploader</strong>: YAOGUO JIANG - jiangyaoguo@gmail.com<br><strong>Created</strong>: 5/25/2017, 4:15:19 AM<br><strong>UnmergedRevision</strong>: [ce2eea53ff0b9024de612ef33e842ba286094138](https://github.com/hyperledger-gerrit-archive/fabric/commit/ce2eea53ff0b9024de612ef33e842ba286094138)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/25/2017, 4:50:16 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: YAOGUO JIANG - jiangyaoguo@gmail.com<br><strong>Uploader</strong>: YAOGUO JIANG - jiangyaoguo@gmail.com<br><strong>Created</strong>: 8/24/2017, 10:56:49 AM<br><strong>UnmergedRevision</strong>: [90b28c38a8b9a29b7588409b411cb9f2579538d1](https://github.com/hyperledger-gerrit-archive/fabric/commit/90b28c38a8b9a29b7588409b411cb9f2579538d1)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/24/2017, 12:45:17 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: YAOGUO JIANG - jiangyaoguo@gmail.com<br><strong>Uploader</strong>: YAOGUO JIANG - jiangyaoguo@gmail.com<br><strong>Created</strong>: 8/25/2017, 3:47:18 AM<br><strong>UnmergedRevision</strong>: [801f26162518712f8be8c32413b4fca9a6fba3f8](https://github.com/hyperledger-gerrit-archive/fabric/commit/801f26162518712f8be8c32413b4fca9a6fba3f8)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/25/2017, 4:53:19 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Baohua Yang - yangbaohua@gmail.com<br><strong>Approved</strong>: 9/1/2017, 2:35:08 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/chaincode_support.go#L204](https://github.com/hyperledger-gerrit-archive/fabric/blob/801f26162518712f8be8c32413b4fca9a6fba3f8/core/chaincode/chaincode_support.go#L204)<br><strong>Comment</strong>: <pre>perhaps extract to a variable or a constant</pre><strong>Commenter</strong>: YAOGUO JIANG - jiangyaoguo@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/chaincode_support.go#L204](https://github.com/hyperledger-gerrit-archive/fabric/blob/801f26162518712f8be8c32413b4fca9a6fba3f8/core/chaincode/chaincode_support.go#L204)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Baohua Yang - yangbaohua@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/chaincode_support.go#L746](https://github.com/hyperledger-gerrit-archive/fabric/blob/801f26162518712f8be8c32413b4fca9a6fba3f8/core/chaincode/chaincode_support.go#L746)<br><strong>Comment</strong>: <pre>Add what if lots of cc invoke happens quickly?

Maybe we do not need to update the status every time?

One possible design is we use a timeout flag to track when need to do the update. e.g., every 1/2*CLEAN_TIMEOUT we open the flag to allow update.</pre><strong>Commenter</strong>: YAOGUO JIANG - jiangyaoguo@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/chaincode_support.go#L746](https://github.com/hyperledger-gerrit-archive/fabric/blob/801f26162518712f8be8c32413b4fca9a6fba3f8/core/chaincode/chaincode_support.go#L746)<br><strong>Comment</strong>: <pre>Have changed gcManager to two-lock strategy for improving efficiency. Considering current tps, we could delay this optimization. What do you think?</pre><strong>Commenter</strong>: Baohua Yang - yangbaohua@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/chaincode_support.go#L747](https://github.com/hyperledger-gerrit-archive/fabric/blob/801f26162518712f8be8c32413b4fca9a6fba3f8/core/chaincode/chaincode_support.go#L747)<br><strong>Comment</strong>: <pre>Maybe we can move this part after the cc launching status checking?

If the cc has not been launched, then no need to updateVM?</pre><strong>Commenter</strong>: YAOGUO JIANG - jiangyaoguo@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/chaincode_support.go#L747](https://github.com/hyperledger-gerrit-archive/fabric/blob/801f26162518712f8be8c32413b4fca9a6fba3f8/core/chaincode/chaincode_support.go#L747)<br><strong>Comment</strong>: <pre>Before this "Execute", chaincode should have been launched. Chaincode "active" means it was invoked recently, no matter if the real container is running or stopped accidentally.</pre><strong>Commenter</strong>: Baohua Yang - yangbaohua@gmail.com<br><strong>CommentLine</strong>: [core/container/gc/gc.go#L2](https://github.com/hyperledger-gerrit-archive/fabric/blob/801f26162518712f8be8c32413b4fca9a6fba3f8/core/container/gc/gc.go#L2)<br><strong>Comment</strong>: <pre>I guess u would like to update this info :)</pre><strong>Commenter</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>CommentLine</strong>: [core/container/gc/gc.go#L8](https://github.com/hyperledger-gerrit-archive/fabric/blob/801f26162518712f8be8c32413b4fca9a6fba3f8/core/container/gc/gc.go#L8)<br><strong>Comment</strong>: <pre>For efficiency, I'd consider breaking this up into two systems of locks. A Mutex for vmInfo and the vmLock for the GCManager (and the vmLock be RWMutex).

This way, the more frequent access to vmLock need not hold UpdateVM would RLock on vmLock for updating timer on that VM will be local helping UpdateVM to not become a hotspot. 

This two-lock strategy should be looked at closely clearly but I think can be made to work.</pre><strong>Commenter</strong>: YAOGUO JIANG - jiangyaoguo@gmail.com<br><strong>CommentLine</strong>: [core/container/gc/gc.go#L8](https://github.com/hyperledger-gerrit-archive/fabric/blob/801f26162518712f8be8c32413b4fca9a6fba3f8/core/container/gc/gc.go#L8)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 5</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: YAOGUO JIANG - jiangyaoguo@gmail.com<br><strong>Uploader</strong>: YAOGUO JIANG - jiangyaoguo@gmail.com<br><strong>Created</strong>: 9/6/2017, 4:30:26 AM<br><strong>UnmergedRevision</strong>: [b8595aad888a9ebf157153410dcff9fc6decd3fa](https://github.com/hyperledger-gerrit-archive/fabric/commit/b8595aad888a9ebf157153410dcff9fc6decd3fa)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/6/2017, 5:43:28 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/chaincode_support.go#L529](https://github.com/hyperledger-gerrit-archive/fabric/blob/b8595aad888a9ebf157153410dcff9fc6decd3fa/core/chaincode/chaincode_support.go#L529)<br><strong>Comment</strong>: <pre>We want to do this only if Chaincode was launched (ie, in else part above)</pre><strong>Commenter</strong>: YAOGUO JIANG - jiangyaoguo@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/chaincode_support.go#L529](https://github.com/hyperledger-gerrit-archive/fabric/blob/b8595aad888a9ebf157153410dcff9fc6decd3fa/core/chaincode/chaincode_support.go#L529)<br><strong>Comment</strong>: <pre>You're right, fixed it.</pre><strong>Commenter</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>CommentLine</strong>: [core/container/gc/gc.go#L95](https://github.com/hyperledger-gerrit-archive/fabric/blob/b8595aad888a9ebf157153410dcff9fc6decd3fa/core/container/gc/gc.go#L95)<br><strong>Comment</strong>: <pre>We are accessing vmInfo in line 110 without lock. Suggest we add a copy of vmInfo to expiredVMs so we can freely manipulate the copy in expiredVMs</pre><strong>Commenter</strong>: YAOGUO JIANG - jiangyaoguo@gmail.com<br><strong>CommentLine</strong>: [core/container/gc/gc.go#L95](https://github.com/hyperledger-gerrit-archive/fabric/blob/b8595aad888a9ebf157153410dcff9fc6decd3fa/core/container/gc/gc.go#L95)<br><strong>Comment</strong>: <pre>line 110 is accessing the constant part of vmInfo, so i didn't lock vmInfo. Agree that making a copy enable us to freely manipulate it.</pre><strong>Commenter</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>CommentLine</strong>: [core/container/gc/gc.go#L120](https://github.com/hyperledger-gerrit-archive/fabric/blob/b8595aad888a9ebf157153410dcff9fc6decd3fa/core/container/gc/gc.go#L120)<br><strong>Comment</strong>: <pre>What do you think of changing this to info ? Avoid users concern that something bad is happening when all we are doing is removing a chaincode thats not been accessed for a while.</pre><strong>Commenter</strong>: YAOGUO JIANG - jiangyaoguo@gmail.com<br><strong>CommentLine</strong>: [core/container/gc/gc.go#L120](https://github.com/hyperledger-gerrit-archive/fabric/blob/b8595aad888a9ebf157153410dcff9fc6decd3fa/core/container/gc/gc.go#L120)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>CommentLine</strong>: [core/container/gc/gc_test.go#L95](https://github.com/hyperledger-gerrit-archive/fabric/blob/b8595aad888a9ebf157153410dcff9fc6decd3fa/core/container/gc/gc_test.go#L95)<br><strong>Comment</strong>: <pre>minor correction .. "Should be left with only one vm"</pre><strong>Commenter</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>CommentLine</strong>: [core/container/gc/gc_test.go#L96](https://github.com/hyperledger-gerrit-archive/fabric/blob/b8595aad888a9ebf157153410dcff9fc6decd3fa/core/container/gc/gc_test.go#L96)<br><strong>Comment</strong>: <pre>minor correction .. "Should be left with vm %s"</pre><strong>Commenter</strong>: YAOGUO JIANG - jiangyaoguo@gmail.com<br><strong>CommentLine</strong>: [core/container/gc/gc_test.go#L96](https://github.com/hyperledger-gerrit-archive/fabric/blob/b8595aad888a9ebf157153410dcff9fc6decd3fa/core/container/gc/gc_test.go#L96)<br><strong>Comment</strong>: <pre>Thanks for correntions. Fixed it.</pre></blockquote><h3>PatchSet Number: 6</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: YAOGUO JIANG - jiangyaoguo@gmail.com<br><strong>Uploader</strong>: YAOGUO JIANG - jiangyaoguo@gmail.com<br><strong>Created</strong>: 9/6/2017, 11:30:56 PM<br><strong>UnmergedRevision</strong>: [c6fc942cb948b9f654176b8b6bb9f9b1561f02f0](https://github.com/hyperledger-gerrit-archive/fabric/commit/c6fc942cb948b9f654176b8b6bb9f9b1561f02f0)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/6/2017, 11:53:02 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 7</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: YAOGUO JIANG - jiangyaoguo@gmail.com<br><strong>Uploader</strong>: YAOGUO JIANG - jiangyaoguo@gmail.com<br><strong>Created</strong>: 9/7/2017, 3:09:54 AM<br><strong>UnmergedRevision</strong>: [3a70fa9f97deffe82b621b6562131447f367e927](https://github.com/hyperledger-gerrit-archive/fabric/commit/3a70fa9f97deffe82b621b6562131447f367e927)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/7/2017, 4:42:49 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Approved</strong>: 9/8/2017, 2:23:38 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Baohua Yang - yangbaohua@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/chaincode_support.go#L195](https://github.com/hyperledger-gerrit-archive/fabric/blob/3a70fa9f97deffe82b621b6562131447f367e927/core/chaincode/chaincode_support.go#L195)<br><strong>Comment</strong>: <pre>extra space</pre><strong>Commenter</strong>: YAOGUO JIANG - jiangyaoguo@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/chaincode_support.go#L195](https://github.com/hyperledger-gerrit-archive/fabric/blob/3a70fa9f97deffe82b621b6562131447f367e927/core/chaincode/chaincode_support.go#L195)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Baohua Yang - yangbaohua@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/chaincode_support.go#L748](https://github.com/hyperledger-gerrit-archive/fabric/blob/3a70fa9f97deffe82b621b6562131447f367e927/core/chaincode/chaincode_support.go#L748)<br><strong>Comment</strong>: <pre>perhaps it's safe to run the UpdateVM call in go routine, which will not block the execute.</pre><strong>Commenter</strong>: YAOGUO JIANG - jiangyaoguo@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/chaincode_support.go#L748](https://github.com/hyperledger-gerrit-archive/fabric/blob/3a70fa9f97deffe82b621b6562131447f367e927/core/chaincode/chaincode_support.go#L748)<br><strong>Comment</strong>: <pre>Thanks,baohua. Can we leave it as it is since it on</pre><strong>Commenter</strong>: Baohua Yang - yangbaohua@gmail.com<br><strong>CommentLine</strong>: [sampleconfig/core.yaml#L378](https://github.com/hyperledger-gerrit-archive/fabric/blob/3a70fa9f97deffe82b621b6562131447f367e927/sampleconfig/core.yaml#L378)<br><strong>Comment</strong>: <pre>"inactive" is better.</pre><strong>Commenter</strong>: YAOGUO JIANG - jiangyaoguo@gmail.com<br><strong>CommentLine</strong>: [sampleconfig/core.yaml#L378](https://github.com/hyperledger-gerrit-archive/fabric/blob/3a70fa9f97deffe82b621b6562131447f367e927/sampleconfig/core.yaml#L378)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 8</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: YAOGUO JIANG - jiangyaoguo@gmail.com<br><strong>Uploader</strong>: YAOGUO JIANG - jiangyaoguo@gmail.com<br><strong>Created</strong>: 9/14/2017, 3:21:35 AM<br><strong>UnmergedRevision</strong>: [15b9993baf72a3c7cf53f3c95fbffbb6c97d6f39](https://github.com/hyperledger-gerrit-archive/fabric/commit/15b9993baf72a3c7cf53f3c95fbffbb6c97d6f39)<br><br><strong>Approver</strong>: Christopher Ferris - chris.ferris@gmail.com<br><strong>Approved</strong>: 3/29/2018, 1:53:28 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/14/2017, 12:21:21 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Approved</strong>: 9/14/2017, 8:40:12 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br></blockquote>