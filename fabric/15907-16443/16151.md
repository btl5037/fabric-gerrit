<strong>Project</strong>: fabric<br><strong>Branch</strong>: master<br><strong>ID</strong>: 16151<br><strong>Subject</strong>: [FAB-7131] CouchDB: per channel-chaincode DB<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 12/12/2017, 11:22:37 AM<br><strong>LastUpdated</strong>: 1/5/2018, 5:14:51 PM<br><strong>CommitMessage</strong>:<br><pre>[FAB-7131] CouchDB: per channel-chaincode DB

For every chaincode, use a separate database instead of using
the same channel database. This CR makes the following changes:
(i) creates a database per channel_chaincode and two DBs per
channel_chaincode_collection (one for hashed data and another for
actual private data).
(ii) modifies GetState, RangeQuery, and ExecuteQuery implementation
to use appropriate chaincode DB as per the given namespace.
(iii) modifies commit process (ApplyUpdates) to apply changes to
respective chaincode DBs.

In the subsequent CR, for loadCommittedVersions and ApplyUpdates,
goroutines would be used to process each chaincode batches
parallely.

Change-Id: I05b5f70e6c253cec683382c9e5b2b39b6a6bcce8
Signed-off-by: senthil <cendhu@gmail.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 12/12/2017, 11:22:37 AM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/12/2017, 11:22:48 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-s390x/667/ (1/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/12/2017, 11:23:15 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/19518/ (2/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/12/2017, 11:24:19 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/13588/ (3/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/12/2017, 11:24:32 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/11216/ (4/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/12/2017, 11:24:59 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/23/ (5/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/12/2017, 11:56:11 AM<br><strong>Message</strong>: <pre>Patch Set 1: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/19518/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/19518/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/19518

https://jenkins.hyperledger.org/job/fabric-verify-s390x/667/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-s390x/667/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-s390x/667

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/23/ : FAILURE (skipped)

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/23/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/23

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/13588/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-behave-x86_64/13588

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/11216/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/11216</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 12/12/2017, 1:04:18 PM<br><strong>Message</strong>: <pre>Uploaded patch set 2.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/12/2017, 1:04:29 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-s390x/671/ (1/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/12/2017, 1:05:38 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/19522/ (2/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/12/2017, 1:05:52 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/13592/ (3/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/12/2017, 1:05:54 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/11220/ (4/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/12/2017, 1:06:17 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/27/ (5/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/12/2017, 1:36:12 PM<br><strong>Message</strong>: <pre>Patch Set 2: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/19522/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/19522/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/19522

https://jenkins.hyperledger.org/job/fabric-verify-s390x/671/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-s390x/671/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-s390x/671

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/27/ : FAILURE (skipped)

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/27/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/27

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/13592/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-behave-x86_64/13592

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/11220/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/11220</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 12/12/2017, 2:06:22 PM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/12/2017, 2:06:37 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-s390x/673/ (1/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/12/2017, 2:07:09 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/19524/ (2/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/12/2017, 2:07:38 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/13594/ (3/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/12/2017, 2:07:49 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/11222/ (4/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/12/2017, 2:08:08 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/29/ (5/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/12/2017, 3:16:59 PM<br><strong>Message</strong>: <pre>Patch Set 3: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/29/ : FAILURE (skipped)

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/29/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/29

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/19524/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/19524

https://jenkins.hyperledger.org/job/fabric-verify-s390x/673/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-s390x/673

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/13594/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-behave-x86_64/13594

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/11222/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/11222</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 12/12/2017, 9:39:13 PM<br><strong>Message</strong>: <pre>Patch Set 4: Commit message was updated.</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 12/12/2017, 9:40:09 PM<br><strong>Message</strong>: <pre>Patch Set 5: Patch Set 4 was rebased</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/12/2017, 9:40:09 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-s390x/677/ (1/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/12/2017, 9:40:12 PM<br><strong>Message</strong>: <pre>Patch Set 4: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-s390x/677/ : ABORTED

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-s390x/677/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-s390x/677</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/12/2017, 9:40:19 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-s390x/678/ (1/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/12/2017, 9:41:16 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/19528/ (2/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/12/2017, 9:41:49 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/13598/ (3/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/12/2017, 9:42:03 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/11226/ (4/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/12/2017, 9:42:30 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/33/ (5/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/12/2017, 10:55:39 PM<br><strong>Message</strong>: <pre>Patch Set 5: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-s390x/678/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-s390x/678/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-s390x/678

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/19528/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/19528

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/13598/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-behave-x86_64/13598

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/11226/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/11226

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/33/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/33</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 12/13/2017, 10:08:04 AM<br><strong>Message</strong>: <pre>Patch Set 5:

rebuild-s390x</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/13/2017, 10:08:14 AM<br><strong>Message</strong>: <pre>Patch Set 5: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-s390x/693/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/13/2017, 10:53:50 AM<br><strong>Message</strong>: <pre>Patch Set 5: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-s390x/693/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-s390x/693</pre><strong>Reviewer</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>Reviewed</strong>: 12/15/2017, 9:10:04 AM<br><strong>Message</strong>: <pre>Patch Set 5:

(1 comment)</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 12/19/2017, 2:38:36 PM<br><strong>Message</strong>: <pre>Patch Set 5:

(5 comments)</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 12/19/2017, 3:20:06 PM<br><strong>Message</strong>: <pre>Patch Set 5:

In the commit message it says:
"two DBs per channel_chaincode_collection (one for hashed data and another for actual private data)".
Is code for that included here?</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 12/20/2017, 10:19:29 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Senthil, A high level commen: So far statedb was virtually unaware of terminologies like channel, chaincode etc. All it provided was a concept of a namespace and data managed under that namespace. The mapping of the namespace to a particular chaincode was done at the higher layers.

Please remove the references (in the variable names and in the comments).</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 12/20/2017, 11:56:34 AM<br><strong>Message</strong>: <pre>Patch Set 5:

(15 comments)</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 12/28/2017, 4:01:54 PM<br><strong>Message</strong>: <pre>Patch Set 5:

(2 comments)</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 1/2/2018, 9:41:32 AM<br><strong>Message</strong>: <pre>Patch Set 5:

(17 comments)</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 1/2/2018, 11:09:09 AM<br><strong>Message</strong>: <pre>Uploaded patch set 6.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/2/2018, 11:09:19 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-s390x/1121/ (1/5)</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 1/2/2018, 11:09:27 AM<br><strong>Message</strong>: <pre>Patch Set 6:

(1 comment)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/2/2018, 11:10:50 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/14036/ (2/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/2/2018, 11:11:25 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/11652/ (3/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/2/2018, 11:11:35 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/19945/ (4/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/2/2018, 11:12:23 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/427/ (5/5)</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 1/2/2018, 11:25:05 AM<br><strong>Message</strong>: <pre>Patch Set 6: Code-Review-1

Need to modify privateData and hashedData namespace creation logic (in common_storage_db.go).</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 1/2/2018, 11:25:45 AM<br><strong>Message</strong>: <pre>Patch Set 6: -Code-Review</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/2/2018, 12:14:33 PM<br><strong>Message</strong>: <pre>Patch Set 6: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-s390x/1121/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-s390x/1121

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/14036/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-behave-x86_64/14036

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/11652/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/11652

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/19945/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/19945

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/427/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/427</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 1/2/2018, 12:17:19 PM<br><strong>Message</strong>: <pre>Uploaded patch set 7.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/2/2018, 12:17:26 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-s390x/1122/ (1/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/2/2018, 12:19:23 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/14037/ (2/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/2/2018, 12:21:45 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/11653/ (3/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/2/2018, 12:21:49 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/19947/ (4/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/2/2018, 12:21:51 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/428/ (5/5)</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 1/2/2018, 12:22:00 PM<br><strong>Message</strong>: <pre>Uploaded patch set 8.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/2/2018, 12:22:11 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/14038/ (1/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/2/2018, 12:22:11 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/11654/ (5/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/2/2018, 12:22:11 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/19948/ (3/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/2/2018, 12:22:11 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-s390x/1123/ (4/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/2/2018, 12:22:12 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/429/ (2/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/2/2018, 12:22:28 PM<br><strong>Message</strong>: <pre>Patch Set 7: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/11653/ : ABORTED

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/11653/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/11653

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/19947/ : ABORTED

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/19947/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/19947

https://jenkins.hyperledger.org/job/fabric-verify-s390x/1122/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-s390x/1122/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-s390x/1122

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/14037/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/14037/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-behave-x86_64/14037

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/428/ : FAILURE (skipped)

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/428/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/428</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 1/2/2018, 12:29:18 PM<br><strong>Message</strong>: <pre>Patch Set 8:

(1 comment)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/2/2018, 12:44:12 PM<br><strong>Message</strong>: <pre>Patch Set 8: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-s390x/1123/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-s390x/1123/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-s390x/1123

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/19948/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/19948/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/19948

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/14038/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-behave-x86_64/14038

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/11654/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/11654

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/429/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/429</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 1/4/2018, 12:27:36 AM<br><strong>Message</strong>: <pre>Patch Set 8:

rebuild-x</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/4/2018, 12:31:04 AM<br><strong>Message</strong>: <pre>Patch Set 8: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/19978/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/4/2018, 1:01:08 AM<br><strong>Message</strong>: <pre>Patch Set 8: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/19978/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/19978/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/19978</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 1/4/2018, 7:27:06 AM<br><strong>Message</strong>: <pre>Uploaded patch set 9.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/4/2018, 7:27:16 AM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-s390x/1153/ (1/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/4/2018, 7:29:00 AM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/11682/ (2/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/4/2018, 7:29:05 AM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/14065/ (3/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/4/2018, 7:29:58 AM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/19980/ (4/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/4/2018, 7:29:58 AM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/456/ (5/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/4/2018, 8:55:25 AM<br><strong>Message</strong>: <pre>Patch Set 9: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/14065/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/14065/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-behave-x86_64/14065

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/11682/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/11682

https://jenkins.hyperledger.org/job/fabric-verify-s390x/1153/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-s390x/1153

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/19980/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/19980

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/456/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/456</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 1/4/2018, 9:47:40 AM<br><strong>Message</strong>: <pre>Patch Set 9:

rebuild-behave</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/4/2018, 9:47:47 AM<br><strong>Message</strong>: <pre>Patch Set 9: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-tests-x86_64/232/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/4/2018, 9:49:08 AM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/14069/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/4/2018, 9:59:41 AM<br><strong>Message</strong>: <pre>Patch Set 9: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-behave-tests-x86_64/232/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-behave-tests-x86_64/232/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-behave-tests-x86_64/232

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/14069/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/14069/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-behave-x86_64/14069</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 1/5/2018, 12:25:59 AM<br><strong>Message</strong>: <pre>Patch Set 9:

rebuild-behave</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/5/2018, 12:26:08 AM<br><strong>Message</strong>: <pre>Patch Set 9: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/14085/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/5/2018, 12:34:17 AM<br><strong>Message</strong>: <pre>Patch Set 9: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/14085/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-behave-x86_64/14085</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 1/5/2018, 9:18:53 AM<br><strong>Message</strong>: <pre>Patch Set 9:

(4 comments)</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 1/5/2018, 9:23:38 AM<br><strong>Message</strong>: <pre>Patch Set 9:

(1 comment)</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 1/5/2018, 10:59:19 AM<br><strong>Message</strong>: <pre>Patch Set 9:

Noted. Will make the necessary changes. No remaining issues.</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 1/5/2018, 11:50:36 AM<br><strong>Message</strong>: <pre>Uploaded patch set 10.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/5/2018, 11:50:47 AM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-s390x/1176/ (1/5)</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 1/5/2018, 11:53:33 AM<br><strong>Message</strong>: <pre>Patch Set 10:

(4 comments)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/5/2018, 11:55:09 AM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/11705/ (2/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/5/2018, 11:55:24 AM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/14094/ (3/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/5/2018, 11:55:31 AM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20002/ (4/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/5/2018, 11:56:01 AM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/478/ (5/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/5/2018, 1:09:12 PM<br><strong>Message</strong>: <pre>Patch Set 10: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/11705/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/11705

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/14094/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-behave-x86_64/14094

https://jenkins.hyperledger.org/job/fabric-verify-s390x/1176/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-s390x/1176

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20002/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/20002

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/478/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/478</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 1/5/2018, 2:18:25 PM<br><strong>Message</strong>: <pre>Patch Set 10: Code-Review+2

I am good with this CR now.
- I have tested e2e with regular public data
- I have tested e2e with private data collections
- CouchDB databases are as expected and all chaincode functions are tested.
- The TODOs accurately cover the remaining items that will come in subsequent CRs.</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 1/5/2018, 3:58:15 PM<br><strong>Message</strong>: <pre>Patch Set 10: Code-Review+1</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 1/5/2018, 3:58:25 PM<br><strong>Message</strong>: <pre>Patch Set 10: Code-Review+2</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 1/5/2018, 3:58:48 PM<br><strong>Message</strong>: <pre>Change has been successfully merged by Manish Sethi</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/5/2018, 5:14:51 PM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-merge-behave-x86_64/2008/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-behave-x86_64/2008

https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/1700/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-end-2-end-x86_64/1700

https://jenkins.hyperledger.org/job/fabric-merge-s390x/178/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-s390x/178

https://jenkins.hyperledger.org/job/fabric-merge-x86_64/3025/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-x86_64/3025</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Uploader</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Created</strong>: 12/12/2017, 11:22:37 AM<br><strong>UnmergedRevision</strong>: [5e8b00b18bb81c6676e35f633c403d04354ae91c](https://github.com/hyperledger-gerrit-archive/fabric/commit/5e8b00b18bb81c6676e35f633c403d04354ae91c)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/12/2017, 11:56:11 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Uploader</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Created</strong>: 12/12/2017, 1:04:18 PM<br><strong>UnmergedRevision</strong>: [f45dfe3be92f25120ace95932b282e85a8066d7f](https://github.com/hyperledger-gerrit-archive/fabric/commit/f45dfe3be92f25120ace95932b282e85a8066d7f)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/12/2017, 1:36:12 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Uploader</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Created</strong>: 12/12/2017, 2:06:22 PM<br><strong>UnmergedRevision</strong>: [8919bb1327878bf840a140ea25eb183f04f4f055](https://github.com/hyperledger-gerrit-archive/fabric/commit/8919bb1327878bf840a140ea25eb183f04f4f055)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/12/2017, 3:16:59 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: NO_CODE_CHANGE<br><strong>Author</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Uploader</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Created</strong>: 12/12/2017, 9:39:13 PM<br><strong>UnmergedRevision</strong>: [4078dc25f9f3ff1b55c6146f67f270df3e878d27](https://github.com/hyperledger-gerrit-archive/fabric/commit/4078dc25f9f3ff1b55c6146f67f270df3e878d27)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/12/2017, 9:40:12 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 5</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Uploader</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Created</strong>: 12/12/2017, 9:40:09 PM<br><strong>UnmergedRevision</strong>: [727b2e712277deffc442ae9d800054fdb5969535](https://github.com/hyperledger-gerrit-archive/fabric/commit/727b2e712277deffc442ae9d800054fdb5969535)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/13/2017, 10:53:50 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/privacyenabledstate/common_storage_db.go#L21](https://github.com/hyperledger-gerrit-archive/fabric/blob/727b2e712277deffc442ae9d800054fdb5969535/core/ledger/kvledger/txmgmt/privacyenabledstate/common_storage_db.go#L21)<br><strong>Comment</strong>: <pre>See comments in other file about naming.</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/privacyenabledstate/common_storage_db.go#L21](https://github.com/hyperledger-gerrit-archive/fabric/blob/727b2e712277deffc442ae9d800054fdb5969535/core/ledger/kvledger/txmgmt/privacyenabledstate/common_storage_db.go#L21)<br><strong>Comment</strong>: <pre>We can use any of _$()+-/ as separator as per couchDB naming convention. I do not have any specific preference.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L31](https://github.com/hyperledger-gerrit-archive/fabric/blob/727b2e712277deffc442ae9d800054fdb5969535/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L31)<br><strong>Comment</strong>: <pre>Though it is not allowed in the chaincode name but why chaincode name should matter when we have a separate db for the chaincode?</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L31](https://github.com/hyperledger-gerrit-archive/fabric/blob/727b2e712277deffc442ae9d800054fdb5969535/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L31)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L77](https://github.com/hyperledger-gerrit-archive/fabric/blob/727b2e712277deffc442ae9d800054fdb5969535/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L77)<br><strong>Comment</strong>: <pre>let it be 'dbName'</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L77](https://github.com/hyperledger-gerrit-archive/fabric/blob/727b2e712277deffc442ae9d800054fdb5969535/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L77)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L101](https://github.com/hyperledger-gerrit-archive/fabric/blob/727b2e712277deffc442ae9d800054fdb5969535/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L101)<br><strong>Comment</strong>: <pre>Mention that this is for metadata like savepoint. Variable name could be channelMetadataDB to make this clear.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L101](https://github.com/hyperledger-gerrit-archive/fabric/blob/727b2e712277deffc442ae9d800054fdb5969535/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L101)<br><strong>Comment</strong>: <pre>metadataDB</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L101](https://github.com/hyperledger-gerrit-archive/fabric/blob/727b2e712277deffc442ae9d800054fdb5969535/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L101)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L101](https://github.com/hyperledger-gerrit-archive/fabric/blob/727b2e712277deffc442ae9d800054fdb5969535/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L101)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L102](https://github.com/hyperledger-gerrit-archive/fabric/blob/727b2e712277deffc442ae9d800054fdb5969535/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L102)<br><strong>Comment</strong>: <pre>dbName</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L102](https://github.com/hyperledger-gerrit-archive/fabric/blob/727b2e712277deffc442ae9d800054fdb5969535/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L102)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L103](https://github.com/hyperledger-gerrit-archive/fabric/blob/727b2e712277deffc442ae9d800054fdb5969535/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L103)<br><strong>Comment</strong>: <pre>namespaceDBs</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L103](https://github.com/hyperledger-gerrit-archive/fabric/blob/727b2e712277deffc442ae9d800054fdb5969535/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L103)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L112](https://github.com/hyperledger-gerrit-archive/fabric/blob/727b2e712277deffc442ae9d800054fdb5969535/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L112)<br><strong>Comment</strong>: <pre>In the comment mention this is for metadata like savepoint.

We don't want to use the same name as in 1.0 for the channel database, as the intent is to drop the 1.0 couchdb state db and regenerate/repopulate the new couchdb state dbs upon first start after upgrade.

We also want to avoid collisions with "<channelname>_<chaincode>" database.  So how about simply "<channelname>_" as the metadata database name?

See more comments in FAB-7130 on naming.  e.g. the need to hash the name if it is long... but this could come in a follow-on CR.</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L112](https://github.com/hyperledger-gerrit-archive/fabric/blob/727b2e712277deffc442ae9d800054fdb5969535/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L112)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L126](https://github.com/hyperledger-gerrit-archive/fabric/blob/727b2e712277deffc442ae9d800054fdb5969535/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L126)<br><strong>Comment</strong>: <pre>This function can be private and can be renamed as `getNamespaceDBHandle(namespace string)`.</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L126](https://github.com/hyperledger-gerrit-archive/fabric/blob/727b2e712277deffc442ae9d800054fdb5969535/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L126)<br><strong>Comment</strong>: <pre>Yes, it can be done. For now, it is not clear where and all GetNamespaceDBHandle would be used (mainly during deployment, index creation/update).</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L128](https://github.com/hyperledger-gerrit-archive/fabric/blob/727b2e712277deffc442ae9d800054fdb5969535/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L128)<br><strong>Comment</strong>: <pre>better take lock after preparing the name</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L128](https://github.com/hyperledger-gerrit-archive/fabric/blob/727b2e712277deffc442ae9d800054fdb5969535/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L128)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Chris Elder - chris.elder@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L129](https://github.com/hyperledger-gerrit-archive/fabric/blob/727b2e712277deffc442ae9d800054fdb5969535/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L129)<br><strong>Comment</strong>: <pre>This seems a bit confusing to me.  Shouldn't the namespace be passed in instead of chaincodeDBName?  Then chaincodeDBName := vdb.channelDBName + "-" + namespace</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L129](https://github.com/hyperledger-gerrit-archive/fabric/blob/727b2e712277deffc442ae9d800054fdb5969535/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L129)<br><strong>Comment</strong>: <pre>Right. Also see db naming discussion here in FAB-7130, e.g. we need to use underscore instead of dash, since dash is allowed in the channel name, while underscore is not.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L129](https://github.com/hyperledger-gerrit-archive/fabric/blob/727b2e712277deffc442ae9d800054fdb5969535/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L129)<br><strong>Comment</strong>: <pre>On the naming, even using underscore is not unique. Though, it is correct that 'underscore' is not allowed in the channel name but a 'dot' is allowed in the channel name and further, in the current implementation, we replace all 'dots' by 'underscore' for couch (https://github.com/hyperledger/fabric/blob/master/core/ledger/util/couchdb/couchdbutil.go#L150).

What is wrong continue using a 'slash' as a separator? (this is already used in the private data context as a namespace joiner)</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L129](https://github.com/hyperledger-gerrit-archive/fabric/blob/727b2e712277deffc442ae9d800054fdb5969535/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L129)<br><strong>Comment</strong>: <pre>I prefer to use underscore to separate channel and namespace, since underscore is more user friendly, as it is not a URL encoded character.  Therefore people doing simple HelloWorld type trials can easily use underscore in the couchdb URLs.

In 1.0 we did replace dot (.) with underscore (_) in channel names.  I'm suggesting to replace dot with dollar ($) in 1.1.

Senthil, I'd suggest go ahead and make the change in this CR so that all the changes go in together. In couchdbutil.go this line:
databaseName = strings.Replace(databaseName, ".", "_", -1)
needs to change to:
databaseName = strings.Replace(databaseName, ".", "$", -1)

Slash can continue to be used as the separator between chaincode id and collection id, for example the collection DB would be:

"channel_chaincode/collection"

See my full naming comments at:
https://jira.hyperledger.org/browse/FAB-7130?focusedCommentId=37641&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-37641</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L129](https://github.com/hyperledger-gerrit-archive/fabric/blob/727b2e712277deffc442ae9d800054fdb5969535/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L129)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L129](https://github.com/hyperledger-gerrit-archive/fabric/blob/727b2e712277deffc442ae9d800054fdb5969535/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L129)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L129](https://github.com/hyperledger-gerrit-archive/fabric/blob/727b2e712277deffc442ae9d800054fdb5969535/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L129)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L142](https://github.com/hyperledger-gerrit-archive/fabric/blob/727b2e712277deffc442ae9d800054fdb5969535/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L142)<br><strong>Comment</strong>: <pre>this can lead to the construction of multiple 'CouchDatabase'. The first line in the 'if' block needs to be to take lock and explicitly check for absence of the db. In other words, the code above the `if` block can only be optimization but cannot help in the completeness of the code inside the `if` block.</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L142](https://github.com/hyperledger-gerrit-archive/fabric/blob/727b2e712277deffc442ae9d800054fdb5969535/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L142)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L174](https://github.com/hyperledger-gerrit-archive/fabric/blob/727b2e712277deffc442ae9d800054fdb5969535/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L174)<br><strong>Comment</strong>: <pre>This will automatically lead to a separate db for each of the collections in the private data. Dave, did you get a chance to finalize your thoughts on this? If we still want to keep private data in the same chaincode specific db, this would require change in the layer on top of statedb layer.</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L174](https://github.com/hyperledger-gerrit-archive/fabric/blob/727b2e712277deffc442ae9d800054fdb5969535/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L174)<br><strong>Comment</strong>: <pre>I'm good with having a db per private data collection.  This makes the data isolation per collection very obvious and intuitive.  (it also means we won't be able to add views across public and private data in the future, but i think that is ok as we have been saying that any types of analytics should be done in a separate database outside of state db).</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L311](https://github.com/hyperledger-gerrit-archive/fabric/blob/727b2e712277deffc442ae9d800054fdb5969535/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L311)<br><strong>Comment</strong>: <pre>I am not very certain of this `lastKeyIndicator`. This is 0xFF which is not a valid utf-8 and I am not certain how couch compares it.

More than this, I am wondering that do we need to replace anything at all now. Earlier, it was needed because, we were manipulating the keys. I think that startKey="" and endKey="" will automatically be interpreted as unbounded range on the start and end respectively... Chris - is my understanding correct?</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L311](https://github.com/hyperledger-gerrit-archive/fabric/blob/727b2e712277deffc442ae9d800054fdb5969535/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L311)<br><strong>Comment</strong>: <pre>Yes, start/endkey Indicators are not required.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L865](https://github.com/hyperledger-gerrit-archive/fabric/blob/727b2e712277deffc442ae9d800054fdb5969535/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L865)<br><strong>Comment</strong>: <pre>shouldn't you be calling `EnsureFullCommit` on each of the dbs in the map?

Infact, for channelDB, this line is not required anymore. We can omit this. However, if we want to keep this, it makes better sense at the end of the function, instead of at the beginning.</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L865](https://github.com/hyperledger-gerrit-archive/fabric/blob/727b2e712277deffc442ae9d800054fdb5969535/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L865)<br><strong>Comment</strong>: <pre>Ahh. Nice find. Done.</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L873](https://github.com/hyperledger-gerrit-archive/fabric/blob/727b2e712277deffc442ae9d800054fdb5969535/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L873)<br><strong>Comment</strong>: <pre>I don't think anything uses this?  Can likely remove either in this CR or future CR, thoughts?</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L873](https://github.com/hyperledger-gerrit-archive/fabric/blob/727b2e712277deffc442ae9d800054fdb5969535/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L873)<br><strong>Comment</strong>: <pre>Agreed</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L873](https://github.com/hyperledger-gerrit-archive/fabric/blob/727b2e712277deffc442ae9d800054fdb5969535/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L873)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L880](https://github.com/hyperledger-gerrit-archive/fabric/blob/727b2e712277deffc442ae9d800054fdb5969535/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L880)<br><strong>Comment</strong>: <pre>I don't think anything uses this?  Can likely remove either in this CR or future CR, thoughts?</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L880](https://github.com/hyperledger-gerrit-archive/fabric/blob/727b2e712277deffc442ae9d800054fdb5969535/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L880)<br><strong>Comment</strong>: <pre>Agreed</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L880](https://github.com/hyperledger-gerrit-archive/fabric/blob/727b2e712277deffc442ae9d800054fdb5969535/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L880)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 6</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Uploader</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Created</strong>: 1/2/2018, 11:09:09 AM<br><strong>UnmergedRevision</strong>: [15adc8e68cc638d50a064be24520e376f88a3984](https://github.com/hyperledger-gerrit-archive/fabric/commit/15adc8e68cc638d50a064be24520e376f88a3984)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/2/2018, 12:14:33 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 7</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Uploader</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Created</strong>: 1/2/2018, 12:17:19 PM<br><strong>UnmergedRevision</strong>: [ae43d97768d6d1640d7607f8064b4fdd528d36c8](https://github.com/hyperledger-gerrit-archive/fabric/commit/ae43d97768d6d1640d7607f8064b4fdd528d36c8)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/2/2018, 12:22:28 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 8</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Uploader</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Created</strong>: 1/2/2018, 12:22:00 PM<br><strong>UnmergedRevision</strong>: [bc773cb45c77a8e10a9dc08421219a668f6d4875](https://github.com/hyperledger-gerrit-archive/fabric/commit/bc773cb45c77a8e10a9dc08421219a668f6d4875)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/4/2018, 1:01:08 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L124](https://github.com/hyperledger-gerrit-archive/fabric/blob/bc773cb45c77a8e10a9dc08421219a668f6d4875/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L124)<br><strong>Comment</strong>: <pre>Currently, collection DBs are named as follows: "namespace _ namespace / p collectionName" for privateData. However, we need "namespace _ p collectionName" as DB name. Replace "p" with "h" for hashedData. We cannot change common_storage_db.go to realize this as it is common for both level and couchdb. If the current naming convention used for collection DB is not good, we need to perform certain preprocessing in GetNamespaceDBHandle() to retrieve "p"/"h" and collectionName.  What should we do here?</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L124](https://github.com/hyperledger-gerrit-archive/fabric/blob/bc773cb45c77a8e10a9dc08421219a668f6d4875/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L124)<br><strong>Comment</strong>: <pre>I tried with $ as the namespace separator for private data, and it appears to work as expected now.  I get couchdb database names like:
mychannel_marbles$pcollectionmarbles
mychannel_marbles$hcollectionmarbles

I think this is fine...any remaining issue?</pre></blockquote><h3>PatchSet Number: 9</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Uploader</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Created</strong>: 1/4/2018, 7:27:06 AM<br><strong>UnmergedRevision</strong>: [066e250eba35014d013823ee08e4c28e880a513f](https://github.com/hyperledger-gerrit-archive/fabric/commit/066e250eba35014d013823ee08e4c28e880a513f)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/5/2018, 12:34:17 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/privacyenabledstate/common_storage_db.go#L21](https://github.com/hyperledger-gerrit-archive/fabric/blob/066e250eba35014d013823ee08e4c28e880a513f/core/ledger/kvledger/txmgmt/privacyenabledstate/common_storage_db.go#L21)<br><strong>Comment</strong>: <pre>Since chaincode names can have an underscore, we can't use underscore as the separator.
I have tried "/" but unfortunately I'm having issues between golang and couchdb due to the urlencoding of "/".
I have had success with using $ as the separator here.  I realize $ is also used for replacement of . in the channel name, but I think it is ok to use for both purposes since they are in different parts of the database name.  Note that if we go with $, it will have to be added to couchdbutil.go as a valid character in db name.</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/privacyenabledstate/common_storage_db.go#L21](https://github.com/hyperledger-gerrit-archive/fabric/blob/066e250eba35014d013823ee08e4c28e880a513f/core/ledger/kvledger/txmgmt/privacyenabledstate/common_storage_db.go#L21)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L124](https://github.com/hyperledger-gerrit-archive/fabric/blob/066e250eba35014d013823ee08e4c28e880a513f/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L124)<br><strong>Comment</strong>: <pre>Note that Fabric enforces channel names to be all lowercase.
But Fabric allows mixed case chaincode and collection names.  It is possible to have separate chaincodes called "mycc" and "MyCC".  CouchDB requires all lowercase.  

I discussed with Murali and we want to keep the Fabric rules as they are.  In order to guarantee no collisions between similar named chanicodes, I think we will have to somehow encode caps characters using an escape character followed by the lowercase character.

For this CR, I think you can simply do a strings.ToLower(namespace) so that we can merge and start testing sooner than later.  And add a TODO comment that the name lower casing will be handled more appropriately when we address the additional name mapping logic specified in FAB-7130.</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L124](https://github.com/hyperledger-gerrit-archive/fabric/blob/066e250eba35014d013823ee08e4c28e880a513f/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go#L124)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/util/couchdb/couchdbutil.go#L28](https://github.com/hyperledger-gerrit-archive/fabric/blob/066e250eba35014d013823ee08e4c28e880a513f/core/ledger/util/couchdb/couchdbutil.go#L28)<br><strong>Comment</strong>: <pre>Need to add $ here as well.

Let's call it expectedDatabaseNamePattern now, since it includes more than just Channel now.</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/ledger/util/couchdb/couchdbutil.go#L28](https://github.com/hyperledger-gerrit-archive/fabric/blob/066e250eba35014d013823ee08e4c28e880a513f/core/ledger/util/couchdb/couchdbutil.go#L28)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/util/couchdb/couchdbutil.go#L166](https://github.com/hyperledger-gerrit-archive/fabric/blob/066e250eba35014d013823ee08e4c28e880a513f/core/ledger/util/couchdb/couchdbutil.go#L166)<br><strong>Comment</strong>: <pre>$</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/ledger/util/couchdb/couchdbutil.go#L166](https://github.com/hyperledger-gerrit-archive/fabric/blob/066e250eba35014d013823ee08e4c28e880a513f/core/ledger/util/couchdb/couchdbutil.go#L166)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 10</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Uploader</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Created</strong>: 1/5/2018, 11:50:36 AM<br><strong>GitHubMergedRevision</strong>: [6cbebf4a3b7088f3b4647c4794b25dca79e20778](https://github.com/hyperledger-gerrit-archive/fabric/commit/6cbebf4a3b7088f3b4647c4794b25dca79e20778)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/5/2018, 1:09:12 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Approved</strong>: 1/5/2018, 3:58:25 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Manish Sethi<br><strong>Merged</strong>: 1/5/2018, 3:58:48 PM<br><br><strong>Approver</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Approved</strong>: 1/5/2018, 2:18:25 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br></blockquote>