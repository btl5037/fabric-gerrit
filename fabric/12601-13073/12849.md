<strong>Project</strong>: fabric<br><strong>Branch</strong>: master<br><strong>ID</strong>: 12849<br><strong>Subject</strong>: [FAB-5932] - Parallel tx validation<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Assignee</strong>:<br><strong>Created</strong>: 8/28/2017, 10:40:37 AM<br><strong>LastUpdated</strong>: 10/10/2017, 11:06:10 AM<br><strong>CommitMessage</strong>:<br><pre>[FAB-5932] - Parallel tx validation

This change-set introduces parallelism on the committer. In particular, tx
generic validation (e.g. well-formedness, signature checks) and VSCC validation
are conducted in parallel for all transactions inside a block. This change-set
scales the *validation* throughput with number of cores on the machine that
runs the peer.

Change-Id: I80c03bd713a30f3db56627c7ae8fcf6fdd0d7891
Signed-off-by: Alessandro Sorniotti <ale.linux@sopit.net>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 8/28/2017, 10:40:37 AM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/28/2017, 10:40:44 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/11809/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/28/2017, 10:43:03 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7743/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/28/2017, 10:44:09 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10191/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/28/2017, 10:45:09 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16177/ (4/4)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 8/28/2017, 11:57:15 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Dear reviewers, it's very hard to review this code change with the gerrit interface. I recommend you check it out, install meld (http://meldmerge.org/), set in the preferences that it should ignore  spaces/leading spaces and then look at it with

git difftool -d -t meld HEAD~1

That will show you a much more compact version of the changes, which aren't as large (there's a lot of code shuffling)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/28/2017, 11:58:19 AM<br><strong>Message</strong>: <pre>Patch Set 1: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7743/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7743/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/7743

https://jenkins.hyperledger.org/job/fabric-verify-z/11809/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/11809

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16177/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/16177

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10191/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/10191</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 8/28/2017, 12:02:32 PM<br><strong>Message</strong>: <pre>Patch Set 1:

rebuild-e2e</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/28/2017, 12:02:50 PM<br><strong>Message</strong>: <pre>Patch Set 1: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7754/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/28/2017, 12:31:11 PM<br><strong>Message</strong>: <pre>Patch Set 1: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7754/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7754/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/7754</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 8/28/2017, 3:55:37 PM<br><strong>Message</strong>: <pre>Patch Set 1:

rebuild-e2e</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/28/2017, 3:59:25 PM<br><strong>Message</strong>: <pre>Patch Set 1: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7774/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/28/2017, 4:35:45 PM<br><strong>Message</strong>: <pre>Patch Set 1: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7774/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7774/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/7774</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 8/29/2017, 2:40:34 AM<br><strong>Message</strong>: <pre>Patch Set 1:

rebuild-e2e</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/29/2017, 2:41:37 AM<br><strong>Message</strong>: <pre>Patch Set 1: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7790/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/29/2017, 3:06:49 AM<br><strong>Message</strong>: <pre>Patch Set 1: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7790/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7790/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/7790</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 8/29/2017, 4:53:53 AM<br><strong>Message</strong>: <pre>Uploaded patch set 2.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/29/2017, 4:54:04 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/11851/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/29/2017, 4:55:48 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16218/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/29/2017, 4:55:49 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7794/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/29/2017, 4:56:15 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10230/ (4/4)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 8/29/2017, 6:08:43 AM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/29/2017, 6:08:50 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/11857/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/29/2017, 6:09:51 AM<br><strong>Message</strong>: <pre>Patch Set 2: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16218/ : ABORTED

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16218/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/16218

https://jenkins.hyperledger.org/job/fabric-verify-z/11851/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-z/11851/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/11851

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7794/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7794/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/7794

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10230/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/10230</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/29/2017, 6:10:13 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16224/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/29/2017, 6:11:14 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7802/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/29/2017, 6:11:28 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10237/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/29/2017, 7:26:01 AM<br><strong>Message</strong>: <pre>Patch Set 3: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-z/11857/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/11857

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16224/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/16224

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7802/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/7802

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10237/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/10237</pre><strong>Reviewer</strong>: Marko Vukolic - mvu@zurich.ibm.com<br><strong>Reviewed</strong>: 8/29/2017, 8:31:08 AM<br><strong>Message</strong>: <pre>Patch Set 3:

(2 comments)

lgtm - minor comments around logger</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 8/29/2017, 9:53:00 AM<br><strong>Message</strong>: <pre>Uploaded patch set 4.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/29/2017, 9:53:08 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/11866/ (1/4)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 8/29/2017, 9:53:33 AM<br><strong>Message</strong>: <pre>Patch Set 4:

(2 comments)

Thanks, Marko, see below and new drop</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/29/2017, 9:54:26 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16233/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/29/2017, 9:54:51 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7813/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/29/2017, 9:55:14 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10246/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/29/2017, 11:19:42 AM<br><strong>Message</strong>: <pre>Patch Set 4: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-z/11866/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/11866

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16233/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/16233

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7813/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/7813

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10246/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/10246</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 8/29/2017, 6:37:38 PM<br><strong>Message</strong>: <pre>Patch Set 4:

(2 comments)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 8/30/2017, 2:40:22 AM<br><strong>Message</strong>: <pre>Patch Set 4:

(2 comments)

Thanks, Murali! See below</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 8/30/2017, 2:46:03 AM<br><strong>Message</strong>: <pre>Uploaded patch set 5.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/30/2017, 2:46:13 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/11925/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/30/2017, 2:47:38 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16291/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/30/2017, 2:48:13 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7870/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/30/2017, 2:48:41 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10301/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/30/2017, 4:18:50 AM<br><strong>Message</strong>: <pre>Patch Set 5: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-z/11925/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/11925

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16291/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/16291

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7870/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/7870

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10301/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/10301</pre><strong>Reviewer</strong>: Marko Vukolic - mvu@zurich.ibm.com<br><strong>Reviewed</strong>: 8/30/2017, 6:01:13 AM<br><strong>Message</strong>: <pre>Patch Set 5: Code-Review+1</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 8/30/2017, 8:14:32 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Honestly, I didn't pay attention to when NewTxValidator was called ... basically assumed the object for created for every commt. Given that its once per channel create I agree my comments are invalid.

Let me take another look soon please.</pre><strong>Reviewer</strong>: Marko Vukolic - mvu@zurich.ibm.com<br><strong>Reviewed</strong>: 8/30/2017, 8:23:31 AM<br><strong>Message</strong>: <pre>Patch Set 5:

(1 comment)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 8/30/2017, 8:33:48 AM<br><strong>Message</strong>: <pre>Patch Set 5:

(1 comment)

@Murali: thx, sure!

@Marko: thx, see below.</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 8/31/2017, 9:44:43 AM<br><strong>Message</strong>: <pre>Uploaded patch set 6.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/31/2017, 9:44:53 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/11988/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/31/2017, 9:46:50 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16346/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/31/2017, 9:47:07 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7927/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/31/2017, 9:47:32 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10358/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/31/2017, 10:17:47 AM<br><strong>Message</strong>: <pre>Patch Set 6: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-z/11988/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-z/11988/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/11988

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16346/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16346/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/16346

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7927/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/7927

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10358/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/10358</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 8/31/2017, 10:23:40 AM<br><strong>Message</strong>: <pre>Patch Set 6:

13:51:28 LINT: Running code checks..
13:51:29 Checking ./bccsp
13:51:30 Checking ./common
13:51:33 The following files contain goimports errors
13:51:33 common/workers/worker.go common/workers/workers_test.go
13:51:33 The goimports command must be run for these files
13:51:34 Makefile:184: recipe for target 'linter' failed
13:51:34 make: *** [linter] Error 1

Can you take care of the goimports errors Ale ?</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 8/31/2017, 10:38:00 AM<br><strong>Message</strong>: <pre>Uploaded patch set 7.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/31/2017, 10:38:10 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/11993/ (1/4)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 8/31/2017, 10:38:36 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Thx Murali, done!</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/31/2017, 10:39:40 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16351/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/31/2017, 10:39:42 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7933/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/31/2017, 10:40:03 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10363/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/31/2017, 11:58:16 AM<br><strong>Message</strong>: <pre>Patch Set 7: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-z/11993/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/11993

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16351/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/16351

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7933/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/7933

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10363/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/10363</pre><strong>Reviewer</strong>: Marko Vukolic - mvu@zurich.ibm.com<br><strong>Reviewed</strong>: 9/1/2017, 4:17:51 AM<br><strong>Message</strong>: <pre>Patch Set 7:

(1 comment)

Practical experiment results suggest that there is no benefit in overprovisioning the cores wrt number of workers, i.e., that runtime.NumCPU() workers for the pool is sufficient.</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 9/1/2017, 6:11:16 AM<br><strong>Message</strong>: <pre>Uploaded patch set 8.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/1/2017, 6:11:24 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/12020/ (1/4)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 9/1/2017, 6:12:32 AM<br><strong>Message</strong>: <pre>Patch Set 7:

(1 comment)

Thanks, Marko. I've changed the commit message to reflect more clearly what this change-set achieves and set the default number of workers to NCPU.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/1/2017, 6:12:47 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16378/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/1/2017, 6:13:08 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7962/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/1/2017, 6:13:44 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10390/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/1/2017, 7:28:31 AM<br><strong>Message</strong>: <pre>Patch Set 8: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-z/12020/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/12020

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16378/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/16378

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7962/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/7962

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10390/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/10390</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 9/3/2017, 2:57:11 PM<br><strong>Message</strong>: <pre>Patch Set 8:

(1 comment)</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 9/10/2017, 12:47:32 AM<br><strong>Message</strong>: <pre>Patch Set 8:

(1 comment)</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 9/16/2017, 6:45:31 AM<br><strong>Message</strong>: <pre>Patch Set 8:

(2 comments)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 9/21/2017, 12:35:00 PM<br><strong>Message</strong>: <pre>Patch Set 8:

(4 comments)

Thanks Jason, Murali and Gari. Pls see the new drop addressing your comments</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 9/21/2017, 12:36:27 PM<br><strong>Message</strong>: <pre>Uploaded patch set 9.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/21/2017, 12:36:58 PM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/17159/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/21/2017, 12:36:59 PM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/12809/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/21/2017, 12:36:59 PM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/11171/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/21/2017, 12:40:31 PM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/8744/ (4/4)</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 9/21/2017, 12:49:09 PM<br><strong>Message</strong>: <pre>Patch Set 9:

(1 comment)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/21/2017, 2:03:46 PM<br><strong>Message</strong>: <pre>Patch Set 9: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-z/12809/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-z/12809/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/12809

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/17159/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/17159

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/11171/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/11171

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/8744/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/8744</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 9/21/2017, 2:26:38 PM<br><strong>Message</strong>: <pre>Patch Set 9:

rebuild-z</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/21/2017, 2:26:48 PM<br><strong>Message</strong>: <pre>Patch Set 9: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/12810/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/21/2017, 3:15:20 PM<br><strong>Message</strong>: <pre>Patch Set 9: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-z/12810/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/12810</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 9/22/2017, 6:10:55 AM<br><strong>Message</strong>: <pre>Uploaded patch set 10.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/22/2017, 6:11:03 AM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/12842/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/22/2017, 6:12:43 AM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/17186/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/22/2017, 6:13:08 AM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/11196/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/22/2017, 6:13:11 AM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/8768/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/22/2017, 7:42:01 AM<br><strong>Message</strong>: <pre>Patch Set 10: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-z/12842/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/12842

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/17186/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/17186

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/11196/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/11196

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/8768/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/8768</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 9/25/2017, 11:20:03 AM<br><strong>Message</strong>: <pre>Uploaded patch set 11.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/25/2017, 11:20:11 AM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/12901/ (1/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/25/2017, 11:21:46 AM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/17241/ (2/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/25/2017, 11:22:24 AM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/11251/ (3/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/25/2017, 11:22:53 AM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/8822/ (4/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/25/2017, 11:23:16 AM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/22/ (5/5)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 9/25/2017, 11:39:30 AM<br><strong>Message</strong>: <pre>Uploaded patch set 12: Patch Set 11 was rebased.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/25/2017, 11:39:41 AM<br><strong>Message</strong>: <pre>Patch Set 12:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/12906/ (1/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/25/2017, 11:41:40 AM<br><strong>Message</strong>: <pre>Patch Set 11: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/8822/ : ABORTED

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/8822/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/8822

https://jenkins.hyperledger.org/job/fabric-verify-z/12901/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-z/12901/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/12901

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/17241/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/17241/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/17241

https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/22/ : FAILURE (skipped)

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/22/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-two-staged-ci-check-x86_64/22

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/11251/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/11251</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/25/2017, 11:41:48 AM<br><strong>Message</strong>: <pre>Patch Set 12:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/17246/ (2/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/25/2017, 11:42:19 AM<br><strong>Message</strong>: <pre>Patch Set 12:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/11256/ (3/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/25/2017, 11:42:36 AM<br><strong>Message</strong>: <pre>Patch Set 12:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/8827/ (4/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/25/2017, 11:47:51 AM<br><strong>Message</strong>: <pre>Patch Set 12:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/27/ (5/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/25/2017, 12:34:21 PM<br><strong>Message</strong>: <pre>Patch Set 12: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/17246/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/17246/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/17246

https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/27/ : FAILURE (skipped)

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/27/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-two-staged-ci-check-x86_64/27

https://jenkins.hyperledger.org/job/fabric-verify-z/12906/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/12906

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/11256/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/11256

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/8827/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/8827</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 9/25/2017, 2:08:08 PM<br><strong>Message</strong>: <pre>Patch Set 12:

CI failure worth looking into, Manish ?

16:33:10 unit-tests_1  | 2017-09-25 16:33:09.814 UTC [pvtdatastorage] Prepare -> DEBU 036 Adding private data to batch blockNum=9, tranNum=0
16:33:10 unit-tests_1  | panic: Could not truncate current file to known size after an error during block append: write /tmp/fabric/core/ledger/ledgerstorage/ledgersData/chains/chains/testLedger/blockfile_000000: file already closed
16:33:10 unit-tests_1  | 
16:33:10 unit-tests_1  | goroutine 10 [running]:
16:33:10 unit-tests_1  | github.com/hyperledger/fabric/common/ledger/blkstorage/fsblkstorage.(*blockfileMgr).addBlock(0xc420162600, 0xc420d8b7a0, 0x2, 0xc42017d580)
16:33:10 unit-tests_1  | 	/opt/gopath/src/github.com/hyperledger/fabric/common/ledger/blkstorage/fsblkstorage/blockfile_mgr.go:278 +0xb46
16:33:10 unit-tests_1  | github.com/hyperledger/fabric/common/ledger/blkstorage/fsblkstorage.(*fsBlockStore).AddBlock(0xc420126e60, 0xc420d8b7a0, 0xc42002bf20, 0xc42002bf10)
16:33:10 unit-tests_1  | 	/opt/gopath/src/github.com/hyperledger/fabric/common/ledger/blkstorage/fsblkstorage/fs_blockstore.go:43 +0x39
16:33:10 unit-tests_1  | github.com/hyperledger/fabric/core/ledger/ledgerstorage.(*slowBlockStore).AddBlock(0xc420126f20, 0xc420d8b7a0, 0x0, 0x0)
16:33:10 unit-tests_1  | 	/opt/gopath/src/github.com/hyperledger/fabric/core/ledger/ledgerstorage/store_test.go:259 +0x4f
16:33:10 unit-tests_1  | github.com/hyperledger/fabric/core/ledger/ledgerstorage.(*Store).CommitWithPvtData(0xc42017e840, 0xc420d7e1c0, 0x0, 0x0)
16:33:10 unit-tests_1  | 	github.com/hyperledger/fabric/core/ledger/ledgerstorage/_test/_obj_test/store.go:92 +0x248
16:33:10 unit-tests_1  | github.com/hyperledger/fabric/core/ledger/ledgerstorage.TestStoreConcurrentReadWrite.func1(0xc420156680, 0xa, 0x10, 0xc42017e840)
16:33:10 unit-tests_1  | 	/opt/gopath/src/github.com/hyperledger/fabric/core/ledger/ledgerstorage/store_test.go:64 +0x80
16:33:10 unit-tests_1  | created by github.com/hyperledger/fabric/core/ledger/ledgerstorage.TestStoreConcurrentReadWrite
16:33:10 unit-tests_1  | 	/opt/gopath/src/github.com/hyperledger/fabric/core/ledger/ledgerstorage/store_test.go:60 +0x260
16:33:10 unit-tests_1  | FAIL	github.com/hyperledger/fabric/core/ledger/ledgerstorage	3.184s
16:33:10 unit-tests_1  | error: exit status 1
16:33:10 unit-tests_1  | panic: EOF
16:33:10 unit-tests_1  | 
16:33:10 unit-tests_1  | goroutine 1 [running]:
16:33:10 unit-tests_1  | main.main()
16:33:10 unit-tests_1  | 	/opt/gotools/obj/gopath/src/github.com/AlekSi/gocov-xml/gocov-xml.go:60 +0x14a4</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 9/25/2017, 2:36:44 PM<br><strong>Message</strong>: <pre>Patch Set 12:

> Patch Set 12:
> 
> CI failure worth looking into, Manish ?
> 
> 16:33:10 unit-tests_1  | 2017-09-25 16:33:09.814 UTC [pvtdatastorage] Prepare -> DEBU 036 Adding private data to batch blockNum=9, tranNum=0
> 16:33:10 unit-tests_1  | panic: Could not truncate current file to known size after an error during block append: write /tmp/fabric/core/ledger/ledgerstorage/ledgersData/chains/chains/testLedger/blockfile_000000: file already closed
> 16:33:10 unit-tests_1  | 
> 16:33:10 unit-tests_1  | goroutine 10 [running]:
> 16:33:10 unit-tests_1  | github.com/hyperledger/fabric/common/ledger/blkstorage/fsblkstorage.(*blockfileMgr).addBlock(0xc420162600, 0xc420d8b7a0, 0x2, 0xc42017d580)
> 16:33:10 unit-tests_1  | 	/opt/gopath/src/github.com/hyperledger/fabric/common/ledger/blkstorage/fsblkstorage/blockfile_mgr.go:278 +0xb46
> 16:33:10 unit-tests_1  | github.com/hyperledger/fabric/common/ledger/blkstorage/fsblkstorage.(*fsBlockStore).AddBlock(0xc420126e60, 0xc420d8b7a0, 0xc42002bf20, 0xc42002bf10)
> 16:33:10 unit-tests_1  | 	/opt/gopath/src/github.com/hyperledger/fabric/common/ledger/blkstorage/fsblkstorage/fs_blockstore.go:43 +0x39
> 16:33:10 unit-tests_1  | github.com/hyperledger/fabric/core/ledger/ledgerstorage.(*slowBlockStore).AddBlock(0xc420126f20, 0xc420d8b7a0, 0x0, 0x0)
> 16:33:10 unit-tests_1  | 	/opt/gopath/src/github.com/hyperledger/fabric/core/ledger/ledgerstorage/store_test.go:259 +0x4f
> 16:33:10 unit-tests_1  | github.com/hyperledger/fabric/core/ledger/ledgerstorage.(*Store).CommitWithPvtData(0xc42017e840, 0xc420d7e1c0, 0x0, 0x0)
> 16:33:10 unit-tests_1  | 	github.com/hyperledger/fabric/core/ledger/ledgerstorage/_test/_obj_test/store.go:92 +0x248
> 16:33:10 unit-tests_1  | github.com/hyperledger/fabric/core/ledger/ledgerstorage.TestStoreConcurrentReadWrite.func1(0xc420156680, 0xa, 0x10, 0xc42017e840)
> 16:33:10 unit-tests_1  | 	/opt/gopath/src/github.com/hyperledger/fabric/core/ledger/ledgerstorage/store_test.go:64 +0x80
> 16:33:10 unit-tests_1  | created by github.com/hyperledger/fabric/core/ledger/ledgerstorage.TestStoreConcurrentReadWrite
> 16:33:10 unit-tests_1  | 	/opt/gopath/src/github.com/hyperledger/fabric/core/ledger/ledgerstorage/store_test.go:60 +0x260
> 16:33:10 unit-tests_1  | FAIL	github.com/hyperledger/fabric/core/ledger/ledgerstorage	3.184s
> 16:33:10 unit-tests_1  | error: exit status 1
> 16:33:10 unit-tests_1  | panic: EOF
> 16:33:10 unit-tests_1  | 
> 16:33:10 unit-tests_1  | goroutine 1 [running]:
> 16:33:10 unit-tests_1  | main.main()
> 16:33:10 unit-tests_1  | 	/opt/gotools/obj/gopath/src/github.com/AlekSi/gocov-xml/gocov-xml.go:60 +0x14a4

Yacov, following is what appears to me to cause this. Can you check if this could be the cause.
In your recent test in the store_test.go (TestStoreConcurrentReadWrite), you do not wait for the writes to finish and exit from the 'test' routine. The exit 
from the test routine would close and cleanup the ledger - this would cause a panic in the ongoing writing routine.</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 9/25/2017, 3:01:16 PM<br><strong>Message</strong>: <pre>Patch Set 12:

oops... Fix is in https://gerrit.hyperledger.org/r/#/c/13815/</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 9/25/2017, 4:25:53 PM<br><strong>Message</strong>: <pre>Uploaded patch set 13.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/25/2017, 4:25:59 PM<br><strong>Message</strong>: <pre>Patch Set 13:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/12928/ (1/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/25/2017, 4:27:19 PM<br><strong>Message</strong>: <pre>Patch Set 13:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/17267/ (2/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/25/2017, 4:27:44 PM<br><strong>Message</strong>: <pre>Patch Set 13:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/11276/ (3/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/25/2017, 4:28:08 PM<br><strong>Message</strong>: <pre>Patch Set 13:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/8847/ (4/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/25/2017, 4:28:09 PM<br><strong>Message</strong>: <pre>Patch Set 13:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/48/ (5/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/25/2017, 5:48:57 PM<br><strong>Message</strong>: <pre>Patch Set 13: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-z/12928/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/12928

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/17267/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/17267

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/11276/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/11276

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/8847/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/8847

https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/48/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-two-staged-ci-check-x86_64/48</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 9/28/2017, 7:39:10 PM<br><strong>Message</strong>: <pre>Patch Set 8:

(2 comments)</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 9/29/2017, 12:44:44 PM<br><strong>Message</strong>: <pre>Patch Set 13:

(1 comment)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 9/29/2017, 2:19:15 PM<br><strong>Message</strong>: <pre>Patch Set 13:

(1 comment)

Thanks, Jason, see below.</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 9/30/2017, 7:41:25 AM<br><strong>Message</strong>: <pre>Patch Set 13:

(2 comments)</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 9/30/2017, 7:42:17 AM<br><strong>Message</strong>: <pre>Patch Set 13:

(1 comment)</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 9/30/2017, 5:14:16 PM<br><strong>Message</strong>: <pre>Patch Set 13: Code-Review-1

(2 comments)</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 9/30/2017, 5:22:40 PM<br><strong>Message</strong>: <pre>Patch Set 13:

(1 comment)</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 9/30/2017, 7:20:17 PM<br><strong>Message</strong>: <pre>Patch Set 13:

(1 comment)</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 10/1/2017, 12:13:01 AM<br><strong>Message</strong>: <pre>Patch Set 13:

(1 comment)</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 10/1/2017, 9:25:00 PM<br><strong>Message</strong>: <pre>Patch Set 13:

(1 comment)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 10/2/2017, 9:11:34 AM<br><strong>Message</strong>: <pre>Uploaded patch set 14.</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 10/2/2017, 9:11:42 AM<br><strong>Message</strong>: <pre>Patch Set 13:

(7 comments)

Thx, see below + new drop</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/2/2017, 9:11:43 AM<br><strong>Message</strong>: <pre>Patch Set 14:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/13145/ (1/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/2/2017, 9:13:33 AM<br><strong>Message</strong>: <pre>Patch Set 14:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/17476/ (2/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/2/2017, 9:13:34 AM<br><strong>Message</strong>: <pre>Patch Set 14:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/9046/ (3/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/2/2017, 9:14:33 AM<br><strong>Message</strong>: <pre>Patch Set 14:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/11475/ (5/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/2/2017, 9:14:33 AM<br><strong>Message</strong>: <pre>Patch Set 14:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/238/ (4/5)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 10/2/2017, 9:18:29 AM<br><strong>Message</strong>: <pre>Patch Set 13:

(1 comment)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/2/2017, 10:23:17 AM<br><strong>Message</strong>: <pre>Patch Set 14: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/17476/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/17476

https://jenkins.hyperledger.org/job/fabric-verify-z/13145/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/13145

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/9046/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/9046

https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/238/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-two-staged-ci-check-x86_64/238

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/11475/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/11475</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 10/2/2017, 11:57:13 AM<br><strong>Message</strong>: <pre>Patch Set 14:

This will most likely need to be rebased given the fate of the changeset it's stacked against. Regardless of that though, can we please add a review entrypoint? What is the proposed file/method for reviewers to begin with?

(This is a practice that I'd like us to adopt for changesets rippling through many files. I am not as well-versed in this code path as I'd like to be, and I could probably figure out what's going on after a while, but providing a pointer would be a good habit to form nonetheless.)</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 10/3/2017, 5:37:50 PM<br><strong>Message</strong>: <pre>Patch Set 14:

(4 comments)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 10/6/2017, 7:44:16 AM<br><strong>Message</strong>: <pre>Uploaded patch set 15.</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 10/6/2017, 7:44:24 AM<br><strong>Message</strong>: <pre>Patch Set 14:

(4 comments)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/6/2017, 7:44:25 AM<br><strong>Message</strong>: <pre>Patch Set 15:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/13335/ (1/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/6/2017, 7:45:48 AM<br><strong>Message</strong>: <pre>Patch Set 15:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/9221/ (2/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/6/2017, 7:46:28 AM<br><strong>Message</strong>: <pre>Patch Set 15:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/17654/ (3/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/6/2017, 7:47:04 AM<br><strong>Message</strong>: <pre>Patch Set 15:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/398/ (4/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/6/2017, 7:49:52 AM<br><strong>Message</strong>: <pre>Patch Set 15:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/11649/ (5/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/6/2017, 8:56:03 AM<br><strong>Message</strong>: <pre>Patch Set 15: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/398/ : FAILURE (skipped)

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/398/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-two-staged-ci-check-x86_64/398

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/9221/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/9221

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/17654/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/17654

https://jenkins.hyperledger.org/job/fabric-verify-z/13335/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/13335

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/11649/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/11649</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 10/6/2017, 10:13:00 AM<br><strong>Message</strong>: <pre>Patch Set 15:

(1 comment)</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 10/6/2017, 4:45:07 PM<br><strong>Message</strong>: <pre>Patch Set 15:

(4 comments)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 10/7/2017, 7:36:43 AM<br><strong>Message</strong>: <pre>Patch Set 15:

(5 comments)</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 10/7/2017, 7:41:33 AM<br><strong>Message</strong>: <pre>Patch Set 15:

(1 comment)</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 10/7/2017, 8:13:10 AM<br><strong>Message</strong>: <pre>Patch Set 15:

(3 comments)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 10/7/2017, 8:30:22 AM<br><strong>Message</strong>: <pre>Patch Set 15:

(2 comments)</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 10/7/2017, 8:52:33 AM<br><strong>Message</strong>: <pre>Patch Set 15:

(1 comment)</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 10/7/2017, 8:53:36 AM<br><strong>Message</strong>: <pre>Patch Set 15:

(1 comment)</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 10/7/2017, 9:04:00 AM<br><strong>Message</strong>: <pre>Patch Set 15:

(1 comment)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 10/7/2017, 9:11:01 AM<br><strong>Message</strong>: <pre>Uploaded patch set 16.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/7/2017, 9:11:12 AM<br><strong>Message</strong>: <pre>Patch Set 16:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/13372/ (1/5)</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 10/7/2017, 9:12:22 AM<br><strong>Message</strong>: <pre>Patch Set 16:

(1 comment)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/7/2017, 9:12:42 AM<br><strong>Message</strong>: <pre>Patch Set 16:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/9252/ (2/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/7/2017, 9:12:56 AM<br><strong>Message</strong>: <pre>Patch Set 16:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/17685/ (3/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/7/2017, 9:13:50 AM<br><strong>Message</strong>: <pre>Patch Set 16:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/11679/ (5/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/7/2017, 9:13:50 AM<br><strong>Message</strong>: <pre>Patch Set 16:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/429/ (4/5)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 10/7/2017, 9:16:15 AM<br><strong>Message</strong>: <pre>Patch Set 16:

(2 comments)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/7/2017, 10:21:58 AM<br><strong>Message</strong>: <pre>Patch Set 16: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/429/ : FAILURE (skipped)

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/429/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-two-staged-ci-check-x86_64/429

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/9252/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/9252

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/17685/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/17685

https://jenkins.hyperledger.org/job/fabric-verify-z/13372/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/13372

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/11679/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/11679</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 10/8/2017, 3:43:59 PM<br><strong>Message</strong>: <pre>Patch Set 16:

(4 comments)

My conclusion from CRing this and comparing to the original file is that the golang compiler should not be able to let developers write functions which are more than... 70 or so lines long. 

See a few lines below which don't look to me as they were in the original logic.</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 10/8/2017, 3:54:01 PM<br><strong>Message</strong>: <pre>Uploaded patch set 17.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/8/2017, 3:54:12 PM<br><strong>Message</strong>: <pre>Patch Set 17:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/13411/ (1/5)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 10/8/2017, 3:54:43 PM<br><strong>Message</strong>: <pre>Patch Set 16:

(4 comments)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/8/2017, 3:55:27 PM<br><strong>Message</strong>: <pre>Patch Set 17:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/9288/ (2/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/8/2017, 3:56:03 PM<br><strong>Message</strong>: <pre>Patch Set 17:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/17722/ (3/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/8/2017, 3:56:21 PM<br><strong>Message</strong>: <pre>Patch Set 17:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/462/ (4/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/8/2017, 3:57:36 PM<br><strong>Message</strong>: <pre>Patch Set 17:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/11715/ (5/5)</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 10/8/2017, 4:06:01 PM<br><strong>Message</strong>: <pre>Patch Set 17: Code-Review+2</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/8/2017, 5:07:33 PM<br><strong>Message</strong>: <pre>Patch Set 17: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/462/ : FAILURE (skipped)

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/462/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-two-staged-ci-check-x86_64/462

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/9288/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/9288

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/17722/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/17722

https://jenkins.hyperledger.org/job/fabric-verify-z/13411/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/13411

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/11715/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/11715</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 10/9/2017, 9:56:44 AM<br><strong>Message</strong>: <pre>Patch Set 17: Code-Review-1

(2 comments)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 10/9/2017, 11:58:51 AM<br><strong>Message</strong>: <pre>Uploaded patch set 18.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/9/2017, 11:59:00 AM<br><strong>Message</strong>: <pre>Patch Set 18:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/13437/ (1/5)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 10/9/2017, 11:59:13 AM<br><strong>Message</strong>: <pre>Patch Set 17:

(2 comments)

Thanks, Jason. See below</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/9/2017, 12:00:35 PM<br><strong>Message</strong>: <pre>Patch Set 18:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/9311/ (2/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/9/2017, 12:00:54 PM<br><strong>Message</strong>: <pre>Patch Set 18:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/17748/ (3/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/9/2017, 12:01:35 PM<br><strong>Message</strong>: <pre>Patch Set 18:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/480/ (4/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/9/2017, 12:04:14 PM<br><strong>Message</strong>: <pre>Patch Set 18:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/11741/ (5/5)</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 10/9/2017, 12:08:23 PM<br><strong>Message</strong>: <pre>Patch Set 18: Code-Review-1

(3 comments)

One notable comment regarding a potential deadlock.

Otherwise, I suspect I am mostly commenting against code which you did not necessarily originally write, but the depth of the 'if/else' statements gets to be rather challenging to read.  I always advocate a 'return early, return often' approach, and I think this validation code could benefit greatly from it.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/9/2017, 1:22:54 PM<br><strong>Message</strong>: <pre>Patch Set 18: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/480/ : FAILURE (skipped)

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/480/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-two-staged-ci-check-x86_64/480

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/9311/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/9311

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/17748/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/17748

https://jenkins.hyperledger.org/job/fabric-verify-z/13437/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/13437

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/11741/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/11741</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 10/9/2017, 2:05:05 PM<br><strong>Message</strong>: <pre>Uploaded patch set 19.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/9/2017, 2:05:13 PM<br><strong>Message</strong>: <pre>Patch Set 19:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/13440/ (1/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/9/2017, 2:06:25 PM<br><strong>Message</strong>: <pre>Patch Set 19:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/9312/ (2/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/9/2017, 2:07:03 PM<br><strong>Message</strong>: <pre>Patch Set 19:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/17749/ (3/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/9/2017, 2:07:43 PM<br><strong>Message</strong>: <pre>Patch Set 19:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/481/ (4/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/9/2017, 2:07:57 PM<br><strong>Message</strong>: <pre>Patch Set 19:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/11742/ (5/5)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 10/9/2017, 2:12:13 PM<br><strong>Message</strong>: <pre>Patch Set 19:

(3 comments)</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 10/9/2017, 2:47:20 PM<br><strong>Message</strong>: <pre>Patch Set 18:

(1 comment)</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 10/9/2017, 3:04:22 PM<br><strong>Message</strong>: <pre>Patch Set 18:

(3 comments)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 10/9/2017, 3:05:36 PM<br><strong>Message</strong>: <pre>Patch Set 19:

(1 comment)</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 10/9/2017, 3:13:00 PM<br><strong>Message</strong>: <pre>Patch Set 18:

(1 comment)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/9/2017, 3:26:20 PM<br><strong>Message</strong>: <pre>Patch Set 19: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/481/ : FAILURE (skipped)

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/481/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-two-staged-ci-check-x86_64/481

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/9312/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/9312

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/17749/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/17749

https://jenkins.hyperledger.org/job/fabric-verify-z/13440/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/13440

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/11742/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/11742</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 10/9/2017, 3:43:19 PM<br><strong>Message</strong>: <pre>Patch Set 19:

(1 comment)</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 10/9/2017, 3:58:17 PM<br><strong>Message</strong>: <pre>Patch Set 19: Code-Review+2</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 10/9/2017, 4:19:15 PM<br><strong>Message</strong>: <pre>Patch Set 19: Code-Review+1

just to get some more eyes from everyone else who chimed in</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 10/9/2017, 4:23:11 PM<br><strong>Message</strong>: <pre>Patch Set 19: Code-Review+2</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 10/9/2017, 4:40:19 PM<br><strong>Message</strong>: <pre>Patch Set 19: Code-Review+2

(Can’t wait to see this refactored.)</pre><strong>Reviewer</strong>: Greg Haskins - gregory.haskins@gmail.com<br><strong>Reviewed</strong>: 10/9/2017, 4:45:15 PM<br><strong>Message</strong>: <pre>Patch Set 19:

(4 comments)

Much better, thank you for your patience.  Some comments/questions inline</pre><strong>Reviewer</strong>: Greg Haskins - gregory.haskins@gmail.com<br><strong>Reviewed</strong>: 10/9/2017, 5:17:18 PM<br><strong>Message</strong>: <pre>Patch Set 19:

(3 comments)</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 10/9/2017, 5:22:59 PM<br><strong>Message</strong>: <pre>Patch Set 19:

(1 comment)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 10/10/2017, 3:53:52 AM<br><strong>Message</strong>: <pre>Patch Set 19:

(5 comments)</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 10/10/2017, 6:07:46 AM<br><strong>Message</strong>: <pre>Patch Set 19: Code-Review+2</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 10/10/2017, 9:43:02 AM<br><strong>Message</strong>: <pre>Patch Set 19:

(1 comment)</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 10/10/2017, 9:53:48 AM<br><strong>Message</strong>: <pre>Patch Set 19:

Given Jason's comments and four +2, I will merge.</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 10/10/2017, 9:54:00 AM<br><strong>Message</strong>: <pre>Change has been successfully merged by David Enyeart</pre><strong>Reviewer</strong>: Greg Haskins - gregory.haskins@gmail.com<br><strong>Reviewed</strong>: 10/10/2017, 11:06:10 AM<br><strong>Message</strong>: <pre>Patch Set 19: Code-Review+2

(1 comment)

> Patch Set 19:
> 
> (1 comment)</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 8/28/2017, 10:40:37 AM<br><strong>UnmergedRevision</strong>: [68a782334320f06749cb4894549fa98d29b6555b](https://github.com/hyperledger-gerrit-archive/fabric/commit/68a782334320f06749cb4894549fa98d29b6555b)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/29/2017, 3:06:49 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 8/29/2017, 4:53:53 AM<br><strong>UnmergedRevision</strong>: [42a426f7e21d5f8ce644abdcb705835b310310a1](https://github.com/hyperledger-gerrit-archive/fabric/commit/42a426f7e21d5f8ce644abdcb705835b310310a1)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/29/2017, 6:09:51 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 8/29/2017, 6:08:43 AM<br><strong>UnmergedRevision</strong>: [af020243fc7c36d1f79336f6fc994e37d573f971](https://github.com/hyperledger-gerrit-archive/fabric/commit/af020243fc7c36d1f79336f6fc994e37d573f971)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/29/2017, 7:26:01 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Marko Vukolic - mvu@zurich.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/worker.go#L61](https://github.com/hyperledger-gerrit-archive/fabric/blob/af020243fc7c36d1f79336f6fc994e37d573f971/core/committer/txvalidator/worker.go#L61)<br><strong>Comment</strong>: <pre>This does not log any tx metadata so makes the logger just chatty. Add some relevant tx metadata that we may want to debug.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/committer/txvalidator/worker.go#L61](https://github.com/hyperledger-gerrit-archive/fabric/blob/af020243fc7c36d1f79336f6fc994e37d573f971/core/committer/txvalidator/worker.go#L61)<br><strong>Comment</strong>: <pre>Tx, done</pre><strong>Commenter</strong>: Marko Vukolic - mvu@zurich.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/worker.go#L63](https://github.com/hyperledger-gerrit-archive/fabric/blob/af020243fc7c36d1f79336f6fc994e37d573f971/core/committer/txvalidator/worker.go#L63)<br><strong>Comment</strong>: <pre>same as above</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/committer/txvalidator/worker.go#L63](https://github.com/hyperledger-gerrit-archive/fabric/blob/af020243fc7c36d1f79336f6fc994e37d573f971/core/committer/txvalidator/worker.go#L63)<br><strong>Comment</strong>: <pre>Tx, done</pre></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 8/29/2017, 9:53:00 AM<br><strong>UnmergedRevision</strong>: [04b1f565e589bff2e7a569d07ac6a623c575fc8c](https://github.com/hyperledger-gerrit-archive/fabric/commit/04b1f565e589bff2e7a569d07ac6a623c575fc8c)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/29/2017, 11:19:42 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L243](https://github.com/hyperledger-gerrit-archive/fabric/blob/04b1f565e589bff2e7a569d07ac6a623c575fc8c/core/committer/txvalidator/validator.go#L243)<br><strong>Comment</strong>: <pre>there's a benign race between workers starting (line 158) and this resizeReq. If the worker came late, it will be on the new channel and won't get the resizeReq.  But this is OK as all it means is some resizeReqs won't be picked up from oldWorkChannel.

In any case, feels a better approach would be to initialize the channels and start the go routines at line 250 just before beginning work ...and you wouldn't need resizeReq. Am I missing something ?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L243](https://github.com/hyperledger-gerrit-archive/fabric/blob/04b1f565e589bff2e7a569d07ac6a623c575fc8c/core/committer/txvalidator/validator.go#L243)<br><strong>Comment</strong>: <pre>> there's a benign race

I thought about it, but the race is practically impossible to hit because the goroutines are created at peer startup (or channel creation) whereas this line is hit only after gossip has delivered the first block, so there seems to be a healthy amount of time elapsing between the two. Wdyt?

> feels a better approach would be to initialize the channels and start the go routines at line 250

Actually an earlier version of this change set did exactly that, but then we realized that we were paying the overhead of starting the worker pool every time a block was received. Then we moved to this implementation where the worker pool is initialized once at peer startup (or channel creation). This way we save that overhead. Note also that in practice we'll only enter this if once or twice in the life of a peer, because we should zero in on the max # tx/block and never move away from that. Does this make sense?</pre><strong>Commenter</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/worker.go#L36](https://github.com/hyperledger-gerrit-archive/fabric/blob/04b1f565e589bff2e7a569d07ac6a623c575fc8c/core/committer/txvalidator/worker.go#L36)<br><strong>Comment</strong>: <pre>Maybe I'm missing something... but where does v.work get closed for line 48 to kick in ?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/committer/txvalidator/worker.go#L36](https://github.com/hyperledger-gerrit-archive/fabric/blob/04b1f565e589bff2e7a569d07ac6a623c575fc8c/core/committer/txvalidator/worker.go#L36)<br><strong>Comment</strong>: <pre>In practice, never. However I had to provide a default to that switch, and - given that I'm sending pointers on this channel - default means either a valid pointer of something unexpected (programming error, panic) or a nil pointer, which is a benign channel close.

I thought it would be clearer to spell this out, even though in practice it's unreachable code... wdyt?</pre></blockquote><h3>PatchSet Number: 5</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 8/30/2017, 2:46:03 AM<br><strong>UnmergedRevision</strong>: [5aa189df5c35d1f8374523080a26d9c517fc0f39](https://github.com/hyperledger-gerrit-archive/fabric/commit/5aa189df5c35d1f8374523080a26d9c517fc0f39)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/30/2017, 4:18:50 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Marko Vukolic - mvu@zurich.ibm.com<br><strong>Approved</strong>: 8/30/2017, 6:01:13 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Marko Vukolic - mvu@zurich.ibm.com<br><strong>CommentLine</strong>: [/COMMIT_MSG#L15](https://github.com/hyperledger-gerrit-archive/fabric/blob/5aa189df5c35d1f8374523080a26d9c517fc0f39//COMMIT_MSG#L15)<br><strong>Comment</strong>: <pre>Due to Amdahl's law and a sequential part of the committer code (ledger/MVCC) it is not correct to say that we improve throughput by a factor of n. I would simply say we scale the *validation* throughput with number of cores.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [/COMMIT_MSG#L15](https://github.com/hyperledger-gerrit-archive/fabric/blob/5aa189df5c35d1f8374523080a26d9c517fc0f39//COMMIT_MSG#L15)<br><strong>Comment</strong>: <pre>Good point, I'll amend the commit message - thx!</pre></blockquote><h3>PatchSet Number: 6</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 8/31/2017, 9:44:43 AM<br><strong>UnmergedRevision</strong>: [a5829ba1ad8455c010df23ce87f6e92ce24f849c](https://github.com/hyperledger-gerrit-archive/fabric/commit/a5829ba1ad8455c010df23ce87f6e92ce24f849c)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/31/2017, 10:17:47 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 7</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 8/31/2017, 10:38:00 AM<br><strong>UnmergedRevision</strong>: [b53eb4daf3aa093bf732795565a8f564ad1e8b64](https://github.com/hyperledger-gerrit-archive/fabric/commit/b53eb4daf3aa093bf732795565a8f564ad1e8b64)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/31/2017, 11:58:16 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Marko Vukolic - mvu@zurich.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L148](https://github.com/hyperledger-gerrit-archive/fabric/blob/b53eb4daf3aa093bf732795565a8f564ad1e8b64/core/committer/txvalidator/validator.go#L148)<br><strong>Comment</strong>: <pre>Practical experiments with this constant (done with 2, 4, 8 and 16-core peers)- varying it from the proposed here 128 exponentially downto 1 indicate that there is no significant benefit of having "128 * runtime.NumCPU()" here instead of simply "runtime.NumCPU()". So suggest to leave only "nWorkers = runtime.NumCPU()"</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L148](https://github.com/hyperledger-gerrit-archive/fabric/blob/b53eb4daf3aa093bf732795565a8f564ad1e8b64/core/committer/txvalidator/validator.go#L148)<br><strong>Comment</strong>: <pre>Thanks, Marko! Done (see next drop)</pre></blockquote><h3>PatchSet Number: 8</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 9/1/2017, 6:11:16 AM<br><strong>UnmergedRevision</strong>: [1b11fc39f37229e5f17b1cff57ab510ec19a982b](https://github.com/hyperledger-gerrit-archive/fabric/commit/1b11fc39f37229e5f17b1cff57ab510ec19a982b)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/1/2017, 7:28:31 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L145](https://github.com/hyperledger-gerrit-archive/fabric/blob/1b11fc39f37229e5f17b1cff57ab510ec19a982b/core/committer/txvalidator/validator.go#L145)<br><strong>Comment</strong>: <pre>This would need to exposed in core.yaml (is "nvalidators" expressive enough ?)</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L145](https://github.com/hyperledger-gerrit-archive/fabric/blob/1b11fc39f37229e5f17b1cff57ab510ec19a982b/core/committer/txvalidator/validator.go#L145)<br><strong>Comment</strong>: <pre>Good point, what name do you suggest?</pre><strong>Commenter</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L145](https://github.com/hyperledger-gerrit-archive/fabric/blob/1b11fc39f37229e5f17b1cff57ab510ec19a982b/core/committer/txvalidator/validator.go#L145)<br><strong>Comment</strong>: <pre>how about something like "txs_validator_pool_size" or "num_txs_validation_workers" ?</pre><strong>Commenter</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L151](https://github.com/hyperledger-gerrit-archive/fabric/blob/1b11fc39f37229e5f17b1cff57ab510ec19a982b/core/committer/txvalidator/validator.go#L151)<br><strong>Comment</strong>: <pre>How was this value determined?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L151](https://github.com/hyperledger-gerrit-archive/fabric/blob/1b11fc39f37229e5f17b1cff57ab510ec19a982b/core/committer/txvalidator/validator.go#L151)<br><strong>Comment</strong>: <pre>This argument is gone, I've simplified the workerpool implementation and this is no longer required</pre><strong>Commenter</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L151](https://github.com/hyperledger-gerrit-archive/fabric/blob/1b11fc39f37229e5f17b1cff57ab510ec19a982b/core/committer/txvalidator/validator.go#L151)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L219](https://github.com/hyperledger-gerrit-archive/fabric/blob/1b11fc39f37229e5f17b1cff57ab510ec19a982b/core/committer/txvalidator/validator.go#L219)<br><strong>Comment</strong>: <pre>Not sure if it's worth the optimization, but, the channel config does contain the max message count for a block which may be queried.  In order to prevent conflicts, you would also probably want to verify that the block does not contain more messages than the max message count.  Maybe this is more complexity than it is worth though.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L219](https://github.com/hyperledger-gerrit-archive/fabric/blob/1b11fc39f37229e5f17b1cff57ab510ec19a982b/core/committer/txvalidator/validator.go#L219)<br><strong>Comment</strong>: <pre>Thx Jason. This block of code is actually gone now because of the workerpool simplification.</pre><strong>Commenter</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L247](https://github.com/hyperledger-gerrit-archive/fabric/blob/1b11fc39f37229e5f17b1cff57ab510ec19a982b/core/committer/txvalidator/validator.go#L247)<br><strong>Comment</strong>: <pre>order</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L247](https://github.com/hyperledger-gerrit-archive/fabric/blob/1b11fc39f37229e5f17b1cff57ab510ec19a982b/core/committer/txvalidator/validator.go#L247)<br><strong>Comment</strong>: <pre>HA! Freudian kind of typo :D</pre><strong>Commenter</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L247](https://github.com/hyperledger-gerrit-archive/fabric/blob/1b11fc39f37229e5f17b1cff57ab510ec19a982b/core/committer/txvalidator/validator.go#L247)<br><strong>Comment</strong>: <pre>:-)</pre></blockquote><h3>PatchSet Number: 9</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 9/21/2017, 12:36:27 PM<br><strong>UnmergedRevision</strong>: [412b9093ce740839f8ecd18c380681ac81c6d6ee](https://github.com/hyperledger-gerrit-archive/fabric/commit/412b9093ce740839f8ecd18c380681ac81c6d6ee)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/21/2017, 3:15:20 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 10</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 9/22/2017, 6:10:55 AM<br><strong>UnmergedRevision</strong>: [9548fe47d462349168327d3deaabd6ff07f8b678](https://github.com/hyperledger-gerrit-archive/fabric/commit/9548fe47d462349168327d3deaabd6ff07f8b678)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/22/2017, 7:42:01 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 11</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 9/25/2017, 11:20:03 AM<br><strong>UnmergedRevision</strong>: [254c10572849e8167de0012ace20d585aa8b4c76](https://github.com/hyperledger-gerrit-archive/fabric/commit/254c10572849e8167de0012ace20d585aa8b4c76)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/25/2017, 11:41:40 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 12</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 9/25/2017, 11:39:30 AM<br><strong>UnmergedRevision</strong>: [bfe9a0dfa3e44ab4abb83e0dadc91ead6cddef37](https://github.com/hyperledger-gerrit-archive/fabric/commit/bfe9a0dfa3e44ab4abb83e0dadc91ead6cddef37)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/25/2017, 12:34:21 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 13</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 9/25/2017, 4:25:53 PM<br><strong>UnmergedRevision</strong>: [94a31ca0f637de35c78a98ea83a3c978eae1795c](https://github.com/hyperledger-gerrit-archive/fabric/commit/94a31ca0f637de35c78a98ea83a3c978eae1795c)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/25/2017, 5:48:57 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Approved</strong>: 9/30/2017, 5:14:16 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L170](https://github.com/hyperledger-gerrit-archive/fabric/blob/94a31ca0f637de35c78a98ea83a3c978eae1795c/core/committer/txvalidator/validator.go#L170)<br><strong>Comment</strong>: <pre>another freudian slip?  "order" in case you need to make an update</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L170](https://github.com/hyperledger-gerrit-archive/fabric/blob/94a31ca0f637de35c78a98ea83a3c978eae1795c/core/committer/txvalidator/validator.go#L170)<br><strong>Comment</strong>: <pre>Ouch! We'll have to setup a jar and I'll put a dollar every time I do it :D</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L189](https://github.com/hyperledger-gerrit-archive/fabric/blob/94a31ca0f637de35c78a98ea83a3c978eae1795c/core/committer/txvalidator/validator.go#L189)<br><strong>Comment</strong>: <pre>why do we need this?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L189](https://github.com/hyperledger-gerrit-archive/fabric/blob/94a31ca0f637de35c78a98ea83a3c978eae1795c/core/committer/txvalidator/validator.go#L189)<br><strong>Comment</strong>: <pre>Good point, thx</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L197](https://github.com/hyperledger-gerrit-archive/fabric/blob/94a31ca0f637de35c78a98ea83a3c978eae1795c/core/committer/txvalidator/validator.go#L197)<br><strong>Comment</strong>: <pre>Is there a reason now to build up this work slice, rather than simply invoking `AssignWorkAsync` for each iteration of the for loop?  Naively, it seems like an unneeded memory allocation?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L197](https://github.com/hyperledger-gerrit-archive/fabric/blob/94a31ca0f637de35c78a98ea83a3c978eae1795c/core/committer/txvalidator/validator.go#L197)<br><strong>Comment</strong>: <pre>I would like to avoid a goroutine for each of the transactions in the block, especially given that there is no explicit bound to that number (there might be some implicit bound today but it's not clear that this will hold forever). It's a small allocation anyway so I thought it would be acceptable.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L197](https://github.com/hyperledger-gerrit-archive/fabric/blob/94a31ca0f637de35c78a98ea83a3c978eae1795c/core/committer/txvalidator/validator.go#L197)<br><strong>Comment</strong>: <pre>Of course the alternative, is to spawn a single go routine outside the for loop, iterate over the transactions with it, enqueueing each synchronously.  My inclination would be to do it that way, less for any efficiency in memory allocation, and more that I believe it would make the code clearer.  But, since they're functionally equivalent, I'm willing to let it go if you disagree.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L197](https://github.com/hyperledger-gerrit-archive/fabric/blob/94a31ca0f637de35c78a98ea83a3c978eae1795c/core/committer/txvalidator/validator.go#L197)<br><strong>Comment</strong>: <pre>Thx, Jason. I've started doing that but then I realized that it would complicate things because I don't know in advance how many items of work there will actually be: it'll be anything between 0 and len(block.Data.Data), but until I go through the loop, I won't know. I need to know that number because I need to wait for that many validation responses from the pool, and so it's handy that we can just look at len(workSlice). If you don't mind I'll leave it as is. Thx</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L202](https://github.com/hyperledger-gerrit-archive/fabric/blob/94a31ca0f637de35c78a98ea83a3c978eae1795c/core/committer/txvalidator/validator.go#L202)<br><strong>Comment</strong>: <pre>notice that in line 197 you define a closure function, so you need to "record" the tIdx in a local variable inside the loop body, else the value of this will be the value of the last iteration. 

Example:
	for tIdx, d := range block.Data.Data {
		var tIdx int = tIdx // add this

I guess the same applies for the variable "d" ?


See playground snippet: https://play.golang.org/p/CPuQMRPJlN

Now, maybe worth to enhance the tests since they passed with this bug?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L202](https://github.com/hyperledger-gerrit-archive/fabric/blob/94a31ca0f637de35c78a98ea83a3c978eae1795c/core/committer/txvalidator/validator.go#L202)<br><strong>Comment</strong>: <pre>Good catch Yacov, thx (longer story: I thought that by creating a new blockValidationRequest we would set the value by copy into the new allocation, but some magic aliasing takes place if closures are there).

> Now, maybe worth to enhance the tests since they passed with this bug?

This is actually a bug in itself IMHO: the validator code currently creates an array of validation codes which are all set to "validation was successful" by definition. Then the validation code sets them (to an error or again to success). From a security perspective, the proper way would be to set them all to invalid when the array is created and only later clear the bit. This is part of the "default securely" design principle btw. I'll create a JIRA and fix the issue in that change set.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L202](https://github.com/hyperledger-gerrit-archive/fabric/blob/94a31ca0f637de35c78a98ea83a3c978eae1795c/core/committer/txvalidator/validator.go#L202)<br><strong>Comment</strong>: <pre>https://jira.hyperledger.org/browse/FAB-6381</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L391](https://github.com/hyperledger-gerrit-archive/fabric/blob/94a31ca0f637de35c78a98ea83a3c978eae1795c/core/committer/txvalidator/validator.go#L391)<br><strong>Comment</strong>: <pre>isn't this a problem that we apply the config updates in an arbitrary order across peers?</pre><strong>Commenter</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L391](https://github.com/hyperledger-gerrit-archive/fabric/blob/94a31ca0f637de35c78a98ea83a3c978eae1795c/core/committer/txvalidator/validator.go#L391)<br><strong>Comment</strong>: <pre>I think this is ok since we are not doing blocks in parallel but just the transactions in the block and since there's only one tx in a config block, we should be ok?</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L391](https://github.com/hyperledger-gerrit-archive/fabric/blob/94a31ca0f637de35c78a98ea83a3c978eae1795c/core/committer/txvalidator/validator.go#L391)<br><strong>Comment</strong>: <pre>Yeah, what saves us is that we indeed have config txns im a separate block</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L391](https://github.com/hyperledger-gerrit-archive/fabric/blob/94a31ca0f637de35c78a98ea83a3c978eae1795c/core/committer/txvalidator/validator.go#L391)<br><strong>Comment</strong>: <pre>Indeed, I checked with Jason before writing this code and he confirmed that the assumption is true. I've left a comment to that extent above.</pre><strong>Commenter</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>CommentLine</strong>: [core/peer/peer.go#L149](https://github.com/hyperledger-gerrit-archive/fabric/blob/94a31ca0f637de35c78a98ea83a3c978eae1795c/core/peer/peer.go#L149)<br><strong>Comment</strong>: <pre>see https://gerrit.hyperledger.org/r/#/c/12849/13/sampleconfig/core.yaml@266</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/peer/peer.go#L149](https://github.com/hyperledger-gerrit-archive/fabric/blob/94a31ca0f637de35c78a98ea83a3c978eae1795c/core/peer/peer.go#L149)<br><strong>Comment</strong>: <pre>Yup, thx</pre><strong>Commenter</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>CommentLine</strong>: [sampleconfig/core.yaml#L266](https://github.com/hyperledger-gerrit-archive/fabric/blob/94a31ca0f637de35c78a98ea83a3c978eae1795c/sampleconfig/core.yaml#L266)<br><strong>Comment</strong>: <pre>I'm pretty sure we won't be able to set this via an env variable because we replace "." with "_" so viper will thinks this is txs.validator.pool.size.
In any case, we don't use underscores but rather camelCase, so this should either be
`txValidatorPoolSize` or just `validatorPoolSize`</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [sampleconfig/core.yaml#L266](https://github.com/hyperledger-gerrit-archive/fabric/blob/94a31ca0f637de35c78a98ea83a3c978eae1795c/sampleconfig/core.yaml#L266)<br><strong>Comment</strong>: <pre>Got it, fixed, thx</pre></blockquote><h3>PatchSet Number: 14</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 10/2/2017, 9:11:34 AM<br><strong>UnmergedRevision</strong>: [04b7b213703949c993134e037d88c95fde8ad89c](https://github.com/hyperledger-gerrit-archive/fabric/commit/04b7b213703949c993134e037d88c95fde8ad89c)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 10/2/2017, 10:23:17 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L240](https://github.com/hyperledger-gerrit-archive/fabric/blob/04b7b213703949c993134e037d88c95fde8ad89c/core/committer/txvalidator/validator.go#L240)<br><strong>Comment</strong>: <pre>Why don't we skip this check?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L240](https://github.com/hyperledger-gerrit-archive/fabric/blob/04b7b213703949c993134e037d88c95fde8ad89c/core/committer/txvalidator/validator.go#L240)<br><strong>Comment</strong>: <pre>The new code should behave in the exact same way as the old code (minus the concurrency). In the old code

txsChaincodeNames[tIdx]

and

txsUpgradedChaincodes[tIdx]

are set from a single code path, and I'm just making sure that the new code doesn't change that.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L243](https://github.com/hyperledger-gerrit-archive/fabric/blob/04b7b213703949c993134e037d88c95fde8ad89c/core/committer/txvalidator/validator.go#L243)<br><strong>Comment</strong>: <pre>This one as well.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L243](https://github.com/hyperledger-gerrit-archive/fabric/blob/04b7b213703949c993134e037d88c95fde8ad89c/core/committer/txvalidator/validator.go#L243)<br><strong>Comment</strong>: <pre>See above</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L271](https://github.com/hyperledger-gerrit-archive/fabric/blob/04b7b213703949c993134e037d88c95fde8ad89c/core/committer/txvalidator/validator.go#L271)<br><strong>Comment</strong>: <pre>Is there any particular reason why we set the `err` field  in the `blockValidationResult` struct that we push to the `results` channel, only in _some_ of the error cases in this method?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L271](https://github.com/hyperledger-gerrit-archive/fabric/blob/04b7b213703949c993134e037d88c95fde8ad89c/core/committer/txvalidator/validator.go#L271)<br><strong>Comment</strong>: <pre>I checked and the old validation code ignored some errors and the new code must behave in the same way so sometimes we're reporting an error, and other times we are just marking the tx as invalid and proceeding. It's very important that this change set only changes the degree of parallelism but doesn't change the semantics of the check. Wdyt?</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L280](https://github.com/hyperledger-gerrit-archive/fabric/blob/04b7b213703949c993134e037d88c95fde8ad89c/core/committer/txvalidator/validator.go#L280)<br><strong>Comment</strong>: <pre>What does this mean?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L280](https://github.com/hyperledger-gerrit-archive/fabric/blob/04b7b213703949c993134e037d88c95fde8ad89c/core/committer/txvalidator/validator.go#L280)<br><strong>Comment</strong>: <pre>This is a comment inherited from the old code, which I copied word for word. As to what it means, I think it's trying to say that the code below implements a check that is trying to verify that a security property (referred to as security chain) that binds three fabric artifacts (proposal, endorsement, tx) is not violated. The nature of the property is described in the comments to the protos and in the security design document (https://docs.google.com/document/d/1qD2zOTxmPoss3Xop_pDdkSXHozIR4N27NEsymosW4Gk/edit?usp=sharing)</pre></blockquote><h3>PatchSet Number: 15</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 10/6/2017, 7:44:16 AM<br><strong>UnmergedRevision</strong>: [97563102e82963e1dea2c3ea92711b23d565c9f6](https://github.com/hyperledger-gerrit-archive/fabric/commit/97563102e82963e1dea2c3ea92711b23d565c9f6)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 10/6/2017, 8:56:03 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L192](https://github.com/hyperledger-gerrit-archive/fabric/blob/97563102e82963e1dea2c3ea92711b23d565c9f6/core/committer/txvalidator/validator.go#L192)<br><strong>Comment</strong>: <pre>why do you need this? why not just use the block length?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L192](https://github.com/hyperledger-gerrit-archive/fabric/blob/97563102e82963e1dea2c3ea92711b23d565c9f6/core/committer/txvalidator/validator.go#L192)<br><strong>Comment</strong>: <pre>If we used block len(block.Data.Data) we may deadlock if we hit

```
			if env, err := utils.GetEnvelopeFromBlock(d); err != nil {
```
because in that case we don't start any validating goroutine.</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L192](https://github.com/hyperledger-gerrit-archive/fabric/blob/97563102e82963e1dea2c3ea92711b23d565c9f6/core/committer/txvalidator/validator.go#L192)<br><strong>Comment</strong>: <pre>right.</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L193](https://github.com/hyperledger-gerrit-archive/fabric/blob/97563102e82963e1dea2c3ea92711b23d565c9f6/core/committer/txvalidator/validator.go#L193)<br><strong>Comment</strong>: <pre>why not make it a channel that is size of the block?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L193](https://github.com/hyperledger-gerrit-archive/fabric/blob/97563102e82963e1dea2c3ea92711b23d565c9f6/core/committer/txvalidator/validator.go#L193)<br><strong>Comment</strong>: <pre>It's an alternative, though Jason made a case against buffered channels in a previous review and I was trying to take his feedback into consideration.</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L193](https://github.com/hyperledger-gerrit-archive/fabric/blob/97563102e82963e1dea2c3ea92711b23d565c9f6/core/committer/txvalidator/validator.go#L193)<br><strong>Comment</strong>: <pre>I don't get it.
When the goroutine that performs the validation is waiting on the results channel for the goroutine that reads from the results channel, that's a wasted time - isn't it?
You only have a fixed number of goroutines that do validation so you'd want to take advantage of them fully.

What is the case against using buffering for the results channel?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L193](https://github.com/hyperledger-gerrit-archive/fabric/blob/97563102e82963e1dea2c3ea92711b23d565c9f6/core/committer/txvalidator/validator.go#L193)<br><strong>Comment</strong>: <pre>The system is guaranteed to make progress because the code that reads out validation results isn't blocking. Furthermore, it isn't doing any heavy work (only setting one flag, 2 maps and an error var, at most), so we'll process results pretty quickly without stalling anyone.

That said: at the end of the day, I don't mind either way, I consciously chose not to use buffered channels ONLY to honor Jason's comment earlier in this CR.</pre><strong>Commenter</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L228](https://github.com/hyperledger-gerrit-archive/fabric/blob/97563102e82963e1dea2c3ea92711b23d565c9f6/core/committer/txvalidator/validator.go#L228)<br><strong>Comment</strong>: <pre>Hey Ale, one suggestion...we can avoid channel communication altogether by moving this code inside validateTx and use WaitGroup. The only thing you need for post processing is the lowest error if any which should be easy to get ?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L228](https://github.com/hyperledger-gerrit-archive/fabric/blob/97563102e82963e1dea2c3ea92711b23d565c9f6/core/committer/txvalidator/validator.go#L228)<br><strong>Comment</strong>: <pre>Hey Murali, I tried and then realized it's a little more complex: we also need to set the flag in txsfltr and set the cc name in txsChaincodeNames and txsUpgradedChaincodes. None of these data structures are concurrent and so we would need to synchronize writes to those using mutexes. If you don't disagree, I'd like to leave it as is and possibly change it later, wdyt?</pre><strong>Commenter</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L228](https://github.com/hyperledger-gerrit-archive/fabric/blob/97563102e82963e1dea2c3ea92711b23d565c9f6/core/committer/txvalidator/validator.go#L228)<br><strong>Comment</strong>: <pre>Maybe I',m missing something Ale... but these "Sets" you mention (pretty much the "else" processing here right ?) are on tIdx which is just the tx index into block.Data.Data. As far as I can tell, these per-index setters have no dependence on other indices and do not have to be done in this post-processing for loop ? if you don;t want to pass txsfltr, txsChainodeNames and txsUpgradedChaincodes to the go routine (and thats a good point as in future someone might be tempted to muck with indices other than the one they own) you could just pass a func to modify those values - basically make the else a func and pass it in.

Channel communication is not efficient.  And why another loop if we can avoid it ? Just wanted to see if we can squeeze the last drop out of this after your work.</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L228](https://github.com/hyperledger-gerrit-archive/fabric/blob/97563102e82963e1dea2c3ea92711b23d565c9f6/core/committer/txvalidator/validator.go#L228)<br><strong>Comment</strong>: <pre>It's not that easy to use a waitgroup because you don't know how many goroutines you'll need because some of the envelopes in the block might be corrupted. He only initializes them in the else block and not before that.

You'll right that if we use a waitgroup - it will synchronize all the memory writes of the goroutines.
However - considering that ECDSA verification is in the magnitude of milliseconds and not micro-seconds (which is the magnitude of synchronization primitives) I'm not sure how much we gain from that. 

I do think personally that a pattern of:
- Spawn workers
- Wait for them to finish

is much more elegant than:
- Spawn workers that write their output
- Read their output, and process it

However there is another problem here with regarding of doing what you suggest:
There is no way of computing what is the lowest error in the goroutines themselves without using an atomic operation such as compare-and-swap which comes with its own cost, so you have anyway to make them return their errors and then iterate over it.</pre><strong>Commenter</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L228](https://github.com/hyperledger-gerrit-archive/fabric/blob/97563102e82963e1dea2c3ea92711b23d565c9f6/core/committer/txvalidator/validator.go#L228)<br><strong>Comment</strong>: <pre>The lowest error is a problem no doubt (hence I singled that out) but easily solved with a mutex and function...likely much cheaper than channel communication). As for the WaitGroup , we could just move the entire code  into the go routine...

However there's a bigger problem. Ale just pointed out what I was missing.
We are not dealing with arrays but maps.... I was thinking arrays all along. That does put the brakes on the suggestion. I think there's still value in moving this into the goroutine somehow but ok if we want to do that investigation in a future CR</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L228](https://github.com/hyperledger-gerrit-archive/fabric/blob/97563102e82963e1dea2c3ea92711b23d565c9f6/core/committer/txvalidator/validator.go#L228)<br><strong>Comment</strong>: <pre>Thanks, I'll keep working on performance anyway so we'll be in a good position to revisit this and other choices as we gather more perf data.</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [core/peer/peer.go#L165](https://github.com/hyperledger-gerrit-archive/fabric/blob/97563102e82963e1dea2c3ea92711b23d565c9f6/core/peer/peer.go#L165)<br><strong>Comment</strong>: <pre>why shouldn't it just be os.NumCPU() ? 

Won't users shoot themselves in the foot with this?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/peer/peer.go#L165](https://github.com/hyperledger-gerrit-archive/fabric/blob/97563102e82963e1dea2c3ea92711b23d565c9f6/core/peer/peer.go#L165)<br><strong>Comment</strong>: <pre>I'm not sure. Our experiments aren't conclusive (the distributions are a bit noisy) but in some cases 2*NCPUs was outperforming NCPUs (with no other noticeable impact on other components of the peer (e.g. gossip or endorser). For this reason, I would like to expose this configuration parameter. We can add some additional text in peer.yaml though.</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [core/peer/peer.go#L165](https://github.com/hyperledger-gerrit-archive/fabric/blob/97563102e82963e1dea2c3ea92711b23d565c9f6/core/peer/peer.go#L165)<br><strong>Comment</strong>: <pre>Right but this opens the window for abuse for the user, no?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/peer/peer.go#L165](https://github.com/hyperledger-gerrit-archive/fabric/blob/97563102e82963e1dea2c3ea92711b23d565c9f6/core/peer/peer.go#L165)<br><strong>Comment</strong>: <pre>It does. That said, if it later transpires that on some platforms, NCPUs leads to sub-optimal performance:
 - if we had left this tunable we could just tell users to simply edit core.yaml
 - if we had hardcoded it, we are forced to tell them to rebuild fabric or wait for the next release.

My 2 cents is to leave it as a tunable - we already have so many anyway that if the user wants to shoot themselves in the foot, they have a very wide range of tunables they can use to do so. We can add a warning to core.yaml if you think that would help.

Let's see what other say?</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [core/peer/peer.go#L165](https://github.com/hyperledger-gerrit-archive/fabric/blob/97563102e82963e1dea2c3ea92711b23d565c9f6/core/peer/peer.go#L165)<br><strong>Comment</strong>: <pre>the "we already have so many anyway that if the user wants to shoot themselves in the foot..." is actually quite convincing.
Can you please add a warning to the core.yaml that playing with it too much (setting it to lower than NumCPU or way too high) may poke someone's eye out ?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/peer/peer.go#L165](https://github.com/hyperledger-gerrit-archive/fabric/blob/97563102e82963e1dea2c3ea92711b23d565c9f6/core/peer/peer.go#L165)<br><strong>Comment</strong>: <pre>Will do - see next drop</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [core/peer/peer.go#L169](https://github.com/hyperledger-gerrit-archive/fabric/blob/97563102e82963e1dea2c3ea92711b23d565c9f6/core/peer/peer.go#L169)<br><strong>Comment</strong>: <pre>I understand why this semaphore is better vs a channel based semaphore for the weighted case.

But did we compare performance of this semaphore vs. a simple channel based semaphore in which you always use 1 resource at a time?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/peer/peer.go#L169](https://github.com/hyperledger-gerrit-archive/fabric/blob/97563102e82963e1dea2c3ea92711b23d565c9f6/core/peer/peer.go#L169)<br><strong>Comment</strong>: <pre>Overall validation of fabric performance (incl. this change set) is still work in progress. My vote would be: leave the implementation of this primitive as is for now and replace later (if experiments show that this is needed). The good news is that the way I coded it, we can just produce a drop-in replacement for this primitive with minimal changes.</pre><strong>Commenter</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>CommentLine</strong>: [core/peer/peer.go#L169](https://github.com/hyperledger-gerrit-archive/fabric/blob/97563102e82963e1dea2c3ea92711b23d565c9f6/core/peer/peer.go#L169)<br><strong>Comment</strong>: <pre>I tend to agree</pre></blockquote><h3>PatchSet Number: 16</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 10/7/2017, 9:11:01 AM<br><strong>UnmergedRevision</strong>: [23c0410ccc4d8a8ab786899da101eb628424b656](https://github.com/hyperledger-gerrit-archive/fabric/commit/23c0410ccc4d8a8ab786899da101eb628424b656)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 10/7/2017, 10:21:58 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L355](https://github.com/hyperledger-gerrit-archive/fabric/blob/23c0410ccc4d8a8ab786899da101eb628424b656/core/committer/txvalidator/validator.go#L355)<br><strong>Comment</strong>: <pre>this isn't found in the original file</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L355](https://github.com/hyperledger-gerrit-archive/fabric/blob/23c0410ccc4d8a8ab786899da101eb628424b656/core/committer/txvalidator/validator.go#L355)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L362](https://github.com/hyperledger-gerrit-archive/fabric/blob/23c0410ccc4d8a8ab786899da101eb628424b656/core/committer/txvalidator/validator.go#L362)<br><strong>Comment</strong>: <pre>so isn't this</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L362](https://github.com/hyperledger-gerrit-archive/fabric/blob/23c0410ccc4d8a8ab786899da101eb628424b656/core/committer/txvalidator/validator.go#L362)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L396](https://github.com/hyperledger-gerrit-archive/fabric/blob/23c0410ccc4d8a8ab786899da101eb628424b656/core/committer/txvalidator/validator.go#L396)<br><strong>Comment</strong>: <pre>and this</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L396](https://github.com/hyperledger-gerrit-archive/fabric/blob/23c0410ccc4d8a8ab786899da101eb628424b656/core/committer/txvalidator/validator.go#L396)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L407](https://github.com/hyperledger-gerrit-archive/fabric/blob/23c0410ccc4d8a8ab786899da101eb628424b656/core/committer/txvalidator/validator.go#L407)<br><strong>Comment</strong>: <pre>and this</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L407](https://github.com/hyperledger-gerrit-archive/fabric/blob/23c0410ccc4d8a8ab786899da101eb628424b656/core/committer/txvalidator/validator.go#L407)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 17</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 10/8/2017, 3:54:01 PM<br><strong>UnmergedRevision</strong>: [ed5f1ca7a1643d57cb3760cb3063d3d140e05d17](https://github.com/hyperledger-gerrit-archive/fabric/commit/ed5f1ca7a1643d57cb3760cb3063d3d140e05d17)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 10/8/2017, 5:07:33 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Approved</strong>: 10/9/2017, 9:56:44 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Approved</strong>: 10/8/2017, 4:06:01 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L194](https://github.com/hyperledger-gerrit-archive/fabric/blob/ed5f1ca7a1643d57cb3760cb3063d3d140e05d17/core/committer/txvalidator/validator.go#L194)<br><strong>Comment</strong>: <pre>A bit of a nit, but why close this channel? I don't see anyone checking the _, ok portion of the read response.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L194](https://github.com/hyperledger-gerrit-archive/fabric/blob/ed5f1ca7a1643d57cb3760cb3063d3d140e05d17/core/committer/txvalidator/validator.go#L194)<br><strong>Comment</strong>: <pre>I can remove it, sure - Yacov actually also pointed it out :)</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L203](https://github.com/hyperledger-gerrit-archive/fabric/blob/ed5f1ca7a1643d57cb3760cb3063d3d140e05d17/core/committer/txvalidator/validator.go#L203)<br><strong>Comment</strong>: <pre>Why not make the loop look like this:

 go func() {
   for {
     v.support.Acquire(...)
     go func() {
       defer v.support.Release(1)
       ...
     }()
   }
 }()

In this way, there would only ever be 1 routine attempting to acquire the lock, and n attempting to release.  Rather than N (the number of transactions) attempting to concurrently acquire?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L203](https://github.com/hyperledger-gerrit-archive/fabric/blob/ed5f1ca7a1643d57cb3760cb3063d3d140e05d17/core/committer/txvalidator/validator.go#L203)<br><strong>Comment</strong>: <pre>Good idea, thx. I'll change it.</pre></blockquote><h3>PatchSet Number: 18</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 10/9/2017, 11:58:51 AM<br><strong>UnmergedRevision</strong>: [66d4ec8dcad8766b86f5e015d5fc92f3576fce35](https://github.com/hyperledger-gerrit-archive/fabric/commit/66d4ec8dcad8766b86f5e015d5fc92f3576fce35)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 10/9/2017, 1:22:54 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Approved</strong>: 10/9/2017, 12:08:23 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L274](https://github.com/hyperledger-gerrit-archive/fabric/blob/66d4ec8dcad8766b86f5e015d5fc92f3576fce35/core/committer/txvalidator/validator.go#L274)<br><strong>Comment</strong>: <pre>Two-fold

Can we simply do a:

 if d == nil {
     result <- ...
     return
 }

to reduce the amount of indentation in this function?  Secondly, it looks like nothing is ever written to the channel in this case, which will cause the validation results reading go routine to block reading for this tx forever?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L274](https://github.com/hyperledger-gerrit-archive/fabric/blob/66d4ec8dcad8766b86f5e015d5fc92f3576fce35/core/committer/txvalidator/validator.go#L274)<br><strong>Comment</strong>: <pre>Great catch, thx Jason. The old code was simply not setting txsfltr; in an attempt to mimic that, I've left validationCode to its zero value - the receiving end will leave that position as is.</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L274](https://github.com/hyperledger-gerrit-archive/fabric/blob/66d4ec8dcad8766b86f5e015d5fc92f3576fce35/core/committer/txvalidator/validator.go#L274)<br><strong>Comment</strong>: <pre>The old code was setting such a Txn to be valid IIUC.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L274](https://github.com/hyperledger-gerrit-archive/fabric/blob/66d4ec8dcad8766b86f5e015d5fc92f3576fce35/core/committer/txvalidator/validator.go#L274)<br><strong>Comment</strong>: <pre>As discussed, because I don't think this error path is actually possible, and because a nil transaction can't modify state.  I _think_ fixing this bug would be just fine.  But I'm okay either way.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L274](https://github.com/hyperledger-gerrit-archive/fabric/blob/66d4ec8dcad8766b86f5e015d5fc92f3576fce35/core/committer/txvalidator/validator.go#L274)<br><strong>Comment</strong>: <pre>hmmm.. afaik, txsfltr isn't set if d == nil, so it's left to its zero value


```
	for tIdx, d := range block.Data.Data {
		if d != nil {
		...
		}
	}

	txsfltr = v.invalidTXsForUpgradeCC(txsChaincodeNames, txsUpgradedChaincodes, txsfltr)

	// Initialize metadata structure
	utils.InitBlockMetadata(block)

	block.Metadata.Metadata[common.BlockMetadataIndex_TRANSACTIONS_FILTER] = txsfltr

	return nil
```</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L274](https://github.com/hyperledger-gerrit-archive/fabric/blob/66d4ec8dcad8766b86f5e015d5fc92f3576fce35/core/committer/txvalidator/validator.go#L274)<br><strong>Comment</strong>: <pre>> hmmm.. afaik, txsfltr isn't set if d == nil, so it's left to its zero value

Right, which is valid IIRC</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L274](https://github.com/hyperledger-gerrit-archive/fabric/blob/66d4ec8dcad8766b86f5e015d5fc92f3576fce35/core/committer/txvalidator/validator.go#L274)<br><strong>Comment</strong>: <pre>yup</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L282](https://github.com/hyperledger-gerrit-archive/fabric/blob/66d4ec8dcad8766b86f5e015d5fc92f3576fce35/core/committer/txvalidator/validator.go#L282)<br><strong>Comment</strong>: <pre>I realize you are somewhat emulating the style of the previous code here, but in general, any time we 'return', the if should not be followed by an else.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L282](https://github.com/hyperledger-gerrit-archive/fabric/blob/66d4ec8dcad8766b86f5e015d5fc92f3576fce35/core/committer/txvalidator/validator.go#L282)<br><strong>Comment</strong>: <pre>Right, a refactor of the validator code is long overdue.. if you don't mind I'll tackle this in another CR? Also, another reason to leave the code as close to the original as possible is because if you install meld (http://meldmerge.org/), set in the preferences that it should ignore  spaces/leading spaces and then look at it with
git difftool -d -t meld HEAD~1
you'll see a very compact representation of the change set.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L282](https://github.com/hyperledger-gerrit-archive/fabric/blob/66d4ec8dcad8766b86f5e015d5fc92f3576fce35/core/committer/txvalidator/validator.go#L282)<br><strong>Comment</strong>: <pre>Understood.  I would definitely like to see this refactored, but understand it isn't this CR's fault.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L436](https://github.com/hyperledger-gerrit-archive/fabric/blob/66d4ec8dcad8766b86f5e015d5fc92f3576fce35/core/committer/txvalidator/validator.go#L436)<br><strong>Comment</strong>: <pre>Move this to the front with a similar:

 if foo == nil {
    result <- ...
    return
 }

?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L436](https://github.com/hyperledger-gerrit-archive/fabric/blob/66d4ec8dcad8766b86f5e015d5fc92f3576fce35/core/committer/txvalidator/validator.go#L436)<br><strong>Comment</strong>: <pre>Same as for the previous comment - mind if I refactor in another CR?</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L436](https://github.com/hyperledger-gerrit-archive/fabric/blob/66d4ec8dcad8766b86f5e015d5fc92f3576fce35/core/committer/txvalidator/validator.go#L436)<br><strong>Comment</strong>: <pre>Sure, understood.</pre></blockquote><h3>PatchSet Number: 19</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 10/9/2017, 2:05:05 PM<br><strong>GitHubMergedRevision</strong>: [9b6b8fe6057360cc13dc9a676a79c87d815beabc](https://github.com/hyperledger-gerrit-archive/fabric/commit/9b6b8fe6057360cc13dc9a676a79c87d815beabc)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 10/9/2017, 3:26:20 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Greg Haskins - gregory.haskins@gmail.com<br><strong>Approved</strong>: 10/10/2017, 11:06:10 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Approved</strong>: 10/9/2017, 4:40:19 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Approved</strong>: 10/9/2017, 3:58:17 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Approved</strong>: 10/9/2017, 4:23:11 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Approved</strong>: 10/10/2017, 6:07:46 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: David Enyeart<br><strong>Merged</strong>: 10/10/2017, 9:54:00 AM<br><br><h2>Comments</h2><strong>Commenter</strong>: Greg Haskins - gregory.haskins@gmail.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L41](https://github.com/hyperledger-gerrit-archive/fabric/blob/9b6b8fe6057360cc13dc9a676a79c87d815beabc/core/committer/txvalidator/validator.go#L41)<br><strong>Comment</strong>: <pre>Does it make sense to have the semaphore interface attached to "Support"?  I am sincerely asking, this struck me as a surprise.  I would have expected it to be encapsulated deeper.  To be fair, I don't know this subsystem very well.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L41](https://github.com/hyperledger-gerrit-archive/fabric/blob/9b6b8fe6057360cc13dc9a676a79c87d815beabc/core/committer/txvalidator/validator.go#L41)<br><strong>Comment</strong>: <pre>Good point. There's some massive refactoring coming for the validator so we can decide to rearrange things later if it's deemed necessary, would that work?</pre><strong>Commenter</strong>: Greg Haskins - gregory.haskins@gmail.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L192](https://github.com/hyperledger-gerrit-archive/fabric/blob/9b6b8fe6057360cc13dc9a676a79c87d815beabc/core/committer/txvalidator/validator.go#L192)<br><strong>Comment</strong>: <pre>Not sure the initial go routine buys (or hurts) anything here.  We will ultimately block on the next statement at L216 waiting for the nested routines to complete.  Suggest collapsing to just a for + nested go-routines</pre><strong>Commenter</strong>: Greg Haskins - gregory.haskins@gmail.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L192](https://github.com/hyperledger-gerrit-archive/fabric/blob/9b6b8fe6057360cc13dc9a676a79c87d815beabc/core/committer/txvalidator/validator.go#L192)<br><strong>Comment</strong>: <pre>@yacovm pointed out the the use of an unbuffered channel requires the second context, so I was wrong about this and retract the comment.</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L192](https://github.com/hyperledger-gerrit-archive/fabric/blob/9b6b8fe6057360cc13dc9a676a79c87d815beabc/core/committer/txvalidator/validator.go#L192)<br><strong>Comment</strong>: <pre>But you still have a point, we can just buffer the channel to the size of the block and then get rid of the goroutine.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L192](https://github.com/hyperledger-gerrit-archive/fabric/blob/9b6b8fe6057360cc13dc9a676a79c87d815beabc/core/committer/txvalidator/validator.go#L192)<br><strong>Comment</strong>: <pre>Jason has already argued against buffered channels so would it be okay to stick with this approach?</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L192](https://github.com/hyperledger-gerrit-archive/fabric/blob/9b6b8fe6057360cc13dc9a676a79c87d815beabc/core/committer/txvalidator/validator.go#L192)<br><strong>Comment</strong>: <pre>Personally, I find the current approach clear and easy to understand.

The original argument against using buffered channels was around the (now abandoned) worker pool CR.

My statement there was that more often than not, using a buffered channel is the wrong choice.  Many of the naive uses actually produce races and buffered channels generally make code harder to test.  Of course there are appropriate use cases for them, but any time I see a buffered channel my reaction is to ask "should this really be buffered?"

With all that being said, in this case, I see no real issue with using a buffered channel.  My biggest complaint would be that the size of the buffered channel is arbitrary, but per other constraints, this is probably fine.

Still, my vote is for the code as written.  I think it's more obvious what the code is doing with the extra go routine than with the buffered channel.  I would need to profile it to be sure, but, I suspect the overhead for one additional go routine vs the overhead for a large unbuffered channel are pretty equivalent.

So in summary, I vote keep it as is.</pre><strong>Commenter</strong>: Greg Haskins - gregory.haskins@gmail.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L192](https://github.com/hyperledger-gerrit-archive/fabric/blob/9b6b8fe6057360cc13dc9a676a79c87d815beabc/core/committer/txvalidator/validator.go#L192)<br><strong>Comment</strong>: <pre>I know this has already been merged, but for the record, I agree with Jason.  My guess is that the overhead of the go routine is negligible and the potentially large channel depth needed to mitigate its use is more likely to be a problem.  I just simply missed the intent in my initial review.  Therefore, I personally am fine with considering this closed, and sorry for the noise.</pre><strong>Commenter</strong>: Greg Haskins - gregory.haskins@gmail.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L201](https://github.com/hyperledger-gerrit-archive/fabric/blob/9b6b8fe6057360cc13dc9a676a79c87d815beabc/core/committer/txvalidator/validator.go#L201)<br><strong>Comment</strong>: <pre>Much nicer, thank you!</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L201](https://github.com/hyperledger-gerrit-archive/fabric/blob/9b6b8fe6057360cc13dc9a676a79c87d815beabc/core/committer/txvalidator/validator.go#L201)<br><strong>Comment</strong>: <pre>:) sure! thx for the good feedback</pre><strong>Commenter</strong>: Greg Haskins - gregory.haskins@gmail.com<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L215](https://github.com/hyperledger-gerrit-archive/fabric/blob/9b6b8fe6057360cc13dc9a676a79c87d815beabc/core/committer/txvalidator/validator.go#L215)<br><strong>Comment</strong>: <pre>Out of curiosity, do we care about the order?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/committer/txvalidator/validator.go#L215](https://github.com/hyperledger-gerrit-archive/fabric/blob/9b6b8fe6057360cc13dc9a676a79c87d815beabc/core/committer/txvalidator/validator.go#L215)<br><strong>Comment</strong>: <pre>We don't, really. We pass in the tx index and we order responsea using it, so we set the right bit position in the filter and we return the first error in case more than one is returned to emulate the serial code.</pre><strong>Commenter</strong>: Greg Haskins - gregory.haskins@gmail.com<br><strong>CommentLine</strong>: [core/scc/sysccapi.go#L120](https://github.com/hyperledger-gerrit-archive/fabric/blob/9b6b8fe6057360cc13dc9a676a79c87d815beabc/core/scc/sysccapi.go#L120)<br><strong>Comment</strong>: <pre>I realize this logic was already in place, but not sure it makes sense to have a defer as the last statement in a scope block</pre><strong>Commenter</strong>: Greg Haskins - gregory.haskins@gmail.com<br><strong>CommentLine</strong>: [core/scc/sysccapi.go#L120](https://github.com/hyperledger-gerrit-archive/fabric/blob/9b6b8fe6057360cc13dc9a676a79c87d815beabc/core/scc/sysccapi.go#L120)<br><strong>Comment</strong>: <pre>@yacovm pointed out that golang's defer is function-block oriented.  I had C++ RAII scoping rules on the brain.  My bad.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/scc/sysccapi.go#L120](https://github.com/hyperledger-gerrit-archive/fabric/blob/9b6b8fe6057360cc13dc9a676a79c87d815beabc/core/scc/sysccapi.go#L120)<br><strong>Comment</strong>: <pre>Done</pre></blockquote>