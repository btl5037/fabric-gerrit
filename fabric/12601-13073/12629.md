<strong>Project</strong>: fabric<br><strong>Branch</strong>: master<br><strong>ID</strong>: 12629<br><strong>Subject</strong>: [FAB-4768] don't kill deliver clients on first err<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Luis Sanchez - luiss@me.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 8/20/2017, 10:52:46 PM<br><strong>LastUpdated</strong>: 10/1/2017, 10:19:30 PM<br><strong>CommitMessage</strong>:<br><pre>[FAB-4768] don't kill deliver clients on first err

Deliver clients no longer fail at the first sign of
trouble with the orderer/kafka cluster link.

- Custom sarama logger enhanced to allow listening to logging
  'events'.

Change-Id: I4a30e86ff77fd3555e1b67cf79fd44a04ab352f9
Signed-off-by: Luis Sanchez <sanchezl@us.ibm.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Luis Sanchez - luiss@me.com<br><strong>Reviewed</strong>: 8/20/2017, 10:52:46 PM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Luis Sanchez - luiss@me.com<br><strong>Reviewed</strong>: 8/25/2017, 10:08:32 AM<br><strong>Message</strong>: <pre>Patch Set 2: Patch Set 1 was rebased</pre><strong>Reviewer</strong>: Luis Sanchez - luiss@me.com<br><strong>Reviewed</strong>: 8/26/2017, 6:56:34 PM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/26/2017, 6:56:44 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/11752/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/26/2017, 6:59:35 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7664/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/26/2017, 6:59:49 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10130/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/26/2017, 7:00:11 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16120/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/26/2017, 8:24:42 PM<br><strong>Message</strong>: <pre>Patch Set 3: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-z/11752/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/11752

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16120/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/16120

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7664/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/7664

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10130/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/10130</pre><strong>Reviewer</strong>: Luis Sanchez - luiss@me.com<br><strong>Reviewed</strong>: 8/26/2017, 8:55:48 PM<br><strong>Message</strong>: <pre>Uploaded patch set 4: Commit message was updated.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/26/2017, 8:55:56 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/11755/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/26/2017, 8:56:46 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16123/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/26/2017, 8:57:16 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7667/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/26/2017, 8:58:10 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10133/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/26/2017, 9:40:38 PM<br><strong>Message</strong>: <pre>Patch Set 4: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16123/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16123/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/16123

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7667/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7667/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/7667

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10133/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10133/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/10133

https://jenkins.hyperledger.org/job/fabric-verify-z/11755/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/11755</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 8/26/2017, 10:16:37 PM<br><strong>Message</strong>: <pre>Patch Set 4:

rebuild-x rebuild-behave rebuild-e2e</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/26/2017, 10:17:31 PM<br><strong>Message</strong>: <pre>Patch Set 4: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16124/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/26/2017, 10:19:19 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7668/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/26/2017, 10:20:09 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10134/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/26/2017, 11:48:16 PM<br><strong>Message</strong>: <pre>Patch Set 4: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16124/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/16124

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7668/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/7668

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10134/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/10134</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 8/27/2017, 2:27:16 AM<br><strong>Message</strong>: <pre>Patch Set 4:

(1 comment)</pre><strong>Reviewer</strong>: Luis Sanchez - luiss@me.com<br><strong>Reviewed</strong>: 8/27/2017, 1:52:29 PM<br><strong>Message</strong>: <pre>Patch Set 4:

(1 comment)</pre><strong>Reviewer</strong>: Luis Sanchez - luiss@me.com<br><strong>Reviewed</strong>: 8/28/2017, 12:39:43 PM<br><strong>Message</strong>: <pre>Patch Set 5: Patch Set 4 was rebased</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/28/2017, 12:39:54 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/11820/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/28/2017, 12:41:58 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16189/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/28/2017, 12:42:30 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7757/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/28/2017, 12:42:36 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10201/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/28/2017, 1:58:17 PM<br><strong>Message</strong>: <pre>Patch Set 5: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-z/11820/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/11820

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16189/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/16189

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7757/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/7757

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10201/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/10201</pre><strong>Reviewer</strong>: Luis Sanchez - luiss@me.com<br><strong>Reviewed</strong>: 8/30/2017, 2:31:20 PM<br><strong>Message</strong>: <pre>Uploaded patch set 6.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/30/2017, 2:31:28 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/11947/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/30/2017, 2:32:53 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16311/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/30/2017, 2:33:16 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7891/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/30/2017, 2:33:53 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10322/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/30/2017, 3:49:54 PM<br><strong>Message</strong>: <pre>Patch Set 6: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-z/11947/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/11947

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/16311/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/16311

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/7891/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/7891

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/10322/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/10322</pre><strong>Reviewer</strong>: Luis Sanchez - luiss@me.com<br><strong>Reviewed</strong>: 8/30/2017, 4:05:53 PM<br><strong>Message</strong>: <pre>Patch Set 6:

(1 comment)</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 9/10/2017, 5:33:09 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Do I recall correctly that a rewrite is coming and thus, this version of the changeset should not be reviewed?</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 9/10/2017, 6:38:21 PM<br><strong>Message</strong>: <pre>Patch Set 6: Code-Review-1

> Patch Set 6:
> 
> Do I recall correctly that a rewrite is coming and thus, this version of the changeset should not be reviewed?

Went back to our logs, and I do remember correctly. -1'ing to prevent reviews until your new changeset is out. LMK if I'm wrong.</pre><strong>Reviewer</strong>: Luis Sanchez - luiss@me.com<br><strong>Reviewed</strong>: 9/21/2017, 12:33:48 PM<br><strong>Message</strong>: <pre>Uploaded patch set 7.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/21/2017, 12:33:57 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/12808/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/21/2017, 12:36:01 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/17158/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/21/2017, 12:36:18 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/11170/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/21/2017, 12:36:38 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/8743/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/21/2017, 2:08:48 PM<br><strong>Message</strong>: <pre>Patch Set 7: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-z/12808/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-z/12808/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/12808

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/17158/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/17158

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/11170/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/11170

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/8743/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/8743</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 9/21/2017, 4:38:01 PM<br><strong>Message</strong>: <pre>Patch Set 7:

rebuild-z</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/21/2017, 4:38:12 PM<br><strong>Message</strong>: <pre>Patch Set 7: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/12813/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/21/2017, 5:27:39 PM<br><strong>Message</strong>: <pre>Patch Set 7: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-z/12813/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/12813</pre><strong>Reviewer</strong>: Luis Sanchez - luiss@me.com<br><strong>Reviewed</strong>: 9/22/2017, 11:25:17 AM<br><strong>Message</strong>: <pre>Uploaded patch set 8: Patch Set 7 was rebased.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/22/2017, 11:25:24 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/12853/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/22/2017, 11:26:51 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/17195/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/22/2017, 11:27:21 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/11205/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/22/2017, 11:27:53 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/8777/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/22/2017, 12:48:38 PM<br><strong>Message</strong>: <pre>Patch Set 8: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-z/12853/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/12853

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/17195/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/17195

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/11205/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/11205

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/8777/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/8777</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 9/24/2017, 4:08:29 PM<br><strong>Message</strong>: <pre>Patch Set 8: Code-Review-1

(14 comments)

This is a nice approach to the problem, and the work that has been put into taking advantage the printouts of sarama's built-in logger is great.

I see that you're going all in on using testify's Mock construct for your tests. Is there a plan to rewrite all the existing tests so that they use "testify/mock" as well? Whichever path we decide to take (the existing one or the testify/mock one), I'm fine. What we need to make sure is that we're consistent. (This is also relevant to some of my inline observations w/r/t existing variables and functions that are meant to be used across tests. I'm fine with changing the patterns -- and I understand that the existing patterns that I'm invoking in my comments are sometimes not too obvious --, but whatever path we take, let's try to keep things consistent.)

See inline comments for some other observations as well.</pre><strong>Reviewer</strong>: Luis Sanchez - luiss@me.com<br><strong>Reviewed</strong>: 9/25/2017, 1:26:40 PM<br><strong>Message</strong>: <pre>Uploaded patch set 9.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/25/2017, 1:26:51 PM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/12913/ (1/5)</pre><strong>Reviewer</strong>: Luis Sanchez - luiss@me.com<br><strong>Reviewed</strong>: 9/25/2017, 1:26:54 PM<br><strong>Message</strong>: <pre>Patch Set 8:

(11 comments)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/25/2017, 1:28:36 PM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/17251/ (2/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/25/2017, 1:28:58 PM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/11261/ (3/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/25/2017, 1:29:23 PM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/8832/ (4/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/25/2017, 1:31:31 PM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/32/ (5/5)</pre><strong>Reviewer</strong>: Luis Sanchez - luiss@me.com<br><strong>Reviewed</strong>: 9/25/2017, 1:35:01 PM<br><strong>Message</strong>: <pre>Patch Set 9:

(2 comments)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/25/2017, 2:57:36 PM<br><strong>Message</strong>: <pre>Patch Set 9: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-z/12913/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/12913

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/17251/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/17251

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/11261/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/11261

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/8832/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/8832

https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/32/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-two-staged-ci-check-x86_64/32</pre><strong>Reviewer</strong>: Luis Sanchez - luiss@me.com<br><strong>Reviewed</strong>: 9/25/2017, 4:10:40 PM<br><strong>Message</strong>: <pre>Uploaded patch set 10.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/25/2017, 4:10:48 PM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/12925/ (1/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/25/2017, 4:12:34 PM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/17264/ (2/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/25/2017, 4:13:06 PM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/11273/ (3/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/25/2017, 4:13:22 PM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/8844/ (4/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/25/2017, 4:15:07 PM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/45/ (5/5)</pre><strong>Reviewer</strong>: Luis Sanchez - luiss@me.com<br><strong>Reviewed</strong>: 9/25/2017, 4:15:42 PM<br><strong>Message</strong>: <pre>Patch Set 10:

(1 comment)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/25/2017, 5:38:04 PM<br><strong>Message</strong>: <pre>Patch Set 10: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/17264/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/17264/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/17264

https://jenkins.hyperledger.org/job/fabric-verify-z/12925/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/12925

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/11273/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/11273

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/8844/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/8844

https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/45/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-two-staged-ci-check-x86_64/45</pre><strong>Reviewer</strong>: Luis Sanchez - luiss@me.com<br><strong>Reviewed</strong>: 9/25/2017, 11:14:11 PM<br><strong>Message</strong>: <pre>Uploaded patch set 11.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/25/2017, 11:14:22 PM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/12940/ (1/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/25/2017, 11:16:02 PM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/17278/ (2/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/25/2017, 11:16:31 PM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/11287/ (3/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/25/2017, 11:17:15 PM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/8858/ (4/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/25/2017, 11:18:58 PM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/58/ (5/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/26/2017, 12:43:27 AM<br><strong>Message</strong>: <pre>Patch Set 11: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-z/12940/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/12940

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/17278/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/17278

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/11287/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/11287

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/8858/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/8858

https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/58/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-two-staged-ci-check-x86_64/58</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 9/26/2017, 5:56:21 AM<br><strong>Message</strong>: <pre>Patch Set 11: Code-Review+1

(4 comments)

Minor nits aside, this looks very good.</pre><strong>Reviewer</strong>: Luis Sanchez - luiss@me.com<br><strong>Reviewed</strong>: 9/26/2017, 10:20:32 AM<br><strong>Message</strong>: <pre>Uploaded patch set 12.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/26/2017, 10:20:41 AM<br><strong>Message</strong>: <pre>Patch Set 12:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/12950/ (1/5)</pre><strong>Reviewer</strong>: Luis Sanchez - luiss@me.com<br><strong>Reviewed</strong>: 9/26/2017, 10:22:52 AM<br><strong>Message</strong>: <pre>Patch Set 12:

(3 comments)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/26/2017, 10:22:59 AM<br><strong>Message</strong>: <pre>Patch Set 12:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/17289/ (2/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/26/2017, 10:23:03 AM<br><strong>Message</strong>: <pre>Patch Set 12:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/11297/ (3/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/26/2017, 10:23:29 AM<br><strong>Message</strong>: <pre>Patch Set 12:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/8868/ (4/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/26/2017, 10:24:10 AM<br><strong>Message</strong>: <pre>Patch Set 12:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/68/ (5/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/26/2017, 11:49:37 AM<br><strong>Message</strong>: <pre>Patch Set 12: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/68/ : FAILURE (skipped)

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/68/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-two-staged-ci-check-x86_64/68

https://jenkins.hyperledger.org/job/fabric-verify-z/12950/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/12950

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/17289/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/17289

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/11297/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/11297

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/8868/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/8868</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 9/26/2017, 1:27:06 PM<br><strong>Message</strong>: <pre>Patch Set 12: Code-Review+2</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 10/1/2017, 10:19:17 PM<br><strong>Message</strong>: <pre>Patch Set 12: Code-Review+2</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 10/1/2017, 10:19:30 PM<br><strong>Message</strong>: <pre>Change has been successfully merged by Jason Yellick</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Luis Sanchez - luiss@me.com<br><strong>Uploader</strong>: Luis Sanchez - luiss@me.com<br><strong>Created</strong>: 8/20/2017, 10:52:46 PM<br><strong>UnmergedRevision</strong>: [25f923c0f404f76b1c0e0a93ba25e6a7562d4bef](https://github.com/hyperledger-gerrit-archive/fabric/commit/25f923c0f404f76b1c0e0a93ba25e6a7562d4bef)<br><br></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Luis Sanchez - luiss@me.com<br><strong>Uploader</strong>: Luis Sanchez - luiss@me.com<br><strong>Created</strong>: 8/25/2017, 10:08:32 AM<br><strong>UnmergedRevision</strong>: [3ce5812d463e9303def4b93f7cc482f9eaab16a7](https://github.com/hyperledger-gerrit-archive/fabric/commit/3ce5812d463e9303def4b93f7cc482f9eaab16a7)<br><br></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Luis Sanchez - luiss@me.com<br><strong>Uploader</strong>: Luis Sanchez - luiss@me.com<br><strong>Created</strong>: 8/26/2017, 6:56:34 PM<br><strong>UnmergedRevision</strong>: [8f22bce82c016322a2d53aebc6060b7eb788f132](https://github.com/hyperledger-gerrit-archive/fabric/commit/8f22bce82c016322a2d53aebc6060b7eb788f132)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/26/2017, 8:24:42 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: NO_CODE_CHANGE<br><strong>Author</strong>: Luis Sanchez - luiss@me.com<br><strong>Uploader</strong>: Luis Sanchez - luiss@me.com<br><strong>Created</strong>: 8/26/2017, 8:55:48 PM<br><strong>UnmergedRevision</strong>: [d96ee5f71653f255ee28dd8db9007fba30d178a5](https://github.com/hyperledger-gerrit-archive/fabric/commit/d96ee5f71653f255ee28dd8db9007fba30d178a5)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/26/2017, 11:48:16 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain.go#L238](https://github.com/hyperledger-gerrit-archive/fabric/blob/d96ee5f71653f255ee28dd8db9007fba30d178a5/orderer/consensus/kafka/chain.go#L238)<br><strong>Comment</strong>: <pre>By my brief reading ErrOffsetOutOfRange occurs when the requested offset is either ahead of the latest offset for the broker, or when the requested offset is behind the last index retained by the broker.

Why would these be the only 'Deliver Killing' errors?  I'm imagining for instance that an orderer suffers a network partition from the Kafka brokers, is this simply handled elsewhere?</pre><strong>Commenter</strong>: Luis Sanchez - luiss@me.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain.go#L238](https://github.com/hyperledger-gerrit-archive/fabric/blob/d96ee5f71653f255ee28dd8db9007fba30d178a5/orderer/consensus/kafka/chain.go#L238)<br><strong>Comment</strong>: <pre>From the kafka client's point of view this is the only error that can be caused by a bad client request (given that they've already acquired a consumer for a valid topic & partition) and cannot be resolved by fixing something on the server side.

All other errors are "ignored" by the kafka client (sarama) and retried indefinitely, waiting for either a new partition leader to be elected or kafka administrators to fix the problem in the cluster without bringing down the client.</pre></blockquote><h3>PatchSet Number: 5</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Luis Sanchez - luiss@me.com<br><strong>Uploader</strong>: Luis Sanchez - luiss@me.com<br><strong>Created</strong>: 8/28/2017, 12:39:43 PM<br><strong>UnmergedRevision</strong>: [961a4b4ec52e43eb762d6f2bfe64c99b1e251256](https://github.com/hyperledger-gerrit-archive/fabric/commit/961a4b4ec52e43eb762d6f2bfe64c99b1e251256)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/28/2017, 1:58:17 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 6</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Luis Sanchez - luiss@me.com<br><strong>Uploader</strong>: Luis Sanchez - luiss@me.com<br><strong>Created</strong>: 8/30/2017, 2:31:20 PM<br><strong>UnmergedRevision</strong>: [20fd2cb089d333531115e7ce8d7329880085930e](https://github.com/hyperledger-gerrit-archive/fabric/commit/20fd2cb089d333531115e7ce8d7329880085930e)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/30/2017, 3:49:54 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Approved</strong>: 9/10/2017, 6:38:21 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Luis Sanchez - luiss@me.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain.go#L225](https://github.com/hyperledger-gerrit-archive/fabric/blob/20fd2cb089d333531115e7ce8d7329880085930e/orderer/consensus/kafka/chain.go#L225)<br><strong>Comment</strong>: <pre>I would like some advice on what these values should be.
*sessionTimeoutDuration* – period time where if only errors occur (and no messages are received) the errorChan is closed (which would disconnect Deliver clients).
*sessionTimeoutResetDuration* – while I can detect when errors occur, I cannot detect when errors are not occurring so I resort to 1. if a successful message is received, then the session timeout is reset and 2. if the session has already timed out, and no error has occurred in sessionTimeoutResetDuration, then assume things are going well and reset the session timeout timer. Here I set it to 10 times the max time that the client will spend trying to refresh it's metadata when it is having trouble.</pre></blockquote><h3>PatchSet Number: 7</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Luis Sanchez - luiss@me.com<br><strong>Uploader</strong>: Luis Sanchez - luiss@me.com<br><strong>Created</strong>: 9/21/2017, 12:33:48 PM<br><strong>UnmergedRevision</strong>: [c20eb734e0972963e4a17e37a8afd0776a2cdcef](https://github.com/hyperledger-gerrit-archive/fabric/commit/c20eb734e0972963e4a17e37a8afd0776a2cdcef)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/21/2017, 5:27:39 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/server/server_test.go#L29](https://github.com/hyperledger-gerrit-archive/fabric/blob/c20eb734e0972963e4a17e37a8afd0776a2cdcef/orderer/common/server/server_test.go#L29)<br><strong>Comment</strong>: <pre>The thinking, esp. after FAB-6108 was merged, was to have each package call `flogging.SetLevel` on its `pkgLogID` only. See https://gerrit.hyperledger.org/r/#/c/13345/2/orderer/common/deliver/deliver_test.go for example.</pre><strong>Commenter</strong>: Luis Sanchez - luiss@me.com<br><strong>CommentLine</strong>: [orderer/common/server/server_test.go#L29](https://github.com/hyperledger-gerrit-archive/fabric/blob/c20eb734e0972963e4a17e37a8afd0776a2cdcef/orderer/common/server/server_test.go#L29)<br><strong>Comment</strong>: <pre>Done
Not meant to be checked in.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain.go#L232](https://github.com/hyperledger-gerrit-archive/fabric/blob/c20eb734e0972963e4a17e37a8afd0776a2cdcef/orderer/consensus/kafka/chain.go#L232)<br><strong>Comment</strong>: <pre>s/subscription/subscription</pre><strong>Commenter</strong>: Luis Sanchez - luiss@me.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain.go#L232](https://github.com/hyperledger-gerrit-archive/fabric/blob/c20eb734e0972963e4a17e37a8afd0776a2cdcef/orderer/consensus/kafka/chain.go#L232)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [sampleconfig/orderer.yaml#L233](https://github.com/hyperledger-gerrit-archive/fabric/blob/c20eb734e0972963e4a17e37a8afd0776a2cdcef/sampleconfig/orderer.yaml#L233)<br><strong>Comment</strong>: <pre>I'm sure that, as usual, this was considered carefully, but I'm can't help but wonder why the option below isn't part of the `Retry` config group above. I'd claim this is either `Retry.DeliverChannelTimeout` or, maybe, even overload `Retry.NetworkTimeouts.ReadTimeout` and add a comment to note the setting's dual role? This would also mean you don't have to modify the signature of the `New` constructor in the `kafka` package.</pre><strong>Commenter</strong>: Luis Sanchez - luiss@me.com<br><strong>CommentLine</strong>: [sampleconfig/orderer.yaml#L233](https://github.com/hyperledger-gerrit-archive/fabric/blob/c20eb734e0972963e4a17e37a8afd0776a2cdcef/sampleconfig/orderer.yaml#L233)<br><strong>Comment</strong>: <pre>I did start off with this in Retry, but it didn't feel correct as Retry is all about the Consenter-Kafaka connections, whereas this is about the "Deliver Client"-Consenter connection. I felt that a separate, explicit configuration would keep the purpose clear for the user.

Overloading `Retry.NetworkTimeouts.ReadTimeout` was considered, but in addition to my concern about how to be clear about the dual use of the field, I did not want to make it impossible for a user to set separate values for the overloaded functions.</pre><strong>Commenter</strong>: Luis Sanchez - luiss@me.com<br><strong>CommentLine</strong>: [sampleconfig/orderer.yaml#L233](https://github.com/hyperledger-gerrit-archive/fabric/blob/c20eb734e0972963e4a17e37a8afd0776a2cdcef/sampleconfig/orderer.yaml#L233)<br><strong>Comment</strong>: <pre>I think we should just make kafka.New() just take a single `localconfig.Kafka` parameter.</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [sampleconfig/orderer.yaml#L233](https://github.com/hyperledger-gerrit-archive/fabric/blob/c20eb734e0972963e4a17e37a8afd0776a2cdcef/sampleconfig/orderer.yaml#L233)<br><strong>Comment</strong>: <pre>> I think we should just make kafka.New() just take a single `localconfig.Kafka` parameter.

(I think you're right.)</pre><strong>Commenter</strong>: Luis Sanchez - luiss@me.com<br><strong>CommentLine</strong>: [sampleconfig/orderer.yaml#L233](https://github.com/hyperledger-gerrit-archive/fabric/blob/c20eb734e0972963e4a17e37a8afd0776a2cdcef/sampleconfig/orderer.yaml#L233)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 8</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Luis Sanchez - luiss@me.com<br><strong>Uploader</strong>: Luis Sanchez - luiss@me.com<br><strong>Created</strong>: 9/22/2017, 11:25:17 AM<br><strong>UnmergedRevision</strong>: [74de59d8403fa45a9412a1f1c193417c25b4eaa8](https://github.com/hyperledger-gerrit-archive/fabric/commit/74de59d8403fa45a9412a1f1c193417c25b4eaa8)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/22/2017, 12:48:38 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Approved</strong>: 9/24/2017, 4:08:29 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain_test.go#L2338](https://github.com/hyperledger-gerrit-archive/fabric/blob/74de59d8403fa45a9412a1f1c193417c25b4eaa8/orderer/consensus/kafka/chain_test.go#L2338)<br><strong>Comment</strong>: <pre>The pattern on this one is not clear —and I'm all for changing to something better/clearer if you have suggestions— but `consenter_test.go` carries an `init` function that initializes common test-related objects, one of them being the logger. See `setupTestLogging` and feel free to modify it so that it sets the sarama logger's level as well.</pre><strong>Commenter</strong>: Luis Sanchez - luiss@me.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain_test.go#L2338](https://github.com/hyperledger-gerrit-archive/fabric/blob/74de59d8403fa45a9412a1f1c193417c25b4eaa8/orderer/consensus/kafka/chain_test.go#L2338)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain_test.go#L2358](https://github.com/hyperledger-gerrit-archive/fabric/blob/74de59d8403fa45a9412a1f1c193417c25b4eaa8/orderer/consensus/kafka/chain_test.go#L2358)<br><strong>Comment</strong>: <pre>This is referred to as `defaultPartition` throughout the tests in the package.</pre><strong>Commenter</strong>: Luis Sanchez - luiss@me.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain_test.go#L2358](https://github.com/hyperledger-gerrit-archive/fabric/blob/74de59d8403fa45a9412a1f1c193417c25b4eaa8/orderer/consensus/kafka/chain_test.go#L2358)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain_test.go#L2438](https://github.com/hyperledger-gerrit-archive/fabric/blob/74de59d8403fa45a9412a1f1c193417c25b4eaa8/orderer/consensus/kafka/chain_test.go#L2438)<br><strong>Comment</strong>: <pre>See `newMockLocalConfig` in `consenter_test.go`.</pre><strong>Commenter</strong>: Luis Sanchez - luiss@me.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain_test.go#L2438](https://github.com/hyperledger-gerrit-archive/fabric/blob/74de59d8403fa45a9412a1f1c193417c25b4eaa8/orderer/consensus/kafka/chain_test.go#L2438)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain_test.go#L2463](https://github.com/hyperledger-gerrit-archive/fabric/blob/74de59d8403fa45a9412a1f1c193417c25b4eaa8/orderer/consensus/kafka/chain_test.go#L2463)<br><strong>Comment</strong>: <pre>Let's try to minimize the use of such statements as much as possible. I'd argue that they're bad practice in general, and they make tests on resource-constrained environments (such as our CI) flaky.

That said, there is a chance that the code you're testing against doesn't provide the proper hook for you.

Would checking for a closed `chain.startChan` work for what you're trying to check? That's the reason I introduced this hook; see lines 105 to 110.</pre><strong>Commenter</strong>: Luis Sanchez - luiss@me.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain_test.go#L2463](https://github.com/hyperledger-gerrit-archive/fabric/blob/74de59d8403fa45a9412a1f1c193417c25b4eaa8/orderer/consensus/kafka/chain_test.go#L2463)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain_test.go#L2511](https://github.com/hyperledger-gerrit-archive/fabric/blob/74de59d8403fa45a9412a1f1c193417c25b4eaa8/orderer/consensus/kafka/chain_test.go#L2511)<br><strong>Comment</strong>: <pre>*If* I'm reading the test right, if the code doesn't work as expected, we'll be stuck here for quite a while. This means we need to add the timeout before we merge.</pre><strong>Commenter</strong>: Luis Sanchez - luiss@me.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain_test.go#L2511](https://github.com/hyperledger-gerrit-archive/fabric/blob/74de59d8403fa45a9412a1f1c193417c25b4eaa8/orderer/consensus/kafka/chain_test.go#L2511)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain_test.go#L2548](https://github.com/hyperledger-gerrit-archive/fabric/blob/74de59d8403fa45a9412a1f1c193417c25b4eaa8/orderer/consensus/kafka/chain_test.go#L2548)<br><strong>Comment</strong>: <pre>What does this mean exactly? Can we be a bit more verbose here?</pre><strong>Commenter</strong>: Luis Sanchez - luiss@me.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain_test.go#L2548](https://github.com/hyperledger-gerrit-archive/fabric/blob/74de59d8403fa45a9412a1f1c193417c25b4eaa8/orderer/consensus/kafka/chain_test.go#L2548)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain_test.go#L2563](https://github.com/hyperledger-gerrit-archive/fabric/blob/74de59d8403fa45a9412a1f1c193417c25b4eaa8/orderer/consensus/kafka/chain_test.go#L2563)<br><strong>Comment</strong>: <pre>All of the time values should be set to one of the time-related variables at the top of the file:
- extraShortTimeout
- shortTimeout
- longTimeout

This matches what the rest of the tests in this package do as well.

This applies to the rest of your tests as well.</pre><strong>Commenter</strong>: Luis Sanchez - luiss@me.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain_test.go#L2563](https://github.com/hyperledger-gerrit-archive/fabric/blob/74de59d8403fa45a9412a1f1c193417c25b4eaa8/orderer/consensus/kafka/chain_test.go#L2563)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain_test.go#L2564](https://github.com/hyperledger-gerrit-archive/fabric/blob/74de59d8403fa45a9412a1f1c193417c25b4eaa8/orderer/consensus/kafka/chain_test.go#L2564)<br><strong>Comment</strong>: <pre>(have?)</pre><strong>Commenter</strong>: Luis Sanchez - luiss@me.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain_test.go#L2564](https://github.com/hyperledger-gerrit-archive/fabric/blob/74de59d8403fa45a9412a1f1c193417c25b4eaa8/orderer/consensus/kafka/chain_test.go#L2564)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain_test.go#L2602](https://github.com/hyperledger-gerrit-archive/fabric/blob/74de59d8403fa45a9412a1f1c193417c25b4eaa8/orderer/consensus/kafka/chain_test.go#L2602)<br><strong>Comment</strong>: <pre>(omit?)</pre><strong>Commenter</strong>: Luis Sanchez - luiss@me.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain_test.go#L2602](https://github.com/hyperledger-gerrit-archive/fabric/blob/74de59d8403fa45a9412a1f1c193417c25b4eaa8/orderer/consensus/kafka/chain_test.go#L2602)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain_test.go#L2630](https://github.com/hyperledger-gerrit-archive/fabric/blob/74de59d8403fa45a9412a1f1c193417c25b4eaa8/orderer/consensus/kafka/chain_test.go#L2630)<br><strong>Comment</strong>: <pre>Does this expression implies that it's OK for the test to take anywhere up to a minute to complete? If that is the case, we'll need to change this. If the period here is a function of the default `ChannelTopicSubscriptionTimeout` value, then that value should be modified (decreased) via the `mockRetryOptions` variable, which then needs to be fed into this test.

(This is similar to what the rest of the tests in this file do as well.)</pre><strong>Commenter</strong>: Luis Sanchez - luiss@me.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain_test.go#L2630](https://github.com/hyperledger-gerrit-archive/fabric/blob/74de59d8403fa45a9412a1f1c193417c25b4eaa8/orderer/consensus/kafka/chain_test.go#L2630)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/logger.go#L76](https://github.com/hyperledger-gerrit-archive/fabric/blob/74de59d8403fa45a9412a1f1c193417c25b4eaa8/orderer/consensus/kafka/logger.go#L76)<br><strong>Comment</strong>: <pre>Shouldn't this be exposed as a configuration setting?</pre></blockquote><h3>PatchSet Number: 9</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Luis Sanchez - luiss@me.com<br><strong>Uploader</strong>: Luis Sanchez - luiss@me.com<br><strong>Created</strong>: 9/25/2017, 1:26:40 PM<br><strong>UnmergedRevision</strong>: [13ad6f2ec3c19cb48985773ae96f03eda0e6c39a](https://github.com/hyperledger-gerrit-archive/fabric/commit/13ad6f2ec3c19cb48985773ae96f03eda0e6c39a)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/25/2017, 2:57:36 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 10</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Luis Sanchez - luiss@me.com<br><strong>Uploader</strong>: Luis Sanchez - luiss@me.com<br><strong>Created</strong>: 9/25/2017, 4:10:40 PM<br><strong>UnmergedRevision</strong>: [7c256d470eef2dc7cc96538c4287fe0d8355afcb](https://github.com/hyperledger-gerrit-archive/fabric/commit/7c256d470eef2dc7cc96538c4287fe0d8355afcb)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/25/2017, 5:38:04 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 11</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Luis Sanchez - luiss@me.com<br><strong>Uploader</strong>: Luis Sanchez - luiss@me.com<br><strong>Created</strong>: 9/25/2017, 11:14:11 PM<br><strong>UnmergedRevision</strong>: [a89cbd5ee43e401db217c404c9ecccfbd7c6605d](https://github.com/hyperledger-gerrit-archive/fabric/commit/a89cbd5ee43e401db217c404c9ecccfbd7c6605d)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/26/2017, 12:43:27 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Approved</strong>: 9/26/2017, 5:56:21 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [/COMMIT_MSG#L15](https://github.com/hyperledger-gerrit-archive/fabric/blob/a89cbd5ee43e401db217c404c9ecccfbd7c6605d//COMMIT_MSG#L15)<br><strong>Comment</strong>: <pre>Let's update the commit message since this is no longer the case.</pre><strong>Commenter</strong>: Luis Sanchez - luiss@me.com<br><strong>CommentLine</strong>: [/COMMIT_MSG#L15](https://github.com/hyperledger-gerrit-archive/fabric/blob/a89cbd5ee43e401db217c404c9ecccfbd7c6605d//COMMIT_MSG#L15)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain_test.go#L2454](https://github.com/hyperledger-gerrit-archive/fabric/blob/a89cbd5ee43e401db217c404c9ecccfbd7c6605d/orderer/consensus/kafka/chain_test.go#L2454)<br><strong>Comment</strong>: <pre>(should have?)</pre><strong>Commenter</strong>: Luis Sanchez - luiss@me.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/chain_test.go#L2454](https://github.com/hyperledger-gerrit-archive/fabric/blob/a89cbd5ee43e401db217c404c9ecccfbd7c6605d/orderer/consensus/kafka/chain_test.go#L2454)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/consensus/kafka/logger.go#L90](https://github.com/hyperledger-gerrit-archive/fabric/blob/a89cbd5ee43e401db217c404c9ecccfbd7c6605d/orderer/consensus/kafka/logger.go#L90)<br><strong>Comment</strong>: <pre>It might not be a bad idea to explain, via a short code comment here, why you decided to stick with a map instead of just a slice of channels.
(As a developer reading the code, I'd be inclined to think that this implementation is wrong w/o hearing your thinking.)</pre></blockquote><h3>PatchSet Number: 12</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Luis Sanchez - luiss@me.com<br><strong>Uploader</strong>: Luis Sanchez - luiss@me.com<br><strong>Created</strong>: 9/26/2017, 10:20:32 AM<br><strong>GitHubMergedRevision</strong>: [d151ef89c35c73b25a445e2096b4bada324d5a07](https://github.com/hyperledger-gerrit-archive/fabric/commit/d151ef89c35c73b25a445e2096b4bada324d5a07)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/26/2017, 11:49:37 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Approved</strong>: 9/26/2017, 1:27:06 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Approved</strong>: 10/1/2017, 10:19:17 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Jason Yellick<br><strong>Merged</strong>: 10/1/2017, 10:19:30 PM<br><br></blockquote>