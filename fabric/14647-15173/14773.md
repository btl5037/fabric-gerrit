<strong>Project</strong>: fabric<br><strong>Branch</strong>: master<br><strong>ID</strong>: 14773<br><strong>Subject</strong>: [FAB-6716] Enabled mutual TLS support for orderer<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 10/23/2017, 8:58:42 AM<br><strong>LastUpdated</strong>: 10/24/2017, 4:09:36 PM<br><strong>CommitMessage</strong>:<br><pre>[FAB-6716] Enabled mutual TLS support for orderer

The orderer currently supports the ability to
require mutual TLS, however it only uses a
static list of root CAs to validate client
certificates.  In order to support the
dynamic membership capabilities of channels,
the trusted client roots for the gRPC server
need to be updated whenever channel membership
is changed.

Also need to modify a core/peer test as a
TLS intermediate root was added to the
sampleconfig for completeness

Change-Id: I4eccfd88ff7b86621b356e9f880062f98c425c60
Signed-off-by: Gari Singh <gari.r.singh@gmail.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 10/23/2017, 8:58:42 AM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/23/2017, 8:58:52 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/14058/ (1/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/23/2017, 9:00:25 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/9979/ (2/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/23/2017, 9:01:02 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/995/ (3/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/23/2017, 9:01:23 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/18337/ (4/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/23/2017, 9:02:30 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/12349/ (5/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/23/2017, 9:46:36 AM<br><strong>Message</strong>: <pre>Patch Set 1: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/18337/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/18337/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/18337

https://jenkins.hyperledger.org/job/fabric-verify-z/14058/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-z/14058/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/14058

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/9979/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/9979

https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/995/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-two-staged-ci-check-x86_64/995

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/12349/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/12349</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 10/23/2017, 9:52:47 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(1 comment)</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 10/23/2017, 10:42:36 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(1 comment)</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 10/23/2017, 10:56:20 AM<br><strong>Message</strong>: <pre>Uploaded patch set 2.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/23/2017, 11:24:50 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/9995/ (1/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/23/2017, 11:24:51 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/18353/ (3/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/23/2017, 11:24:51 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/1010/ (2/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/23/2017, 11:26:03 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/12365/ (4/5)</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 10/23/2017, 11:35:33 AM<br><strong>Message</strong>: <pre>Patch Set 2:

(1 comment)

Changes in the orderer look sensible to me.  One rambling comment on the higher level approach to multiple copies of MSP across channels.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/23/2017, 11:39:15 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/14074/ (5/5)</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 10/23/2017, 12:01:35 PM<br><strong>Message</strong>: <pre>Patch Set 2:

(1 comment)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/23/2017, 12:18:18 PM<br><strong>Message</strong>: <pre>Patch Set 2: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/1010/ : FAILURE (skipped)

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/1010/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-two-staged-ci-check-x86_64/1010

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/18353/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/18353/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/18353

https://jenkins.hyperledger.org/job/fabric-verify-z/14074/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-z/14074/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/14074

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/12365/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/12365/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/12365

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/9995/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/9995</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 10/23/2017, 1:22:44 PM<br><strong>Message</strong>: <pre>Patch Set 2:

rebuild-z</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 10/23/2017, 1:22:50 PM<br><strong>Message</strong>: <pre>Patch Set 2:

rebuild-x</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/23/2017, 1:22:50 PM<br><strong>Message</strong>: <pre>Patch Set 2: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/14080/ (1/2)</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 10/23/2017, 1:23:21 PM<br><strong>Message</strong>: <pre>Patch Set 2:

rebuild-behave</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/23/2017, 1:24:23 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/18360/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/23/2017, 1:25:28 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/12374/ (3/3)</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 10/23/2017, 1:25:44 PM<br><strong>Message</strong>: <pre>Patch Set 2:

(1 comment)</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 10/23/2017, 1:28:03 PM<br><strong>Message</strong>: <pre>Patch Set 2:

I meant to ask, of course - how would the server TLS handle handshake with 2 verification paths ending in the same AKI but with different keys?</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 10/23/2017, 1:54:44 PM<br><strong>Message</strong>: <pre>Patch Set 2:

> I meant to ask, of course - how would the server TLS handle
 > handshake with 2 verification paths ending in the same AKI but with
 > different keys?

If we truly have two different root certs, then the AKIs should be different (even if the subjects are the same).  So as long as AKIs don't overlap (which should be the case in the way we can generate them), then the net result is that we'll end up with both root certs in the trust store and TLS will consider this to be two different chains</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 10/23/2017, 2:16:05 PM<br><strong>Message</strong>: <pre>Patch Set 2:

(1 comment)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/23/2017, 2:21:29 PM<br><strong>Message</strong>: <pre>Patch Set 2: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-z/14080/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-z/14080/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/14080

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/18360/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/18360/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/18360

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/12374/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/12374</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 10/23/2017, 2:46:42 PM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/23/2017, 2:47:31 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/14082/ (1/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/23/2017, 2:50:37 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/10005/ (2/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/23/2017, 2:50:38 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/1015/ (3/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/23/2017, 2:51:06 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/18362/ (4/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/23/2017, 2:51:06 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/12376/ (5/5)</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 10/23/2017, 2:56:59 PM<br><strong>Message</strong>: <pre>Patch Set 3:

might help if I actually save my changes properly  :-)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/23/2017, 3:56:20 PM<br><strong>Message</strong>: <pre>Patch Set 3: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/10005/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/10005

https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/1015/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-two-staged-ci-check-x86_64/1015

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/18362/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/18362

https://jenkins.hyperledger.org/job/fabric-verify-z/14082/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/14082

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/12376/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/12376</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 10/24/2017, 7:36:56 AM<br><strong>Message</strong>: <pre>Patch Set 3:

> > I meant to ask, of course - how would the server TLS handle
 > > handshake with 2 verification paths ending in the same AKI but
 > with
 > > different keys?
 > 
 > If we truly have two different root certs, then the AKIs should be
 > different (even if the subjects are the same).  So as long as AKIs
 > don't overlap (which should be the case in the way we can generate
 > them), then the net result is that we'll end up with both root
 > certs in the trust store and TLS will consider this to be two
 > different chains

I should have said SKI - subject key identifier.  AKI is used when trying to find the parent roots for an issued certificate</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 10/24/2017, 8:29:36 AM<br><strong>Message</strong>: <pre>Patch Set 3:

(1 comment)</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 10/24/2017, 8:34:43 AM<br><strong>Message</strong>: <pre>Uploaded patch set 4.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/24/2017, 8:34:50 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/14093/ (1/5)</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 10/24/2017, 8:35:12 AM<br><strong>Message</strong>: <pre>Patch Set 4:

(1 comment)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/24/2017, 8:36:54 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/10020/ (2/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/24/2017, 8:37:43 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/1023/ (3/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/24/2017, 8:37:50 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/18371/ (4/5)</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 10/24/2017, 8:42:00 AM<br><strong>Message</strong>: <pre>Patch Set 4: Code-Review+2</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/24/2017, 8:44:21 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/12394/ (5/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/24/2017, 9:03:20 AM<br><strong>Message</strong>: <pre>Patch Set 4: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/10020/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/10020/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/10020

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/18371/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/18371/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/18371

https://jenkins.hyperledger.org/job/fabric-verify-z/14093/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-z/14093/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/14093

https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/1023/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-two-staged-ci-check-x86_64/1023

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/12394/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/12394</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 10/24/2017, 9:15:07 AM<br><strong>Message</strong>: <pre>Patch Set 4:

rebuild-e2e</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 10/24/2017, 9:15:38 AM<br><strong>Message</strong>: <pre>Patch Set 4:

rebuild-x</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/24/2017, 9:17:31 AM<br><strong>Message</strong>: <pre>Patch Set 4: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/10022/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/24/2017, 9:18:00 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/18373/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/24/2017, 9:48:44 AM<br><strong>Message</strong>: <pre>Patch Set 4: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/18373/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/18373/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/18373

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/10022/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/10022</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 10/24/2017, 10:02:54 AM<br><strong>Message</strong>: <pre>Patch Set 4:

(2 comments)

rebuild-x</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/24/2017, 10:07:37 AM<br><strong>Message</strong>: <pre>Patch Set 4: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/18375/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/24/2017, 10:29:26 AM<br><strong>Message</strong>: <pre>Patch Set 4: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/18375/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/18375/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/18375</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 10/24/2017, 10:52:00 AM<br><strong>Message</strong>: <pre>Uploaded patch set 5.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/24/2017, 10:52:11 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/14097/ (1/5)</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 10/24/2017, 10:53:09 AM<br><strong>Message</strong>: <pre>Patch Set 5:

(2 comments)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/24/2017, 10:54:34 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/10024/ (2/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/24/2017, 10:54:59 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/1026/ (3/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/24/2017, 10:57:51 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/18376/ (4/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/24/2017, 11:04:26 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/12398/ (5/5)</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 10/24/2017, 11:14:44 AM<br><strong>Message</strong>: <pre>Patch Set 5: Code-Review+2</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/24/2017, 11:20:59 AM<br><strong>Message</strong>: <pre>Patch Set 5: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/10024/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/10024/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/10024

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/18376/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/18376/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/18376

https://jenkins.hyperledger.org/job/fabric-verify-z/14097/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-z/14097/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/14097

https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/1026/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-two-staged-ci-check-x86_64/1026

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/12398/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/12398</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 10/24/2017, 12:04:42 PM<br><strong>Message</strong>: <pre>Patch Set 5:

rebuild-x rebuild-z rebuild-e2e</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/24/2017, 12:04:51 PM<br><strong>Message</strong>: <pre>Patch Set 5: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/14099/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/24/2017, 12:07:00 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/10026/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/24/2017, 12:07:06 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/18378/ (3/3)</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 10/24/2017, 12:33:10 PM<br><strong>Message</strong>: <pre>Patch Set 5: Code-Review+2</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/24/2017, 12:41:06 PM<br><strong>Message</strong>: <pre>Patch Set 5: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/18378/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/18378/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/18378

https://jenkins.hyperledger.org/job/fabric-verify-z/14099/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-z/14099/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/14099

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/10026/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/10026</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 10/24/2017, 1:39:23 PM<br><strong>Message</strong>: <pre>Patch Set 6: Patch Set 5 was rebased</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/24/2017, 1:39:32 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/14103/ (1/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/24/2017, 1:41:00 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/10030/ (2/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/24/2017, 1:41:32 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/1030/ (3/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/24/2017, 1:41:52 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/18382/ (4/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/24/2017, 1:42:32 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/12403/ (5/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/24/2017, 1:51:41 PM<br><strong>Message</strong>: <pre>Patch Set 6: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/10030/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/10030/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/10030

https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/1030/ : FAILURE (skipped)

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/1030/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-two-staged-ci-check-x86_64/1030

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/18382/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/18382/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/18382

https://jenkins.hyperledger.org/job/fabric-verify-z/14103/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-z/14103/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/14103

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/12403/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/12403/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/12403</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 10/24/2017, 2:54:13 PM<br><strong>Message</strong>: <pre>Uploaded patch set 7: Patch Set 6 was rebased.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/24/2017, 2:54:24 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/14107/ (1/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/24/2017, 2:56:11 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/10033/ (2/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/24/2017, 2:56:26 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/1032/ (3/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/24/2017, 2:57:07 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/18386/ (4/5)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/24/2017, 2:57:22 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/12406/ (5/5)</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 10/24/2017, 3:50:18 PM<br><strong>Message</strong>: <pre>Patch Set 7: Code-Review+2</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/24/2017, 4:08:49 PM<br><strong>Message</strong>: <pre>Patch Set 7: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/10033/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/10033

https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/1032/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-two-staged-ci-check-x86_64/1032

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/18386/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/18386

https://jenkins.hyperledger.org/job/fabric-verify-z/14107/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/14107

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/12406/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/12406</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 10/24/2017, 4:09:32 PM<br><strong>Message</strong>: <pre>Patch Set 7: Code-Review+2</pre><strong>Reviewer</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Reviewed</strong>: 10/24/2017, 4:09:36 PM<br><strong>Message</strong>: <pre>Change has been successfully merged by Kostas Christidis</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Uploader</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Created</strong>: 10/23/2017, 8:58:42 AM<br><strong>UnmergedRevision</strong>: [e26955dcd858f3197d7bf295e7ed1df25c024cb7](https://github.com/hyperledger-gerrit-archive/fabric/commit/e26955dcd858f3197d7bf295e7ed1df25c024cb7)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 10/23/2017, 9:46:36 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/server/main.go#L247](https://github.com/hyperledger-gerrit-archive/fabric/blob/e26955dcd858f3197d7bf295e7ed1df25c024cb7/orderer/common/server/main.go#L247)<br><strong>Comment</strong>: <pre>if you can check if this is required when setting up the callback, and make it a no-op callback in case it isn't then you can just get rid of this indentation, no?</pre><strong>Commenter</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>CommentLine</strong>: [orderer/common/server/main.go#L247](https://github.com/hyperledger-gerrit-archive/fabric/blob/e26955dcd858f3197d7bf295e7ed1df25c024cb7/orderer/common/server/main.go#L247)<br><strong>Comment</strong>: <pre>Good point.  Will do the check in the tlscallback function above</pre></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Uploader</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Created</strong>: 10/23/2017, 10:56:20 AM<br><strong>UnmergedRevision</strong>: [bf42c3b5251e1c4c3ea91c9fa2ff60f97d5194f4](https://github.com/hyperledger-gerrit-archive/fabric/commit/bf42c3b5251e1c4c3ea91c9fa2ff60f97d5194f4)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 10/23/2017, 2:21:29 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [orderer/common/server/main.go#L317](https://github.com/hyperledger-gerrit-archive/fabric/blob/bf42c3b5251e1c4c3ea91c9fa2ff60f97d5194f4/orderer/common/server/main.go#L317)<br><strong>Comment</strong>: <pre>Because the chains are iterated over in random order, and the SetClientRootCAs function does deduplication by subject, it seems like two different servers will very likely have two different trust stores for TLS.

Since there's no relative order across chains and updates anyway, I'm not sure it's worth addressing here.

My concern is "what if someone forgets to update their MSP on one channel?"  It seems like we could wind up picking the outdated MSP's TLS certs instead of the desired one?

I think gossip has similar problems if there is a non-updated MSP definition, so maybe we simply state that users must update their MSPs in all channels.

TLDR; Probably not worth addressing in this CR, but worth keeping in mind scenarios when an MSP in some channel is not updated.</pre><strong>Commenter</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>CommentLine</strong>: [orderer/common/server/main.go#L317](https://github.com/hyperledger-gerrit-archive/fabric/blob/bf42c3b5251e1c4c3ea91c9fa2ff60f97d5194f4/orderer/common/server/main.go#L317)<br><strong>Comment</strong>: <pre>I can create another CR to update that.  I can likely use / generate an AKI (authority key identifier) instead of using the subject.  On the other hand, if they actually use the same subject but create an entirely new key pair, it's likely that some clients will fail to submit messages for channels where they did make the change as well.</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/server/main.go#L317](https://github.com/hyperledger-gerrit-archive/fabric/blob/bf42c3b5251e1c4c3ea91c9fa2ff60f97d5194f4/orderer/common/server/main.go#L317)<br><strong>Comment</strong>: <pre>1) I don't think gossip doesn't really suffer from the problem because a malicious connected client only has a few seconds to authenticate itself before gossip disconnects the stream,
https://github.com/hyperledger/fabric/blob/master/gossip/comm/comm_impl.go#L595-L629
 and the authenticate after the TLS handshake is done via the signing identity. 
Did you have in mind some other attack, Jason?

2) w.r.t updating per AKI - would that even work? Does the verify() code in the x509 library know how to handle multiple verification chains with the same issuer but having different keys? Won't it give an "incorrectly signed" error or something?</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [orderer/common/server/main.go#L317](https://github.com/hyperledger-gerrit-archive/fabric/blob/bf42c3b5251e1c4c3ea91c9fa2ff60f97d5194f4/orderer/common/server/main.go#L317)<br><strong>Comment</strong>: <pre>I meant that gossip has the same problem in the sense that gossip is dealing with authentication from a 'union of channels' perspective, where each channel may define different crypto material for the same MSP ID.  So, if a channel is neglected/abandoned, the peer will continue to use the old crypto material, presumably until it expires (once expiration is implemented).

Both in gossip, and in this code, I think it's simple to argue 'working as designed, make sure you sync your MSP definitions.'

Still, I'd support Gari's proposed followup CR to use an AKI instead of the subject.  Failing the TLS handshake is I suspect going to be much harder to debug than failing to submit a message for a particular channel, so I'd rather see the problem pushed in that direction.</pre></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Uploader</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Created</strong>: 10/23/2017, 2:46:42 PM<br><strong>UnmergedRevision</strong>: [8083114cc0be361941a3359c1d9fcfbed6ea87ed](https://github.com/hyperledger-gerrit-archive/fabric/commit/8083114cc0be361941a3359c1d9fcfbed6ea87ed)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 10/23/2017, 3:56:20 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/server/main.go#L309](https://github.com/hyperledger-gerrit-archive/fabric/blob/8083114cc0be361941a3359c1d9fcfbed6ea87ed/orderer/common/server/main.go#L309)<br><strong>Comment</strong>: <pre>missing</pre></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Uploader</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Created</strong>: 10/24/2017, 8:34:43 AM<br><strong>UnmergedRevision</strong>: [5c7f64e2102a63ca18c170cec5aecc7854478b5b](https://github.com/hyperledger-gerrit-archive/fabric/commit/5c7f64e2102a63ca18c170cec5aecc7854478b5b)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 10/24/2017, 10:29:26 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Approved</strong>: 10/24/2017, 8:42:00 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>CommentLine</strong>: [orderer/common/server/main.go#L314](https://github.com/hyperledger-gerrit-archive/fabric/blob/5c7f64e2102a63ca18c170cec5aecc7854478b5b/orderer/common/server/main.go#L314)<br><strong>Comment</strong>: <pre>Yacov pointed out that this was missing</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/server/main_test.go#L315](https://github.com/hyperledger-gerrit-archive/fabric/blob/5c7f64e2102a63ca18c170cec5aecc7854478b5b/orderer/common/server/main_test.go#L315)<br><strong>Comment</strong>: <pre>(is, right?)</pre><strong>Commenter</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>CommentLine</strong>: [orderer/common/server/main_test.go#L315](https://github.com/hyperledger-gerrit-archive/fabric/blob/5c7f64e2102a63ca18c170cec5aecc7854478b5b/orderer/common/server/main_test.go#L315)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Kostas Christidis - kostas@gmail.com<br><strong>CommentLine</strong>: [orderer/common/server/main_test.go#L317](https://github.com/hyperledger-gerrit-archive/fabric/blob/5c7f64e2102a63ca18c170cec5aecc7854478b5b/orderer/common/server/main_test.go#L317)<br><strong>Comment</strong>: <pre>Perhaps I'm nitpicking here, but if the length during lines 289-290 is not equal to 0, then the expectation here shouldn't be that this one's 2, correct?
There is a dependency between the two groups of assertions.
Let us initialize `caSupport` again during this sub-test, or make it so that the target value is "old length + 2"?</pre><strong>Commenter</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>CommentLine</strong>: [orderer/common/server/main_test.go#L317](https://github.com/hyperledger-gerrit-archive/fabric/blob/5c7f64e2102a63ca18c170cec5aecc7854478b5b/orderer/common/server/main_test.go#L317)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 5</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Uploader</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Created</strong>: 10/24/2017, 10:52:00 AM<br><strong>UnmergedRevision</strong>: [51dd97c3421c33ea191bdf5c27bba932fcef2b50](https://github.com/hyperledger-gerrit-archive/fabric/commit/51dd97c3421c33ea191bdf5c27bba932fcef2b50)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 10/24/2017, 12:41:06 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Approved</strong>: 10/24/2017, 11:14:44 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Approved</strong>: 10/24/2017, 12:33:10 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 6</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Uploader</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Created</strong>: 10/24/2017, 1:39:23 PM<br><strong>UnmergedRevision</strong>: [28b5da4e71b80dbea5eeed26b3cfa31272deb4c9](https://github.com/hyperledger-gerrit-archive/fabric/commit/28b5da4e71b80dbea5eeed26b3cfa31272deb4c9)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 10/24/2017, 1:51:41 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 7</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Uploader</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Created</strong>: 10/24/2017, 2:54:13 PM<br><strong>GitHubMergedRevision</strong>: [e90b92ba6947d84ad5a4bdad5d1004f0bfd5819f](https://github.com/hyperledger-gerrit-archive/fabric/commit/e90b92ba6947d84ad5a4bdad5d1004f0bfd5819f)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 10/24/2017, 4:08:49 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Kostas Christidis - kostas@gmail.com<br><strong>Approved</strong>: 10/24/2017, 4:09:32 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Kostas Christidis<br><strong>Merged</strong>: 10/24/2017, 4:09:36 PM<br><br><strong>Approver</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Approved</strong>: 10/24/2017, 3:50:18 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br></blockquote>