<strong>Project</strong>: fabric<br><strong>Branch</strong>: master<br><strong>ID</strong>: 15037<br><strong>Subject</strong>: [FAB-6486] Periodically check for ledger integrity<br><strong>Status</strong>: ABANDONED<br><strong>Owner</strong>: Qi Zhang - rickcheung@foxmail.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 10/31/2017, 5:21:14 PM<br><strong>LastUpdated</strong>: 1/22/2018, 5:14:52 PM<br><strong>CommitMessage</strong>:<br><pre>[FAB-6486] Periodically check for ledger integrity

Change-Id: I6b6406b648f38d0d49f506fad43c06edb44301c8
Signed-off-by: Qi Zhang <rickcheung@foxmail.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Qi Zhang - rickcheung@foxmail.com<br><strong>Reviewed</strong>: 10/31/2017, 5:21:14 PM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/31/2017, 5:21:22 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/1243/ (1/6)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/31/2017, 5:21:23 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/10276/ (3/6)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/31/2017, 5:21:23 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/18630/ (4/6)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/31/2017, 5:21:23 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/14351/ (2/6)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/31/2017, 5:23:50 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/12648/ (5/6)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/31/2017, 5:24:05 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-smoke-tests-verify-x86_64/95/ (6/6)</pre><strong>Reviewer</strong>: Qi Zhang - rickcheung@foxmail.com<br><strong>Reviewed</strong>: 10/31/2017, 5:24:05 PM<br><strong>Message</strong>: <pre>Uploaded patch set 2: Commit message was updated.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/31/2017, 5:24:26 PM<br><strong>Message</strong>: <pre>Patch Set 1: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/10276/ : ABORTED

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/10276/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/10276

https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/1243/ : ABORTED

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/1243/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-two-staged-ci-check-x86_64/1243

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/18630/ : ABORTED

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/18630/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/18630

https://jenkins.hyperledger.org/job/fabric-verify-z/14351/ : ABORTED

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-z/14351/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-z/14351

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/12648/ : ABORTED

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/12648/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-behave-x86_64/12648

https://jenkins.hyperledger.org/job/fabric-smoke-tests-verify-x86_64/95/ : ABORTED

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-smoke-tests-verify-x86_64/95/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-smoke-tests-verify-x86_64/95</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/31/2017, 5:24:26 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-smoke-tests-verify-x86_64/96/ (1/6)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/31/2017, 5:24:26 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/1244/ (2/6)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/31/2017, 5:24:26 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/18631/ (5/6)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/31/2017, 5:24:27 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/14352/ (4/6)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/31/2017, 5:24:27 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/10277/ (3/6)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/31/2017, 5:24:27 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/12649/ (6/6)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/31/2017, 6:25:53 PM<br><strong>Message</strong>: <pre>Patch Set 2: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/10277/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/10277/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/10277

https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/1244/ : FAILURE (skipped)

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-two-staged-ci-check-x86_64/1244/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-two-staged-ci-check-x86_64/1244

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/18631/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/18631/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/18631

https://jenkins.hyperledger.org/job/fabric-verify-z/14352/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-z/14352/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-z/14352

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/12649/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/12649/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-behave-x86_64/12649

https://jenkins.hyperledger.org/job/fabric-smoke-tests-verify-x86_64/96/ : UNSTABLE (skipped)

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-smoke-tests-verify-x86_64/96/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-smoke-tests-verify-x86_64/96</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 11/1/2017, 5:16:51 AM<br><strong>Message</strong>: <pre>Patch Set 2: Code-Review+2

(12 comments)

Honestly I do not think that this logic should be part of the peer process, since it has very heavy overhead, for example checking for integrity over all time will most likely increase linearly with number of blocks, hence at some point time to check will be much greater than period of checks.

Also I do not think that ledger API has to be extended to support fix or replication of broken or corrupted blocks, since as far as I remember correctly if you will try to commit block from the past ledger won't accept it.

Overall I think this feature has not cooked yet and we need to turn back to the design table.</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 11/1/2017, 5:16:58 AM<br><strong>Message</strong>: <pre>Patch Set 2: Code-Review-2</pre><strong>Reviewer</strong>: Qi Zhang - rickcheung@foxmail.com<br><strong>Reviewed</strong>: 1/12/2018, 10:38:16 AM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/12/2018, 10:40:02 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/11964/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/12/2018, 10:40:15 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/14371/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/12/2018, 10:41:12 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20241/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/12/2018, 10:55:24 AM<br><strong>Message</strong>: <pre>Patch Set 3: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/11964/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/11964/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/11964

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/14371/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/14371/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-behave-x86_64/14371

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20241/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20241/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/20241

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/695/ : fabric-verify-build-checks-x86_64 finish successful - $TRIGGER_COMMENT

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/695</pre><strong>Reviewer</strong>: Qi Zhang - rickcheung@foxmail.com<br><strong>Reviewed</strong>: 1/12/2018, 11:18:58 AM<br><strong>Message</strong>: <pre>Uploaded patch set 4.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/12/2018, 11:19:06 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/11965/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/12/2018, 11:22:36 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/14372/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/12/2018, 11:22:42 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20242/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/12/2018, 11:41:26 AM<br><strong>Message</strong>: <pre>Patch Set 4: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/14372/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/14372/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-behave-x86_64/14372

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20242/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20242/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/20242

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/11965/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/11965

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/696/ : fabric-verify-build-checks-x86_64 finish successful - $TRIGGER_COMMENT

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/696</pre><strong>Reviewer</strong>: Qi Zhang - rickcheung@foxmail.com<br><strong>Reviewed</strong>: 1/22/2018, 5:14:52 PM<br><strong>Message</strong>: <pre>Abandoned

Design changed</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Qi Zhang - rickcheung@foxmail.com<br><strong>Uploader</strong>: Qi Zhang - rickcheung@foxmail.com<br><strong>Created</strong>: 10/31/2017, 5:21:14 PM<br><strong>UnmergedRevision</strong>: [182508bd7506dfe8378e6a5165fed361164a310a](https://github.com/hyperledger-gerrit-archive/fabric/commit/182508bd7506dfe8378e6a5165fed361164a310a)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 10/31/2017, 5:24:26 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: NO_CODE_CHANGE<br><strong>Author</strong>: Qi Zhang - rickcheung@foxmail.com<br><strong>Uploader</strong>: Qi Zhang - rickcheung@foxmail.com<br><strong>Created</strong>: 10/31/2017, 5:24:05 PM<br><strong>UnmergedRevision</strong>: [74c6a85dad764f1689dcebfa4a24fae4ab6b68ac](https://github.com/hyperledger-gerrit-archive/fabric/commit/74c6a85dad764f1689dcebfa4a24fae4ab6b68ac)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 10/31/2017, 6:25:53 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Approved</strong>: 11/1/2017, 5:16:58 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [core/ledger/ledgermgmt/ledger_mgmt.go#L168](https://github.com/hyperledger-gerrit-archive/fabric/blob/74c6a85dad764f1689dcebfa4a24fae4ab6b68ac/core/ledger/ledgermgmt/ledger_mgmt.go#L168)<br><strong>Comment</strong>: <pre>How this expected to work if the only block I'd like to check is the genesis block?</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [core/ledger/ledgermgmt/ledger_mgmt.go#L179](https://github.com/hyperledger-gerrit-archive/fabric/blob/74c6a85dad764f1689dcebfa4a24fae4ab6b68ac/core/ledger/ledgermgmt/ledger_mgmt.go#L179)<br><strong>Comment</strong>: <pre>at least</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [core/ledger/ledgermgmt/ledger_mgmt.go#L180](https://github.com/hyperledger-gerrit-archive/fabric/blob/74c6a85dad764f1689dcebfa4a24fae4ab6b68ac/core/ledger/ledgermgmt/ledger_mgmt.go#L180)<br><strong>Comment</strong>: <pre>I think it should be

      logger.Errorf("Start block number (%d) should not be below ledger height (%d)", startBlockNum, blockChainInfo.Height)</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [core/ledger/ledgermgmt/ledger_mgmt.go#L184](https://github.com/hyperledger-gerrit-archive/fabric/blob/74c6a85dad764f1689dcebfa4a24fae4ab6b68ac/core/ledger/ledgermgmt/ledger_mgmt.go#L184)<br><strong>Comment</strong>: <pre>IMO this case is an error.</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [core/ledger/ledgermgmt/ledger_mgmt.go#L215](https://github.com/hyperledger-gerrit-archive/fabric/blob/74c6a85dad764f1689dcebfa4a24fae4ab6b68ac/core/ledger/ledgermgmt/ledger_mgmt.go#L215)<br><strong>Comment</strong>: <pre>Why this statement leads to conclusion of block not being fixed? Who tried to fix it?</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [core/ledger/ledgermgmt/ledger_mgmt.go#L217](https://github.com/hyperledger-gerrit-archive/fabric/blob/74c6a85dad764f1689dcebfa4a24fae4ab6b68ac/core/ledger/ledgermgmt/ledger_mgmt.go#L217)<br><strong>Comment</strong>: <pre>we are at last</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [core/ledger/ledgermgmt/ledger_mgmt.go#L223](https://github.com/hyperledger-gerrit-archive/fabric/blob/74c6a85dad764f1689dcebfa4a24fae4ab6b68ac/core/ledger/ledgermgmt/ledger_mgmt.go#L223)<br><strong>Comment</strong>: <pre>This will not lead state transfer mechanism to replicate the corrupted block</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [core/ledger/ledgermgmt/ledger_mgmt.go#L245](https://github.com/hyperledger-gerrit-archive/fabric/blob/74c6a85dad764f1689dcebfa4a24fae4ab6b68ac/core/ledger/ledgermgmt/ledger_mgmt.go#L245)<br><strong>Comment</strong>: <pre>Why are you duplicating this check here again? E.g. you already have this check at lines 220-223, am I missing something?</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [core/peer/peer.go#L671](https://github.com/hyperledger-gerrit-archive/fabric/blob/74c6a85dad764f1689dcebfa4a24fae4ab6b68ac/core/peer/peer.go#L671)<br><strong>Comment</strong>: <pre>I think in case of error there is no need to continue, since you just failed to obtain ledger info.

Moreover it seems you need to periodically check this, since this information will be continuously updated over time.</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [gossip/state/state.go#L30](https://github.com/hyperledger-gerrit-archive/fabric/blob/74c6a85dad764f1689dcebfa4a24fae4ab6b68ac/gossip/state/state.go#L30)<br><strong>Comment</strong>: <pre>Seems that these global variables are accessed from different go routines, hence has to be mutex protected.</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [gossip/state/state.go#L609](https://github.com/hyperledger-gerrit-archive/fabric/blob/74c6a85dad764f1689dcebfa4a24fae4ab6b68ac/gossip/state/state.go#L609)<br><strong>Comment</strong>: <pre>This change completely misses the intended logic. Here the code flow checks whenever there are missing blocks and trying to request them from the neighbor peers.

By the change below it seems that you will be always assuming blocks are corrupted.</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [gossip/state/state.go#L683](https://github.com/hyperledger-gerrit-archive/fabric/blob/74c6a85dad764f1689dcebfa4a24fae4ab6b68ac/gossip/state/state.go#L683)<br><strong>Comment</strong>: <pre>Why this section leads to 

       CorruptedBlock = true</pre></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Qi Zhang - rickcheung@foxmail.com<br><strong>Uploader</strong>: Qi Zhang - rickcheung@foxmail.com<br><strong>Created</strong>: 1/12/2018, 10:38:16 AM<br><strong>UnmergedRevision</strong>: [a9da1479a1309567ace0e7454c5b9314f6ddbb42](https://github.com/hyperledger-gerrit-archive/fabric/commit/a9da1479a1309567ace0e7454c5b9314f6ddbb42)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/12/2018, 10:55:24 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Approved</strong>: 11/1/2017, 5:16:58 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Qi Zhang - rickcheung@foxmail.com<br><strong>Uploader</strong>: Qi Zhang - rickcheung@foxmail.com<br><strong>Created</strong>: 1/12/2018, 11:18:58 AM<br><strong>UnmergedRevision</strong>: [78e7f952d050ab7ad915e50bcbece7b386fbf8f2](https://github.com/hyperledger-gerrit-archive/fabric/commit/78e7f952d050ab7ad915e50bcbece7b386fbf8f2)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/12/2018, 11:41:26 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Approved</strong>: 11/1/2017, 5:16:58 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br></blockquote>