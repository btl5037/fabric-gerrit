<strong>Project</strong>: fabric<br><strong>Branch</strong>: master<br><strong>ID</strong>: 17665<br><strong>Subject</strong>: [FAB-8103] final HasMore should return false<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Luis Sanchez - luiss@me.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 2/8/2018, 1:10:53 AM<br><strong>LastUpdated</strong>: 2/21/2018, 9:02:03 PM<br><strong>CommitMessage</strong>:<br><pre>[FAB-8103] final HasMore should return false

final GET_STATE_BY_RANGE response now indicates that
there are no more results when the total number of
responses are a multiple of maxResultLimit (the maximum
number of responses that can be returned in a single
GET_STATE_BY_RANGE response).

Change-Id: Ifd482f6f0951ac69698a5cd9f2c610ef84654bf7
Signed-off-by: Luis Sanchez <sanchezl@us.ibm.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Luis Sanchez - luiss@me.com<br><strong>Reviewed</strong>: 2/8/2018, 1:10:53 AM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/8/2018, 1:13:06 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/1244/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/8/2018, 1:13:09 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20801/ (2/3)</pre><strong>Reviewer</strong>: Luis Sanchez - luiss@me.com<br><strong>Reviewed</strong>: 2/8/2018, 1:13:25 AM<br><strong>Message</strong>: <pre>Patch Set 1: Code-Review-1

WIP</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/8/2018, 1:14:01 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12487/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/8/2018, 1:39:53 AM<br><strong>Message</strong>: <pre>Patch Set 1: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/1244/ : FAILURE (skipped)

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/1244/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/1244

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20801/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/20801

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12487/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/12487</pre><strong>Reviewer</strong>: Luis Sanchez - luiss@me.com<br><strong>Reviewed</strong>: 2/8/2018, 1:42:22 AM<br><strong>Message</strong>: <pre>Uploaded patch set 2.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/8/2018, 1:44:24 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/1245/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/8/2018, 1:45:16 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20802/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/8/2018, 1:45:19 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12488/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/8/2018, 1:55:53 AM<br><strong>Message</strong>: <pre>Patch Set 2: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20802/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20802/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/20802

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/1245/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/1245

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12488/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/12488</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 2/8/2018, 7:02:30 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Can you explain how this solves it?

Instead of changing the contract, can you simply iterate to the 101st item and check if it is there and set HasMore accordingly?  But not append it to the result set (append it at the beginning of the next page instead).</pre><strong>Reviewer</strong>: Luis Sanchez - luiss@me.com<br><strong>Reviewed</strong>: 2/8/2018, 8:08:54 AM<br><strong>Message</strong>: <pre>Patch Set 2:

reverify</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/8/2018, 8:11:34 AM<br><strong>Message</strong>: <pre>Patch Set 2: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20803/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/8/2018, 8:12:29 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12489/ (2/2)</pre><strong>Reviewer</strong>: Luis Sanchez - luiss@me.com<br><strong>Reviewed</strong>: 2/8/2018, 8:32:54 AM<br><strong>Message</strong>: <pre>Patch Set 2:

> Can you explain how this solves it?
> 
By returning an empty list, it should not break well behaved clients of this API that are expecting a list. (see FAB-8115).
> Instead of changing the contract, can you simply iterate to the 101st item and check if it is there and set HasMore accordingly?  But not append it to the result set (append it at the beginning of the next page instead).

I was going for the most minimally invasive thing that would solve the immediate problem, without breaking a well behaving client. I can make the more invasive change instead.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/8/2018, 8:40:54 AM<br><strong>Message</strong>: <pre>Patch Set 2: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20803/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/20803

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12489/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/12489</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 2/8/2018, 9:28:44 AM<br><strong>Message</strong>: <pre>Patch Set 2:

I'd suggest fix HasMore function in FAB-8103.  And fix the nil response in FAB-8115.  I believe this is what the reporter intended.</pre><strong>Reviewer</strong>: Luis Sanchez - luiss@me.com<br><strong>Reviewed</strong>: 2/9/2018, 12:42:18 AM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Luis Sanchez - luiss@me.com<br><strong>Reviewed</strong>: 2/9/2018, 12:42:45 AM<br><strong>Message</strong>: <pre>Uploaded patch set 4: Patch Set 3 was rebased.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/9/2018, 12:42:47 AM<br><strong>Message</strong>: <pre>Patch Set 3:

No Builds Executed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/9/2018, 12:44:39 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20847/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/9/2018, 12:45:37 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12531/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/9/2018, 12:45:41 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/1285/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/9/2018, 1:06:44 AM<br><strong>Message</strong>: <pre>Patch Set 4: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20847/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/20847

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12531/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/12531

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/1285/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/1285</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 2/13/2018, 3:59:28 PM<br><strong>Message</strong>: <pre>Patch Set 4:

(4 comments)

Looks good and I've tested e2e with success.  Would also like Murali to take a look.

Just a few minor things...

handler_test.go can be called queryresponse_test.go since it only tests one aspect, not the entire handler.</pre><strong>Reviewer</strong>: Luis Sanchez - luiss@me.com<br><strong>Reviewed</strong>: 2/14/2018, 3:07:07 PM<br><strong>Message</strong>: <pre>Uploaded patch set 5.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/14/2018, 3:09:20 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20938/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/14/2018, 3:09:43 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12616/ (2/2)</pre><strong>Reviewer</strong>: Luis Sanchez - luiss@me.com<br><strong>Reviewed</strong>: 2/14/2018, 3:14:51 PM<br><strong>Message</strong>: <pre>Patch Set 5:

(4 comments)

> handler_test.go can be called queryresponse_test.go since it only tests one aspect, not the entire handler.

I prefer the 'handler_test.go' name as it matches the typical golang convention. I can see others in the future adding more unit tests here in order to improve the the relatively light code coverage of this package.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/14/2018, 3:33:42 PM<br><strong>Message</strong>: <pre>Patch Set 5: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20938/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/20938

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12616/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/12616</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 2/14/2018, 3:59:38 PM<br><strong>Message</strong>: <pre>Patch Set 5: Code-Review+2</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 2/15/2018, 11:38:04 PM<br><strong>Message</strong>: <pre>Patch Set 5:

(4 comments)</pre><strong>Reviewer</strong>: Luis Sanchez - luiss@me.com<br><strong>Reviewed</strong>: 2/16/2018, 11:19:32 AM<br><strong>Message</strong>: <pre>Uploaded patch set 6.</pre><strong>Reviewer</strong>: Luis Sanchez - luiss@me.com<br><strong>Reviewed</strong>: 2/16/2018, 11:21:24 AM<br><strong>Message</strong>: <pre>Patch Set 6:

(2 comments)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/16/2018, 11:22:16 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12658/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/16/2018, 11:23:17 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20974/ (2/2)</pre><strong>Reviewer</strong>: Luis Sanchez - luiss@me.com<br><strong>Reviewed</strong>: 2/16/2018, 11:25:26 AM<br><strong>Message</strong>: <pre>Patch Set 6:

I missed Manish's comments on the unit test in my last patch. I will upload another patch set to address his comments in a few hours.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/16/2018, 11:47:30 AM<br><strong>Message</strong>: <pre>Patch Set 6: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20974/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20974/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/20974

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12658/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/12658</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 2/16/2018, 12:06:55 PM<br><strong>Message</strong>: <pre>Patch Set 6:

(1 comment)</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 2/16/2018, 1:07:52 PM<br><strong>Message</strong>: <pre>Patch Set 6:

(1 comment)</pre><strong>Reviewer</strong>: Luis Sanchez - luiss@me.com<br><strong>Reviewed</strong>: 2/16/2018, 4:53:39 PM<br><strong>Message</strong>: <pre>Patch Set 7: Patch Set 6 was rebased</pre><strong>Reviewer</strong>: Luis Sanchez - luiss@me.com<br><strong>Reviewed</strong>: 2/16/2018, 4:54:44 PM<br><strong>Message</strong>: <pre>Patch Set 7:

(1 comment)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/16/2018, 4:55:47 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12665/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/16/2018, 4:56:50 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20981/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/16/2018, 5:18:32 PM<br><strong>Message</strong>: <pre>Patch Set 7: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12665/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/12665

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/20981/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/20981</pre><strong>Reviewer</strong>: Luis Sanchez - luiss@me.com<br><strong>Reviewed</strong>: 2/21/2018, 8:08:48 AM<br><strong>Message</strong>: <pre>Uploaded patch set 8.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/21/2018, 8:11:29 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12757/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/21/2018, 8:12:04 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/21067/ (2/2)</pre><strong>Reviewer</strong>: Luis Sanchez - luiss@me.com<br><strong>Reviewed</strong>: 2/21/2018, 8:35:06 AM<br><strong>Message</strong>: <pre>Uploaded patch set 9.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/21/2018, 8:35:27 AM<br><strong>Message</strong>: <pre>Patch Set 8: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12757/ : ABORTED

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12757/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/12757

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/21067/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-x86_64/21067/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/21067</pre><strong>Reviewer</strong>: Luis Sanchez - luiss@me.com<br><strong>Reviewed</strong>: 2/21/2018, 8:36:39 AM<br><strong>Message</strong>: <pre>Patch Set 9:

(3 comments)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/21/2018, 8:37:39 AM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12759/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/21/2018, 8:38:01 AM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/21069/ (2/2)</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 2/21/2018, 9:23:38 AM<br><strong>Message</strong>: <pre>Patch Set 9:

(1 comment)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/21/2018, 9:28:52 AM<br><strong>Message</strong>: <pre>Patch Set 9: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12759/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12759/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/12759

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/21069/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/21069</pre><strong>Reviewer</strong>: Luis Sanchez - luiss@me.com<br><strong>Reviewed</strong>: 2/21/2018, 9:36:21 AM<br><strong>Message</strong>: <pre>Uploaded patch set 10.</pre><strong>Reviewer</strong>: Luis Sanchez - luiss@me.com<br><strong>Reviewed</strong>: 2/21/2018, 9:37:57 AM<br><strong>Message</strong>: <pre>Patch Set 10:

(1 comment)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/21/2018, 9:38:49 AM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12761/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/21/2018, 9:39:19 AM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/21071/ (2/2)</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 2/21/2018, 10:16:45 AM<br><strong>Message</strong>: <pre>Patch Set 10: Code-Review+1

(1 comment)

Will +2 after build passes</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/21/2018, 10:30:20 AM<br><strong>Message</strong>: <pre>Patch Set 10: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12761/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12761/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/12761

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/21071/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/21071</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 2/21/2018, 1:13:23 PM<br><strong>Message</strong>: <pre>Patch Set 9:

(1 comment)</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 2/21/2018, 3:21:17 PM<br><strong>Message</strong>: <pre>Patch Set 9:

(1 comment)</pre><strong>Reviewer</strong>: Luis Sanchez - luiss@me.com<br><strong>Reviewed</strong>: 2/21/2018, 5:00:19 PM<br><strong>Message</strong>: <pre>Uploaded patch set 11.</pre><strong>Reviewer</strong>: Luis Sanchez - luiss@me.com<br><strong>Reviewed</strong>: 2/21/2018, 5:01:13 PM<br><strong>Message</strong>: <pre>Patch Set 11:

(1 comment)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/21/2018, 5:02:07 PM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12785/ (1/2)</pre><strong>Reviewer</strong>: Luis Sanchez - luiss@me.com<br><strong>Reviewed</strong>: 2/21/2018, 5:02:32 PM<br><strong>Message</strong>: <pre>Patch Set 11:

(1 comment)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/21/2018, 5:02:52 PM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/21092/ (2/2)</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 2/21/2018, 5:21:47 PM<br><strong>Message</strong>: <pre>Patch Set 9:

(1 comment)</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 2/21/2018, 5:23:51 PM<br><strong>Message</strong>: <pre>Patch Set 11: Code-Review+2

(1 comment)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/21/2018, 5:32:11 PM<br><strong>Message</strong>: <pre>Patch Set 11: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/12785/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-end-2-end-x86_64/12785

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/21092/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-x86_64/21092</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 2/21/2018, 8:33:02 PM<br><strong>Message</strong>: <pre>Patch Set 11: Code-Review+2</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 2/21/2018, 8:33:06 PM<br><strong>Message</strong>: <pre>Change has been successfully merged by Manish Sethi</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/21/2018, 9:02:03 PM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/1881/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-end-2-end-x86_64/1881

https://jenkins.hyperledger.org/job/fabric-merge-x86_64/3204/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-x86_64/3204</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Luis Sanchez - luiss@me.com<br><strong>Uploader</strong>: Luis Sanchez - luiss@me.com<br><strong>Created</strong>: 2/8/2018, 1:10:53 AM<br><strong>UnmergedRevision</strong>: [fc3f45db332db6c76c2bfc331ad8f58b11536343](https://github.com/hyperledger-gerrit-archive/fabric/commit/fc3f45db332db6c76c2bfc331ad8f58b11536343)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/8/2018, 1:39:53 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Luis Sanchez - luiss@me.com<br><strong>Approved</strong>: 2/8/2018, 1:13:25 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Luis Sanchez - luiss@me.com<br><strong>Uploader</strong>: Luis Sanchez - luiss@me.com<br><strong>Created</strong>: 2/8/2018, 1:42:22 AM<br><strong>UnmergedRevision</strong>: [b51aa796f9abc3c7033414cbb764dd5be2154266](https://github.com/hyperledger-gerrit-archive/fabric/commit/b51aa796f9abc3c7033414cbb764dd5be2154266)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/8/2018, 8:40:54 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Luis Sanchez - luiss@me.com<br><strong>Uploader</strong>: Luis Sanchez - luiss@me.com<br><strong>Created</strong>: 2/9/2018, 12:42:18 AM<br><strong>UnmergedRevision</strong>: [2f00610d762911f9df45a33304b39338841e6114](https://github.com/hyperledger-gerrit-archive/fabric/commit/2f00610d762911f9df45a33304b39338841e6114)<br><br></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Luis Sanchez - luiss@me.com<br><strong>Uploader</strong>: Luis Sanchez - luiss@me.com<br><strong>Created</strong>: 2/9/2018, 12:42:45 AM<br><strong>UnmergedRevision</strong>: [db09b2ccef43173e58d20b7e8ef39f1384c2eab6](https://github.com/hyperledger-gerrit-archive/fabric/commit/db09b2ccef43173e58d20b7e8ef39f1384c2eab6)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/9/2018, 1:06:44 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/handler_test.go#L77](https://github.com/hyperledger-gerrit-archive/fabric/blob/db09b2ccef43173e58d20b7e8ef39f1384c2eab6/core/chaincode/handler_test.go#L77)<br><strong>Comment</strong>: <pre>Do you want to use the constant maxResultLimit, instead of hardcoding to 100?</pre><strong>Commenter</strong>: Luis Sanchez - luiss@me.com<br><strong>CommentLine</strong>: [core/chaincode/handler_test.go#L77](https://github.com/hyperledger-gerrit-archive/fabric/blob/db09b2ccef43173e58d20b7e8ef39f1384c2eab6/core/chaincode/handler_test.go#L77)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/handler_test.go#L78](https://github.com/hyperledger-gerrit-archive/fabric/blob/db09b2ccef43173e58d20b7e8ef39f1384c2eab6/core/chaincode/handler_test.go#L78)<br><strong>Comment</strong>: <pre>maxResultLimit</pre><strong>Commenter</strong>: Luis Sanchez - luiss@me.com<br><strong>CommentLine</strong>: [core/chaincode/handler_test.go#L78](https://github.com/hyperledger-gerrit-archive/fabric/blob/db09b2ccef43173e58d20b7e8ef39f1384c2eab6/core/chaincode/handler_test.go#L78)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/handler_test.go#L80](https://github.com/hyperledger-gerrit-archive/fabric/blob/db09b2ccef43173e58d20b7e8ef39f1384c2eab6/core/chaincode/handler_test.go#L80)<br><strong>Comment</strong>: <pre>maxResultLimit</pre><strong>Commenter</strong>: Luis Sanchez - luiss@me.com<br><strong>CommentLine</strong>: [core/chaincode/handler_test.go#L80](https://github.com/hyperledger-gerrit-archive/fabric/blob/db09b2ccef43173e58d20b7e8ef39f1384c2eab6/core/chaincode/handler_test.go#L80)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/handler_test.go#L83](https://github.com/hyperledger-gerrit-archive/fabric/blob/db09b2ccef43173e58d20b7e8ef39f1384c2eab6/core/chaincode/handler_test.go#L83)<br><strong>Comment</strong>: <pre>Why is the sleep needed?</pre><strong>Commenter</strong>: Luis Sanchez - luiss@me.com<br><strong>CommentLine</strong>: [core/chaincode/handler_test.go#L83](https://github.com/hyperledger-gerrit-archive/fabric/blob/db09b2ccef43173e58d20b7e8ef39f1384c2eab6/core/chaincode/handler_test.go#L83)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 5</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Luis Sanchez - luiss@me.com<br><strong>Uploader</strong>: Luis Sanchez - luiss@me.com<br><strong>Created</strong>: 2/14/2018, 3:07:07 PM<br><strong>UnmergedRevision</strong>: [46022817b8010342616d7c304bbaa62c8e2acb24](https://github.com/hyperledger-gerrit-archive/fabric/commit/46022817b8010342616d7c304bbaa62c8e2acb24)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/14/2018, 3:33:42 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Approved</strong>: 2/14/2018, 3:59:38 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/handler.go#L790](https://github.com/hyperledger-gerrit-archive/fabric/blob/46022817b8010342616d7c304bbaa62c8e2acb24/core/chaincode/handler.go#L790)<br><strong>Comment</strong>: <pre>would it be hard to move this function outside. The sequence of these three calls are getting called multiple times in this file - may be same for the intializing the querycontext?</pre><strong>Commenter</strong>: Luis Sanchez - luiss@me.com<br><strong>CommentLine</strong>: [core/chaincode/handler.go#L790](https://github.com/hyperledger-gerrit-archive/fabric/blob/46022817b8010342616d7c304bbaa62c8e2acb24/core/chaincode/handler.go#L790)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/handler.go#L814](https://github.com/hyperledger-gerrit-archive/fabric/blob/46022817b8010342616d7c304bbaa62c8e2acb24/core/chaincode/handler.go#L814)<br><strong>Comment</strong>: <pre>This whole block is repeated in the 'default:' clause as well. Better to change the function signature of 'pendingQueryResults.add' to take byte and perform marshaling inside that? Also, 'else{' is unnecessary.</pre><strong>Commenter</strong>: Luis Sanchez - luiss@me.com<br><strong>CommentLine</strong>: [core/chaincode/handler.go#L814](https://github.com/hyperledger-gerrit-archive/fabric/blob/46022817b8010342616d7c304bbaa62c8e2acb24/core/chaincode/handler.go#L814)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/handler_test.go#L32](https://github.com/hyperledger-gerrit-archive/fabric/blob/46022817b8010342616d7c304bbaa62c8e2acb24/core/chaincode/handler_test.go#L32)<br><strong>Comment</strong>: <pre>Can you please add a comment that these entries are based on the current value of maxResultLimit 100. If someone reduces this constant in the code, these tests may fail and it would be difficult to see the relationship. This may be true even for the entries where you use this constant, if  this constant is set to a significantly lower say 1 for some reason.</pre><strong>Commenter</strong>: Luis Sanchez - luiss@me.com<br><strong>CommentLine</strong>: [core/chaincode/handler_test.go#L32](https://github.com/hyperledger-gerrit-archive/fabric/blob/46022817b8010342616d7c304bbaa62c8e2acb24/core/chaincode/handler_test.go#L32)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/handler_test.go#L81](https://github.com/hyperledger-gerrit-archive/fabric/blob/46022817b8010342616d7c304bbaa62c8e2acb24/core/chaincode/handler_test.go#L81)<br><strong>Comment</strong>: <pre>I feel that this may be more readable if this if-else block is merged with the previous one such that the line 80 is moved after line 73. and the 'if' condition and line 78 is move after line 75 in the form of switch case - 1) case 1- tc.expectedResultCount == 0, case 2 - tc.expectedResultCount %maxResultLimit == 0, and then default.

But this may be my personal taste/opinion so you can leave this if you like it this way :-)</pre><strong>Commenter</strong>: Luis Sanchez - luiss@me.com<br><strong>CommentLine</strong>: [core/chaincode/handler_test.go#L81](https://github.com/hyperledger-gerrit-archive/fabric/blob/46022817b8010342616d7c304bbaa62c8e2acb24/core/chaincode/handler_test.go#L81)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 6</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Luis Sanchez - luiss@me.com<br><strong>Uploader</strong>: Luis Sanchez - luiss@me.com<br><strong>Created</strong>: 2/16/2018, 11:19:32 AM<br><strong>UnmergedRevision</strong>: [f94d07f96f623b2437eb447deed74e6b8521958d](https://github.com/hyperledger-gerrit-archive/fabric/commit/f94d07f96f623b2437eb447deed74e6b8521958d)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/16/2018, 11:47:30 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/handler.go#L778](https://github.com/hyperledger-gerrit-archive/fabric/blob/f94d07f96f623b2437eb447deed74e6b8521958d/core/chaincode/handler.go#L778)<br><strong>Comment</strong>: <pre>I didn't look deeply but shouldn't we lock in cleanupQueryContext once atomically instead of having 3 separate locks ?</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/handler.go#L778](https://github.com/hyperledger-gerrit-archive/fabric/blob/f94d07f96f623b2437eb447deed74e6b8521958d/core/chaincode/handler.go#L778)<br><strong>Comment</strong>: <pre>Yes Murali. That's right. Also, this function better be defined on '*Handler' type, I feel. Similarly, line 757-758 could be moved in a separate funciton say `handler.initQueryContext` and work with a single lock.</pre><strong>Commenter</strong>: Luis Sanchez - luiss@me.com<br><strong>CommentLine</strong>: [core/chaincode/handler.go#L778](https://github.com/hyperledger-gerrit-archive/fabric/blob/f94d07f96f623b2437eb447deed74e6b8521958d/core/chaincode/handler.go#L778)<br><strong>Comment</strong>: <pre>I was trying to keep the refactoring to a minimum, but there is just something funky about these iterators. I don't see why the handler is keeping a reference to them. There iterator itself should have all the state it needs. I will make an attempt to clean up on the next patch set.</pre><strong>Commenter</strong>: Luis Sanchez - luiss@me.com<br><strong>CommentLine</strong>: [core/chaincode/handler.go#L778](https://github.com/hyperledger-gerrit-archive/fabric/blob/f94d07f96f623b2437eb447deed74e6b8521958d/core/chaincode/handler.go#L778)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 7</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Luis Sanchez - luiss@me.com<br><strong>Uploader</strong>: Luis Sanchez - luiss@me.com<br><strong>Created</strong>: 2/16/2018, 4:53:39 PM<br><strong>UnmergedRevision</strong>: [346bc9df702722268ecb37277a32cf9eb6d6c05b](https://github.com/hyperledger-gerrit-archive/fabric/commit/346bc9df702722268ecb37277a32cf9eb6d6c05b)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/16/2018, 5:18:32 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 8</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Luis Sanchez - luiss@me.com<br><strong>Uploader</strong>: Luis Sanchez - luiss@me.com<br><strong>Created</strong>: 2/21/2018, 8:08:48 AM<br><strong>UnmergedRevision</strong>: [5bee42a6e706dd778eb60057078ed60d61007c06](https://github.com/hyperledger-gerrit-archive/fabric/commit/5bee42a6e706dd778eb60057078ed60d61007c06)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/21/2018, 8:35:27 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 9</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Luis Sanchez - luiss@me.com<br><strong>Uploader</strong>: Luis Sanchez - luiss@me.com<br><strong>Created</strong>: 2/21/2018, 8:35:06 AM<br><strong>UnmergedRevision</strong>: [39c7255e33e7ec28219c1ca0462f3653db48888c](https://github.com/hyperledger-gerrit-archive/fabric/commit/39c7255e33e7ec28219c1ca0462f3653db48888c)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/21/2018, 9:28:52 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/handler.go#L778](https://github.com/hyperledger-gerrit-archive/fabric/blob/39c7255e33e7ec28219c1ca0462f3653db48888c/core/chaincode/handler.go#L778)<br><strong>Comment</strong>: <pre>don't you need to clean up query context for this case as well?</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/handler.go#L778](https://github.com/hyperledger-gerrit-archive/fabric/blob/39c7255e33e7ec28219c1ca0462f3653db48888c/core/chaincode/handler.go#L778)<br><strong>Comment</strong>: <pre>Yes Artem. I had missed this.</pre><strong>Commenter</strong>: Luis Sanchez - luiss@me.com<br><strong>CommentLine</strong>: [core/chaincode/handler.go#L778](https://github.com/hyperledger-gerrit-archive/fabric/blob/39c7255e33e7ec28219c1ca0462f3653db48888c/core/chaincode/handler.go#L778)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Luis Sanchez - luiss@me.com<br><strong>CommentLine</strong>: [core/chaincode/handler.go#L778](https://github.com/hyperledger-gerrit-archive/fabric/blob/39c7255e33e7ec28219c1ca0462f3653db48888c/core/chaincode/handler.go#L778)<br><strong>Comment</strong>: <pre>Thanks Artem, I adjusted the test cases to catch this.</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/handler.go#L805](https://github.com/hyperledger-gerrit-archive/fabric/blob/39c7255e33e7ec28219c1ca0462f3653db48888c/core/chaincode/handler.go#L805)<br><strong>Comment</strong>: <pre>a nit, but having in mind that you already doing casting while calling this function, why do you repeating it here again? (line: 789)</pre><strong>Commenter</strong>: Luis Sanchez - luiss@me.com<br><strong>CommentLine</strong>: [core/chaincode/handler.go#L805](https://github.com/hyperledger-gerrit-archive/fabric/blob/39c7255e33e7ec28219c1ca0462f3653db48888c/core/chaincode/handler.go#L805)<br><strong>Comment</strong>: <pre>Thanks. Just some leftovers from a refactor. Done.</pre></blockquote><h3>PatchSet Number: 10</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Luis Sanchez - luiss@me.com<br><strong>Uploader</strong>: Luis Sanchez - luiss@me.com<br><strong>Created</strong>: 2/21/2018, 9:36:21 AM<br><strong>UnmergedRevision</strong>: [f3b574f6df576aa39e7f83f0218dd3a9dbb5297b](https://github.com/hyperledger-gerrit-archive/fabric/commit/f3b574f6df576aa39e7f83f0218dd3a9dbb5297b)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/21/2018, 10:30:20 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Approved</strong>: 2/21/2018, 10:16:45 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/handler_test.go#L73](https://github.com/hyperledger-gerrit-archive/fabric/blob/f3b574f6df576aa39e7f83f0218dd3a9dbb5297b/core/chaincode/handler_test.go#L73)<br><strong>Comment</strong>: <pre>Thanks Luis for an extra effort. Looks much readable to me now :-)</pre></blockquote><h3>PatchSet Number: 11</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Luis Sanchez - luiss@me.com<br><strong>Uploader</strong>: Luis Sanchez - luiss@me.com<br><strong>Created</strong>: 2/21/2018, 5:00:19 PM<br><strong>GitHubMergedRevision</strong>: [a6885b587e172fc1c2eed517dd4d16f3fa3cdc0b](https://github.com/hyperledger-gerrit-archive/fabric/commit/a6885b587e172fc1c2eed517dd4d16f3fa3cdc0b)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/21/2018, 5:32:11 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Approved</strong>: 2/21/2018, 8:33:02 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Manish Sethi<br><strong>Merged</strong>: 2/21/2018, 8:33:06 PM<br><br><strong>Approver</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Approved</strong>: 2/21/2018, 5:23:51 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/handler.go#L779](https://github.com/hyperledger-gerrit-archive/fabric/blob/a6885b587e172fc1c2eed517dd4d16f3fa3cdc0b/core/chaincode/handler.go#L779)<br><strong>Comment</strong>: <pre>sorry for being over pedantic, but isn't that better to have it with defer statement right after the for statement, since you are cleaning context before return. E.g.:

     for {
          defer handler.cleanupQueryContext(txContext, iterID)
     }

wdyt?</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/handler.go#L779](https://github.com/hyperledger-gerrit-archive/fabric/blob/a6885b587e172fc1c2eed517dd4d16f3fa3cdc0b/core/chaincode/handler.go#L779)<br><strong>Comment</strong>: <pre>actually, just realized that you have a case where you still has more results, so you are do not need to clean context. please discard my previous comment.</pre></blockquote>