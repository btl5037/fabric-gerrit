<strong>Project</strong>: fabric<br><strong>Branch</strong>: master<br><strong>ID</strong>: 8657<br><strong>Subject</strong>: [FAB-3446] Bug - Alive msgs in MemReq and MemResp<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 4/27/2017, 10:19:01 AM<br><strong>LastUpdated</strong>: 5/8/2017, 8:45:36 PM<br><strong>CommitMessage</strong>:<br><pre>[FAB-3446] Bug - Alive msgs in MemReq and MemResp

Alive messages inside MemReq and MemResponce messages should be
valideted using alive message store inside discovery

Current implementation validates MemReq and MemResp msgs instead
Alive messages stored inside membership messages.

Change-Id: I0098a8d032ea9630fe94f0a5be0c0a804e8a09a7
Signed-off-by: Gennady Laventman <gennady@il.ibm.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>Reviewed</strong>: 4/27/2017, 10:19:01 AM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 4/27/2017, 10:25:34 AM<br><strong>Message</strong>: <pre>Patch Set 1: Code-Review-1

Hi Gennady. 

Thanks for the fix. 2 comments:

1) I think you should make the commit title and body explain that this is a bug fix, and explain the bug.
2) I don't think the test needs to be part of an existing test.
Since you're in the discovery package, you have the ability to create a test that is tailored just to check this bug.
If I'm wrong and I'm missing something, please let me know :)</pre><strong>Reviewer</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>Reviewed</strong>: 4/30/2017, 6:26:25 PM<br><strong>Message</strong>: <pre>Uploaded patch set 2.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/30/2017, 6:27:58 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/2428/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/30/2017, 6:29:33 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/10901/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/30/2017, 6:29:34 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/4958/ (3/3)</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 4/30/2017, 6:55:24 PM<br><strong>Message</strong>: <pre>Patch Set 2:

(2 comments)</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 4/30/2017, 7:27:05 PM<br><strong>Message</strong>: <pre>Patch Set 2:

(2 comments)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/30/2017, 10:28:33 PM<br><strong>Message</strong>: <pre>Patch Set 2: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/2428/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/10901/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/4958/ : SUCCESS</pre><strong>Reviewer</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>Reviewed</strong>: 5/1/2017, 2:21:08 AM<br><strong>Message</strong>: <pre>Patch Set 2:

reverify</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/1/2017, 2:22:26 AM<br><strong>Message</strong>: <pre>Patch Set 2: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/2437/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/1/2017, 2:22:52 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/10910/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/1/2017, 2:23:11 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/4967/ (3/3)</pre><strong>Reviewer</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>Reviewed</strong>: 5/1/2017, 2:50:49 AM<br><strong>Message</strong>: <pre>Patch Set 2:

(4 comments)</pre><strong>Reviewer</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>Reviewed</strong>: 5/1/2017, 2:52:19 AM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/1/2017, 2:53:57 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/2438/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/1/2017, 2:55:23 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/10911/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/1/2017, 2:55:28 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/4968/ (3/3)</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 5/1/2017, 4:01:01 AM<br><strong>Message</strong>: <pre>Patch Set 3: Code-Review-1

Hi Genna, overall it look good, while I'm missing the change for message store, CheckValid method. Didn't we agreed to add validation there for correct message types and in case of the wrong one to panic?

Can you add this please and test which verifies it?</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 5/1/2017, 4:28:24 AM<br><strong>Message</strong>: <pre>Patch Set 3: Code-Review-1

So here I am CRing your change set and I encounter this and I wonder - since you changed this, and this was obviously a bug that you fixed now - how did that ever work?

Then I looked at the assertMembership method and saw that the logic is completely backwards! 

It needs to be:

	fullMembership := func() bool {
		for _, inst := range instances {
			if len(inst.GetMembership()) != expectedNum {
				return false
			}
		}
		return true
	}
	waitUntilOrFail(t, fullMembership)
}


instead of:
	fullMembership := func() bool {
		for _, inst := range instances {
			if len(inst.GetMembership()) == expectedNum {
				return true
			}
		}
		return false
	}




So, I fixed it and re-ran the tests and now TestExpiration (from your change set) fails. 
Can you please fix this in this change set and attend to the test that now fails?</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 5/1/2017, 4:29:24 AM<br><strong>Message</strong>: <pre>Patch Set 3:

^ 
I was talking about 856
assertMembership(t, instances[:len(instances)-2], nodeNum-3) of course</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 5/1/2017, 5:29:04 AM<br><strong>Message</strong>: <pre>Patch Set 3:

(7 comments)</pre><strong>Reviewer</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>Reviewed</strong>: 5/1/2017, 6:14:40 AM<br><strong>Message</strong>: <pre>Patch Set 3:

(1 comment)

Artem - no, I really don't remember that we agreed on change to MsgStore at all. I can add such change, but it will require adding change to Add method as well. The original MsgStore idea was to keep msgs of any types all together.

Yacov - regarding assertMembership bug. I think it should be different JIRA and different change set. I can open one for it as well.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/1/2017, 6:23:05 AM<br><strong>Message</strong>: <pre>Patch Set 2: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/2437/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/10910/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/4967/ : SUCCESS</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/1/2017, 6:54:44 AM<br><strong>Message</strong>: <pre>Patch Set 3: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/2438/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/10911/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/4968/ : SUCCESS</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 5/1/2017, 8:43:09 AM<br><strong>Message</strong>: <pre>Patch Set 3:

(1 comment)

RE: Yacov - regarding assertMembership bug. I think it should be different JIRA and different change set. I can open one for it as well.

Genna, this is perfectly fine to have this issue fixed in separate JIRA and different CR, however you will have to wait with current changeset and once bug fix will be introduced to rebase on top of it. I think it will be much easier and quicker to handle it in this CR, what do you think?</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 5/1/2017, 8:43:58 AM<br><strong>Message</strong>: <pre>Patch Set 3:

WRT, message store CheckValid, let's take it offline.</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 5/1/2017, 10:36:05 AM<br><strong>Message</strong>: <pre>Patch Set 3:

(1 comment)</pre><strong>Reviewer</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>Reviewed</strong>: 5/1/2017, 11:30:27 AM<br><strong>Message</strong>: <pre>Patch Set 3:

(4 comments)

Yacov - I addressed some of comments,
Artem - ping me once you have time
Yacov + Artem - I will fix assertMembership bug here as well.
Will push new patch soon</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 5/1/2017, 1:30:32 PM<br><strong>Message</strong>: <pre>Patch Set 3:

(2 comments)</pre><strong>Reviewer</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>Reviewed</strong>: 5/3/2017, 8:23:11 AM<br><strong>Message</strong>: <pre>Patch Set 3:

(8 comments)</pre><strong>Reviewer</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>Reviewed</strong>: 5/3/2017, 8:26:26 AM<br><strong>Message</strong>: <pre>Uploaded patch set 4.</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 5/3/2017, 8:27:02 AM<br><strong>Message</strong>: <pre>Patch Set 3:

(1 comment)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/3/2017, 8:29:28 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/2566/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/3/2017, 8:29:41 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/11038/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/3/2017, 8:30:21 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/5097/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/3/2017, 9:26:32 AM<br><strong>Message</strong>: <pre>Patch Set 4: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/2566/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/11038/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/5097/ : FAILURE (skipped)</pre><strong>Reviewer</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>Reviewed</strong>: 5/4/2017, 9:54:11 AM<br><strong>Message</strong>: <pre>Patch Set 3:

(1 comment)</pre><strong>Reviewer</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>Reviewed</strong>: 5/4/2017, 9:54:28 AM<br><strong>Message</strong>: <pre>Uploaded patch set 5.</pre><strong>Reviewer</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>Reviewed</strong>: 5/4/2017, 9:55:39 AM<br><strong>Message</strong>: <pre>Uploaded patch set 6: Patch Set 5 was rebased.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/4/2017, 9:56:50 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/2650/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/4/2017, 9:57:59 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/11120/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/4/2017, 9:58:18 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/5179/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/4/2017, 9:58:27 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/2651/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/4/2017, 9:58:57 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/11121/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/4/2017, 9:59:01 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/5180/ (3/3)</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 5/4/2017, 10:10:58 AM<br><strong>Message</strong>: <pre>Patch Set 6: Code-Review-1

(1 comment)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/4/2017, 10:37:28 AM<br><strong>Message</strong>: <pre>Patch Set 5: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/2650/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/11120/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/5179/ : FAILURE (skipped)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/4/2017, 11:10:20 AM<br><strong>Message</strong>: <pre>Patch Set 6: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/2651/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/11121/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/5180/ : FAILURE (skipped)</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 5/4/2017, 5:47:19 PM<br><strong>Message</strong>: <pre>Patch Set 3:

(1 comment)</pre><strong>Reviewer</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>Reviewed</strong>: 5/7/2017, 11:21:20 AM<br><strong>Message</strong>: <pre>Patch Set 6:

(1 comment)</pre><strong>Reviewer</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>Reviewed</strong>: 5/7/2017, 11:23:48 AM<br><strong>Message</strong>: <pre>Uploaded patch set 7.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/7/2017, 11:25:55 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/2779/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/7/2017, 11:26:16 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/11250/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/7/2017, 11:26:31 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/5309/ (3/3)</pre><strong>Reviewer</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>Reviewed</strong>: 5/8/2017, 2:51:08 AM<br><strong>Message</strong>: <pre>Uploaded patch set 8.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/8/2017, 2:52:54 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/5326/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/8/2017, 2:54:12 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/11267/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/8/2017, 2:55:02 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/2796/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/8/2017, 4:26:32 AM<br><strong>Message</strong>: <pre>Patch Set 8: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/5326/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/2796/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/11267/ : SUCCESS</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 5/8/2017, 7:13:57 AM<br><strong>Message</strong>: <pre>Patch Set 8: Code-Review-1

(4 comments)</pre><strong>Reviewer</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>Reviewed</strong>: 5/8/2017, 10:15:02 AM<br><strong>Message</strong>: <pre>Patch Set 8:

(2 comments)</pre><strong>Reviewer</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>Reviewed</strong>: 5/8/2017, 10:15:28 AM<br><strong>Message</strong>: <pre>Uploaded patch set 9.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/8/2017, 10:17:40 AM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/5345/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/8/2017, 10:18:26 AM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/11286/ (2/3)</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 5/8/2017, 10:32:08 AM<br><strong>Message</strong>: <pre>Patch Set 9: Code-Review+2</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/8/2017, 10:37:20 AM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/2815/ (3/3)</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 5/8/2017, 11:06:35 AM<br><strong>Message</strong>: <pre>Patch Set 9: Code-Review+1

LGTM... leave it to Artem to verify his comments.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/8/2017, 11:30:00 AM<br><strong>Message</strong>: <pre>Patch Set 9: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/5345/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/2815/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/11286/ : SUCCESS</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 5/8/2017, 7:28:30 PM<br><strong>Message</strong>: <pre>Patch Set 9: Code-Review+2</pre><strong>Reviewer</strong>: Gerrit Code Review - gerrit@hyperledger.org<br><strong>Reviewed</strong>: 5/8/2017, 7:28:33 PM<br><strong>Message</strong>: <pre>Change has been successfully merged by Artem Barger</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/8/2017, 7:30:11 PM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-x86_64/1773/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/8/2017, 7:30:49 PM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/454/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/8/2017, 7:31:31 PM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-behave-x86_64/767/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/8/2017, 8:45:36 PM<br><strong>Message</strong>: <pre>Patch Set 9:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/454/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-merge-behave-x86_64/767/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-merge-x86_64/1773/ : SUCCESS</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>Uploader</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>Created</strong>: 4/27/2017, 10:19:01 AM<br><strong>UnmergedRevision</strong>: [931bdc4b367c2d7fc5609188b27d4f9465a87c78](https://github.com/hyperledger-gerrit-archive/fabric/commit/931bdc4b367c2d7fc5609188b27d4f9465a87c78)<br><br><strong>Approver</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Approved</strong>: 4/27/2017, 10:25:34 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>Uploader</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>Created</strong>: 4/30/2017, 6:26:25 PM<br><strong>UnmergedRevision</strong>: [e4e4152c2d89064b7f6a94cfe3ba7e6cb2abc4dd](https://github.com/hyperledger-gerrit-archive/fabric/commit/e4e4152c2d89064b7f6a94cfe3ba7e6cb2abc4dd)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/1/2017, 6:23:05 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [gossip/discovery/discovery_test.go#L32](https://github.com/hyperledger-gerrit-archive/fabric/blob/e4e4152c2d89064b7f6a94cfe3ba7e6cb2abc4dd/gossip/discovery/discovery_test.go#L32)<br><strong>Comment</strong>: <pre>Can you please remove empty line?</pre><strong>Commenter</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>CommentLine</strong>: [gossip/discovery/discovery_test.go#L32](https://github.com/hyperledger-gerrit-archive/fabric/blob/e4e4152c2d89064b7f6a94cfe3ba7e6cb2abc4dd/gossip/discovery/discovery_test.go#L32)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [gossip/discovery/discovery_test.go#L881](https://github.com/hyperledger-gerrit-archive/fabric/blob/e4e4152c2d89064b7f6a94cfe3ba7e6cb2abc4dd/gossip/discovery/discovery_test.go#L881)<br><strong>Comment</strong>: <pre>Can you please extract this into variable?

   msg := am.(*proto.SignedGossipMessage)</pre><strong>Commenter</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>CommentLine</strong>: [gossip/discovery/discovery_test.go#L881](https://github.com/hyperledger-gerrit-archive/fabric/blob/e4e4152c2d89064b7f6a94cfe3ba7e6cb2abc4dd/gossip/discovery/discovery_test.go#L881)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [gossip/discovery/discovery_test.go#L927](https://github.com/hyperledger-gerrit-archive/fabric/blob/e4e4152c2d89064b7f6a94cfe3ba7e6cb2abc4dd/gossip/discovery/discovery_test.go#L927)<br><strong>Comment</strong>: <pre>Probably instead holding slice of downcasted instances of discovery add new function:

   func (g *gossipInstance) discoveryImpl() (*gossipDiscoveryImpl) {
	return g.Discovery.(*gossipDiscoveryImpl)
   }

and then you will be able simply to call:

   instances[i].discoveryImpl()</pre><strong>Commenter</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>CommentLine</strong>: [gossip/discovery/discovery_test.go#L927](https://github.com/hyperledger-gerrit-archive/fabric/blob/e4e4152c2d89064b7f6a94cfe3ba7e6cb2abc4dd/gossip/discovery/discovery_test.go#L927)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [gossip/discovery/discovery_test.go#L948](https://github.com/hyperledger-gerrit-archive/fabric/blob/e4e4152c2d89064b7f6a94cfe3ba7e6cb2abc4dd/gossip/discovery/discovery_test.go#L948)<br><strong>Comment</strong>: <pre>Genna, you have this logic repeated several times, IMO you can fold it and reuse with:

	repeatForFiltered := func(n int, filter func(i int) bool, action func(i int)) {
		for i := 0; i < n; i++ {
			if filter(i) {
				continue
			}
			action(i)
		}
	}

and then you can use like:

	// Handling Alive
	for i := 0; i < peersNum; i++ {
		repeatForFiltered(peersNum, func(k int) bool {
			return k == i
		}, func(k int) {
			downcastInstances[i].handleMsgFromComm(aliveMsgs[k])
		})
	}

lastly you can use it in other places.</pre><strong>Commenter</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>CommentLine</strong>: [gossip/discovery/discovery_test.go#L948](https://github.com/hyperledger-gerrit-archive/fabric/blob/e4e4152c2d89064b7f6a94cfe3ba7e6cb2abc4dd/gossip/discovery/discovery_test.go#L948)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>Uploader</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>Created</strong>: 5/1/2017, 2:52:19 AM<br><strong>UnmergedRevision</strong>: [cef29229b4c82ad46535f1a9a6645fb6d9737304](https://github.com/hyperledger-gerrit-archive/fabric/commit/cef29229b4c82ad46535f1a9a6645fb6d9737304)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/1/2017, 6:54:44 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Approved</strong>: 5/1/2017, 4:28:24 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Approved</strong>: 5/1/2017, 4:01:01 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [gossip/discovery/discovery_test.go#L905](https://github.com/hyperledger-gerrit-archive/fabric/blob/cef29229b4c82ad46535f1a9a6645fb6d9737304/gossip/discovery/discovery_test.go#L905)<br><strong>Comment</strong>: <pre>This isn't accurate and misleading, as membership requests aren't stored.</pre><strong>Commenter</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>CommentLine</strong>: [gossip/discovery/discovery_test.go#L905](https://github.com/hyperledger-gerrit-archive/fabric/blob/cef29229b4c82ad46535f1a9a6645fb6d9737304/gossip/discovery/discovery_test.go#L905)<br><strong>Comment</strong>: <pre>Will rephrase</pre><strong>Commenter</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>CommentLine</strong>: [gossip/discovery/discovery_test.go#L905](https://github.com/hyperledger-gerrit-archive/fabric/blob/cef29229b4c82ad46535f1a9a6645fb6d9737304/gossip/discovery/discovery_test.go#L905)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>CommentLine</strong>: [gossip/discovery/discovery_test.go#L905](https://github.com/hyperledger-gerrit-archive/fabric/blob/cef29229b4c82ad46535f1a9a6645fb6d9737304/gossip/discovery/discovery_test.go#L905)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [gossip/discovery/discovery_test.go#L909](https://github.com/hyperledger-gerrit-archive/fabric/blob/cef29229b4c82ad46535f1a9a6645fb6d9737304/gossip/discovery/discovery_test.go#L909)<br><strong>Comment</strong>: <pre>same</pre><strong>Commenter</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>CommentLine</strong>: [gossip/discovery/discovery_test.go#L909](https://github.com/hyperledger-gerrit-archive/fabric/blob/cef29229b4c82ad46535f1a9a6645fb6d9737304/gossip/discovery/discovery_test.go#L909)<br><strong>Comment</strong>: <pre>Will rephrase</pre><strong>Commenter</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>CommentLine</strong>: [gossip/discovery/discovery_test.go#L909](https://github.com/hyperledger-gerrit-archive/fabric/blob/cef29229b4c82ad46535f1a9a6645fb6d9737304/gossip/discovery/discovery_test.go#L909)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [gossip/discovery/discovery_test.go#L958](https://github.com/hyperledger-gerrit-archive/fabric/blob/cef29229b4c82ad46535f1a9a6645fb6d9737304/gossip/discovery/discovery_test.go#L958)<br><strong>Comment</strong>: <pre>I guess you're just trying to avoid an alive message created by peer p and sent to peer p, right? 
But why? It's a perfectly valid scenario.
Unless I'm missing something - I think you shouldn't filter out these messages.</pre><strong>Commenter</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>CommentLine</strong>: [gossip/discovery/discovery_test.go#L958](https://github.com/hyperledger-gerrit-archive/fabric/blob/cef29229b4c82ad46535f1a9a6645fb6d9737304/gossip/discovery/discovery_test.go#L958)<br><strong>Comment</strong>: <pre>Either way is correct - this test is not about processing self Alive messages, so they can enter store or not - it will not affect test outcome.</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [gossip/discovery/discovery_test.go#L958](https://github.com/hyperledger-gerrit-archive/fabric/blob/cef29229b4c82ad46535f1a9a6645fb6d9737304/gossip/discovery/discovery_test.go#L958)<br><strong>Comment</strong>: <pre>Even more- there is no point in having this filter if you don't need it here :)</pre><strong>Commenter</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>CommentLine</strong>: [gossip/discovery/discovery_test.go#L958](https://github.com/hyperledger-gerrit-archive/fabric/blob/cef29229b4c82ad46535f1a9a6645fb6d9737304/gossip/discovery/discovery_test.go#L958)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [gossip/discovery/discovery_test.go#L964](https://github.com/hyperledger-gerrit-archive/fabric/blob/cef29229b4c82ad46535f1a9a6645fb6d9737304/gossip/discovery/discovery_test.go#L964)<br><strong>Comment</strong>: <pre>doesn't</pre><strong>Commenter</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>CommentLine</strong>: [gossip/discovery/discovery_test.go#L964](https://github.com/hyperledger-gerrit-archive/fabric/blob/cef29229b4c82ad46535f1a9a6645fb6d9737304/gossip/discovery/discovery_test.go#L964)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [gossip/discovery/discovery_test.go#L967](https://github.com/hyperledger-gerrit-archive/fabric/blob/cef29229b4c82ad46535f1a9a6645fb6d9737304/gossip/discovery/discovery_test.go#L967)<br><strong>Comment</strong>: <pre>doesn't exist</pre><strong>Commenter</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>CommentLine</strong>: [gossip/discovery/discovery_test.go#L967](https://github.com/hyperledger-gerrit-archive/fabric/blob/cef29229b4c82ad46535f1a9a6645fb6d9737304/gossip/discovery/discovery_test.go#L967)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [gossip/discovery/discovery_test.go#L988](https://github.com/hyperledger-gerrit-archive/fabric/blob/cef29229b4c82ad46535f1a9a6645fb6d9737304/gossip/discovery/discovery_test.go#L988)<br><strong>Comment</strong>: <pre>processing</pre><strong>Commenter</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>CommentLine</strong>: [gossip/discovery/discovery_test.go#L988](https://github.com/hyperledger-gerrit-archive/fabric/blob/cef29229b4c82ad46535f1a9a6645fb6d9737304/gossip/discovery/discovery_test.go#L988)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [gossip/discovery/discovery_test.go#L1045](https://github.com/hyperledger-gerrit-archive/fabric/blob/cef29229b4c82ad46535f1a9a6645fb6d9737304/gossip/discovery/discovery_test.go#L1045)<br><strong>Comment</strong>: <pre>this test passes when I change this to Equal...
How and why? :)</pre><strong>Commenter</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>CommentLine</strong>: [gossip/discovery/discovery_test.go#L1045](https://github.com/hyperledger-gerrit-archive/fabric/blob/cef29229b4c82ad46535f1a9a6645fb6d9737304/gossip/discovery/discovery_test.go#L1045)<br><strong>Comment</strong>: <pre>Don't know</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [gossip/discovery/discovery_test.go#L1045](https://github.com/hyperledger-gerrit-archive/fabric/blob/cef29229b4c82ad46535f1a9a6645fb6d9737304/gossip/discovery/discovery_test.go#L1045)<br><strong>Comment</strong>: <pre>Well, it has to be either Equal or NotEqual. Could you please verify this assertion?</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [gossip/discovery/discovery_test.go#L1045](https://github.com/hyperledger-gerrit-archive/fabric/blob/cef29229b4c82ad46535f1a9a6645fb6d9737304/gossip/discovery/discovery_test.go#L1045)<br><strong>Comment</strong>: <pre>There is actually a 3rd option - the msgStore.Get() evaluates to a 0-length slice and then the assertion in the body isn't invoked.

Either way, this needs to be checked.</pre><strong>Commenter</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>CommentLine</strong>: [gossip/discovery/discovery_test.go#L1045](https://github.com/hyperledger-gerrit-archive/fabric/blob/cef29229b4c82ad46535f1a9a6645fb6d9737304/gossip/discovery/discovery_test.go#L1045)<br><strong>Comment</strong>: <pre>And I think it is correct result as well - we need to know that this message is not part of slice returned by msgStore.Get(). So, if slice is empty, assertion holds as well.</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [gossip/discovery/discovery_test.go#L1045](https://github.com/hyperledger-gerrit-archive/fabric/blob/cef29229b4c82ad46535f1a9a6645fb6d9737304/gossip/discovery/discovery_test.go#L1045)<br><strong>Comment</strong>: <pre>No, this assertion doesn't hold because it's not invoked.</pre><strong>Commenter</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>CommentLine</strong>: [gossip/discovery/discovery_test.go#L1045](https://github.com/hyperledger-gerrit-archive/fabric/blob/cef29229b4c82ad46535f1a9a6645fb6d9737304/gossip/discovery/discovery_test.go#L1045)<br><strong>Comment</strong>: <pre>Agreed. This exactly what I said - whole assertion is to check if message in quest is not a part of slice returned by MsgSore.Get(). If slice is empty, it is not part of slice, so assertion holds</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [gossip/discovery/discovery_test.go#L1045](https://github.com/hyperledger-gerrit-archive/fabric/blob/cef29229b4c82ad46535f1a9a6645fb6d9737304/gossip/discovery/discovery_test.go#L1045)<br><strong>Comment</strong>: <pre>What I'm saying is- if the msgStore.Get() is supposed to return an empty slice, then please don't iterate over its content but instead use assert.Empty instead.</pre><strong>Commenter</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>CommentLine</strong>: [gossip/discovery/discovery_test.go#L1045](https://github.com/hyperledger-gerrit-archive/fabric/blob/cef29229b4c82ad46535f1a9a6645fb6d9737304/gossip/discovery/discovery_test.go#L1045)<br><strong>Comment</strong>: <pre>This check cover 2 cases - if MsgStore.Get() not empty, it looks for messages in question in its content, in case it empty, for sure it not contains message in question.</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [gossip/discovery/discovery_test.go#L1045](https://github.com/hyperledger-gerrit-archive/fabric/blob/cef29229b4c82ad46535f1a9a6645fb6d9737304/gossip/discovery/discovery_test.go#L1045)<br><strong>Comment</strong>: <pre>well when I run the test with replacing this for loop with assert.Empty, it succeeds. 

So: 
- If the msgStore.Get() is always supposed to be empty, please replace the loop with an assert.Empty
- Else, this doesn't fit with my (empirical) trials, so there is a bug in the test.</pre><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [gossip/discovery/discovery_test.go#L1045](https://github.com/hyperledger-gerrit-archive/fabric/blob/cef29229b4c82ad46535f1a9a6645fb6d9737304/gossip/discovery/discovery_test.go#L1045)<br><strong>Comment</strong>: <pre>@Yacov, I think the whole point here is:

1. If it's not empty it should not contain the message.
2. If it's empty (which doesn't have true), in particular #1 holds. 


I do not think there is a need to an assertion here, probably for more clarity it's worth adding if-statement (while not necessary).</pre><strong>Commenter</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>CommentLine</strong>: [gossip/discovery/discovery_test.go#L1045](https://github.com/hyperledger-gerrit-archive/fabric/blob/cef29229b4c82ad46535f1a9a6645fb6d9737304/gossip/discovery/discovery_test.go#L1045)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>Uploader</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>Created</strong>: 5/3/2017, 8:26:26 AM<br><strong>UnmergedRevision</strong>: [64848f4ef0e38ac8a45b71b84442e01cb3e00886](https://github.com/hyperledger-gerrit-archive/fabric/commit/64848f4ef0e38ac8a45b71b84442e01cb3e00886)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/3/2017, 9:26:32 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 5</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>Uploader</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>Created</strong>: 5/4/2017, 9:54:28 AM<br><strong>UnmergedRevision</strong>: [20100be0a7bc0e1240bffe1798edf811a5ce7d65](https://github.com/hyperledger-gerrit-archive/fabric/commit/20100be0a7bc0e1240bffe1798edf811a5ce7d65)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/4/2017, 10:37:28 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 6</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>Uploader</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>Created</strong>: 5/4/2017, 9:55:39 AM<br><strong>UnmergedRevision</strong>: [b10ea495293a7f266331fe9dc509daaf6116479d](https://github.com/hyperledger-gerrit-archive/fabric/commit/b10ea495293a7f266331fe9dc509daaf6116479d)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/4/2017, 11:10:20 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Approved</strong>: 5/4/2017, 10:10:58 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 7</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>Uploader</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>Created</strong>: 5/7/2017, 11:23:48 AM<br><strong>UnmergedRevision</strong>: [5aaa9516f2268c5f138bfc53d4305766bda88d0e](https://github.com/hyperledger-gerrit-archive/fabric/commit/5aaa9516f2268c5f138bfc53d4305766bda88d0e)<br><br></blockquote><h3>PatchSet Number: 8</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>Uploader</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>Created</strong>: 5/8/2017, 2:51:08 AM<br><strong>UnmergedRevision</strong>: [64eb0a631dcce35ab837a17dbcbe178539ba0e49](https://github.com/hyperledger-gerrit-archive/fabric/commit/64eb0a631dcce35ab837a17dbcbe178539ba0e49)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/8/2017, 4:26:32 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Approved</strong>: 5/8/2017, 7:13:57 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [gossip/discovery/discovery_impl.go#L979](https://github.com/hyperledger-gerrit-archive/fabric/blob/64eb0a631dcce35ab837a17dbcbe178539ba0e49/gossip/discovery/discovery_impl.go#L979)<br><strong>Comment</strong>: <pre>cache?
Why not just "s" like in the implementation of the package?</pre><strong>Commenter</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>CommentLine</strong>: [gossip/discovery/discovery_impl.go#L979](https://github.com/hyperledger-gerrit-archive/fabric/blob/64eb0a631dcce35ab837a17dbcbe178539ba0e49/gossip/discovery/discovery_impl.go#L979)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [gossip/discovery/discovery_impl.go#L980](https://github.com/hyperledger-gerrit-archive/fabric/blob/64eb0a631dcce35ab837a17dbcbe178539ba0e49/gossip/discovery/discovery_impl.go#L980)<br><strong>Comment</strong>: <pre>IMO since you have this here, it makes sense also to do a runtime coercion check and panic with a meaningful message on failure.</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [gossip/discovery/discovery_impl.go#L987](https://github.com/hyperledger-gerrit-archive/fabric/blob/64eb0a631dcce35ab837a17dbcbe178539ba0e49/gossip/discovery/discovery_impl.go#L987)<br><strong>Comment</strong>: <pre>same</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [gossip/discovery/discovery_test.go#L1024](https://github.com/hyperledger-gerrit-archive/fabric/blob/64eb0a631dcce35ab837a17dbcbe178539ba0e49/gossip/discovery/discovery_test.go#L1024)<br><strong>Comment</strong>: <pre>There is no point in having this function at all, since all of the data structures are totally empty.

I think you should remove this function and instead change checkAliveMsgNotExist to:


	checkAliveMsgNotExist := func(instances []*gossipInstance, msgs []*proto.SignedGossipMessage, index int, step string) {
		instances[index].discoveryImpl().lock.RLock()
		defer instances[index].discoveryImpl().lock.RUnlock()
		assert.Empty(t, instances[index].discoveryImpl().aliveLastTS)
		assert.Empty(t, instances[index].discoveryImpl().deadLastTS)
		assert.Empty(t, instances[index].discoveryImpl().id2Member)
		assert.Empty(t, instances[index].discoveryImpl().msgStore.Get())
	}</pre><strong>Commenter</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>CommentLine</strong>: [gossip/discovery/discovery_test.go#L1024](https://github.com/hyperledger-gerrit-archive/fabric/blob/64eb0a631dcce35ab837a17dbcbe178539ba0e49/gossip/discovery/discovery_test.go#L1024)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 9</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>Uploader</strong>: Gennady Laventman - gennady@il.ibm.com<br><strong>Created</strong>: 5/8/2017, 10:15:28 AM<br><strong>GitHubMergedRevision</strong>: [c01a4332d616b58cef83671e16db45b0f91307b3](https://github.com/hyperledger-gerrit-archive/fabric/commit/c01a4332d616b58cef83671e16db45b0f91307b3)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/8/2017, 11:30:00 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Approved</strong>: 5/8/2017, 11:06:35 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Approved</strong>: 5/8/2017, 10:32:08 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Approved</strong>: 5/8/2017, 7:28:30 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Artem Barger<br><strong>Merged</strong>: 5/8/2017, 7:28:33 PM<br><br></blockquote>