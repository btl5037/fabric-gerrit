<strong>Project</strong>: fabric<br><strong>Branch</strong>: master<br><strong>ID</strong>: 32802<br><strong>Subject</strong>: Admin service proto for peer-scoped lifecycle actions<br><strong>Status</strong>: ABANDONED<br><strong>Owner</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 8/8/2019, 3:33:19 PM<br><strong>LastUpdated</strong>: 8/29/2019, 12:54:58 PM<br><strong>CommitMessage</strong>:<br><pre>Admin service proto for peer-scoped lifecycle actions

FAB-16261

Change-Id: Ib2896d554e5a5352d4ce29c1ac7e76a8e8d4331a
Signed-off-by: Will Lahti <wtlahti@us.ibm.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Reviewed</strong>: 8/8/2019, 3:33:19 PM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/8/2019, 3:33:28 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/16214/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/8/2019, 3:33:51 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting verify build</pre><strong>Reviewer</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Reviewed</strong>: 8/8/2019, 3:33:53 PM<br><strong>Message</strong>: <pre>Set Work In Progress</pre><strong>Reviewer</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Reviewed</strong>: 8/8/2019, 3:36:37 PM<br><strong>Message</strong>: <pre>Patch Set 1:

This change is ready for review.</pre><strong>Reviewer</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Reviewed</strong>: 8/8/2019, 3:36:37 PM<br><strong>Message</strong>: <pre>Set Ready For Review</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/8/2019, 3:40:32 PM<br><strong>Message</strong>: <pre>Patch Set 1: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/8/2019, 3:40:38 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/10945/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/8/2019, 3:41:02 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/8/2019, 3:41:17 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/16214/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/16214</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/8/2019, 3:45:53 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/14337/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/8/2019, 3:46:23 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/8/2019, 4:15:13 PM<br><strong>Message</strong>: <pre>Patch Set 1: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/8/2019, 4:47:27 PM<br><strong>Message</strong>: <pre>Patch Set 1: F3-IntegrationTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/8/2019, 4:48:14 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/10945/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/10945

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/14337/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/14337</pre><strong>Reviewer</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Reviewed</strong>: 8/8/2019, 5:02:24 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Run IntegrationTest

[Fail] PrivateData collection ACL while reading private data chaincode in legacy lifecycle [It] does not allow private data reads to non-members</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/8/2019, 5:06:18 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/10946/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/8/2019, 5:06:48 PM<br><strong>Message</strong>: <pre>Patch Set 1: -F3-IntegrationTest

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/8/2019, 6:18:24 PM<br><strong>Message</strong>: <pre>Patch Set 1: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/8/2019, 6:19:13 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/10946/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/10946</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 8/9/2019, 4:17:35 PM<br><strong>Message</strong>: <pre>Patch Set 1:

I assumed we would need to pass the client credentials to each of the RPCs. Either using the common.Envelope or SignedRequest (from Discover rpc) precedent to wrap the request with an envelope containing the client credentials.</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 8/9/2019, 4:19:16 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Matt, what precedent would you like to set for passing credentials in new GRPC services?</pre><strong>Reviewer</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Reviewed</strong>: 8/9/2019, 5:17:09 PM<br><strong>Message</strong>: <pre>Patch Set 1: Code-Review-1

Let me start with the big one. Admin does not equate to lifecycle. This is actually a case of where I think we need to spend time time on the name and the scope.

1. I do not want a generic service with a bunch of unrelated operations to show up.
2. We already had (and pretty much gutted) and admin service so I find the name reuse confusing</pre><strong>Reviewer</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Reviewed</strong>: 8/9/2019, 5:26:04 PM<br><strong>Message</strong>: <pre>Patch Set 1:

> Patch Set 1: Code-Review-1
> 
> Let me start with the big one. Admin does not equate to lifecycle. This is actually a case of where I think we need to spend time time on the name and the scope.
> 
> 1. I do not want a generic service with a bunch of unrelated operations to show up.
> 2. We already had (and pretty much gutted) and admin service so I find the name reuse confusing

Absolutely. I couldn't think of anything better for now and would appreciate anyone's suggestions of a better name here.</pre><strong>Reviewer</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Reviewed</strong>: 8/9/2019, 5:31:25 PM<br><strong>Message</strong>: <pre>Patch Set 1:

> Patch Set 1:
> 
> Matt, what precedent would you like to set for passing credentials in new GRPC services?

Mutual-TLS as the peer admin would seem to be the natural answer but the current peer admin cert is not generated with TLS client authentication attributes.

I'd like to avoid yet another enveloping scheme to work around this as it just needlessly complicates what should be a simple operation. Authentication for something like this is not the same signing a transaction.</pre><strong>Reviewer</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Reviewed</strong>: 8/12/2019, 11:41:01 AM<br><strong>Message</strong>: <pre>Patch Set 1:

> > Matt, what precedent would you like to set for passing credentials in new GRPC services?
> 
> Mutual-TLS as the peer admin would seem to be the natural answer but the current peer admin cert is not generated with TLS client authentication attributes.
> 
> I'd like to avoid yet another enveloping scheme to work around this as it just needlessly complicates what should be a simple operation. Authentication for something like this is not the same signing a transaction.

Been chatting with Gari in the background and mutual auth is challenging when using grpc-web. I think we need to discuss options outside of this review. Some things that were discussed:

# Per-RPC call credentials
This doesn't remove the authentication step and simply moves it somewhere else. It doesn't really solve the issue and would require additional code.

# reusing common.Envelope
This is the same as every other service but is very complicated with many nested, serialized messages that require multiple marshal and unmarshal operations, hide the actual payload the user wishes to submit, and results in significantly higher memory pressure for large messages.

# explicit fields within the message for payload (or simple fields), creator, [nonce] and signature.
This is conceptually similar to using an Envelope but reduces the layers of wrapping. While this may be a small improvement over common.Envelope, it puts us down a path where different services have different marshaling requirements. If we go with fields instead of a single payload, this also means we have to document how to generate the signature over the fields.

None of these is ideal relative to the goal of producing a simple, secure gRPC service like we'd commonly see elsewhere.</pre><strong>Reviewer</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Reviewed</strong>: 8/14/2019, 8:20:48 AM<br><strong>Message</strong>: <pre>Patch Set 1:

> # Per-RPC call credentials
> This doesn't remove the authentication step and simply moves it somewhere else. It doesn't really solve the issue and would require additional code.

The more Gari and I discuss, the more it seems this is the only viable forward-looking solution. We'll be reaching out to others to discuss the implications.</pre><strong>Reviewer</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Reviewed</strong>: 8/29/2019, 12:54:58 PM<br><strong>Message</strong>: <pre>Abandoned

Deferring this task.</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Uploader</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Created</strong>: 8/8/2019, 3:33:19 PM<br><strong>UnmergedRevision</strong>: [0a77d9112b805d3c8b55d4af26a89990046f19a5](https://github.com/hyperledger-gerrit-archive/fabric/commit/0a77d9112b805d3c8b55d4af26a89990046f19a5)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/8/2019, 3:40:32 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/8/2019, 3:40:32 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/8/2019, 6:18:24 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/8/2019, 4:15:13 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Approved</strong>: 8/9/2019, 5:17:09 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br></blockquote>