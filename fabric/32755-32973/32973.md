<strong>Project</strong>: fabric<br><strong>Branch</strong>: master<br><strong>ID</strong>: 32973<br><strong>Subject</strong>: FAB-16037 Remove common/mocks/peer ref<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 8/16/2019, 4:37:51 PM<br><strong>LastUpdated</strong>: 8/19/2019, 12:56:49 PM<br><strong>CommitMessage</strong>:<br><pre>FAB-16037 Remove common/mocks/peer ref

Change-Id: Ibfe8a33c707c4e6a8e8b7c865ccac3e2cade09dd
Signed-off-by: Gari Singh <gari.r.singh@gmail.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 8/16/2019, 4:37:51 PM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/16/2019, 4:42:37 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/16473/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/16/2019, 4:43:05 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/16/2019, 4:49:41 PM<br><strong>Message</strong>: <pre>Patch Set 1: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/16/2019, 4:50:22 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/16473/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/16473</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/16/2019, 4:52:14 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/14586/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/16/2019, 4:52:43 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/16/2019, 4:52:46 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/11211/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/16/2019, 4:53:15 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/16/2019, 5:14:16 PM<br><strong>Message</strong>: <pre>Patch Set 1: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/16/2019, 6:08:03 PM<br><strong>Message</strong>: <pre>Patch Set 1: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/16/2019, 6:08:54 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/14586/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/14586

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/11211/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/11211</pre><strong>Reviewer</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Reviewed</strong>: 8/19/2019, 9:13:06 AM<br><strong>Message</strong>: <pre>Patch Set 1: Code-Review+2

(8 comments)</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 8/19/2019, 10:30:13 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(5 comments)</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 8/19/2019, 10:31:08 AM<br><strong>Message</strong>: <pre>Uploaded patch set 2.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/19/2019, 10:37:21 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/16514/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/19/2019, 10:37:51 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/19/2019, 10:44:41 AM<br><strong>Message</strong>: <pre>Patch Set 2: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/19/2019, 10:45:27 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/16514/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/16514</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/19/2019, 10:51:11 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/14619/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/19/2019, 10:51:11 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/11244/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/19/2019, 10:54:06 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/19/2019, 10:54:08 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/19/2019, 11:16:49 AM<br><strong>Message</strong>: <pre>Patch Set 2: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/19/2019, 11:57:29 AM<br><strong>Message</strong>: <pre>Patch Set 2: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/19/2019, 11:58:08 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/14619/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/14619

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/11244/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/11244</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 8/19/2019, 12:11:19 PM<br><strong>Message</strong>: <pre>Patch Set 2: Code-Review+2</pre><strong>Reviewer</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Reviewed</strong>: 8/19/2019, 12:28:00 PM<br><strong>Message</strong>: <pre>Patch Set 2: Code-Review+2</pre><strong>Reviewer</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Reviewed</strong>: 8/19/2019, 12:28:09 PM<br><strong>Message</strong>: <pre>Change has been successfully merged by Matthew Sykes</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/19/2019, 12:30:57 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-x86_64/7453/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/19/2019, 12:32:04 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/6149/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/19/2019, 12:56:49 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/6149/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-end-2-end-x86_64/6149

https://jenkins.hyperledger.org/job/fabric-merge-x86_64/7453/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-x86_64/7453</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Uploader</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Created</strong>: 8/16/2019, 4:37:51 PM<br><strong>UnmergedRevision</strong>: [864ba91e7c7f638350c4e3b55562b4b31edbe1c8](https://github.com/hyperledger-gerrit-archive/fabric/commit/864ba91e7c7f638350c4e3b55562b4b31edbe1c8)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/16/2019, 4:49:41 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/16/2019, 4:49:41 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/16/2019, 6:08:03 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/16/2019, 5:14:16 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Approved</strong>: 8/19/2019, 9:13:06 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/shim/handler_test.go#L49](https://github.com/hyperledger-gerrit-archive/fabric/blob/864ba91e7c7f638350c4e3b55562b4b31edbe1c8/core/chaincode/shim/handler_test.go#L49)<br><strong>Comment</strong>: <pre>nit: the review starts with this test and the "created" value comes out of thin error. That implies a prefix or suffix would have been helpful: createdState

probably not worth an action</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/shim/handler_test.go#L51](https://github.com/hyperledger-gerrit-archive/fabric/blob/864ba91e7c7f638350c4e3b55562b4b31edbe1c8/core/chaincode/shim/handler_test.go#L51)<br><strong>Comment</strong>: <pre>Any reason why a literal equality check wasn't used?

```
func TestNewHandler(t *testing.T) {
	t.Parallel()

	chatStream := &mock.PeerChaincodeStream{}
	cc := &mockChaincode{}

	expected := &Handler{
		chatStream:       chatStream,
		cc:               cc,
		responseChannels: map[string]chan pb.ChaincodeMessage{},
		state:            created,
	}
	handler := newChaincodeHandler(chatStream, cc)
	assert.Equal(t, expected, handler)
}
```</pre><strong>Commenter</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/shim/handler_test.go#L51](https://github.com/hyperledger-gerrit-archive/fabric/blob/864ba91e7c7f638350c4e3b55562b4b31edbe1c8/core/chaincode/shim/handler_test.go#L51)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/shim/handler_test.go#L71](https://github.com/hyperledger-gerrit-archive/fabric/blob/864ba91e7c7f638350c4e3b55562b4b31edbe1c8/core/chaincode/shim/handler_test.go#L71)<br><strong>Comment</strong>: <pre>nit: would prefer if we didn't need a hyphen in the test name. Here and the next set of table tests.

go test -run 'go test -run TestHandlerState/created_-_wrong_message_type'

again, nbd.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/shim/handler_test.go#L121](https://github.com/hyperledger-gerrit-archive/fabric/blob/864ba91e7c7f638350c4e3b55562b4b31edbe1c8/core/chaincode/shim/handler_test.go#L121)<br><strong>Comment</strong>: <pre>is it really "Contains" or EqualError?  Honest question.</pre><strong>Commenter</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/shim/handler_test.go#L121](https://github.com/hyperledger-gerrit-archive/fabric/blob/864ba91e7c7f638350c4e3b55562b4b31edbe1c8/core/chaincode/shim/handler_test.go#L121)<br><strong>Comment</strong>: <pre>I was being a bit lazy and only extracting the "interesting" part of the error message in expectedErr</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/shim/handler_test.go#L235](https://github.com/hyperledger-gerrit-archive/fabric/blob/864ba91e7c7f638350c4e3b55562b4b31edbe1c8/core/chaincode/shim/handler_test.go#L235)<br><strong>Comment</strong>: <pre>I guess you're setting up for the future? Right now all of the tests are within 'Error Conditions' so this could be flatted quite a bit.</pre><strong>Commenter</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/shim/handler_test.go#L235](https://github.com/hyperledger-gerrit-archive/fabric/blob/864ba91e7c7f638350c4e3b55562b4b31edbe1c8/core/chaincode/shim/handler_test.go#L235)<br><strong>Comment</strong>: <pre>actually .... I started with most of the tests that are now in stub_test.go here but then realized that I'd be duplicating tests so moved them to stub and drove from there.  I could actually flatten this out because I think we will really only check errors here.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/shim/shim.go#L61](https://github.com/hyperledger-gerrit-archive/fabric/blob/864ba91e7c7f638350c4e3b55562b4b31edbe1c8/core/chaincode/shim/shim.go#L61)<br><strong>Comment</strong>: <pre>nit: this returns an error that's ignored. Doesn't much matter in this context but tools like errcheck will flag.</pre><strong>Commenter</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/shim/shim.go#L61](https://github.com/hyperledger-gerrit-archive/fabric/blob/864ba91e7c7f638350c4e3b55562b4b31edbe1c8/core/chaincode/shim/shim.go#L61)<br><strong>Comment</strong>: <pre>are you sure?</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/shim/shim.go#L126](https://github.com/hyperledger-gerrit-archive/fabric/blob/864ba91e7c7f638350c4e3b55562b4b31edbe1c8/core/chaincode/shim/shim.go#L126)<br><strong>Comment</strong>: <pre>not part of this CR but I don't believe this is the correct behavior. I believe we should simply propagate the io.EOF.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/shim/shim_test.go#L57](https://github.com/hyperledger-gerrit-archive/fabric/blob/864ba91e7c7f638350c4e3b55562b4b31edbe1c8/core/chaincode/shim/shim_test.go#L57)<br><strong>Comment</strong>: <pre>backticks are our friend.</pre><strong>Commenter</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/shim/shim_test.go#L57](https://github.com/hyperledger-gerrit-archive/fabric/blob/864ba91e7c7f638350c4e3b55562b4b31edbe1c8/core/chaincode/shim/shim_test.go#L57)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Uploader</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Created</strong>: 8/19/2019, 10:31:08 AM<br><strong>GitHubMergedRevision</strong>: [098575b7d7b7e517a466a7d3459ac71daae25578](https://github.com/hyperledger-gerrit-archive/fabric/commit/098575b7d7b7e517a466a7d3459ac71daae25578)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/19/2019, 10:44:41 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/19/2019, 10:44:41 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/19/2019, 11:57:29 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/19/2019, 11:16:49 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Approved</strong>: 8/19/2019, 12:11:19 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Approved</strong>: 8/19/2019, 12:28:00 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Matthew Sykes<br><strong>Merged</strong>: 8/19/2019, 12:28:09 PM<br><br></blockquote>