<strong>Project</strong>: fabric<br><strong>Branch</strong>: master<br><strong>ID</strong>: 31335<br><strong>Subject</strong>: FAB-15172 Consensus migration: msgprocessor<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 5/12/2019, 9:00:31 AM<br><strong>LastUpdated</strong>: 5/21/2019, 12:10:04 PM<br><strong>CommitMessage</strong>:<br><pre>FAB-15172 Consensus migration: msgprocessor

Maintenance mode is when ConsensusType.State != Normal.

When maintenance mode is set, block following broadcast
requests:
- block new channel creation
- block all regular messages
- block config updates that are not signed by oderer org admin

On maintainenece mode, block deliver requests unless they are
coming from an orderer admin client, i.e. block requests from
peers.

This is done by:

- Changing the sigfilter such that in maintenance mode it
  requires a signature that satisfies a different policy.
  - In broadcast: /Channel/Orderer/Writers,
  - In Deliver: /Channel/Orderer/Readers,
  This will block Broadcast requests with config updates not
  related to the orderer, and block Deliver requests by peers,
  which are normally /Channel/Readers.
- The msgprocessor ProcessNormalMsg(...) will reject all messages
  in maintenance mode.
- The systemchannel filter will reject new channel creation in
  maintenance mode.

Change-Id: I738eb2cd754d92e2fc906edfa2a5af29a010986e
Signed-off-by: Yoav Tock <tock@il.ibm.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 5/12/2019, 9:00:31 AM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 5/14/2019, 3:40:01 AM<br><strong>Message</strong>: <pre>Uploaded patch set 2.</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 5/14/2019, 4:01:28 AM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/14/2019, 4:09:15 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13723/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/14/2019, 4:09:41 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/14/2019, 4:14:49 AM<br><strong>Message</strong>: <pre>Patch Set 3: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/14/2019, 4:15:31 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13723/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/13723</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/14/2019, 4:16:47 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8752/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/14/2019, 4:17:14 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/14/2019, 4:17:37 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12111/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/14/2019, 4:18:00 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/14/2019, 4:44:17 AM<br><strong>Message</strong>: <pre>Patch Set 3: F3-UnitTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/14/2019, 4:51:48 AM<br><strong>Message</strong>: <pre>Patch Set 3: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/14/2019, 4:52:31 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12111/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/12111

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8752/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/8752</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 5/14/2019, 5:20:07 AM<br><strong>Message</strong>: <pre>Uploaded patch set 4: Patch Set 3 was rebased.</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 5/14/2019, 5:20:36 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/14/2019, 5:24:22 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12112/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/14/2019, 5:24:52 AM<br><strong>Message</strong>: <pre>Patch Set 4: -F3-UnitTest

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/14/2019, 5:54:27 AM<br><strong>Message</strong>: <pre>Patch Set 4: F3-UnitTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/14/2019, 5:55:28 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12112/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/12112</pre><strong>Reviewer</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Reviewed</strong>: 5/14/2019, 8:39:26 AM<br><strong>Message</strong>: <pre>Patch Set 4:

09:54:25 Summarizing 1 Failure:
09:54:25 
09:54:25 [Fail] Chain 3-node Raft cluster when reconfiguring raft cluster reconfiguration [It] does not deadlock if leader steps down while config block is in-flight 
09:54:25 /w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/orderer/consensus/etcdraft/chain_test.go:3941
09:54:25 
09:54:25 Ran 101 of 101 Specs in 42.109 seconds</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 5/14/2019, 9:21:41 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/14/2019, 9:25:50 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12116/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/14/2019, 9:26:17 AM<br><strong>Message</strong>: <pre>Patch Set 4: -F3-UnitTest

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/14/2019, 9:50:15 AM<br><strong>Message</strong>: <pre>Patch Set 4: F3-UnitTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/14/2019, 9:50:53 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12116/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/12116</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 5/14/2019, 10:04:17 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/14/2019, 10:07:18 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12119/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/14/2019, 10:07:43 AM<br><strong>Message</strong>: <pre>Patch Set 4: -F3-UnitTest

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/14/2019, 10:35:05 AM<br><strong>Message</strong>: <pre>Patch Set 4: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/14/2019, 10:35:47 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12119/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/12119</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 5/16/2019, 11:10:50 AM<br><strong>Message</strong>: <pre>Patch Set 4:

(3 comments)</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 5/19/2019, 3:23:42 AM<br><strong>Message</strong>: <pre>Uploaded patch set 5.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/19/2019, 3:25:53 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13809/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/19/2019, 3:26:21 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Starting verify build</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 5/19/2019, 3:27:09 AM<br><strong>Message</strong>: <pre>Patch Set 5:

(3 comments)

@Yacov Thanks for the review!</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/19/2019, 3:32:08 AM<br><strong>Message</strong>: <pre>Patch Set 5: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/19/2019, 3:33:00 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13809/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/13809</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/19/2019, 3:34:35 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12201/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/19/2019, 3:34:59 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/19/2019, 3:35:05 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8813/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/19/2019, 3:35:37 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/19/2019, 4:00:46 AM<br><strong>Message</strong>: <pre>Patch Set 5: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/19/2019, 4:13:28 AM<br><strong>Message</strong>: <pre>Patch Set 5: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/19/2019, 4:14:16 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12201/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/12201

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8813/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/8813</pre><strong>Reviewer</strong>: Artem Barger - bartem@il.ibm.com<br><strong>Reviewed</strong>: 5/19/2019, 4:44:26 AM<br><strong>Message</strong>: <pre>Patch Set 5:

(1 comment)</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 5/19/2019, 6:45:28 AM<br><strong>Message</strong>: <pre>Patch Set 4:

(1 comment)</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 5/20/2019, 6:02:33 AM<br><strong>Message</strong>: <pre>Uploaded patch set 6: Patch Set 5 was rebased.</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 5/20/2019, 6:11:40 AM<br><strong>Message</strong>: <pre>Uploaded patch set 7: New patch set was added with same tree, parent, and commit message as Patch Set 6.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/20/2019, 6:15:56 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13822/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/20/2019, 6:16:22 AM<br><strong>Message</strong>: <pre>Patch Set 7: -F2-DocBuild -F1-VerifyBuild -F3-IntegrationTest -F3-UnitTest

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/20/2019, 6:22:00 AM<br><strong>Message</strong>: <pre>Patch Set 7: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/20/2019, 6:22:48 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13822/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/13822</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/20/2019, 6:24:21 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12209/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/20/2019, 6:24:47 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/20/2019, 6:25:09 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8820/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/20/2019, 6:25:31 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Starting Integration tests</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 5/20/2019, 6:30:43 AM<br><strong>Message</strong>: <pre>Uploaded patch set 8: Commit message was updated.</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 5/20/2019, 6:37:21 AM<br><strong>Message</strong>: <pre>Uploaded patch set 9: Commit message was updated.</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 5/20/2019, 6:41:35 AM<br><strong>Message</strong>: <pre>Topic FAB-15172-filter-broadcast-deliver removed</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 5/20/2019, 6:42:38 AM<br><strong>Message</strong>: <pre>Uploaded patch set 10: Commit message was updated.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/20/2019, 6:50:59 AM<br><strong>Message</strong>: <pre>Patch Set 7: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 5/20/2019, 6:56:17 AM<br><strong>Message</strong>: <pre>Set Ready For Review</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/20/2019, 6:59:44 AM<br><strong>Message</strong>: <pre>Patch Set 7: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/20/2019, 7:00:28 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12209/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/12209

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8820/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/8820</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 5/20/2019, 8:48:20 AM<br><strong>Message</strong>: <pre>Uploaded patch set 11.</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 5/20/2019, 8:51:42 AM<br><strong>Message</strong>: <pre>Patch Set 5:

(2 comments)

@Yacov, @Artem, Thanks for the review!</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/20/2019, 8:52:50 AM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13826/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/20/2019, 8:53:15 AM<br><strong>Message</strong>: <pre>Patch Set 11:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/20/2019, 8:59:00 AM<br><strong>Message</strong>: <pre>Patch Set 11: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/20/2019, 8:59:48 AM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13826/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/13826</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/20/2019, 9:01:40 AM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12212/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/20/2019, 9:01:58 AM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8823/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/20/2019, 9:02:04 AM<br><strong>Message</strong>: <pre>Patch Set 11:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/20/2019, 9:02:24 AM<br><strong>Message</strong>: <pre>Patch Set 11:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/20/2019, 9:28:14 AM<br><strong>Message</strong>: <pre>Patch Set 11: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/20/2019, 9:33:56 AM<br><strong>Message</strong>: <pre>Patch Set 11: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/20/2019, 9:34:38 AM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12212/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/12212

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8823/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/8823</pre><strong>Reviewer</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Reviewed</strong>: 5/20/2019, 11:25:50 AM<br><strong>Message</strong>: <pre>Patch Set 11: Code-Review+2

(9 comments)

All comments are nits. When you can:

- please group the dangling imports back with the rest
- use assert.Error and assert.NoError instead of assert.NotNil and assert.Nil for errors</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 5/20/2019, 12:44:04 PM<br><strong>Message</strong>: <pre>Patch Set 11:

(8 comments)

Overall looks pretty good to me, but a few notes.  We can merge now and address later if you'd prefer, just let me know.</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 5/21/2019, 9:36:20 AM<br><strong>Message</strong>: <pre>Uploaded patch set 12.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/21/2019, 9:38:23 AM<br><strong>Message</strong>: <pre>Patch Set 12:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13856/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/21/2019, 9:38:49 AM<br><strong>Message</strong>: <pre>Patch Set 12:

Starting verify build</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 5/21/2019, 9:40:55 AM<br><strong>Message</strong>: <pre>Uploaded patch set 13.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/21/2019, 9:42:09 AM<br><strong>Message</strong>: <pre>Patch Set 12: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13856/ : ABORTED

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/13856</pre><strong>Reviewer</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Reviewed</strong>: 5/21/2019, 9:42:33 AM<br><strong>Message</strong>: <pre>Patch Set 13:

(18 comments)

@Matt, @Jason, thanks for the review!</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/21/2019, 9:42:48 AM<br><strong>Message</strong>: <pre>Patch Set 13:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13857/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/21/2019, 9:43:15 AM<br><strong>Message</strong>: <pre>Patch Set 13:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/21/2019, 9:48:42 AM<br><strong>Message</strong>: <pre>Patch Set 13: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/21/2019, 9:49:25 AM<br><strong>Message</strong>: <pre>Patch Set 13:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13857/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/13857</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/21/2019, 9:50:22 AM<br><strong>Message</strong>: <pre>Patch Set 13:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12257/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/21/2019, 9:50:46 AM<br><strong>Message</strong>: <pre>Patch Set 13:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/21/2019, 9:51:17 AM<br><strong>Message</strong>: <pre>Patch Set 13:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8852/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/21/2019, 9:51:40 AM<br><strong>Message</strong>: <pre>Patch Set 13:

Starting Integration tests</pre><strong>Reviewer</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Reviewed</strong>: 5/21/2019, 9:52:23 AM<br><strong>Message</strong>: <pre>Patch Set 13: Code-Review+2</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/21/2019, 10:19:03 AM<br><strong>Message</strong>: <pre>Patch Set 13: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/21/2019, 10:27:03 AM<br><strong>Message</strong>: <pre>Patch Set 13: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/21/2019, 10:27:45 AM<br><strong>Message</strong>: <pre>Patch Set 13:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12257/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/12257

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8852/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/8852</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 5/21/2019, 11:07:58 AM<br><strong>Message</strong>: <pre>Patch Set 13: Code-Review+2

(3 comments)</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 5/21/2019, 11:08:21 AM<br><strong>Message</strong>: <pre>Change has been successfully merged by Jason Yellick</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/21/2019, 11:10:23 AM<br><strong>Message</strong>: <pre>Patch Set 13:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-x86_64/6703/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/21/2019, 11:11:06 AM<br><strong>Message</strong>: <pre>Patch Set 13:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/5388/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/21/2019, 12:10:04 PM<br><strong>Message</strong>: <pre>Patch Set 13:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-merge-x86_64/6703/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-x86_64/6703

https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/5388/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-end-2-end-x86_64/5388</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Uploader</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Created</strong>: 5/12/2019, 9:00:31 AM<br><strong>UnmergedRevision</strong>: [2a69b2ed8e116fb5c42c8af59162d8928f7e7691](https://github.com/hyperledger-gerrit-archive/fabric/commit/2a69b2ed8e116fb5c42c8af59162d8928f7e7691)<br><br></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Uploader</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Created</strong>: 5/14/2019, 3:40:01 AM<br><strong>UnmergedRevision</strong>: [5323d88854b8a19ae5b5ec3637705e1cad969b4f](https://github.com/hyperledger-gerrit-archive/fabric/commit/5323d88854b8a19ae5b5ec3637705e1cad969b4f)<br><br></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Uploader</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Created</strong>: 5/14/2019, 4:01:28 AM<br><strong>UnmergedRevision</strong>: [e57edec73da666f1240853a2a65ca096a08bb45f](https://github.com/hyperledger-gerrit-archive/fabric/commit/e57edec73da666f1240853a2a65ca096a08bb45f)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/14/2019, 4:14:49 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/14/2019, 4:14:49 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/14/2019, 4:51:48 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/14/2019, 4:44:17 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Uploader</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Created</strong>: 5/14/2019, 5:20:07 AM<br><strong>UnmergedRevision</strong>: [34d1cde778af5e56f68671f870c493faf905ec8c](https://github.com/hyperledger-gerrit-archive/fabric/commit/34d1cde778af5e56f68671f870c493faf905ec8c)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/14/2019, 4:14:49 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/14/2019, 4:14:49 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/14/2019, 4:51:48 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/14/2019, 10:35:05 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/sigfilter.go#L25](https://github.com/hyperledger-gerrit-archive/fabric/blob/34d1cde778af5e56f68671f870c493faf905ec8c/orderer/common/msgprocessor/sigfilter.go#L25)<br><strong>Comment</strong>: <pre>Instead of extending the current signature filter for maintenance mode, what do you think about an idea of having an additional signature filter, that has a policy manager that checks whether we are in maintenance mode or not:

If we're in maintenance mode, it uses a policies.ChannelOrdererWriters as a policy.

else, it uses an "acceptAll" policy that always returns nil. 

This way, this file is kept intact.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/sigfilter.go#L25](https://github.com/hyperledger-gerrit-archive/fabric/blob/34d1cde778af5e56f68671f870c493faf905ec8c/orderer/common/msgprocessor/sigfilter.go#L25)<br><strong>Comment</strong>: <pre>I see some problems with this proposal. The filters are applied sequentially. This means that in maintenance mode it will be required to satisfy both /Channel/Writers and /Channel/Orderer/Writer policy. Not sure that is what we want; and even if we do, it is easier and more readable to implement it here. I think that for readability and code-maintenance it is better keep all signature related issues in the same filter. In addition, adding an additional filter for maintenance mode will mean that we'll have to change the way Deliver requests are filtered (orderer/common/server/server.go L159-190) - the policyChecker. Right now that file stays intact... Therefore I think the current approach is preferable.</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/sigfilter.go#L25](https://github.com/hyperledger-gerrit-archive/fabric/blob/34d1cde778af5e56f68671f870c493faf905ec8c/orderer/common/msgprocessor/sigfilter.go#L25)<br><strong>Comment</strong>: <pre>What about wrapping this signature filter, with another Filter (has Apply method), and that filter is a demultiplexer to one of two filters- in maintenance mode, a signature filter that is initialized with the maintenance specific policy, and in non maintenance mode - just applies the regular filter?

So, in the right places where this signature filter is constructed, you can just replace it with that demux filter that accepts as parameters in its construction, 2 filters (one for maintenance and one for non maintenance).

What do you think about this idea?</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/sigfilter.go#L25](https://github.com/hyperledger-gerrit-archive/fabric/blob/34d1cde778af5e56f68671f870c493faf905ec8c/orderer/common/msgprocessor/sigfilter.go#L25)<br><strong>Comment</strong>: <pre>What I like about this idea is the possibility to define at construction of the filter the "normal" policy vs. the "maintenance" policy. However, I think it would be simpler to just expose the maintenance policy as another parameter in the construction, and save it as a field.</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/sigfilter.go#L61](https://github.com/hyperledger-gerrit-archive/fabric/blob/34d1cde778af5e56f68671f870c493faf905ec8c/orderer/common/msgprocessor/sigfilter.go#L61)<br><strong>Comment</strong>: <pre>why not explicitly compare to maintenance mode?</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/sigfilter.go#L61](https://github.com/hyperledger-gerrit-archive/fabric/blob/34d1cde778af5e56f68671f870c493faf905ec8c/orderer/common/msgprocessor/sigfilter.go#L61)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/sigfilter.go#L72](https://github.com/hyperledger-gerrit-archive/fabric/blob/34d1cde778af5e56f68671f870c493faf905ec8c/orderer/common/msgprocessor/sigfilter.go#L72)<br><strong>Comment</strong>: <pre>are you sure we want to log this each time? Perhaps log only if we're in maintenance mode?</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/sigfilter.go#L72](https://github.com/hyperledger-gerrit-archive/fabric/blob/34d1cde778af5e56f68671f870c493faf905ec8c/orderer/common/msgprocessor/sigfilter.go#L72)<br><strong>Comment</strong>: <pre>I prefer to keep it simple. A few extra characters in debug won't make a difference, in my opinion...</pre></blockquote><h3>PatchSet Number: 5</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Uploader</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Created</strong>: 5/19/2019, 3:23:42 AM<br><strong>UnmergedRevision</strong>: [1e771099f158054396efc3cdf7611bc30148dc59](https://github.com/hyperledger-gerrit-archive/fabric/commit/1e771099f158054396efc3cdf7611bc30148dc59)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/19/2019, 3:32:08 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/19/2019, 3:32:08 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/19/2019, 4:13:28 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/19/2019, 4:00:46 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Artem Barger - bartem@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/sigfilter_test.go#L15](https://github.com/hyperledger-gerrit-archive/fabric/blob/1e771099f158054396efc3cdf7611bc30148dc59/orderer/common/msgprocessor/sigfilter_test.go#L15)<br><strong>Comment</strong>: <pre>can you please fix imports?</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/sigfilter_test.go#L15](https://github.com/hyperledger-gerrit-archive/fabric/blob/1e771099f158054396efc3cdf7611bc30148dc59/orderer/common/msgprocessor/sigfilter_test.go#L15)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 6</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Uploader</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Created</strong>: 5/20/2019, 6:02:33 AM<br><strong>UnmergedRevision</strong>: [87d386afcd1af9dce878502196af17b03fc9fe5d](https://github.com/hyperledger-gerrit-archive/fabric/commit/87d386afcd1af9dce878502196af17b03fc9fe5d)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/19/2019, 3:32:08 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/19/2019, 3:32:08 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/19/2019, 4:13:28 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/19/2019, 4:00:46 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 7</h3><blockquote><strong>Type</strong>: NO_CHANGE<br><strong>Author</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Uploader</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Created</strong>: 5/20/2019, 6:11:40 AM<br><strong>UnmergedRevision</strong>: [853cdbde26839f52872533e31069228a246bc185](https://github.com/hyperledger-gerrit-archive/fabric/commit/853cdbde26839f52872533e31069228a246bc185)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/20/2019, 6:22:00 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/20/2019, 6:22:00 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/20/2019, 6:59:44 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/20/2019, 6:50:59 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 8</h3><blockquote><strong>Type</strong>: NO_CODE_CHANGE<br><strong>Author</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Uploader</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Created</strong>: 5/20/2019, 6:30:43 AM<br><strong>UnmergedRevision</strong>: [76afea9583db417cd5d5a2d385d0957ca89b3ec7](https://github.com/hyperledger-gerrit-archive/fabric/commit/76afea9583db417cd5d5a2d385d0957ca89b3ec7)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/20/2019, 6:22:00 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/20/2019, 6:22:00 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/19/2019, 4:13:28 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/19/2019, 4:00:46 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 9</h3><blockquote><strong>Type</strong>: NO_CODE_CHANGE<br><strong>Author</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Uploader</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Created</strong>: 5/20/2019, 6:37:21 AM<br><strong>UnmergedRevision</strong>: [00ff5605b3ddf15ce78d76b235cf1a172401810a](https://github.com/hyperledger-gerrit-archive/fabric/commit/00ff5605b3ddf15ce78d76b235cf1a172401810a)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/20/2019, 6:22:00 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/20/2019, 6:22:00 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/19/2019, 4:13:28 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/19/2019, 4:00:46 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 10</h3><blockquote><strong>Type</strong>: NO_CODE_CHANGE<br><strong>Author</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Uploader</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Created</strong>: 5/20/2019, 6:42:38 AM<br><strong>UnmergedRevision</strong>: [51b0946b804f190e60a2cf775bc7e816a0e4748d](https://github.com/hyperledger-gerrit-archive/fabric/commit/51b0946b804f190e60a2cf775bc7e816a0e4748d)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/20/2019, 6:22:00 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/20/2019, 6:22:00 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/19/2019, 4:13:28 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/19/2019, 4:00:46 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 11</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Uploader</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Created</strong>: 5/20/2019, 8:48:20 AM<br><strong>UnmergedRevision</strong>: [a64bfa9232282f6e6a3ce419a724fe877069916d](https://github.com/hyperledger-gerrit-archive/fabric/commit/a64bfa9232282f6e6a3ce419a724fe877069916d)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/20/2019, 8:59:00 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/20/2019, 8:59:00 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/20/2019, 9:33:56 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/20/2019, 9:28:14 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Approved</strong>: 5/20/2019, 11:25:50 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/sigfilter.go#L53](https://github.com/hyperledger-gerrit-archive/fabric/blob/a64bfa9232282f6e6a3ce419a724fe877069916d/orderer/common/msgprocessor/sigfilter.go#L53)<br><strong>Comment</strong>: <pre>curious: why panic instead of error?  Caller already seems to have to deal with errors.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/sigfilter.go#L53](https://github.com/hyperledger-gerrit-archive/fabric/blob/a64bfa9232282f6e6a3ce419a724fe877069916d/orderer/common/msgprocessor/sigfilter.go#L53)<br><strong>Comment</strong>: <pre>My $0.02, the sentinel on this call should probably be removed, and simple early panic checks put in.  Not the fault of this CR, just a bad decision that was made in this API.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/sigfilter.go#L53](https://github.com/hyperledger-gerrit-archive/fabric/blob/a64bfa9232282f6e6a3ce419a724fe877069916d/orderer/common/msgprocessor/sigfilter.go#L53)<br><strong>Comment</strong>: <pre>An error results in rejection of the message and the server keeps running. However this should never happen, getting !ok here indicates something is horribly wrong in the server and it better shut down. I am following the patterns I saw in expiration.go, the API kind of forces you to do that.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/sigfilter.go#L53](https://github.com/hyperledger-gerrit-archive/fabric/blob/a64bfa9232282f6e6a3ce419a724fe877069916d/orderer/common/msgprocessor/sigfilter.go#L53)<br><strong>Comment</strong>: <pre>I agree...</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/sigfilter.go#L62](https://github.com/hyperledger-gerrit-archive/fabric/blob/a64bfa9232282f6e6a3ce419a724fe877069916d/orderer/common/msgprocessor/sigfilter.go#L62)<br><strong>Comment</strong>: <pre>Writers</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/sigfilter.go#L62](https://github.com/hyperledger-gerrit-archive/fabric/blob/a64bfa9232282f6e6a3ce419a724fe877069916d/orderer/common/msgprocessor/sigfilter.go#L62)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/sigfilter.go#L77](https://github.com/hyperledger-gerrit-archive/fabric/blob/a64bfa9232282f6e6a3ce419a724fe877069916d/orderer/common/msgprocessor/sigfilter.go#L77)<br><strong>Comment</strong>: <pre>just curious why debug level?</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/sigfilter.go#L77](https://github.com/hyperledger-gerrit-archive/fabric/blob/a64bfa9232282f6e6a3ce419a724fe877069916d/orderer/common/msgprocessor/sigfilter.go#L77)<br><strong>Comment</strong>: <pre>Probably to protect the logs from an attacker that does not sign his envelopes correctly on purpose... we don't need to log every failure of this filter. I only want to be able to trace/debug the behavior of migration...

In addition, the error propagates back to the user anyway in the broadcast phase.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/sigfilter.go#L78](https://github.com/hyperledger-gerrit-archive/fabric/blob/a64bfa9232282f6e6a3ce419a724fe877069916d/orderer/common/msgprocessor/sigfilter.go#L78)<br><strong>Comment</strong>: <pre>you didn't do this but this is throwing away the value of having the exported ErrPermissionDenied value since people can check for it directly any longer...

second, wrap already adds a stack so wrapping and adding a stack seems redundant.

This is another example of less-than-optimal code that I don't expect you to fix but I want to make you aware of - especially as I see you've copied a bit of this pattern for the maintenance mode error.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/sigfilter.go#L78](https://github.com/hyperledger-gerrit-archive/fabric/blob/a64bfa9232282f6e6a3ce419a724fe877069916d/orderer/common/msgprocessor/sigfilter.go#L78)<br><strong>Comment</strong>: <pre>The broadcast.go code does look at this value -- it calls errors.Cause(err) which returns the underlying error.  Perhaps this is a bad pattern, but thought I would mention it.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/sigfilter.go#L78](https://github.com/hyperledger-gerrit-archive/fabric/blob/a64bfa9232282f6e6a3ce419a724fe877069916d/orderer/common/msgprocessor/sigfilter.go#L78)<br><strong>Comment</strong>: <pre>I agree, this pattern looked a bit weird to me as well, but I am being very careful not changing things I don't fully understand. Since this goes back to the caller, and ultimately the client, it has the potential of breaking things I am not fully aware of here. In the best case, I'll have to fix a bunch of tests, or introduce changes up the call stack. In the worst case, I'll introduce a bug that is not covered by unit or integration tests. Just being conservative.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/sigfilter.go#L78](https://github.com/hyperledger-gerrit-archive/fabric/blob/a64bfa9232282f6e6a3ce419a724fe877069916d/orderer/common/msgprocessor/sigfilter.go#L78)<br><strong>Comment</strong>: <pre>Maybe we can fix that on the top of the stack, after stabilizing migration? Do you think it`s worth the effort?

I assume this boils down to the code in broadcast.go which calls:

func ClassifyError(err error) cb.Status</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/sigfilter_test.go#L89](https://github.com/hyperledger-gerrit-archive/fabric/blob/a64bfa9232282f6e6a3ce419a724fe877069916d/orderer/common/msgprocessor/sigfilter_test.go#L89)<br><strong>Comment</strong>: <pre>unnecessary; if we do want to assert, we can use assert.Error instead of NotNil

here and below</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/sigfilter_test.go#L89](https://github.com/hyperledger-gerrit-archive/fabric/blob/a64bfa9232282f6e6a3ce419a724fe877069916d/orderer/common/msgprocessor/sigfilter_test.go#L89)<br><strong>Comment</strong>: <pre>Done, changed all over the file as well.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/sigfilter_test.go#L97](https://github.com/hyperledger-gerrit-archive/fabric/blob/a64bfa9232282f6e6a3ce419a724fe877069916d/orderer/common/msgprocessor/sigfilter_test.go#L97)<br><strong>Comment</strong>: <pre>please use assert.NoError

here and below</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/sigfilter_test.go#L97](https://github.com/hyperledger-gerrit-archive/fabric/blob/a64bfa9232282f6e6a3ce419a724fe877069916d/orderer/common/msgprocessor/sigfilter_test.go#L97)<br><strong>Comment</strong>: <pre>Done, changed all over the file as well.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/standardchannel.go#L98](https://github.com/hyperledger-gerrit-archive/fabric/blob/a64bfa9232282f6e6a3ce419a724fe877069916d/orderer/common/msgprocessor/standardchannel.go#L98)<br><strong>Comment</strong>: <pre>I think the capability check here is unnecessary.  Unless the capability is set, it should not be possible for ConsensusState() to return anything other than STATE_NORMAL, no?</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/standardchannel.go#L98](https://github.com/hyperledger-gerrit-archive/fabric/blob/a64bfa9232282f6e6a3ce419a724fe877069916d/orderer/common/msgprocessor/standardchannel.go#L98)<br><strong>Comment</strong>: <pre>In theory, you are correct, it may be redundant. I would have to take care of it in the MaintenanceFilter and prevent entry to maintenance mode unless the capability is on. 

However, I was thinking about being extra careful and not even reading ConsensusType.State unless the capability is on. It that a problem?</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/standardchannel.go#L98](https://github.com/hyperledger-gerrit-archive/fabric/blob/a64bfa9232282f6e6a3ce419a724fe877069916d/orderer/common/msgprocessor/standardchannel.go#L98)<br><strong>Comment</strong>: <pre>I'm a little wary of performing checks which we know should be unnecessary.  If the value is set to maintenance but the capability is not set, what is the appropriate behavior? Here we've picked "ignore maintenance mode", but, "respect maintenance mode" would be an equally appropriate choice (and removes this check), so I would lean towards skipping it, but I'm fine as written.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/standardchannel.go#L101](https://github.com/hyperledger-gerrit-archive/fabric/blob/a64bfa9232282f6e6a3ce419a724fe877069916d/orderer/common/msgprocessor/standardchannel.go#L101)<br><strong>Comment</strong>: <pre>I am going to drop that, to make it consistent with the message in systemchannelfilter.go.

The message "maintenance mode" is added by wrapping with ErrMaintenanceMode.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/standardchannel.go#L102](https://github.com/hyperledger-gerrit-archive/fabric/blob/a64bfa9232282f6e6a3ce419a724fe877069916d/orderer/common/msgprocessor/standardchannel.go#L102)<br><strong>Comment</strong>: <pre>So, you didn't start this pattern but...

When errors are exported as vars, that's generally done to make it easier for callers to compare the exported error with the one that was returned. By wrapping the error, we completely destroy that capability. Hence, we have all of the decorations and none of the value.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/standardchannel.go#L102](https://github.com/hyperledger-gerrit-archive/fabric/blob/a64bfa9232282f6e6a3ce419a724fe877069916d/orderer/common/msgprocessor/standardchannel.go#L102)<br><strong>Comment</strong>: <pre>As noted before, you can retrieve the original error via errors.Cause(err), is this a problem?</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/standardchannel.go#L102](https://github.com/hyperledger-gerrit-archive/fabric/blob/a64bfa9232282f6e6a3ce419a724fe877069916d/orderer/common/msgprocessor/standardchannel.go#L102)<br><strong>Comment</strong>: <pre>As a corollary, should I add a new status code to broadcast ClassifyError()? right now this translates to the default BAD_REQUEST... maybe classify it as Status_SERVICE_UNAVAILABLE? That sounds more accurate to me.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/standardchannel.go#L102](https://github.com/hyperledger-gerrit-archive/fabric/blob/a64bfa9232282f6e6a3ce419a724fe877069916d/orderer/common/msgprocessor/standardchannel.go#L102)<br><strong>Comment</strong>: <pre>Jason answered it... I hope</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/standardchannel.go#L102](https://github.com/hyperledger-gerrit-archive/fabric/blob/a64bfa9232282f6e6a3ce419a724fe877069916d/orderer/common/msgprocessor/standardchannel.go#L102)<br><strong>Comment</strong>: <pre>Agreed -- the broadcast.go ClassifyError should be enhanced to handle this one.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/standardchannel_test.go#L13](https://github.com/hyperledger-gerrit-archive/fabric/blob/a64bfa9232282f6e6a3ce419a724fe877069916d/orderer/common/msgprocessor/standardchannel_test.go#L13)<br><strong>Comment</strong>: <pre>nit: why is this in a group by itself? seems it belongs with the others.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/standardchannel_test.go#L13](https://github.com/hyperledger-gerrit-archive/fabric/blob/a64bfa9232282f6e6a3ce419a724fe877069916d/orderer/common/msgprocessor/standardchannel_test.go#L13)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/standardchannel_test.go#L51](https://github.com/hyperledger-gerrit-archive/fabric/blob/a64bfa9232282f6e6a3ce419a724fe877069916d/orderer/common/msgprocessor/standardchannel_test.go#L51)<br><strong>Comment</strong>: <pre>nit: multi line struct: all on one line or the closing brace goes on the line by itself</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/standardchannel_test.go#L51](https://github.com/hyperledger-gerrit-archive/fabric/blob/a64bfa9232282f6e6a3ce419a724fe877069916d/orderer/common/msgprocessor/standardchannel_test.go#L51)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/systemchannel.go#L46](https://github.com/hyperledger-gerrit-archive/fabric/blob/a64bfa9232282f6e6a3ce419a724fe877069916d/orderer/common/msgprocessor/systemchannel.go#L46)<br><strong>Comment</strong>: <pre>Writers</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/systemchannel.go#L46](https://github.com/hyperledger-gerrit-archive/fabric/blob/a64bfa9232282f6e6a3ce419a724fe877069916d/orderer/common/msgprocessor/systemchannel.go#L46)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/systemchannelfilter.go#L85](https://github.com/hyperledger-gerrit-archive/fabric/blob/a64bfa9232282f6e6a3ce419a724fe877069916d/orderer/common/msgprocessor/systemchannelfilter.go#L85)<br><strong>Comment</strong>: <pre>Can we just say 'maintenance mode' here for consistency?</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/systemchannelfilter.go#L85](https://github.com/hyperledger-gerrit-archive/fabric/blob/a64bfa9232282f6e6a3ce419a724fe877069916d/orderer/common/msgprocessor/systemchannelfilter.go#L85)<br><strong>Comment</strong>: <pre>Sure, I'll change it also in standardchannel.ProcessNormalMsg(), for consistency ;-)

I'll drop "consensus-type migration". The message "maintenance mode" is added by wrapping with ErrMaintenanceMode.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/systemchannelfilter_test.go#L13](https://github.com/hyperledger-gerrit-archive/fabric/blob/a64bfa9232282f6e6a3ce419a724fe877069916d/orderer/common/msgprocessor/systemchannelfilter_test.go#L13)<br><strong>Comment</strong>: <pre>why is this grouped by itself? Seems like it should be in with the rest.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/systemchannelfilter_test.go#L13](https://github.com/hyperledger-gerrit-archive/fabric/blob/a64bfa9232282f6e6a3ce419a724fe877069916d/orderer/common/msgprocessor/systemchannelfilter_test.go#L13)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [orderer/common/server/server.go#L175](https://github.com/hyperledger-gerrit-archive/fabric/blob/a64bfa9232282f6e6a3ce419a724fe877069916d/orderer/common/server/server.go#L175)<br><strong>Comment</strong>: <pre>I would have thought we should go with /Channel/Orderer/Readers here.  This seems more symmetric and natural, that policies which were /Channel/* become /Channel/Orderer/* in maintenance mode.</pre><strong>Commenter</strong>: Yoav Tock - tock@il.ibm.com<br><strong>CommentLine</strong>: [orderer/common/server/server.go#L175](https://github.com/hyperledger-gerrit-archive/fabric/blob/a64bfa9232282f6e6a3ce419a724fe877069916d/orderer/common/server/server.go#L175)<br><strong>Comment</strong>: <pre>The point here is to prevent the peers from getting any block while the orderer is on maintenance mode. We do this in order to be able to roll back the orderer file system. Normally, peers do not satisfy /Channel/Orderer/Writers; are you sure they do not satisfy /Channel/Orderer/Readers? I just don't know...

I'll change it for now, and I'll write an integration/e2e test case to confirm that the peer does not receive unnecessary blocks in case we do an orderer filesystem rollback.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [orderer/common/server/server.go#L175](https://github.com/hyperledger-gerrit-archive/fabric/blob/a64bfa9232282f6e6a3ce419a724fe877069916d/orderer/common/server/server.go#L175)<br><strong>Comment</strong>: <pre>The default set of policies works pretty much as you would expect it to.  Any policies defined in /Channel/Application/* can only be satisfied by the peer org members.  Any policies defined in /Channel/Orderer/* can only be satisfied by the orderer org members.

The reason why I'd say '/Channel/Orderer/Readers is more appropriate, is because for systems like Raft, which use the Deliver service for block replication when joining a network may (and usually should) configure their policies such that the orderer process credentials are not authorized to submit transactions to the network, but would be authorized to read them.

Today, the default policy for the Broadcast at orderer is '/Channel/Writers', which is "either /Channel/Orderer/Writers or /Channel/Application/Writers", and we remove the "/Channel/Application/Writers" in maintenance mode.  The default policy for the Deliver at orderer is '/Channel/Readers', which is "either /Channel/Orderer/Readers or /Channel/Application/Readers", so it makes sense to me to simply do the same which is remove /Channel/Application/Readers".  In this way both APIs modify their set of allowed users to a subset of the previous set, rather than to an entirely different set.</pre></blockquote><h3>PatchSet Number: 12</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Uploader</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Created</strong>: 5/21/2019, 9:36:20 AM<br><strong>UnmergedRevision</strong>: [35e67b68f567f314a86a512bbf58fd9b95035d4a](https://github.com/hyperledger-gerrit-archive/fabric/commit/35e67b68f567f314a86a512bbf58fd9b95035d4a)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/21/2019, 9:42:09 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 13</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Uploader</strong>: Yoav Tock - tock@il.ibm.com<br><strong>Created</strong>: 5/21/2019, 9:40:55 AM<br><strong>GitHubMergedRevision</strong>: [aa8d1e6cf0acc51055a42b7256bb3f195357adc9](https://github.com/hyperledger-gerrit-archive/fabric/commit/aa8d1e6cf0acc51055a42b7256bb3f195357adc9)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/21/2019, 9:48:42 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/21/2019, 9:48:42 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/21/2019, 10:27:03 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/21/2019, 10:19:03 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Approved</strong>: 5/21/2019, 11:07:58 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Jason Yellick<br><strong>Merged</strong>: 5/21/2019, 11:08:21 AM<br><br><strong>Approver</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Approved</strong>: 5/21/2019, 9:52:23 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br></blockquote>