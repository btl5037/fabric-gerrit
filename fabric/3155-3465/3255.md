<strong>Project</strong>: fabric<br><strong>Branch</strong>: master<br><strong>ID</strong>: 3255<br><strong>Subject</strong>: MSP mgr instantiation from Block<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Assignee</strong>:<br><strong>Created</strong>: 12/13/2016, 10:47:02 AM<br><strong>LastUpdated</strong>: 12/15/2016, 4:41:50 AM<br><strong>CommitMessage</strong>:<br><pre>MSP mgr instantiation from Block

This change-set introduces a proper implementation of the function that
generates an MSP manager out of a Block from the ledger. We expect one
ConfigurationItem per MSP, each containing in the Value field the protobuf
serialization of an MSPConfig message. The MSP config schema has been further
simplified by removing the MSPManagerConfig struct. Furthermore, MSP's and
MSPManager's are now immutable types: the reconfig method has been removed and
reconfiguring a manager/msp means constructing a new one and letting the old
instance go out of scope.

Change-Id: I42b12e1bece4084ab5695f60050ce512a5286e87
Signed-off-by: Alessandro Sorniotti <ale.linux@sopit.net>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 12/13/2016, 10:47:02 AM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/13/2016, 10:51:02 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/3993/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/13/2016, 11:22:15 AM<br><strong>Message</strong>: <pre>Patch Set 1: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/3993/ : SUCCESS</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 12/13/2016, 12:34:44 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(1 comment)</pre><strong>Reviewer</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>Reviewed</strong>: 12/13/2016, 1:49:00 PM<br><strong>Message</strong>: <pre>Patch Set 1: Code-Review-1

(11 comments)

Few changes that I'd like to see (not all of them, which can be later, like comments on the interfaces) before merge. Some files should be moved out of MSP to keep the abstraction clean.</pre><strong>Reviewer</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>Reviewed</strong>: 12/13/2016, 3:00:49 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(1 comment)</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 12/14/2016, 5:08:04 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(2 comments)</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 12/14/2016, 5:18:52 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(2 comments)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 12/14/2016, 6:50:42 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(12 comments)

Thanks Binh and Jason, see below (and I'll push a new change set soon)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 12/14/2016, 7:09:43 AM<br><strong>Message</strong>: <pre>Uploaded patch set 2.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/14/2016, 7:12:58 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/4095/</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 12/14/2016, 7:43:22 AM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/14/2016, 7:45:49 AM<br><strong>Message</strong>: <pre>Patch Set 2: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/4095/ : SUCCESS</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/14/2016, 7:47:53 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/4097/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/14/2016, 8:27:12 AM<br><strong>Message</strong>: <pre>Patch Set 3: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/4097/ : SUCCESS</pre><strong>Reviewer</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>Reviewed</strong>: 12/14/2016, 10:22:31 AM<br><strong>Message</strong>: <pre>Patch Set 3: Code-Review+2

(4 comments)

I am voting to merge this for our integration path. There are more works in other components that requires this MSP.  

Ale will get the rest in another changeset, and also address the remaining comments from Jason and Gari.</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 12/14/2016, 1:05:08 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(1 comment)</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 12/14/2016, 1:05:49 PM<br><strong>Message</strong>: <pre>Patch Set 3: Code-Review+1</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 12/14/2016, 2:39:17 PM<br><strong>Message</strong>: <pre>Patch Set 3: Code-Review+2

I'm ok for now - but I think we'll need to come back - but let's make sure we can get the end to end working - which is the core goal.  I'll +2 so that we don't block the next steps for now</pre><strong>Reviewer</strong>: Gerrit Code Review - gerrit@hyperledger.org<br><strong>Reviewed</strong>: 12/14/2016, 2:41:45 PM<br><strong>Message</strong>: <pre>Change has been successfully merged by Binh Nguyen</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/14/2016, 2:44:14 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-x86_64/580/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 12/14/2016, 3:14:19 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-merge-x86_64/580/ : SUCCESS</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 12/15/2016, 4:28:58 AM<br><strong>Message</strong>: <pre>Patch Set 3:

(5 comments)

Thanks gents, see my comments below, let me know what you think and I can address them in a subsequent CR</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 12/15/2016, 4:41:50 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(1 comment)</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 12/13/2016, 10:47:02 AM<br><strong>UnmergedRevision</strong>: [598dd641d2ab92ce2b0309d8fac3426e62909c21](https://github.com/hyperledger-gerrit-archive/fabric/commit/598dd641d2ab92ce2b0309d8fac3426e62909c21)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/13/2016, 11:22:15 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>Approved</strong>: 12/13/2016, 1:49:00 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>CommentLine</strong>: [core/peer/msp/peermsp_test.go#L12](https://github.com/hyperledger-gerrit-archive/fabric/blob/598dd641d2ab92ce2b0309d8fac3426e62909c21/core/peer/msp/peermsp_test.go#L12)<br><strong>Comment</strong>: <pre>We should use viper to do this -- based off "fileSystemPath".  See core/peer/peer_test.go for example</pre><strong>Commenter</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>CommentLine</strong>: [core/peer/msp/peermsp_test.go#L12](https://github.com/hyperledger-gerrit-archive/fabric/blob/598dd641d2ab92ce2b0309d8fac3426e62909c21/core/peer/msp/peermsp_test.go#L12)<br><strong>Comment</strong>: <pre>I thought about this more, and this is test config files that we need. Not what the user sets. So I retract my comment above.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/peer/msp/peermsp_test.go#L12](https://github.com/hyperledger-gerrit-archive/fabric/blob/598dd641d2ab92ce2b0309d8fac3426e62909c21/core/peer/msp/peermsp_test.go#L12)<br><strong>Comment</strong>: <pre>Ok, thx</pre><strong>Commenter</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>CommentLine</strong>: [msp/configbuilder.go#L45](https://github.com/hyperledger-gerrit-archive/fabric/blob/598dd641d2ab92ce2b0309d8fac3426e62909c21/msp/configbuilder.go#L45)<br><strong>Comment</strong>: <pre>ioutil.ReadDir only returns directories, so this check is unnecessary</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [msp/configbuilder.go#L45](https://github.com/hyperledger-gerrit-archive/fabric/blob/598dd641d2ab92ce2b0309d8fac3426e62909c21/msp/configbuilder.go#L45)<br><strong>Comment</strong>: <pre>That doesn't seem to be true, I've tried

	c, err := ioutil.ReadDir("/home/aso")
	for _, f := range c {
		fmt.Printf("%s isdir %t\n", f.Name(), f.IsDir())
	}


See some sample output below

.vim isdir true
.viminfo isdir false
.vimrc isdir false.

Should I still change it?</pre><strong>Commenter</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>CommentLine</strong>: [msp/configbuilder.go#L45](https://github.com/hyperledger-gerrit-archive/fabric/blob/598dd641d2ab92ce2b0309d8fac3426e62909c21/msp/configbuilder.go#L45)<br><strong>Comment</strong>: <pre>You 've found a bug in golang https://golang.org/pkg/io/ioutil/#ReadDir "ReadDir reads the directory named by dirname and returns a list of directory entries sorted by filename."  And of course in my code :-)</pre><strong>Commenter</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>CommentLine</strong>: [msp/configbuilder.go#L49](https://github.com/hyperledger-gerrit-archive/fabric/blob/598dd641d2ab92ce2b0309d8fac3426e62909c21/msp/configbuilder.go#L49)<br><strong>Comment</strong>: <pre>since we import filepath, we should use filepath.join() function --  https://golang.org/pkg/path/filepath/#Join</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [msp/configbuilder.go#L49](https://github.com/hyperledger-gerrit-archive/fabric/blob/598dd641d2ab92ce2b0309d8fac3426e62909c21/msp/configbuilder.go#L49)<br><strong>Comment</strong>: <pre>Good catch, thanks!</pre><strong>Commenter</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>CommentLine</strong>: [msp/msp.go#L0](https://github.com/hyperledger-gerrit-archive/fabric/blob/598dd641d2ab92ce2b0309d8fac3426e62909c21/msp/msp.go#L0)<br><strong>Comment</strong>: <pre>In general, we need better comment on the interface as this is going to be public and we want folks to provide implementations.  However, I am ok with adding TODOs at this point for us to work through the integration.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [msp/msp.go#L0](https://github.com/hyperledger-gerrit-archive/fabric/blob/598dd641d2ab92ce2b0309d8fac3426e62909c21/msp/msp.go#L0)<br><strong>Comment</strong>: <pre>Thanks, will do. Shall I also create a JIRA not to forget?</pre><strong>Commenter</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>CommentLine</strong>: [msp/msp.go#L0](https://github.com/hyperledger-gerrit-archive/fabric/blob/598dd641d2ab92ce2b0309d8fac3426e62909c21/msp/msp.go#L0)<br><strong>Comment</strong>: <pre>management always wants jira items :-)</pre><strong>Commenter</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>CommentLine</strong>: [msp/msp.go#L63](https://github.com/hyperledger-gerrit-archive/fabric/blob/598dd641d2ab92ce2b0309d8fac3426e62909c21/msp/msp.go#L63)<br><strong>Comment</strong>: <pre>misspelled</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [msp/msp.go#L63](https://github.com/hyperledger-gerrit-archive/fabric/blob/598dd641d2ab92ce2b0309d8fac3426e62909c21/msp/msp.go#L63)<br><strong>Comment</strong>: <pre>Whoops, thx!</pre><strong>Commenter</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>CommentLine</strong>: [msp/msp.go#L72](https://github.com/hyperledger-gerrit-archive/fabric/blob/598dd641d2ab92ce2b0309d8fac3426e62909c21/msp/msp.go#L72)<br><strong>Comment</strong>: <pre>function name</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [msp/msp.go#L72](https://github.com/hyperledger-gerrit-archive/fabric/blob/598dd641d2ab92ce2b0309d8fac3426e62909c21/msp/msp.go#L72)<br><strong>Comment</strong>: <pre>Thanks!</pre><strong>Commenter</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>CommentLine</strong>: [msp/msp.go#L97](https://github.com/hyperledger-gerrit-archive/fabric/blob/598dd641d2ab92ce2b0309d8fac3426e62909c21/msp/msp.go#L97)<br><strong>Comment</strong>: <pre>this form is not read well in statement.
  i would suggest change it to
 Validate() error</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [msp/msp.go#L97](https://github.com/hyperledger-gerrit-archive/fabric/blob/598dd641d2ab92ce2b0309d8fac3426e62909c21/msp/msp.go#L97)<br><strong>Comment</strong>: <pre>Changed - last time around I did it for the function in MSP but I forgot to do it here for the identity. Thx</pre><strong>Commenter</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>CommentLine</strong>: [msp/mspconfig.proto#L0](https://github.com/hyperledger-gerrit-archive/fabric/blob/598dd641d2ab92ce2b0309d8fac3426e62909c21/msp/mspconfig.proto#L0)<br><strong>Comment</strong>: <pre>Should this file be in /protos/common since it is being used in both peer and orderer?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [msp/mspconfig.proto#L0](https://github.com/hyperledger-gerrit-archive/fabric/blob/598dd641d2ab92ce2b0309d8fac3426e62909c21/msp/mspconfig.proto#L0)<br><strong>Comment</strong>: <pre>I've placed it in protos/msp to avoid import cycles - is that okay?</pre><strong>Commenter</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>CommentLine</strong>: [msp/mspconfig.proto#L0](https://github.com/hyperledger-gerrit-archive/fabric/blob/598dd641d2ab92ce2b0309d8fac3426e62909c21/msp/mspconfig.proto#L0)<br><strong>Comment</strong>: <pre>That is fine for now until my head is clear of the cold then i might have a different opinion.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [msp/mspconfig.proto#L0](https://github.com/hyperledger-gerrit-archive/fabric/blob/598dd641d2ab92ce2b0309d8fac3426e62909c21/msp/mspconfig.proto#L0)<br><strong>Comment</strong>: <pre>Understood!</pre><strong>Commenter</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>CommentLine</strong>: [msp/mspconfig.proto#L33](https://github.com/hyperledger-gerrit-archive/fabric/blob/598dd641d2ab92ce2b0309d8fac3426e62909c21/msp/mspconfig.proto#L33)<br><strong>Comment</strong>: <pre>Id this field containing the FabricMSPConfig defined below?  The comment is not clear.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [msp/mspconfig.proto#L33](https://github.com/hyperledger-gerrit-archive/fabric/blob/598dd641d2ab92ce2b0309d8fac3426e62909c21/msp/mspconfig.proto#L33)<br><strong>Comment</strong>: <pre>You are right, thx, will change</pre><strong>Commenter</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>CommentLine</strong>: [msp/mspconfig.proto#L41](https://github.com/hyperledger-gerrit-archive/fabric/blob/598dd641d2ab92ce2b0309d8fac3426e62909c21/msp/mspconfig.proto#L41)<br><strong>Comment</strong>: <pre>I'm not sure I understand what this signing identity would be used for?  Are we trying to be able to also use this proto in a function we could call directly against the peer to give it an identity?   I can't imagine that this would be populated when it comes from a config block via the ordering service.

I can see this being somewhat useful for a admin API on the peer, but I think we need to take care in that you'd never get the signing identity when this comes through a config block</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [msp/mspconfig.proto#L41](https://github.com/hyperledger-gerrit-archive/fabric/blob/598dd641d2ab92ce2b0309d8fac3426e62909c21/msp/mspconfig.proto#L41)<br><strong>Comment</strong>: <pre>There's 2 main types of peer MSP: the local MSP, used by the peer to sign endorsements and to authenticate chain join messages, and the per-chain MSP, used by the peer to authenticate proposals/txes for that chain. This struct aims to be the config struct for either. The local MSP will have a signing identity, whereas per-chain MSPs won't, which is fine, the code will handle that.

Having a single config struct allows us to expose 

MSP.Setup(*MSPConfig)

for either type of MSP.</pre><strong>Commenter</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>CommentLine</strong>: [msp/mspconfig.proto#L41](https://github.com/hyperledger-gerrit-archive/fabric/blob/598dd641d2ab92ce2b0309d8fac3426e62909c21/msp/mspconfig.proto#L41)<br><strong>Comment</strong>: <pre>Done - fair enough.  I think we just need to be careful that people don't mistakenly attempt to add signing identities when configuring per chain MSPs</pre><strong>Commenter</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>CommentLine</strong>: [msp/mspconfig.proto#L56](https://github.com/hyperledger-gerrit-archive/fabric/blob/598dd641d2ab92ce2b0309d8fac3426e62909c21/msp/mspconfig.proto#L56)<br><strong>Comment</strong>: <pre>we should clarify what type of value is expected here.  I would think that this simply be the serialized bytes of the public keys for the admin "identities"?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [msp/mspconfig.proto#L56](https://github.com/hyperledger-gerrit-archive/fabric/blob/598dd641d2ab92ce2b0309d8fac3426e62909c21/msp/mspconfig.proto#L56)<br><strong>Comment</strong>: <pre>Almost, here we expect to have the certs of the admins. But yeah, your point is valid, we should clarify.</pre><strong>Commenter</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>CommentLine</strong>: [msp/mspconfig.proto#L59](https://github.com/hyperledger-gerrit-archive/fabric/blob/598dd641d2ab92ce2b0309d8fac3426e62909c21/msp/mspconfig.proto#L59)<br><strong>Comment</strong>: <pre>do we expect this to be an explicit list of certificates or an actual standard CRL format?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [msp/mspconfig.proto#L59](https://github.com/hyperledger-gerrit-archive/fabric/blob/598dd641d2ab92ce2b0309d8fac3426e62909c21/msp/mspconfig.proto#L59)<br><strong>Comment</strong>: <pre>I don't think we have reached an agreement on that point yet tbh.. let me do some more research and get back to you</pre><strong>Commenter</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>CommentLine</strong>: [msp/testutils/testutils.go#L0](https://github.com/hyperledger-gerrit-archive/fabric/blob/598dd641d2ab92ce2b0309d8fac3426e62909c21/msp/testutils/testutils.go#L0)<br><strong>Comment</strong>: <pre>This file should be in protos/utils to keep the msp abstraction clean</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [msp/testutils/testutils.go#L0](https://github.com/hyperledger-gerrit-archive/fabric/blob/598dd641d2ab92ce2b0309d8fac3426e62909c21/msp/testutils/testutils.go#L0)<br><strong>Comment</strong>: <pre>I've placed it in protos/msp to avoid import cycles - is that okay?</pre><strong>Commenter</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>CommentLine</strong>: [msp/utils/utils.go#L0](https://github.com/hyperledger-gerrit-archive/fabric/blob/598dd641d2ab92ce2b0309d8fac3426e62909c21/msp/utils/utils.go#L0)<br><strong>Comment</strong>: <pre>I don't think this file should be here. Block manipulation should be outside of MSP to keep a clean separation/abstraction.  I would suggest put this in protos/utils and make use of other utils there and in fabric/common</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [msp/utils/utils.go#L0](https://github.com/hyperledger-gerrit-archive/fabric/blob/598dd641d2ab92ce2b0309d8fac3426e62909c21/msp/utils/utils.go#L0)<br><strong>Comment</strong>: <pre>I've placed it in protos/msp to avoid import cycles - is that okay?</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [msp/utils/utils.go#L28](https://github.com/hyperledger-gerrit-archive/fabric/blob/598dd641d2ab92ce2b0309d8fac3426e62909c21/msp/utils/utils.go#L28)<br><strong>Comment</strong>: <pre>I'd strongly encourage you to utilize the configtx.Manager and configtx.Handler interfaces here instead of rolling your own.

The configtx.Manager parses the configuration envelope, and invoke the Handlers for each type of configuration to update them.  In this case, the MSP Manager could simply be a configtx.Handler and I everything should work smoothly.  In this way,there's no need to duplicate the block parsing and error handling multiple times.

Note that at construction, the configtx.Manager skips the policy validation and simply applies the configuration.  This behavior seems desirable though in this case, as nutil the chain is created, there is no MSP to validate things against.</pre><strong>Commenter</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>CommentLine</strong>: [msp/utils/utils.go#L28](https://github.com/hyperledger-gerrit-archive/fabric/blob/598dd641d2ab92ce2b0309d8fac3426e62909c21/msp/utils/utils.go#L28)<br><strong>Comment</strong>: <pre>agree</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [msp/utils/utils.go#L28](https://github.com/hyperledger-gerrit-archive/fabric/blob/598dd641d2ab92ce2b0309d8fac3426e62909c21/msp/utils/utils.go#L28)<br><strong>Comment</strong>: <pre>Thanks Jason, as we discussed I like this approach and can easily change it. @Binh: if I make this change it may require some changes on your side as well, should I go ahead?</pre><strong>Commenter</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>CommentLine</strong>: [msp/utils/utils.go#L28](https://github.com/hyperledger-gerrit-archive/fabric/blob/598dd641d2ab92ce2b0309d8fac3426e62909c21/msp/utils/utils.go#L28)<br><strong>Comment</strong>: <pre>I propose that we do this in another changeset so that i can integrate and test out the path -- whatever works -- rather than keep waiting. Also address Gari's comment on that changeset as well. We need this to drive the msp integration with newchain. Not perfect but subsequent changesets will address that.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [msp/utils/utils.go#L28](https://github.com/hyperledger-gerrit-archive/fabric/blob/598dd641d2ab92ce2b0309d8fac3426e62909c21/msp/utils/utils.go#L28)<br><strong>Comment</strong>: <pre>In the interest of progress, I'm okay with this, +1-ing for now, but want to wait for Gari's consent.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [msp/utils/utils.go#L28](https://github.com/hyperledger-gerrit-archive/fabric/blob/598dd641d2ab92ce2b0309d8fac3426e62909c21/msp/utils/utils.go#L28)<br><strong>Comment</strong>: <pre>Understood, thanks! I'm ready to change this as soon as required</pre></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 12/14/2016, 7:09:43 AM<br><strong>UnmergedRevision</strong>: [9e4e5f416d324bd4823a2314400616e947e5bd5d](https://github.com/hyperledger-gerrit-archive/fabric/commit/9e4e5f416d324bd4823a2314400616e947e5bd5d)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/14/2016, 7:45:49 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 12/14/2016, 7:43:22 AM<br><strong>GitHubMergedRevision</strong>: [64445459eff6ce86dd477387768565b139265381](https://github.com/hyperledger-gerrit-archive/fabric/commit/64445459eff6ce86dd477387768565b139265381)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 12/14/2016, 8:27:12 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Approved</strong>: 12/14/2016, 1:05:49 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>Approved</strong>: 12/14/2016, 10:22:31 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Binh Nguyen<br><strong>Merged</strong>: 12/14/2016, 2:41:45 PM<br><br><strong>Approver</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Approved</strong>: 12/14/2016, 2:39:17 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br></blockquote>