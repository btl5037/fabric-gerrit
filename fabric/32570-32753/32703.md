<strong>Project</strong>: fabric<br><strong>Branch</strong>: release-1.4<br><strong>ID</strong>: 32703<br><strong>Subject</strong>: rollback/reset: ensure that stateDB is dropped<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 8/5/2019, 6:52:03 AM<br><strong>LastUpdated</strong>: 8/7/2019, 12:53:16 PM<br><strong>CommitMessage</strong>:<br><pre>rollback/reset: ensure that stateDB is dropped

Currently, the peer node reset/rollback command itself
take care of dropping the statelevelDB. However, the
couchDB should be removed manually. As an admin could
do a mistake by not removing the couchDB, we need to
add necessary check in the code to ensure that the
stateDB is dropped after a reset/rollback.

FAB-16113 #done

Change-Id: I5f68371ec0bebb4ab35d65eba38033a4c97a27be
Signed-off-by: senthil <cendhu@gmail.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 8/5/2019, 6:52:03 AM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 8/5/2019, 6:52:33 AM<br><strong>Message</strong>: <pre>Uploaded patch set 2: Commit message was updated.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 6:54:22 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/16070/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 6:54:55 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 6:59:37 AM<br><strong>Message</strong>: <pre>Patch Set 1: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 7:00:27 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/16070/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/16070</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 7:01:52 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/10832/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 7:02:25 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 7:02:47 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/14235/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 7:03:16 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 7:21:07 AM<br><strong>Message</strong>: <pre>Patch Set 1: F3-UnitTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 7:51:04 AM<br><strong>Message</strong>: <pre>Patch Set 1: F3-IntegrationTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 7:52:11 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/10832/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/10832

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/14235/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/14235</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 8/5/2019, 8:14:25 AM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 8:19:22 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/16072/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 8:20:01 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 8:24:42 AM<br><strong>Message</strong>: <pre>Patch Set 3: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 8:25:36 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/16072/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/16072</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 8:27:12 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/10833/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 8:27:27 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/14236/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 8:27:41 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 8:27:51 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 8:29:36 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/10833/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/10833

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/14236/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/14236</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 8/5/2019, 10:20:48 AM<br><strong>Message</strong>: <pre>Patch Set 3:

VerifyBuild</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 10:25:40 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/16075/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 10:26:09 AM<br><strong>Message</strong>: <pre>Patch Set 3: -F2-DocBuild -F1-VerifyBuild

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 10:30:58 AM<br><strong>Message</strong>: <pre>Patch Set 3: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 10:33:49 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/10837/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 10:34:20 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 10:34:33 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/14239/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 10:35:17 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Starting unit tests</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 8/5/2019, 10:49:12 AM<br><strong>Message</strong>: <pre>Patch Set 3: Code-Review+1

(2 comments)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 11:01:20 AM<br><strong>Message</strong>: <pre>Patch Set 3: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 11:26:35 AM<br><strong>Message</strong>: <pre>Patch Set 3: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 11:27:31 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/16075/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/16075

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/10837/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/10837

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/14239/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/14239</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 8/5/2019, 12:29:03 PM<br><strong>Message</strong>: <pre>Uploaded patch set 4.</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 8/5/2019, 12:31:34 PM<br><strong>Message</strong>: <pre>Uploaded patch set 5.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 12:31:35 PM<br><strong>Message</strong>: <pre>Patch Set 4:

No Builds Executed</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 8/5/2019, 12:32:13 PM<br><strong>Message</strong>: <pre>Patch Set 5:

(2 comments)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 12:34:40 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/16080/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 12:35:11 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 12:39:11 PM<br><strong>Message</strong>: <pre>Patch Set 5: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 12:39:53 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/16080/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/16080</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 12:41:55 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/10841/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 12:42:19 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/14243/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 12:42:23 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 12:42:50 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 1:09:28 PM<br><strong>Message</strong>: <pre>Patch Set 5: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 1:21:22 PM<br><strong>Message</strong>: <pre>Patch Set 5: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 1:22:06 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/10841/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/10841

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/14243/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/14243</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 8/5/2019, 1:44:15 PM<br><strong>Message</strong>: <pre>Patch Set 5: Code-Review+1

(2 comments)</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 8/5/2019, 11:37:53 PM<br><strong>Message</strong>: <pre>Uploaded patch set 6.</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 8/5/2019, 11:40:18 PM<br><strong>Message</strong>: <pre>Uploaded patch set 7.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 11:40:19 PM<br><strong>Message</strong>: <pre>Patch Set 6:

No Builds Executed</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 8/5/2019, 11:42:46 PM<br><strong>Message</strong>: <pre>Patch Set 7:

(2 comments)

Yes, Manish. That makes it cleaner.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 11:43:22 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/16105/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 11:43:51 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 11:47:51 PM<br><strong>Message</strong>: <pre>Patch Set 7: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 11:48:31 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/16105/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/16105</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 11:49:52 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/10861/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 11:50:20 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/14261/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 11:50:21 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2019, 11:50:45 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/6/2019, 12:07:39 AM<br><strong>Message</strong>: <pre>Patch Set 7: F3-UnitTest-1

Failed</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 8/6/2019, 12:22:57 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/6/2019, 12:29:13 AM<br><strong>Message</strong>: <pre>Patch Set 7: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/6/2019, 12:30:01 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/14261/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/14261

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/10861/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/10861</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 8/6/2019, 1:34:23 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Run UnitTest</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 8/6/2019, 1:34:27 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/6/2019, 1:37:53 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/14265/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/6/2019, 1:38:23 AM<br><strong>Message</strong>: <pre>Patch Set 7: -F3-UnitTest

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/6/2019, 1:57:00 AM<br><strong>Message</strong>: <pre>Patch Set 7: F3-UnitTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/6/2019, 1:57:53 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/14265/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/14265</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 8/6/2019, 4:30:33 AM<br><strong>Message</strong>: <pre>Patch Set 7:

VerifyBuild</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/6/2019, 4:35:09 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/16110/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/6/2019, 4:35:40 AM<br><strong>Message</strong>: <pre>Patch Set 7: -F2-DocBuild -F1-VerifyBuild -F3-IntegrationTest -F3-UnitTest

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/6/2019, 4:40:29 AM<br><strong>Message</strong>: <pre>Patch Set 7: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/6/2019, 4:41:45 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/10867/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/6/2019, 4:41:47 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/14266/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/6/2019, 4:44:39 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/6/2019, 4:44:45 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/6/2019, 5:09:15 AM<br><strong>Message</strong>: <pre>Patch Set 7: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/6/2019, 5:25:05 AM<br><strong>Message</strong>: <pre>Patch Set 7: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/6/2019, 5:25:47 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/16110/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/16110

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/10867/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/10867

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/14266/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/14266</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 8/6/2019, 9:54:25 AM<br><strong>Message</strong>: <pre>Patch Set 7:

(1 comment)</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 8/6/2019, 10:52:21 AM<br><strong>Message</strong>: <pre>Uploaded patch set 8.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/6/2019, 10:52:32 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/16134/</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 8/6/2019, 10:52:42 AM<br><strong>Message</strong>: <pre>Patch Set 8:

(1 comment)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/6/2019, 10:53:01 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/6/2019, 10:58:31 AM<br><strong>Message</strong>: <pre>Patch Set 8: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/6/2019, 10:59:19 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/16134/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/16134</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/6/2019, 11:00:27 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/10883/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/6/2019, 11:00:58 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/6/2019, 11:02:07 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/14282/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/6/2019, 11:02:46 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/6/2019, 11:31:55 AM<br><strong>Message</strong>: <pre>Patch Set 8: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/6/2019, 11:44:43 AM<br><strong>Message</strong>: <pre>Patch Set 8: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/6/2019, 11:45:35 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/10883/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/10883

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/14282/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/14282</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 8/6/2019, 5:15:20 PM<br><strong>Message</strong>: <pre>Patch Set 8: Code-Review+2</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 8/7/2019, 10:06:11 AM<br><strong>Message</strong>: <pre>Patch Set 8: Code-Review+2

(1 comment)

We are good for now. But it would be better to have a separate function where we check all the invariants (e.g., the check for config history store) at the start</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 8/7/2019, 10:06:57 AM<br><strong>Message</strong>: <pre>Change has been successfully merged by Manish Sethi</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/7/2019, 10:11:53 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-x86_64/7346/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/7/2019, 10:12:23 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/6039/ (2/2)</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 8/7/2019, 10:34:04 AM<br><strong>Message</strong>: <pre>Patch Set 8:

> Patch Set 8: Code-Review+2
> 
> (1 comment)
> 
> We are good for now. But it would be better to have a separate function where we check all the invariants (e.g., the check for config history store) at the start

Manish, wouldn't that become a kind of unit-test in the production code? We only need to check for the stateDB. Due to the current implementation of recovery logic using recoverers, we include the test for HistoryDB too. IMO, it may be better to refactor the existing recovery logic and do this check only for the state DB (when CouchDB is used).</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 8/7/2019, 10:41:16 AM<br><strong>Message</strong>: <pre>Patch Set 8:

> > Patch Set 8: Code-Review+2
 > >
 > > (1 comment)
 > >
 > > We are good for now. But it would be better to have a separate
 > function where we check all the invariants (e.g., the check for
 > config history store) at the start
 > 
 > Manish, wouldn't that become a kind of unit-test in the production
 > code? We only need to check for the stateDB. Due to the current
 > implementation of recovery logic using recoverers, we include the
 > test for HistoryDB too. IMO, it may be better to refactor the
 > existing recovery logic and do this check only for the state DB
 > (when CouchDB is used).

lol for unit-test in production :-)
On the not so lighter note, I won't call it a unit-test but rather a preliminary sanity check just to avoid an innocent mistake by an admin if any...</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 8/7/2019, 10:53:33 AM<br><strong>Message</strong>: <pre>Patch Set 8:

> Patch Set 8:
> 
> > > Patch Set 8: Code-Review+2
>  > >
>  > > (1 comment)
>  > >
>  > > We are good for now. But it would be better to have a separate
>  > function where we check all the invariants (e.g., the check for
>  > config history store) at the start
>  > 
>  > Manish, wouldn't that become a kind of unit-test in the production
>  > code? We only need to check for the stateDB. Due to the current
>  > implementation of recovery logic using recoverers, we include the
>  > test for HistoryDB too. IMO, it may be better to refactor the
>  > existing recovery logic and do this check only for the state DB
>  > (when CouchDB is used).
> 
> lol for unit-test in production :-)
> On the not so lighter note, I won't call it a unit-test but rather a preliminary sanity check just to avoid an innocent mistake by an admin if any...

By default, peer reset and peer rollback command delete those stores. The admin can make a mistake by only not dropping the state CouchDB. Hence, we need to ensure that the admin drops that. What I meant was that such check is not needed for the other DB as our command must do it. If we still add a check for other stores, it is a unit-test in the production code (:D). Isn't it?</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/7/2019, 10:55:47 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-merge-x86_64/7346/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-x86_64/7346

https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/6039/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-end-2-end-x86_64/6039</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 8/7/2019, 11:21:58 AM<br><strong>Message</strong>: <pre>Patch Set 8:

> > Patch Set 8:
 > >
 > > > > Patch Set 8: Code-Review+2
 > >  > >
 > >  > > (1 comment)
 > >  > >
 > >  > > We are good for now. But it would be better to have a
 > separate
 > >  > function where we check all the invariants (e.g., the check
 > for
 > >  > config history store) at the start
 > >  >
 > >  > Manish, wouldn't that become a kind of unit-test in the
 > production
 > >  > code? We only need to check for the stateDB. Due to the
 > current
 > >  > implementation of recovery logic using recoverers, we include
 > the
 > >  > test for HistoryDB too. IMO, it may be better to refactor the
 > >  > existing recovery logic and do this check only for the state
 > DB
 > >  > (when CouchDB is used).
 > >
 > > lol for unit-test in production :-)
 > > On the not so lighter note, I won't call it a unit-test but
 > rather a preliminary sanity check just to avoid an innocent mistake
 > by an admin if any...
 > 
 > By default, peer reset and peer rollback command delete those
 > stores. The admin can make a mistake by only not dropping the state
 > CouchDB. Hence, we need to ensure that the admin drops that. What I
 > meant was that such check is not needed for the other DB as our
 > command must do it. If we still add a check for other stores, it is
 > a unit-test in the production code (:D). Isn't it?

I think that you are just over reading the comment. As I said this is just a sanity check that things are normal before proceeding. The side benefit it gives is that if we miss something in future when we add new code, this will help detect that. The other benefit is that this would be one place where we would have coded all the invariant. Recall that how much mental stress we had to give in the base Rollback CR to make sure that the invariants are maintained. If there was a simple sanity check any test that opens the store would have failed.

BTW, this is not something unusual. In java, there is built-in assertion feature (https://docs.oracle.com/javase/7/docs/technotes/guides/language/assert.html) whose sole purpose is to increase confidence that your program. A statement from their doc - "Experience has shown that writing assertions while programming is one of the quickest and most effective ways to detect and correct bugs. As an added benefit, assertions serve to document the inner workings of your program, enhancing maintainability." We are definitely not going that far here but just very basic assertions that our code assumes all over and we trust blindly still we just manually verify these assertions by looking at the code.</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 8/7/2019, 12:53:16 PM<br><strong>Message</strong>: <pre>Patch Set 8:

> Patch Set 8:
> 
> > > Patch Set 8:
>  > >
>  > > > > Patch Set 8: Code-Review+2
>  > >  > >
>  > >  > > (1 comment)
>  > >  > >
>  > >  > > We are good for now. But it would be better to have a
>  > separate
>  > >  > function where we check all the invariants (e.g., the check
>  > for
>  > >  > config history store) at the start
>  > >  >
>  > >  > Manish, wouldn't that become a kind of unit-test in the
>  > production
>  > >  > code? We only need to check for the stateDB. Due to the
>  > current
>  > >  > implementation of recovery logic using recoverers, we include
>  > the
>  > >  > test for HistoryDB too. IMO, it may be better to refactor the
>  > >  > existing recovery logic and do this check only for the state
>  > DB
>  > >  > (when CouchDB is used).
>  > >
>  > > lol for unit-test in production :-)
>  > > On the not so lighter note, I won't call it a unit-test but
>  > rather a preliminary sanity check just to avoid an innocent mistake
>  > by an admin if any...
>  > 
>  > By default, peer reset and peer rollback command delete those
>  > stores. The admin can make a mistake by only not dropping the state
>  > CouchDB. Hence, we need to ensure that the admin drops that. What I
>  > meant was that such check is not needed for the other DB as our
>  > command must do it. If we still add a check for other stores, it is
>  > a unit-test in the production code (:D). Isn't it?
> 
> I think that you are just over reading the comment. As I said this is just a sanity check that things are normal before proceeding. The side benefit it gives is that if we miss something in future when we add new code, this will help detect that. The other benefit is that this would be one place where we would have coded all the invariant. Recall that how much mental stress we had to give in the base Rollback CR to make sure that the invariants are maintained. If there was a simple sanity check any test that opens the store would have failed.
> 
> BTW, this is not something unusual. In java, there is built-in assertion feature (https://docs.oracle.com/javase/7/docs/technotes/guides/language/assert.html) whose sole purpose is to increase confidence that your program. A statement from their doc - "Experience has shown that writing assertions while programming is one of the quickest and most effective ways to detect and correct bugs. As an added benefit, assertions serve to document the inner workings of your program, enhancing maintainability." We are definitely not going that far here but just very basic assertions that our code assumes all over and we trust blindly still we just manually verify these assertions by looking at the code.

I see. Yeah, I have seen a lot of assert statements in the PostgreSQL code too. With a special flag during compilation, we can enable the assertion and it would be executed during query processing. The main confusion that I got here was that we already have a unit-test in place to ensure that peer reset and peer rollback drops the default databases (except CouchDB). Anyway, no harm in adding a certain assertion during peer startup. It might be a longer discussion and also I need to do homework to understand why PostgreSQL has assertion statements while it has unit tests too.</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Uploader</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Created</strong>: 8/5/2019, 6:52:03 AM<br><strong>UnmergedRevision</strong>: [cd166c6f56cac1c8092d52c34e219dbf49a5f013](https://github.com/hyperledger-gerrit-archive/fabric/commit/cd166c6f56cac1c8092d52c34e219dbf49a5f013)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/5/2019, 6:59:37 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/5/2019, 6:59:37 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/5/2019, 7:51:04 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/5/2019, 7:21:07 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: NO_CODE_CHANGE<br><strong>Author</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Uploader</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Created</strong>: 8/5/2019, 6:52:33 AM<br><strong>UnmergedRevision</strong>: [e7e1aad5ec77017a7afc5e27e85117a605d54fc7](https://github.com/hyperledger-gerrit-archive/fabric/commit/e7e1aad5ec77017a7afc5e27e85117a605d54fc7)<br><br></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Uploader</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Created</strong>: 8/5/2019, 8:14:25 AM<br><strong>UnmergedRevision</strong>: [4e409a088747674c84f357fbc0f28a9a63bf9247](https://github.com/hyperledger-gerrit-archive/fabric/commit/4e409a088747674c84f357fbc0f28a9a63bf9247)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/5/2019, 10:30:58 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/5/2019, 10:30:58 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/5/2019, 11:26:35 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/5/2019, 11:01:20 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Approved</strong>: 8/5/2019, 10:49:12 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/kv_ledger.go#L174](https://github.com/hyperledger-gerrit-archive/fabric/blob/4e409a088747674c84f357fbc0f28a9a63bf9247/core/ledger/kvledger/kv_ledger.go#L174)<br><strong>Comment</strong>: <pre>Is this necessary? If any of historydb/statedb is ahead in general has broken the invariant.

I agree that practically, it will always be 0th index where it would fail unless someone reorders things at line 159 but better to keep it simple than to treat a special case which otherwise gives an impression that having historydb ahead is fine.</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/kv_ledger.go#L174](https://github.com/hyperledger-gerrit-archive/fabric/blob/4e409a088747674c84f357fbc0f28a9a63bf9247/core/ledger/kvledger/kv_ledger.go#L174)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/kv_ledger.go#L176](https://github.com/hyperledger-gerrit-archive/fabric/blob/4e409a088747674c84f357fbc0f28a9a63bf9247/core/ledger/kvledger/kv_ledger.go#L176)<br><strong>Comment</strong>: <pre>typo</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/kv_ledger.go#L176](https://github.com/hyperledger-gerrit-archive/fabric/blob/4e409a088747674c84f357fbc0f28a9a63bf9247/core/ledger/kvledger/kv_ledger.go#L176)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Uploader</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Created</strong>: 8/5/2019, 12:29:03 PM<br><strong>UnmergedRevision</strong>: [ed296ac86354f4d48f38cccf35c3c4a0393fb4b2](https://github.com/hyperledger-gerrit-archive/fabric/commit/ed296ac86354f4d48f38cccf35c3c4a0393fb4b2)<br><br></blockquote><h3>PatchSet Number: 5</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Uploader</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Created</strong>: 8/5/2019, 12:31:34 PM<br><strong>UnmergedRevision</strong>: [42149700daccaad42185493f53cd57e03492e015](https://github.com/hyperledger-gerrit-archive/fabric/commit/42149700daccaad42185493f53cd57e03492e015)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/5/2019, 12:39:11 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/5/2019, 12:39:11 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/5/2019, 1:21:22 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/5/2019, 1:09:28 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Approved</strong>: 8/5/2019, 1:44:15 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/kv_ledger.go#L175](https://github.com/hyperledger-gerrit-archive/fabric/blob/42149700daccaad42185493f53cd57e03492e015/core/ledger/kvledger/kv_ledger.go#L175)<br><strong>Comment</strong>: <pre>Can you change this not to hard-code state database.
Perhaps, the interface "recoverable" can have a function GetName()</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/kv_ledger.go#L175](https://github.com/hyperledger-gerrit-archive/fabric/blob/42149700daccaad42185493f53cd57e03492e015/core/ledger/kvledger/kv_ledger.go#L175)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/kv_ledger.go#L176](https://github.com/hyperledger-gerrit-archive/fabric/blob/42149700daccaad42185493f53cd57e03492e015/core/ledger/kvledger/kv_ledger.go#L176)<br><strong>Comment</strong>: <pre>same as above</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/kv_ledger.go#L176](https://github.com/hyperledger-gerrit-archive/fabric/blob/42149700daccaad42185493f53cd57e03492e015/core/ledger/kvledger/kv_ledger.go#L176)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 6</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Uploader</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Created</strong>: 8/5/2019, 11:37:53 PM<br><strong>UnmergedRevision</strong>: [41f17c9d4b0878fd80e89adbf5f530053f4a091c](https://github.com/hyperledger-gerrit-archive/fabric/commit/41f17c9d4b0878fd80e89adbf5f530053f4a091c)<br><br></blockquote><h3>PatchSet Number: 7</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Uploader</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Created</strong>: 8/5/2019, 11:40:18 PM<br><strong>UnmergedRevision</strong>: [9a7641c3ed0cd1911dbb880627bb545acfb6f495](https://github.com/hyperledger-gerrit-archive/fabric/commit/9a7641c3ed0cd1911dbb880627bb545acfb6f495)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/6/2019, 4:40:29 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/6/2019, 4:40:29 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/6/2019, 5:25:05 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/6/2019, 5:09:15 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/kv_ledger.go#L177](https://github.com/hyperledger-gerrit-archive/fabric/blob/9a7641c3ed0cd1911dbb880627bb545acfb6f495/core/ledger/kvledger/kv_ledger.go#L177)<br><strong>Comment</strong>: <pre>Additionally state "The state database can safely be dropped and will be rebuilt up to block store height upon the next peer start."</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/kv_ledger.go#L177](https://github.com/hyperledger-gerrit-archive/fabric/blob/9a7641c3ed0cd1911dbb880627bb545acfb6f495/core/ledger/kvledger/kv_ledger.go#L177)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 8</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Uploader</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Created</strong>: 8/6/2019, 10:52:21 AM<br><strong>GitHubMergedRevision</strong>: [042b6c4ea18102c88fc036942673de847fa35a6e](https://github.com/hyperledger-gerrit-archive/fabric/commit/042b6c4ea18102c88fc036942673de847fa35a6e)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/6/2019, 10:58:31 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/6/2019, 10:58:31 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/6/2019, 11:44:43 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/6/2019, 11:31:55 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Approved</strong>: 8/7/2019, 10:06:11 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Manish Sethi<br><strong>Merged</strong>: 8/7/2019, 10:06:57 AM<br><br><strong>Approver</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Approved</strong>: 8/6/2019, 5:15:20 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/kvledger/tests/reset_test.go#L187](https://github.com/hyperledger-gerrit-archive/fabric/blob/042b6c4ea18102c88fc036942673de847fa35a6e/core/ledger/kvledger/tests/reset_test.go#L187)<br><strong>Comment</strong>: <pre>Just for the sake of completeness, you could drop the statedb and then check the message for historydb as well.</pre></blockquote>