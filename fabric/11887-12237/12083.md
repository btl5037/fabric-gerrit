<strong>Project</strong>: fabric<br><strong>Branch</strong>: master<br><strong>ID</strong>: 12083<br><strong>Subject</strong>: [FAB-5561] Convert policies framework to identity<br><strong>Status</strong>: ABANDONED<br><strong>Owner</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 8/1/2017, 2:20:59 AM<br><strong>LastUpdated</strong>: 8/1/2019, 11:25:43 AM<br><strong>CommitMessage</strong>:<br><pre>[FAB-5561] Convert policies framework to identity

This CR finishes FAB-4605 and converts the interface definition for the
policy manager to accept identities instead of signatures.

The changes are widespread because of the nature of the interface
change, but the actual code changes are fairly rote and obvious.

Change-Id: I20d6773fe5ee695c81f75ffe85e3c64db083e5d6
Signed-off-by: Jason Yellick <jyellick@us.ibm.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 8/1/2017, 2:20:59 AM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/1/2017, 2:21:11 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/10441/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/1/2017, 2:24:32 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/14805/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/1/2017, 2:24:32 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/6339/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/1/2017, 2:24:32 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/8837/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/1/2017, 2:57:05 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/10442/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/1/2017, 3:01:12 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/14806/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/1/2017, 3:19:34 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/6342/ (4/4)</pre><strong>Reviewer</strong>: Ry Jones - ry@linux.com<br><strong>Reviewed</strong>: 8/1/2017, 3:31:21 AM<br><strong>Message</strong>: <pre>Patch Set 1: Code-Review-1

unit-tests_1  | # github.com/hyperledger/fabric/core/scc/cscc
unit-tests_1  | core/scc/cscc/configure_test.go:188: unknown "github.com/hyperledger/fabric/core/policy/mocks".MockPolicy field 'Deserializer' in struct literal
unit-tests_1  | core/scc/cscc/configure_test.go:255: cannot assign to policyManagerGetter.Managers["mytestchainid"].(*"github.com/hyperledger/fabric/core/policy/mocks".MockChannelPolicyManager).MockPolicy.(*"github.com/hyperledger/fabric/core/policy/mocks".MockPolicy).Deserializer.(*"github.com/hyperledger/fabric/core/policy/mocks".MockIdentityDeserializer).Msg
unit-tests_1  | FAIL	github.com/hyperledger/fabric/core/scc/cscc [build failed]
unit-tests_1  | error: exit status 2
unit-tests_1  | panic: EOF
unit-tests_1  | 
unit-tests_1  | goroutine 1 [running]:
unit-tests_1  | panic(0x4daca0, 0xc42000a0f0)
unit-tests_1  | 	/opt/go/src/runtime/panic.go:500 +0x1a1
unit-tests_1  | main.main()
unit-tests_1  | 	/opt/gotools/obj/gopath/src/github.com/AlekSi/gocov-xml/gocov-xml.go:60 +0x15fd
unittest_unit-tests_1 exited with code 2
Stopping couchdb ...</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 8/1/2017, 3:59:32 AM<br><strong>Message</strong>: <pre>Patch Set 1: Code-Review-1

(1 comment)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/1/2017, 4:11:48 AM<br><strong>Message</strong>: <pre>Patch Set 1: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-z/10442/ : FAILURE

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/10442

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/6342/ : FAILURE

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/6342

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/14806/ : FAILURE

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/14806

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/8837/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/8837</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 8/1/2017, 10:45:36 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(1 comment)</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 8/1/2017, 4:32:00 PM<br><strong>Message</strong>: <pre>Uploaded patch set 2.</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 8/1/2017, 4:33:49 PM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 8/1/2017, 4:34:36 PM<br><strong>Message</strong>: <pre>Patch Set 3:

(1 comment)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/1/2017, 5:14:19 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/10448/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/1/2017, 5:14:52 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/8841/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/1/2017, 5:15:23 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/6352/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/1/2017, 5:15:52 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/14811/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/1/2017, 5:22:15 PM<br><strong>Message</strong>: <pre>Patch Set 3: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/8841/ : FAILURE

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/8841

https://jenkins.hyperledger.org/job/fabric-verify-z/10448/ : FAILURE

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/10448

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/6352/ : FAILURE

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/6352

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/14811/ : FAILURE

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/14811</pre><strong>Reviewer</strong>: Ry Jones - ry@linux.com<br><strong>Reviewed</strong>: 8/1/2017, 5:27:16 PM<br><strong>Message</strong>: <pre>Patch Set 3: Code-Review-1

Current error:

# github.com/hyperledger/fabric/core/scc/vscc
core/scc/vscc/validator_onevalidsignature.go:111: tmp declared and not used
Makefile:196: recipe for target 'build/docker/bin/peer' failed
make: *** [build/docker/bin/peer] Error 2</pre><strong>Reviewer</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>Reviewed</strong>: 8/1/2017, 9:44:48 PM<br><strong>Message</strong>: <pre>Patch Set 3:

(6 comments)

As a general reminder, we have to improve test coverage of common/policies. It is below 85% :(</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 8/1/2017, 10:56:31 PM<br><strong>Message</strong>: <pre>Patch Set 3:

(4 comments)

Although I agree we could improve the test coverage percentage, I would rather have poorly covered conceptually clean and well understood code, than 100% covered hacks.

I think this de-duplication bug is a great example of the dangerous complacency relying on code coverage metrics can generate.  The de-duplication was added in a conceptually awkward place, covered with a test, and treated as fixed (despite remaining elsewhere).  I understand that it was a bug fix hurried in before release, but code quality and test coverage are correlated, not equivalent.</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 8/1/2017, 11:20:47 PM<br><strong>Message</strong>: <pre>Uploaded patch set 4.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/1/2017, 11:20:54 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/10455/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/1/2017, 11:21:50 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/8847/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/1/2017, 11:22:20 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/6360/ (3/4)</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 8/1/2017, 11:22:25 PM<br><strong>Message</strong>: <pre>Patch Set 4:

> Current error:
 > 
 > # github.com/hyperledger/fabric/core/scc/vscc
 > core/scc/vscc/validator_onevalidsignature.go:111: tmp declared and
 > not used
 > Makefile:196: recipe for target 'build/docker/bin/peer' failed
 > make: *** [build/docker/bin/peer] Error 2

Hey Ry, maybe I should have tagged these commits as WIP.  I don't expect them to be merged, and I'm not particularly concerned about CI, mostly just pushed for the ability to review.  Feel free to ignore these.</pre><strong>Reviewer</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>Reviewed</strong>: 8/1/2017, 11:22:45 PM<br><strong>Message</strong>: <pre>Patch Set 4:

(4 comments)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/1/2017, 11:22:51 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/14817/ (4/4)</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 8/1/2017, 11:23:23 PM<br><strong>Message</strong>: <pre>Patch Set 3:

(1 comment)</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 8/1/2017, 11:43:08 PM<br><strong>Message</strong>: <pre>Patch Set 3:

(2 comments)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/2/2017, 12:14:23 AM<br><strong>Message</strong>: <pre>Patch Set 4: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/6360/ : FAILURE

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/6360

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/8847/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/8847

https://jenkins.hyperledger.org/job/fabric-verify-z/10455/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/10455

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/14817/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/14817</pre><strong>Reviewer</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>Reviewed</strong>: 8/2/2017, 1:18:42 AM<br><strong>Message</strong>: <pre>Patch Set 4:

(2 comments)</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 8/2/2017, 3:00:11 AM<br><strong>Message</strong>: <pre>Patch Set 3:

(1 comment)</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 8/2/2017, 8:20:25 AM<br><strong>Message</strong>: <pre>Patch Set 3:

(1 comment)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 8/2/2017, 9:51:41 AM<br><strong>Message</strong>: <pre>Patch Set 4:

(3 comments)

Thx, Jason, a few comments from my side</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 8/2/2017, 2:07:38 PM<br><strong>Message</strong>: <pre>Uploaded patch set 5.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/2/2017, 2:07:47 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/10470/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/2/2017, 2:08:50 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/8862/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/2/2017, 2:09:20 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/6375/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/2/2017, 2:09:40 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/14832/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/2/2017, 2:56:27 PM<br><strong>Message</strong>: <pre>Patch Set 5: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/8862/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/8862

https://jenkins.hyperledger.org/job/fabric-verify-z/10470/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/10470

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/6375/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/6375

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/14832/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/14832</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 8/4/2017, 12:59:13 PM<br><strong>Message</strong>: <pre>Uploaded patch set 6.</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 8/4/2017, 12:59:18 PM<br><strong>Message</strong>: <pre>Patch Set 6:

(3 comments)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/4/2017, 12:59:23 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/10552/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/4/2017, 1:04:11 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/8942/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/4/2017, 1:04:11 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/6455/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/4/2017, 1:05:03 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/14914/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/4/2017, 1:54:07 PM<br><strong>Message</strong>: <pre>Patch Set 6: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-z/10552/ : FAILURE

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/10552

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/8942/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/8942

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/6455/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/6455

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/14914/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/14914</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 8/4/2017, 1:55:19 PM<br><strong>Message</strong>: <pre>Patch Set 6:

reverify</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/4/2017, 1:55:27 PM<br><strong>Message</strong>: <pre>Patch Set 6: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/10557/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/4/2017, 1:58:01 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/8947/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/4/2017, 1:58:01 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/6460/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/4/2017, 1:58:31 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/14919/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/4/2017, 2:46:55 PM<br><strong>Message</strong>: <pre>Patch Set 6: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/8947/ : FAILURE

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/8947

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/6460/ : FAILURE

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/6460

https://jenkins.hyperledger.org/job/fabric-verify-z/10557/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/10557

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/14919/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/14919</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 8/4/2017, 5:26:19 PM<br><strong>Message</strong>: <pre>Patch Set 6:

reverify</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/4/2017, 5:26:29 PM<br><strong>Message</strong>: <pre>Patch Set 6: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/10570/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/4/2017, 5:29:13 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/8958/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/4/2017, 5:31:12 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/6471/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/4/2017, 5:31:12 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/14930/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/4/2017, 6:18:39 PM<br><strong>Message</strong>: <pre>Patch Set 6: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/8958/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/8958

https://jenkins.hyperledger.org/job/fabric-verify-z/10570/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/10570

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/6471/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/6471

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/14930/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/14930</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 8/5/2017, 10:47:51 AM<br><strong>Message</strong>: <pre>Uploaded patch set 7.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2017, 10:47:58 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/10604/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2017, 10:52:16 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/8992/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2017, 10:53:03 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/6505/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2017, 10:53:28 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/14964/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2017, 12:05:43 PM<br><strong>Message</strong>: <pre>Patch Set 7: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/14964/ : FAILURE

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/14964

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/8992/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/8992

https://jenkins.hyperledger.org/job/fabric-verify-z/10604/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/10604

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/6505/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/6505</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 8/5/2017, 12:42:12 PM<br><strong>Message</strong>: <pre>Patch Set 7:

reverify</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2017, 12:42:41 PM<br><strong>Message</strong>: <pre>Patch Set 7: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/10615/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2017, 12:46:32 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/9003/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2017, 12:47:34 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/6516/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2017, 12:48:20 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/14975/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2017, 1:40:27 PM<br><strong>Message</strong>: <pre>Patch Set 7: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/6516/ : FAILURE

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/6516

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/9003/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/9003

https://jenkins.hyperledger.org/job/fabric-verify-z/10615/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/10615

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/14975/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/14975</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 8/5/2017, 1:58:17 PM<br><strong>Message</strong>: <pre>Patch Set 7:

reverify</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2017, 1:58:25 PM<br><strong>Message</strong>: <pre>Patch Set 7: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-z/10624/ (1/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2017, 2:01:26 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/9012/ (2/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2017, 2:01:47 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/6525/ (3/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2017, 2:01:58 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/14984/ (4/4)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/5/2017, 3:39:02 PM<br><strong>Message</strong>: <pre>Patch Set 7: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/9012/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-behave-x86_64/9012

https://jenkins.hyperledger.org/job/fabric-verify-z/10624/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-z/10624

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/6525/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-end-2-end-x86_64/6525

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/14984/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-verify-x86_64/14984</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 8/9/2017, 1:12:16 PM<br><strong>Message</strong>: <pre>Patch Set 7: Code-Review-1

Please hold</pre><strong>Reviewer</strong>: Ry Jones - ry@linux.com<br><strong>Reviewed</strong>: 8/10/2017, 1:50:46 PM<br><strong>Message</strong>: <pre>Removed reviewer Ry Jones.</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 8/18/2017, 10:21:58 AM<br><strong>Message</strong>: <pre>Abandoned

This is incompatible with the future API of the MSP.</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 8/1/2019, 11:25:43 AM<br><strong>Message</strong>: <pre>Patch Set 7:

bump - this way it'll show in my review queue :)</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Uploader</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Created</strong>: 8/1/2017, 2:20:59 AM<br><strong>UnmergedRevision</strong>: [ccfef5b80e743c737913dd435d9db36bc47ba6d6](https://github.com/hyperledger-gerrit-archive/fabric/commit/ccfef5b80e743c737913dd435d9db36bc47ba6d6)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/1/2017, 4:11:48 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Approved</strong>: 8/1/2017, 3:59:32 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [core/scc/vscc/validator_onevalidsignature.go#L216](https://github.com/hyperledger-gerrit-archive/fabric/blob/ccfef5b80e743c737913dd435d9db36bc47ba6d6/core/scc/vscc/validator_onevalidsignature.go#L216)<br><strong>Comment</strong>: <pre>So, if the SignatureSetToValidIdentities fails - it returns: nil, error and then you pass nil into Policy.Evaluate, which would (in the best scenario) override the error in line 213. 
I don't think that's a very good program flow.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/scc/vscc/validator_onevalidsignature.go#L216](https://github.com/hyperledger-gerrit-archive/fabric/blob/ccfef5b80e743c737913dd435d9db36bc47ba6d6/core/scc/vscc/validator_onevalidsignature.go#L216)<br><strong>Comment</strong>: <pre>Ah, this is a mistake.... it should be:

 if err == nil

IE, if the signature set is valid or the policy is invalid, return an error.  I'm a little surprised that this passed the unit test.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/scc/vscc/validator_onevalidsignature.go#L216](https://github.com/hyperledger-gerrit-archive/fabric/blob/ccfef5b80e743c737913dd435d9db36bc47ba6d6/core/scc/vscc/validator_onevalidsignature.go#L216)<br><strong>Comment</strong>: <pre>Fixed to be less clever and more sane.</pre></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Uploader</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Created</strong>: 8/1/2017, 4:32:00 PM<br><strong>UnmergedRevision</strong>: [3700576fedf11fb4da1601d4ba173f113a0621ce](https://github.com/hyperledger-gerrit-archive/fabric/commit/3700576fedf11fb4da1601d4ba173f113a0621ce)<br><br></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Uploader</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Created</strong>: 8/1/2017, 4:33:49 PM<br><strong>UnmergedRevision</strong>: [6b049412b595d9f28a5e11cc2b67ad14bdf508de](https://github.com/hyperledger-gerrit-archive/fabric/commit/6b049412b595d9f28a5e11cc2b67ad14bdf508de)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/1/2017, 5:22:15 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>CommentLine</strong>: [common/policies/policy.go#L58](https://github.com/hyperledger-gerrit-archive/fabric/blob/6b049412b595d9f28a5e11cc2b67ad14bdf508de/common/policies/policy.go#L58)<br><strong>Comment</strong>: <pre>MSP Identities</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [common/policies/policy.go#L58](https://github.com/hyperledger-gerrit-archive/fabric/blob/6b049412b595d9f28a5e11cc2b67ad14bdf508de/common/policies/policy.go#L58)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>CommentLine</strong>: [common/policies/policy.go#L59](https://github.com/hyperledger-gerrit-archive/fabric/blob/6b049412b595d9f28a5e11cc2b67ad14bdf508de/common/policies/policy.go#L59)<br><strong>Comment</strong>: <pre>Do we have a case where we pass identities that are not the output of SignatureSetToValidIdentities?</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [common/policies/policy.go#L59](https://github.com/hyperledger-gerrit-archive/fabric/blob/6b049412b595d9f28a5e11cc2b67ad14bdf508de/common/policies/policy.go#L59)<br><strong>Comment</strong>: <pre>I am told by Yacov that this is something that Gossip wants.

Additionally, for the ImplicitMetaPolicy type, it prevents the same identity from being deserialized N times where N is the number of orgs in the network.</pre><strong>Commenter</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>CommentLine</strong>: [common/policies/policy.go#L59](https://github.com/hyperledger-gerrit-archive/fabric/blob/6b049412b595d9f28a5e11cc2b67ad14bdf508de/common/policies/policy.go#L59)<br><strong>Comment</strong>: <pre>I see. I want just to say that this has be used with care if the identities are not backed by signatures. Alright!</pre><strong>Commenter</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>CommentLine</strong>: [common/policies/policy.go#L59](https://github.com/hyperledger-gerrit-archive/fabric/blob/6b049412b595d9f28a5e11cc2b67ad14bdf508de/common/policies/policy.go#L59)<br><strong>Comment</strong>: <pre>Jason is right. When gossip evaluates an identity to check a policy, the signature verification is redundant.
The signatures in question are messages that peers sign about themselves, and they are checked as they are received and are discarded if the signature doesn't match.

After that - the messages enter an in-memory cache where it is used to determine to what peers to send a block to, but evaluating policies with the signatures on the messages, along with the peer certificates.

It would be beneficial to be able to only verify the policy without having the verify again the signatures.</pre><strong>Commenter</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>CommentLine</strong>: [common/policies/policy.go#L77](https://github.com/hyperledger-gerrit-archive/fabric/blob/6b049412b595d9f28a5e11cc2b67ad14bdf508de/common/policies/policy.go#L77)<br><strong>Comment</strong>: <pre>Don't understand why this method is here given that it does not use any method of field of the Manager. Also the names sounds like the returned identities are also validated by the implementation does not do that. Only signatures are checked. May you have a better name here, please?</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [common/policies/policy.go#L77](https://github.com/hyperledger-gerrit-archive/fabric/blob/6b049412b595d9f28a5e11cc2b67ad14bdf508de/common/policies/policy.go#L77)<br><strong>Comment</strong>: <pre>Do you have a suggestion? The identities are validated, insofar as they are deserializable by some MSP in the system.  If a signature is from an identity not in the channel, this will fail, hence the "Valid".

The simple reason why this is here is to make this change slightly less invasive.  It does use one field: the MSP Manager.

I originally did this CR series pushing this purely as a utility method in the msp package.  However, the PolicyManager is generally passed by reference to different components of the system, while the msp Manager usually requires a lookup through the singleton map.  Not tying this to the PolicyManager would have created even more dependencies on this singleton map.

Since this MSP singleton map has been the bane of my existence on more than one occasion, adding new dependencies on it is strictly out of the question.</pre><strong>Commenter</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>CommentLine</strong>: [common/policies/policy.go#L77](https://github.com/hyperledger-gerrit-archive/fabric/blob/6b049412b595d9f28a5e11cc2b67ad14bdf508de/common/policies/policy.go#L77)<br><strong>Comment</strong>: <pre>I see. Anyway, deserialisation does not validate the identity.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [common/policies/policy.go#L77](https://github.com/hyperledger-gerrit-archive/fabric/blob/6b049412b595d9f28a5e11cc2b67ad14bdf508de/common/policies/policy.go#L77)<br><strong>Comment</strong>: <pre>What would you say the appropriate adjective/verb is?  I struggle to ocme up with a scenario where Deserialization+SignatureValidation does not leave us with a 'Valid' identity, but I am sure I am being dense.</pre><strong>Commenter</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>CommentLine</strong>: [common/policies/policy.go#L77](https://github.com/hyperledger-gerrit-archive/fabric/blob/6b049412b595d9f28a5e11cc2b67ad14bdf508de/common/policies/policy.go#L77)<br><strong>Comment</strong>: <pre>Just SignatureSetToIdentities? You then clarify in the comment that the identities are not validated. No?</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [common/policies/policy.go#L77](https://github.com/hyperledger-gerrit-archive/fabric/blob/6b049412b595d9f28a5e11cc2b67ad14bdf508de/common/policies/policy.go#L77)<br><strong>Comment</strong>: <pre>So what does it mean for an identity to be Validated to you?

I think something in this name needs to convey that the identities are returned only if they are all well formed AND there is a valid signature for each identity in the signature set.

Do you have a good word for expressing that the signatures were checked in the operation?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [common/policies/policy.go#L77](https://github.com/hyperledger-gerrit-archive/fabric/blob/6b049412b595d9f28a5e11cc2b67ad14bdf508de/common/policies/policy.go#L77)<br><strong>Comment</strong>: <pre>I've left another comment in the SignatureSetToValidIdentities function: in case of a signedData argument containing a duplicate identity, this function returns an error. Is this what we want? What if the function returned a valid array of MSP Identities with a single copy of the identity that was originally duplicated?</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [common/policies/policy.go#L77](https://github.com/hyperledger-gerrit-archive/fabric/blob/6b049412b595d9f28a5e11cc2b67ad14bdf508de/common/policies/policy.go#L77)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>CommentLine</strong>: [core/scc/vscc/validator_onevalidsignature_test.go#L356](https://github.com/hyperledger-gerrit-archive/fabric/blob/6b049412b595d9f28a5e11cc2b67ad14bdf508de/core/scc/vscc/validator_onevalidsignature_test.go#L356)<br><strong>Comment</strong>: <pre>I think we should keep this to make sure that the invocation properly goes to the policy validation and the error returned refers to duplication.</pre><strong>Commenter</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>CommentLine</strong>: [core/scc/vscc/validator_onevalidsignature_test.go#L356](https://github.com/hyperledger-gerrit-archive/fabric/blob/6b049412b595d9f28a5e11cc2b67ad14bdf508de/core/scc/vscc/validator_onevalidsignature_test.go#L356)<br><strong>Comment</strong>: <pre>now?</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/scc/vscc/validator_onevalidsignature_test.go#L356](https://github.com/hyperledger-gerrit-archive/fabric/blob/6b049412b595d9f28a5e11cc2b67ad14bdf508de/core/scc/vscc/validator_onevalidsignature_test.go#L356)<br><strong>Comment</strong>: <pre>If we really feel that the duplication error is something that clients have a dependency on, then I would suggest we add known error return types to the SignedDataToValidIdentities utility method.

But I would question, is anything outside of this test dependent on this error text? I rather suspect not.  If it is only this test which is dependent on that error, then I see no value in retesting lines implemented outside of this package.</pre><strong>Commenter</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>CommentLine</strong>: [core/scc/vscc/validator_onevalidsignature_test.go#L356](https://github.com/hyperledger-gerrit-archive/fabric/blob/6b049412b595d9f28a5e11cc2b67ad14bdf508de/core/scc/vscc/validator_onevalidsignature_test.go#L356)<br><strong>Comment</strong>: <pre>Don't you think we should be sure that the if a duplication is in place, the invoke should return the right error? The fact that there exists some code that check for it and works does not mean that it is invoked at all or in the right way, no?</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/scc/vscc/validator_onevalidsignature_test.go#L356](https://github.com/hyperledger-gerrit-archive/fabric/blob/6b049412b595d9f28a5e11cc2b67ad14bdf508de/core/scc/vscc/validator_onevalidsignature_test.go#L356)<br><strong>Comment</strong>: <pre>I am not a chaincode API expert, so I don't know what is and what is not considered part of the chaincode API.

My gut reaction (and why I removed the test), was that the explicit declaration of this error was only used in the test.  I am always hesitant to reach too far into the implementation details of another piece of code for a test in another package. 

The rejection of multiply specified identities is _not_ a function of the chaincode, it is a function of the policy framework, and a contract guaranteed by the policy framework.  So I would again assert, that it has no business here.</pre><strong>Commenter</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>CommentLine</strong>: [core/scc/vscc/validator_onevalidsignature_test.go#L356](https://github.com/hyperledger-gerrit-archive/fabric/blob/6b049412b595d9f28a5e11cc2b67ad14bdf508de/core/scc/vscc/validator_onevalidsignature_test.go#L356)<br><strong>Comment</strong>: <pre>Alright, got it :)</pre><strong>Commenter</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/sigfilter.go#L48](https://github.com/hyperledger-gerrit-archive/fabric/blob/6b049412b595d9f28a5e11cc2b67ad14bdf508de/orderer/common/msgprocessor/sigfilter.go#L48)<br><strong>Comment</strong>: <pre>may you give an example of leakage? Moreover in other places err is appended. Why?</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/sigfilter.go#L48](https://github.com/hyperledger-gerrit-archive/fabric/blob/6b049412b595d9f28a5e11cc2b67ad14bdf508de/orderer/common/msgprocessor/sigfilter.go#L48)<br><strong>Comment</strong>: <pre>Yes.  Consider that I learn through some other leakage that a channel by the name "foo" exists.  But, I don't know which members are in that channel.  I could submit transactions with bad signatures and known MSP IDs to the channel, looking for a "Bad signature" response, rather than a "Unknown identity" response, and therefore deduce the channel members.

Once the identity has been validated to at least be from one of the channel members, the risk of leaking information like membership becomes much less important.</pre><strong>Commenter</strong>: Angelo De Caro - adc@zurich.ibm.com<br><strong>CommentLine</strong>: [orderer/common/msgprocessor/sigfilter.go#L48](https://github.com/hyperledger-gerrit-archive/fabric/blob/6b049412b595d9f28a5e11cc2b67ad14bdf508de/orderer/common/msgprocessor/sigfilter.go#L48)<br><strong>Comment</strong>: <pre>makes sense, okay :)</pre></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Uploader</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Created</strong>: 8/1/2017, 11:20:47 PM<br><strong>UnmergedRevision</strong>: [6d02bc56dba6ec9fb16a3d76e33301a74fcf2877](https://github.com/hyperledger-gerrit-archive/fabric/commit/6d02bc56dba6ec9fb16a3d76e33301a74fcf2877)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/2/2017, 12:14:23 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [common/policies/policy.go#L58](https://github.com/hyperledger-gerrit-archive/fabric/blob/6d02bc56dba6ec9fb16a3d76e33301a74fcf2877/common/policies/policy.go#L58)<br><strong>Comment</strong>: <pre>nit: s/signatures/identities/</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [common/policies/policy.go#L58](https://github.com/hyperledger-gerrit-archive/fabric/blob/6d02bc56dba6ec9fb16a3d76e33301a74fcf2877/common/policies/policy.go#L58)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [common/policies/policy.go#L422](https://github.com/hyperledger-gerrit-archive/fabric/blob/6d02bc56dba6ec9fb16a3d76e33301a74fcf2877/common/policies/policy.go#L422)<br><strong>Comment</strong>: <pre>I know this is out of the scope of this change set, but I was wondering: should we raise an error if there is a duplicate identity, or print a warning of some kind and produce a signature set with a single copy of that identity?</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [common/policies/policy.go#L422](https://github.com/hyperledger-gerrit-archive/fabric/blob/6d02bc56dba6ec9fb16a3d76e33301a74fcf2877/common/policies/policy.go#L422)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 5</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Uploader</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Created</strong>: 8/2/2017, 2:07:38 PM<br><strong>UnmergedRevision</strong>: [a96d366c832ac4fb431f372d45b827dd1cb9a376](https://github.com/hyperledger-gerrit-archive/fabric/commit/a96d366c832ac4fb431f372d45b827dd1cb9a376)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/2/2017, 2:56:27 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 6</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Uploader</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Created</strong>: 8/4/2017, 12:59:13 PM<br><strong>UnmergedRevision</strong>: [029f5725407872baf8f7e3cd2972032ee84cbb46](https://github.com/hyperledger-gerrit-archive/fabric/commit/029f5725407872baf8f7e3cd2972032ee84cbb46)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/4/2017, 6:18:39 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 7</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Uploader</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Created</strong>: 8/5/2017, 10:47:51 AM<br><strong>UnmergedRevision</strong>: [5abfa754b54d25c068c241f5ee167271e5459f6d](https://github.com/hyperledger-gerrit-archive/fabric/commit/5abfa754b54d25c068c241f5ee167271e5459f6d)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/5/2017, 3:39:02 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Approved</strong>: 8/9/2017, 1:12:16 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br></blockquote>