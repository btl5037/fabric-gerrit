<strong>Project</strong>: fabric<br><strong>Branch</strong>: master<br><strong>ID</strong>: 7605<br><strong>Subject</strong>: [FAB-2897] make txn index within block starting at 0<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Cong Honglei - conghonglei@gmail.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 3/31/2017, 2:05:23 AM<br><strong>LastUpdated</strong>: 4/19/2017, 8:17:00 PM<br><strong>CommitMessage</strong>:<br><pre>[FAB-2897] make txn index within block starting at 0

Change-Id: I9e33f6a177511f6cbb5a1ff5e20188008d2efae6
Signed-off-by: conghonglei <conghonglei@wanda.cn>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Cong Honglei - conghonglei@gmail.com<br><strong>Reviewed</strong>: 3/31/2017, 2:05:23 AM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/31/2017, 2:06:57 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/9066/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/31/2017, 2:07:39 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/604/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/31/2017, 2:08:12 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/3137/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/31/2017, 2:36:33 AM<br><strong>Message</strong>: <pre>Patch Set 1: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/9066/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/604/ : SUCCESS

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/3137/ : SUCCESS</pre><strong>Reviewer</strong>: Cong Honglei - conghonglei@gmail.com<br><strong>Reviewed</strong>: 3/31/2017, 3:07:49 AM<br><strong>Message</strong>: <pre>Patch Set 1:

> Build Failed
 > 
 > https://jenkins.hyperledger.org/job/fabric-verify-x86_64/9066/ :
 > FAILURE
 > 
 > https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/604/
 > : SUCCESS
 > 
 > https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/3137/
 > : SUCCESS

reverify</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/31/2017, 3:10:18 AM<br><strong>Message</strong>: <pre>Patch Set 1: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/9069/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/31/2017, 3:11:03 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/3140/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/31/2017, 3:42:11 AM<br><strong>Message</strong>: <pre>Patch Set 1: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/9069/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/607/ : SUCCESS

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/3140/ : SUCCESS</pre><strong>Reviewer</strong>: Cong Honglei - conghonglei@gmail.com<br><strong>Reviewed</strong>: 3/31/2017, 4:40:48 AM<br><strong>Message</strong>: <pre>Abandoned

missed some important part in history db. fix it again.</pre><strong>Reviewer</strong>: Cong Honglei - conghonglei@gmail.com<br><strong>Reviewed</strong>: 3/31/2017, 5:19:10 AM<br><strong>Message</strong>: <pre>Restored

fixed history-db part.</pre><strong>Reviewer</strong>: Cong Honglei - conghonglei@gmail.com<br><strong>Reviewed</strong>: 3/31/2017, 5:19:53 AM<br><strong>Message</strong>: <pre>Uploaded patch set 2.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/31/2017, 5:21:36 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/9073/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/31/2017, 5:22:14 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/611/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/31/2017, 5:22:45 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/3144/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 3/31/2017, 6:32:59 AM<br><strong>Message</strong>: <pre>Patch Set 2: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/9073/ : SUCCESS

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/611/ : SUCCESS

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/3144/ : SUCCESS</pre><strong>Reviewer</strong>: Christopher Ferris - chris.ferris@gmail.com<br><strong>Reviewed</strong>: 4/3/2017, 9:56:26 AM<br><strong>Message</strong>: <pre>Patch Set 2: Code-Review+2

LGTM and I see in the JIRA that there is comfort with the nature of the change.</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 4/3/2017, 12:42:34 PM<br><strong>Message</strong>: <pre>Patch Set 2: Code-Review-1

There are some more locations that need to get updated...I'll provide some examples.</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 4/3/2017, 1:02:30 PM<br><strong>Message</strong>: <pre>Patch Set 2:

There are many other locations that need to get updated.

First and foremost is state_based_validator.go which initially sets the tran height in this line: 
committingTxHeight := version.NewHeight(block.Header.Number, uint64(txIndex+1))
The +1 needs to be removed.

Also, grep for "NewHeight" and reduce the second parameter by 1 everywhere.  There are many occurences in tests and also in lockbased_txmgr.go.</pre><strong>Reviewer</strong>: Christopher Ferris - chris.ferris@gmail.com<br><strong>Reviewed</strong>: 4/3/2017, 1:12:36 PM<br><strong>Message</strong>: <pre>Patch Set 2: -Code-Review</pre><strong>Reviewer</strong>: Cong Honglei - conghonglei@gmail.com<br><strong>Reviewed</strong>: 4/4/2017, 10:14:03 PM<br><strong>Message</strong>: <pre>Patch Set 2:

> There are many other locations that need to get updated.
 > 
 > First and foremost is state_based_validator.go which initially sets
 > the tran height in this line:
 > committingTxHeight := version.NewHeight(block.Header.Number,
 > uint64(txIndex+1))
 > The +1 needs to be removed.
 > 
 > Also, grep for "NewHeight" and reduce the second parameter by 1
 > everywhere.  There are many occurences in tests and also in
 > lockbased_txmgr.go.

Thanks for the comments, David.
btw, do you think all version height need to be update, in unit tests?  I found most of them are just used as testing version number, not related with indexing in block.  For example, putting kv to batch with given version, then checking query result with same version number.  I'm OK to update them, not sure if really needed.</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 4/5/2017, 10:28:59 AM<br><strong>Message</strong>: <pre>Patch Set 2:

I agree, many occurrences of height in the tests do not need to be updated.  Better to not touch these if you don't have to. Please use your best judgement and then we will review.</pre><strong>Reviewer</strong>: Cong Honglei - conghonglei@gmail.com<br><strong>Reviewed</strong>: 4/5/2017, 8:46:25 PM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/5/2017, 8:49:01 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/9256/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/5/2017, 8:50:00 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/793/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/5/2017, 8:50:23 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/3326/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/5/2017, 10:25:05 PM<br><strong>Message</strong>: <pre>Patch Set 3: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/9256/ : SUCCESS

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/793/ : SUCCESS

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/3326/ : SUCCESS</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 4/10/2017, 9:22:06 AM<br><strong>Message</strong>: <pre>Patch Set 3:

(2 comments)

Looking good, just a couple small comments.
Also, please rebase on top of latest master.  I'd like to do an end-to-end trial before I +1.</pre><strong>Reviewer</strong>: Cong Honglei - conghonglei@gmail.com<br><strong>Reviewed</strong>: 4/10/2017, 9:04:24 PM<br><strong>Message</strong>: <pre>Patch Set 3:

(2 comments)</pre><strong>Reviewer</strong>: Cong Honglei - conghonglei@gmail.com<br><strong>Reviewed</strong>: 4/10/2017, 9:14:16 PM<br><strong>Message</strong>: <pre>Uploaded patch set 4.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/10/2017, 9:15:40 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/9406/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/10/2017, 9:16:13 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/943/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/10/2017, 9:16:39 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/3476/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/10/2017, 10:53:11 PM<br><strong>Message</strong>: <pre>Patch Set 4: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/9406/ : SUCCESS

https://jenkins.hyperledger.org/job/fabric-verify-end-2-end-x86_64/943/ : SUCCESS

https://jenkins.hyperledger.org/job/fabric-verify-behave-x86_64/3476/ : SUCCESS</pre><strong>Reviewer</strong>: Baohua Yang - yangbaohua@gmail.com<br><strong>Reviewed</strong>: 4/10/2017, 11:22:25 PM<br><strong>Message</strong>: <pre>Patch Set 4: Code-Review+1</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 4/18/2017, 2:43:25 PM<br><strong>Message</strong>: <pre>Patch Set 4: Code-Review+1</pre><strong>Reviewer</strong>: Christopher Ferris - chris.ferris@gmail.com<br><strong>Reviewed</strong>: 4/19/2017, 9:55:44 AM<br><strong>Message</strong>: <pre>Patch Set 4: Code-Review+2</pre><strong>Reviewer</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>Reviewed</strong>: 4/19/2017, 4:49:51 PM<br><strong>Message</strong>: <pre>Patch Set 4: Code-Review+2

thanks.</pre><strong>Reviewer</strong>: Gerrit Code Review - gerrit@hyperledger.org<br><strong>Reviewed</strong>: 4/19/2017, 4:49:54 PM<br><strong>Message</strong>: <pre>Change has been successfully merged by Binh Nguyen</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/19/2017, 6:15:46 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-x86_64/1531/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/19/2017, 6:34:17 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-behave-x86_64/534/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/19/2017, 6:34:18 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/219/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/19/2017, 8:17:00 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-merge-x86_64/1531/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/219/ : FAILURE (skipped)

https://jenkins.hyperledger.org/job/fabric-merge-behave-x86_64/534/ : SUCCESS</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: conghonglei - conghonglei@wanda.cn<br><strong>Uploader</strong>: Cong Honglei - conghonglei@gmail.com<br><strong>Created</strong>: 1490940323<br><strong>GitHubRevision</strong>: [6457ebe74d1cba208d4f2f1aa602d5491b2d84ea](https://github.com/hyperledger/fabric/commit/6457ebe74d1cba208d4f2f1aa602d5491b2d84ea)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 3/31/2017, 3:42:11 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: conghonglei - conghonglei@wanda.cn<br><strong>Uploader</strong>: Cong Honglei - conghonglei@gmail.com<br><strong>Created</strong>: 1490951993<br><strong>GitHubRevision</strong>: [ef5b225b5660c54e5b3f233355bef058babe5326](https://github.com/hyperledger/fabric/commit/ef5b225b5660c54e5b3f233355bef058babe5326)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 3/31/2017, 6:32:59 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Approved</strong>: 4/3/2017, 12:42:34 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: conghonglei - conghonglei@wanda.cn<br><strong>Uploader</strong>: Cong Honglei - conghonglei@gmail.com<br><strong>Created</strong>: 1491439585<br><strong>GitHubRevision</strong>: [31764ab36d3fdffc45963c89a9f9469eef5d58fe](https://github.com/hyperledger/fabric/commit/31764ab36d3fdffc45963c89a9f9469eef5d58fe)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/5/2017, 10:25:05 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: conghonglei - conghonglei@wanda.cn<br><strong>Uploader</strong>: Cong Honglei - conghonglei@gmail.com<br><strong>Created</strong>: 1491873256<br><strong>GitHubRevision</strong>: [47f4ee331131225bc0e2480c24bc4503dd2c9b17](https://github.com/hyperledger/fabric/commit/47f4ee331131225bc0e2480c24bc4503dd2c9b17)<br><br><strong>Approver</strong>: Christopher Ferris - chris.ferris@gmail.com<br><strong>Approved</strong>: 4/19/2017, 9:55:44 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/10/2017, 10:53:11 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>Approved</strong>: 4/19/2017, 4:49:51 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Binh Nguyen<br><strong>Merged</strong>: 4/19/2017, 4:49:54 PM<br><br><strong>Approver</strong>: Baohua Yang - yangbaohua@gmail.com<br><strong>Approved</strong>: 4/10/2017, 11:22:25 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Approved</strong>: 4/18/2017, 2:43:25 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br></blockquote>