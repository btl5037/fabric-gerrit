<strong>Project</strong>: fabric<br><strong>Branch</strong>: master<br><strong>ID</strong>: 30884<br><strong>Subject</strong>: Enable chaincode lifecycle events<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 4/10/2019, 10:57:14 PM<br><strong>LastUpdated</strong>: 5/18/2019, 11:38:33 AM<br><strong>CommitMessage</strong>:<br><pre>Enable chaincode lifecycle events

Allow new lifecycle to invoke listeners for the events
when a chaincode becomes invocable

FAB-15138 #done

Change-Id: I7c90580eafed09ba4e5fbb64f140d19c37fb4acc
Signed-off-by: manish <manish.sethi@gmail.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 4/10/2019, 10:57:14 PM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/10/2019, 11:01:30 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13002/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/10/2019, 11:01:53 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/10/2019, 11:07:07 PM<br><strong>Message</strong>: <pre>Patch Set 1: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/10/2019, 11:07:47 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13002/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/13002</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/10/2019, 11:10:00 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/11454/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/10/2019, 11:10:20 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8126/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/10/2019, 11:10:22 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/10/2019, 11:10:45 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/10/2019, 11:33:02 PM<br><strong>Message</strong>: <pre>Patch Set 1: F3-UnitTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/10/2019, 11:45:32 PM<br><strong>Message</strong>: <pre>Patch Set 1: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/10/2019, 11:46:09 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/11454/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/11454

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8126/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/8126</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 4/12/2019, 5:39:57 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/12/2019, 5:43:30 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/11491/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/12/2019, 5:43:55 AM<br><strong>Message</strong>: <pre>Patch Set 1: -F3-UnitTest

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/12/2019, 6:08:54 AM<br><strong>Message</strong>: <pre>Patch Set 1: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/12/2019, 6:09:39 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/11491/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/11491</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 4/15/2019, 8:49:39 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(9 comments)

Thanks Manish, some comments from my side</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 4/15/2019, 1:17:10 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(9 comments)

Thanks Ale. I figured that most of the comments relate to install path error handling... Highlighting the focused comments on that part (https://gerrit.hyperledger.org/r/#/c/30884/1/core/chaincode/lifecycle/lifecycle.go@469

https://gerrit.hyperledger.org/r/#/c/30884/1/core/chaincode/lifecycle/event_broker.go@107
)

to help settle on this.</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 4/15/2019, 4:04:45 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(8 comments)

Thanks Manish - my responses below</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 4/15/2019, 4:14:52 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(1 comment)</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 4/15/2019, 4:50:42 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(6 comments)</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 4/15/2019, 7:02:49 PM<br><strong>Message</strong>: <pre>Uploaded patch set 2.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/15/2019, 7:09:57 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13088/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/15/2019, 7:10:23 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/15/2019, 7:15:29 PM<br><strong>Message</strong>: <pre>Patch Set 2: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/15/2019, 7:16:08 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13088/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/13088</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/15/2019, 7:18:53 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/11539/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/15/2019, 7:19:07 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8208/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/15/2019, 7:19:16 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/15/2019, 7:19:36 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/15/2019, 7:42:30 PM<br><strong>Message</strong>: <pre>Patch Set 2: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/15/2019, 7:54:12 PM<br><strong>Message</strong>: <pre>Patch Set 2: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/15/2019, 7:54:57 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/11539/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/11539

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8208/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/8208</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 4/16/2019, 5:28:22 AM<br><strong>Message</strong>: <pre>Patch Set 2:

(5 comments)

Thanks Manish, see below, plus:
1) I think we should strive to maintain 100% test coverage in this package as we have done so far
2) wrt. locking: the cache is maintaining its peer-wide lock while invoking our listeners: can you see any deadlock problems with respect to the fact that the call sequence may be ledger holding a lock calling the cache, which holds a lock and calls one of its listeners, the ledger, again?</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 4/16/2019, 1:28:10 PM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 4/16/2019, 1:31:56 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(2 comments)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/16/2019, 1:32:58 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13101/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/16/2019, 1:33:24 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/16/2019, 1:38:40 PM<br><strong>Message</strong>: <pre>Patch Set 3: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/16/2019, 1:39:24 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13101/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/13101</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/16/2019, 1:40:57 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/11551/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/16/2019, 1:41:19 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/16/2019, 1:41:27 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8222/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/16/2019, 1:41:51 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/16/2019, 2:06:33 PM<br><strong>Message</strong>: <pre>Patch Set 3: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/16/2019, 2:19:27 PM<br><strong>Message</strong>: <pre>Patch Set 3: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/16/2019, 2:20:14 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/11551/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/11551

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8222/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/8222</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 4/17/2019, 6:54:51 PM<br><strong>Message</strong>: <pre>Uploaded patch set 4.</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 4/17/2019, 9:51:20 PM<br><strong>Message</strong>: <pre>Patch Set 4:

VerifyBuild</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/17/2019, 9:57:06 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13134/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/17/2019, 9:57:27 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/17/2019, 9:57:56 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13136/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/17/2019, 9:58:23 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/17/2019, 10:02:20 PM<br><strong>Message</strong>: <pre>Patch Set 4: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/17/2019, 10:03:26 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/17/2019, 10:04:04 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13136/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/13136</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/17/2019, 10:06:43 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8246/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/17/2019, 10:06:47 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/11576/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/17/2019, 10:07:12 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/17/2019, 10:07:17 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/17/2019, 10:34:36 PM<br><strong>Message</strong>: <pre>Patch Set 4: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/17/2019, 10:44:25 PM<br><strong>Message</strong>: <pre>Patch Set 4: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/17/2019, 10:45:09 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13134/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/13134

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8246/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/8246

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/11576/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/11576</pre><strong>Reviewer</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Reviewed</strong>: 4/18/2019, 2:41:48 PM<br><strong>Message</strong>: <pre>Uploaded patch set 5: Patch Set 4 was rebased.</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 4/29/2019, 11:24:57 PM<br><strong>Message</strong>: <pre>Uploaded patch set 6: Patch Set 5 was rebased.</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 5/1/2019, 1:30:33 PM<br><strong>Message</strong>: <pre>Patch Set 6:

(1 comment)

Sorry, one more nit..</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 5/1/2019, 2:55:21 PM<br><strong>Message</strong>: <pre>Patch Set 6:

(1 comment)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 5/1/2019, 4:09:15 PM<br><strong>Message</strong>: <pre>Patch Set 6:

(1 comment)</pre><strong>Reviewer</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Reviewed</strong>: 5/1/2019, 5:57:54 PM<br><strong>Message</strong>: <pre>Patch Set 6: Code-Review-1

(27 comments)

Lots of style comments - especially on the ginkgo tests.

The code could also use some vertical spacing between blocks, after fast error returns, and between test setup and assertions.

I see that we're still defining interfaces in shared packages instead of where consume and this has extended that pattern with mocks. We should be moving away from it.

I'm also concerned that the event interface is not something that can be evolved to provide new information without changing the caller. While we can introduce extended interfaces, it's a lot more cumbersome than just using a struct.</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 5/2/2019, 11:53:54 PM<br><strong>Message</strong>: <pre>Uploaded patch set 7.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/2/2019, 11:57:02 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13497/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/2/2019, 11:57:26 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/3/2019, 12:02:26 AM<br><strong>Message</strong>: <pre>Patch Set 7: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/3/2019, 12:03:13 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13497/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/13497</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/3/2019, 12:06:45 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8555/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/3/2019, 12:06:53 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/11888/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/3/2019, 12:07:09 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/3/2019, 12:07:17 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/3/2019, 12:34:05 AM<br><strong>Message</strong>: <pre>Patch Set 7: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/3/2019, 12:43:13 AM<br><strong>Message</strong>: <pre>Patch Set 7: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/3/2019, 12:44:02 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8555/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/8555

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/11888/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/11888</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 5/3/2019, 1:00:04 AM<br><strong>Message</strong>: <pre>Patch Set 7:

(27 comments)</pre><strong>Reviewer</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Reviewed</strong>: 5/6/2019, 11:43:52 AM<br><strong>Message</strong>: <pre>Patch Set 7: Code-Review+1</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 5/7/2019, 10:57:24 AM<br><strong>Message</strong>: <pre>Patch Set 7: Code-Review+2

(2 comments)</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 5/15/2019, 11:40:49 PM<br><strong>Message</strong>: <pre>Patch Set 7:

(5 comments)</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 5/16/2019, 12:27:40 PM<br><strong>Message</strong>: <pre>Patch Set 7:

(5 comments)</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 5/16/2019, 3:15:07 PM<br><strong>Message</strong>: <pre>Patch Set 7:

(3 comments)</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 5/16/2019, 3:34:33 PM<br><strong>Message</strong>: <pre>Patch Set 7:

(1 comment)</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 5/16/2019, 11:32:13 PM<br><strong>Message</strong>: <pre>Uploaded patch set 8.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/16/2019, 11:32:24 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13764/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/16/2019, 11:32:43 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Starting verify build</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 5/16/2019, 11:33:27 PM<br><strong>Message</strong>: <pre>Uploaded patch set 9: Patch Set 8 was rebased.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/16/2019, 11:34:31 PM<br><strong>Message</strong>: <pre>Patch Set 8: F1-VerifyBuild-1

code checks are failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/16/2019, 11:35:24 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13764/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/13764</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 5/16/2019, 11:41:46 PM<br><strong>Message</strong>: <pre>Patch Set 7:

(3 comments)</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 5/16/2019, 11:46:00 PM<br><strong>Message</strong>: <pre>Uploaded patch set 10.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/16/2019, 11:46:08 PM<br><strong>Message</strong>: <pre>Patch Set 10:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13765/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/16/2019, 11:46:49 PM<br><strong>Message</strong>: <pre>Patch Set 10:

Starting verify build</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 5/16/2019, 11:48:20 PM<br><strong>Message</strong>: <pre>Uploaded patch set 11.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/16/2019, 11:49:42 PM<br><strong>Message</strong>: <pre>Patch Set 10: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13765/ : ABORTED

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/13765</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/16/2019, 11:52:32 PM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13766/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/16/2019, 11:52:57 PM<br><strong>Message</strong>: <pre>Patch Set 11:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/16/2019, 11:55:08 PM<br><strong>Message</strong>: <pre>Patch Set 11: F1-VerifyBuild-1

code checks are failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/16/2019, 11:56:05 PM<br><strong>Message</strong>: <pre>Patch Set 11:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13766/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/13766</pre><strong>Reviewer</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Reviewed</strong>: 5/17/2019, 9:08:19 AM<br><strong>Message</strong>: <pre>Patch Set 11:

(1 comment)</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 5/17/2019, 9:49:34 AM<br><strong>Message</strong>: <pre>Uploaded patch set 12.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/17/2019, 9:49:42 AM<br><strong>Message</strong>: <pre>Patch Set 12:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13779/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/17/2019, 9:50:02 AM<br><strong>Message</strong>: <pre>Patch Set 12:

Starting verify build</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 5/17/2019, 9:51:53 AM<br><strong>Message</strong>: <pre>Patch Set 12:

(1 comment)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/17/2019, 9:54:24 AM<br><strong>Message</strong>: <pre>Patch Set 12: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/17/2019, 9:54:58 AM<br><strong>Message</strong>: <pre>Patch Set 12:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/13779/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/13779</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/17/2019, 9:56:06 AM<br><strong>Message</strong>: <pre>Patch Set 12:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12172/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/17/2019, 9:56:10 AM<br><strong>Message</strong>: <pre>Patch Set 12:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8789/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/17/2019, 9:56:33 AM<br><strong>Message</strong>: <pre>Patch Set 12:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/17/2019, 9:56:38 AM<br><strong>Message</strong>: <pre>Patch Set 12:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/17/2019, 10:23:08 AM<br><strong>Message</strong>: <pre>Patch Set 12: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/17/2019, 10:31:36 AM<br><strong>Message</strong>: <pre>Patch Set 12: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/17/2019, 10:32:14 AM<br><strong>Message</strong>: <pre>Patch Set 12:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12172/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/12172

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/8789/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/8789</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 5/18/2019, 4:43:33 AM<br><strong>Message</strong>: <pre>Patch Set 12: Code-Review+2</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 5/18/2019, 10:39:26 AM<br><strong>Message</strong>: <pre>Patch Set 12: Code-Review+2</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 5/18/2019, 10:39:28 AM<br><strong>Message</strong>: <pre>Change has been successfully merged by David Enyeart</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/18/2019, 10:39:35 AM<br><strong>Message</strong>: <pre>Patch Set 12:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-x86_64/6676/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/18/2019, 10:44:17 AM<br><strong>Message</strong>: <pre>Patch Set 12:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/5361/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/18/2019, 11:38:33 AM<br><strong>Message</strong>: <pre>Patch Set 12:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-merge-x86_64/6676/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-x86_64/6676

https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/5361/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-end-2-end-x86_64/5361</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Uploader</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Created</strong>: 4/10/2019, 10:57:14 PM<br><strong>UnmergedRevision</strong>: [651c9d06e34904953a7b303738ff19ff99f51248](https://github.com/hyperledger-gerrit-archive/fabric/commit/651c9d06e34904953a7b303738ff19ff99f51248)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/10/2019, 11:07:07 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/10/2019, 11:07:07 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/10/2019, 11:45:32 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/12/2019, 6:08:54 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/cache.go#L177](https://github.com/hyperledger-gerrit-archive/fabric/blob/651c9d06e34904953a7b303738ff19ff99f51248/core/chaincode/lifecycle/cache.go#L177)<br><strong>Comment</strong>: <pre>Let's please avoid this approach: these additional flags that modify the behaviour of a function make the code harder to maintain; it seems simpler just to move the invocation of ProcessInstallEvent at the end of HandleStateUpdates</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/cache.go#L177](https://github.com/hyperledger-gerrit-archive/fabric/blob/651c9d06e34904953a7b303738ff19ff99f51248/core/chaincode/lifecycle/cache.go#L177)<br><strong>Comment</strong>: <pre>The alternate way requires this function to return "localChaincode" - unless we want to repeat the code for retrieval. 

The another function "update" would need to return rather the slice of names and CachedChaincode. I would suggest you to relook the function "update" and visualize the changes for preparing the slices for names and CachedChaincode (specially in the presence of "continue" statements) and rethink weather you find that would improve the readability?

I won't mind changing if you desire so but want you give another thought.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/cache.go#L177](https://github.com/hyperledger-gerrit-archive/fabric/blob/651c9d06e34904953a7b303738ff19ff99f51248/core/chaincode/lifecycle/cache.go#L177)<br><strong>Comment</strong>: <pre>I'm on the fence here - on the one hand I tend to distrust long and complex functions that behave in different ways depending on more-or-less opaque flags that are passed in; on the other, I see the superior compactness of this way of coding. 

> unless we want to repeat the code for retrieval

that could could be factored out of both functions, but the problem is the other update function whose logic is a little more complex

Overall, I leave it up to you.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/cache.go#L177](https://github.com/hyperledger-gerrit-archive/fabric/blob/651c9d06e34904953a7b303738ff19ff99f51248/core/chaincode/lifecycle/cache.go#L177)<br><strong>Comment</strong>: <pre>Since this flag is not changing any core logic of these functions update and used to decide in the end whether to propagate the event or not, I found this more readable. I would tend to keep it as is.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/cache.go#L177](https://github.com/hyperledger-gerrit-archive/fabric/blob/651c9d06e34904953a7b303738ff19ff99f51248/core/chaincode/lifecycle/cache.go#L177)<br><strong>Comment</strong>: <pre>Ok, no probs</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/cache.go#L308](https://github.com/hyperledger-gerrit-archive/fabric/blob/651c9d06e34904953a7b303738ff19ff99f51248/core/chaincode/lifecycle/cache.go#L308)<br><strong>Comment</strong>: <pre>Same as https://gerrit.hyperledger.org/r/#/c/30884/1/core/chaincode/lifecycle/cache.go@177</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/cache.go#L308](https://github.com/hyperledger-gerrit-archive/fabric/blob/651c9d06e34904953a7b303738ff19ff99f51248/core/chaincode/lifecycle/cache.go#L308)<br><strong>Comment</strong>: <pre>Same reply as to the referred comment</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/cache.go#L308](https://github.com/hyperledger-gerrit-archive/fabric/blob/651c9d06e34904953a7b303738ff19ff99f51248/core/chaincode/lifecycle/cache.go#L308)<br><strong>Comment</strong>: <pre>See above</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L0](https://github.com/hyperledger-gerrit-archive/fabric/blob/651c9d06e34904953a7b303738ff19ff99f51248/core/chaincode/lifecycle/event_broker.go#L0)<br><strong>Comment</strong>: <pre>It would be good to have some comments to the exported functions so that we can understand under what circumstances they are called and for what purpose.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L0](https://github.com/hyperledger-gerrit-archive/fabric/blob/651c9d06e34904953a7b303738ff19ff99f51248/core/chaincode/lifecycle/event_broker.go#L0)<br><strong>Comment</strong>: <pre>None of these functions are exported in any true sense. Here, I am just following the convention in this package to make everything exported but still assume that no one outside will use it - I was not convinced at all with this practice.

You may like to revive some of the previous related discussions here

https://gerrit.hyperledger.org/r/#/c/28515/11/core/chaincode/lifecycle/ledger_shim.go@32

https://gerrit.hyperledger.org/r/#/c/28916/18/core/chaincode/lifecycle/deployedcc_infoprovider.go@224</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L0](https://github.com/hyperledger-gerrit-archive/fabric/blob/651c9d06e34904953a7b303738ff19ff99f51248/core/chaincode/lifecycle/event_broker.go#L0)<br><strong>Comment</strong>: <pre>Ok, understood - thx</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L79](https://github.com/hyperledger-gerrit-archive/fabric/blob/651c9d06e34904953a7b303738ff19ff99f51248/core/chaincode/lifecycle/event_broker.go#L79)<br><strong>Comment</strong>: <pre>Oh, another thing that came to my mind: are our listeners ready to be called multiple times for the same definition/package? It may happen for instance in this scenario here

https://github.com/hyperledger/fabric/blob/master/integration/nwo/network_test.go#L123-L155

where the admin may temporarily disable and then re-enable the chaincode</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L79](https://github.com/hyperledger-gerrit-archive/fabric/blob/651c9d06e34904953a7b303738ff19ff99f51248/core/chaincode/lifecycle/event_broker.go#L79)<br><strong>Comment</strong>: <pre>The index creation listener is written to handle the events more than once because this can happen anyways in a scenario  where a crash takes place between invoking the listener and committing the state changes to db.

For service discovery listener, rather, this raises a new point - i.e., these listeners need to be extended to handle "ChaincodeUnavaliable" event. Because, service discovery may need to update its inventory.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L79](https://github.com/hyperledger-gerrit-archive/fabric/blob/651c9d06e34904953a7b303738ff19ff99f51248/core/chaincode/lifecycle/event_broker.go#L79)<br><strong>Comment</strong>: <pre>Created https://jira.hyperledger.org/browse/FAB-15202 to track that</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L96](https://github.com/hyperledger-gerrit-archive/fabric/blob/651c9d06e34904953a7b303738ff19ff99f51248/core/chaincode/lifecycle/event_broker.go#L96)<br><strong>Comment</strong>: <pre>This code and the body of ProcessInstallEvent seem to have a lot of shared logic: in both cases we load database artefacts, check whether the chaincode is invokable, construct a ChaincodeDefinition instance and invoke listeners. Could we please refactor?</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L96](https://github.com/hyperledger-gerrit-archive/fabric/blob/651c9d06e34904953a7b303738ff19ff99f51248/core/chaincode/lifecycle/event_broker.go#L96)<br><strong>Comment</strong>: <pre>The common code is already factored out in functions such as "loadDBArtifacts". Here this is mostly some orchestration of these functions. If you have any specific idea to refactor further, I would like to hear more on that.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L96](https://github.com/hyperledger-gerrit-archive/fabric/blob/651c9d06e34904953a7b303738ff19ff99f51248/core/chaincode/lifecycle/event_broker.go#L96)<br><strong>Comment</strong>: <pre>Yeah, on second thought this function doesn't have a for loop while the other one does - but there is definitely a pattern of
1) testing for chaincode invokability
2) constructing a ChaincodeDefinition instance
3) invoking listeners

but it would be a minor refactoring anyway - leave this up 2u.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L96](https://github.com/hyperledger-gerrit-archive/fabric/blob/651c9d06e34904953a7b303738ff19ff99f51248/core/chaincode/lifecycle/event_broker.go#L96)<br><strong>Comment</strong>: <pre>Yes, the main difference is caused by the for loop. In the case of install, we want to load the package once only and use that across multiple channels. I think that further refactoring for small reuse will hamper the readability with not much gain - so will leave as is.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L96](https://github.com/hyperledger-gerrit-archive/fabric/blob/651c9d06e34904953a7b303738ff19ff99f51248/core/chaincode/lifecycle/event_broker.go#L96)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L107](https://github.com/hyperledger-gerrit-archive/fabric/blob/651c9d06e34904953a7b303738ff19ff99f51248/core/chaincode/lifecycle/event_broker.go#L107)<br><strong>Comment</strong>: <pre>We never actually return an error so let's please remove it from the prototype</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L107](https://github.com/hyperledger-gerrit-archive/fabric/blob/651c9d06e34904953a7b303738ff19ff99f51248/core/chaincode/lifecycle/event_broker.go#L107)<br><strong>Comment</strong>: <pre>This error stuff looks confusing because the whole event/listener infrastructure was designed for a two phase install (see comment at line 64) while the new install path is just not that.

One option is to actually fix the install path. My thinking was in that line that eventually we would need to throw error from here.

Second option is more in the lines of your comment - I can change this function signature and open a Jira for fixing the install path error handling - wdyt?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L107](https://github.com/hyperledger-gerrit-archive/fabric/blob/651c9d06e34904953a7b303738ff19ff99f51248/core/chaincode/lifecycle/event_broker.go#L107)<br><strong>Comment</strong>: <pre>I would go with the second option - the benefit would be that we can get more quickly to a testable e2e this way, wdyt?</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L107](https://github.com/hyperledger-gerrit-archive/fabric/blob/651c9d06e34904953a7b303738ff19ff99f51248/core/chaincode/lifecycle/event_broker.go#L107)<br><strong>Comment</strong>: <pre>e2e should be largely independent of this but I can make this path error free and reintroduce when the install path is redesigned</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L113](https://github.com/hyperledger-gerrit-archive/fabric/blob/651c9d06e34904953a7b303738ff19ff99f51248/core/chaincode/lifecycle/event_broker.go#L113)<br><strong>Comment</strong>: <pre>Let's just panic instead then - it's too risky to just have a possible error condition unacknowledged and buried in the logs</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L113](https://github.com/hyperledger-gerrit-archive/fabric/blob/651c9d06e34904953a7b303738ff19ff99f51248/core/chaincode/lifecycle/event_broker.go#L113)<br><strong>Comment</strong>: <pre>Not panic'ing because the error model from listeners needs to be clear. Is it good to panic on install of a chaincode package that has malformed index def?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L113](https://github.com/hyperledger-gerrit-archive/fabric/blob/651c9d06e34904953a7b303738ff19ff99f51248/core/chaincode/lifecycle/event_broker.go#L113)<br><strong>Comment</strong>: <pre>Ah yes, good point. But here we could be on 2 separate code paths - install and define. While I suppose it's okay to fail an install if we have bad indexes, I don't think we can fail a define, because that would be a fork, right? 

And actually, when I was trying to trace the code in the legacy LSCC path, it seems like we do fail in that case (or maybe I got it wrong?).

So I suppose we should 
 - check whether the legacy path is okay
 - fail the install (if we can without major restructuring)
 - not much we can do for a define, we definitely can't fail and so we indeed have to log the error</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L113](https://github.com/hyperledger-gerrit-archive/fabric/blob/651c9d06e34904953a7b303738ff19ff99f51248/core/chaincode/lifecycle/event_broker.go#L113)<br><strong>Comment</strong>: <pre>Even in the case of define, propagating error won't cause fork. Since, it will be treated as a general error and hence would cause panic - until the admin reinstall the chaincode with correct indexes and restart the peer. But since this involves a dev cycle to fix the index errors (which may not be immediately fixable), the error was logged instead of panic.

Ideally, there should be some validators that should be invoked during install operation to verify the artifacts but this was assumed that the folks would first test the package on the test network - so practically, this should not happen and hence logging is fine.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L113](https://github.com/hyperledger-gerrit-archive/fabric/blob/651c9d06e34904953a7b303738ff19ff99f51248/core/chaincode/lifecycle/event_broker.go#L113)<br><strong>Comment</strong>: <pre>Ok, but just for my own understanding: it *IS* possible that the listeners return errors, right? So at least we should correct the comment which is incorrect. Also, describing the effects of an error here (peer panics eventually) and the recovery process would be useful in the comment</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L113](https://github.com/hyperledger-gerrit-archive/fabric/blob/651c9d06e34904953a7b303738ff19ff99f51248/core/chaincode/lifecycle/event_broker.go#L113)<br><strong>Comment</strong>: <pre>revised the comments</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L123](https://github.com/hyperledger-gerrit-archive/fabric/blob/651c9d06e34904953a7b303738ff19ff99f51248/core/chaincode/lifecycle/event_broker.go#L123)<br><strong>Comment</strong>: <pre>If we're never calling this function specifying false as argument let us please remove it and just pass the true constant to the call on line 128</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L123](https://github.com/hyperledger-gerrit-archive/fabric/blob/651c9d06e34904953a7b303738ff19ff99f51248/core/chaincode/lifecycle/event_broker.go#L123)<br><strong>Comment</strong>: <pre>That would be even more confusing IMO. In the present form, the purpose of this argument is clear and the comments in the caller at line 63 makes it pretty clear why this is being called with 'true'.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L123](https://github.com/hyperledger-gerrit-archive/fabric/blob/651c9d06e34904953a7b303738ff19ff99f51248/core/chaincode/lifecycle/event_broker.go#L123)<br><strong>Comment</strong>: <pre>Ok - fair enough</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L174](https://github.com/hyperledger-gerrit-archive/fabric/blob/651c9d06e34904953a7b303738ff19ff99f51248/core/chaincode/lifecycle/event_broker.go#L174)<br><strong>Comment</strong>: <pre>I would just remove and use https://golang.org/pkg/sync/#Map instead - we would get rid of this code, not have to maintain it/test it etc.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L174](https://github.com/hyperledger-gerrit-archive/fabric/blob/651c9d06e34904953a7b303738ff19ff99f51248/core/chaincode/lifecycle/event_broker.go#L174)<br><strong>Comment</strong>: <pre>Ack!</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/lifecycle.go#L469](https://github.com/hyperledger-gerrit-archive/fabric/blob/651c9d06e34904953a7b303738ff19ff99f51248/core/chaincode/lifecycle/lifecycle.go#L469)<br><strong>Comment</strong>: <pre>This doesn't sound right: we have already successfully persisted data on disk (on line 460) and yet we're failing the operation. How about we just log errors about failure to extract indices and never fail the operation because of them?</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/lifecycle.go#L469](https://github.com/hyperledger-gerrit-archive/fabric/blob/651c9d06e34904953a7b303738ff19ff99f51248/core/chaincode/lifecycle/lifecycle.go#L469)<br><strong>Comment</strong>: <pre>This is the shortcoming of the install path in the new code. See code comments here - https://gerrit.hyperledger.org/r/#/c/30884/1/core/chaincode/lifecycle/event_broker.go@63

And that why in the current code, I was not returning the error here and just logging it - https://gerrit.hyperledger.org/r/#/c/30884/1/core/chaincode/lifecycle/event_broker.go@117

But I figured that this was enough to cause confusion to you (and will be for others too). I would remove this error propagation path entirely and will open a Jira to make the install 2-phase - wdyt?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/lifecycle.go#L469](https://github.com/hyperledger-gerrit-archive/fabric/blob/651c9d06e34904953a7b303738ff19ff99f51248/core/chaincode/lifecycle/lifecycle.go#L469)<br><strong>Comment</strong>: <pre>Thanks for the pointer. I educated myself a little bit about the legacy code path

https://github.com/hyperledger/fabric/blob/release-1.4/core/scc/lscc/lscc.go#L596-L602

and yes, I now see that we are not exactly doing that here, hence the hardcoded call to true and the awkward error propagation. Yes, I completely agree with the way forward you suggest: remove the error propagation from this patch set and create a JIRA to make the install process truly 2-phased. Thanks</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/lifecycle.go#L469](https://github.com/hyperledger-gerrit-archive/fabric/blob/651c9d06e34904953a7b303738ff19ff99f51248/core/chaincode/lifecycle/lifecycle.go#L469)<br><strong>Comment</strong>: <pre>Sure</pre></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Uploader</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Created</strong>: 4/15/2019, 7:02:49 PM<br><strong>UnmergedRevision</strong>: [be3c2cd51e0ea10cfda022a7b29e3b7eab1e15fd](https://github.com/hyperledger-gerrit-archive/fabric/commit/be3c2cd51e0ea10cfda022a7b29e3b7eab1e15fd)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/15/2019, 7:15:29 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/15/2019, 7:15:29 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/15/2019, 7:54:12 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/15/2019, 7:42:30 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L90](https://github.com/hyperledger-gerrit-archive/fabric/blob/be3c2cd51e0ea10cfda022a7b29e3b7eab1e15fd/core/chaincode/lifecycle/event_broker.go#L90)<br><strong>Comment</strong>: <pre>Why do we return here? And if we have to, why don't we return on line 48?</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L90](https://github.com/hyperledger-gerrit-archive/fabric/blob/be3c2cd51e0ea10cfda022a7b29e3b7eab1e15fd/core/chaincode/lifecycle/event_broker.go#L90)<br><strong>Comment</strong>: <pre>good catch. Fixed line 48.</pre></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Uploader</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Created</strong>: 4/16/2019, 1:28:10 PM<br><strong>UnmergedRevision</strong>: [717d27845567f8b9d3756595e1bc7a1ea27a9367](https://github.com/hyperledger-gerrit-archive/fabric/commit/717d27845567f8b9d3756595e1bc7a1ea27a9367)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/16/2019, 1:38:40 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/16/2019, 1:38:40 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/16/2019, 2:19:27 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/16/2019, 2:06:33 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Uploader</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Created</strong>: 4/17/2019, 6:54:51 PM<br><strong>UnmergedRevision</strong>: [80c331178296c274af320a5346585265c4135625](https://github.com/hyperledger-gerrit-archive/fabric/commit/80c331178296c274af320a5346585265c4135625)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/17/2019, 10:02:20 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/17/2019, 10:02:20 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/17/2019, 10:44:25 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/17/2019, 10:34:36 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 5</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Uploader</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>Created</strong>: 4/18/2019, 2:41:48 PM<br><strong>UnmergedRevision</strong>: [46bd85af663790f814b3b3927b2bd29933597fcc](https://github.com/hyperledger-gerrit-archive/fabric/commit/46bd85af663790f814b3b3927b2bd29933597fcc)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/17/2019, 10:02:20 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/17/2019, 10:02:20 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/17/2019, 10:44:25 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/17/2019, 10:34:36 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 6</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Uploader</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Created</strong>: 4/29/2019, 11:24:57 PM<br><strong>UnmergedRevision</strong>: [856f9b16bc541cfcdae96710dcc0af12ba404600](https://github.com/hyperledger-gerrit-archive/fabric/commit/856f9b16bc541cfcdae96710dcc0af12ba404600)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/17/2019, 10:02:20 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/17/2019, 10:02:20 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/17/2019, 10:44:25 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/17/2019, 10:34:36 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Approved</strong>: 5/1/2019, 5:57:54 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/cache.go#L423](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/cache.go#L423)<br><strong>Comment</strong>: <pre>everything else in here has godoc. why not this?</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/cache.go#L423](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/cache.go#L423)<br><strong>Comment</strong>: <pre>Ack</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/cache_test.go#L224](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/cache_test.go#L224)<br><strong>Comment</strong>: <pre>Why did you move all of this logic into a function? If you only did it to prevent repeating it, move it to the top level before each - you'll get rid of the duplicate vars as well.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/cache_test.go#L224](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/cache_test.go#L224)<br><strong>Comment</strong>: <pre>done</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/cache_test.go#L584](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/cache_test.go#L584)<br><strong>Comment</strong>: <pre>What does this mean? You have a separate file and test for EventBroker.

What is this testing?</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/cache_test.go#L584](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/cache_test.go#L584)<br><strong>Comment</strong>: <pre>This tests that the when functions on cache are invoked the events are pushed to eventbroker (which in turn emits to listeners). The tests in a separate file tests more exhaustive cases which includes error conditions as well</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/cache_test.go#L590](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/cache_test.go#L590)<br><strong>Comment</strong>: <pre>blank lines separate blocks - this basic comment applies almost everywhere.

vertical space is used to help humans read flow</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/cache_test.go#L590](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/cache_test.go#L590)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/cache_test.go#L594](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/cache_test.go#L594)<br><strong>Comment</strong>: <pre>trailing blank that should go away</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/cache_test.go#L594](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/cache_test.go#L594)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/cache_test.go#L667](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/cache_test.go#L667)<br><strong>Comment</strong>: <pre>you don't need functions on by's - they complicate the flow for no good reason. By exists to do one thing: Log a STEP in the test output

here and elsewhere</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/cache_test.go#L667](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/cache_test.go#L667)<br><strong>Comment</strong>: <pre>Done - changes this to nested 'Context'.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L11](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/event_broker.go#L11)<br><strong>Comment</strong>: <pre>this isn't a very meaningful name...</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L11](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/event_broker.go#L11)<br><strong>Comment</strong>: <pre>was not my invention... copy pasted imports from other file. changed in other file as well</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L11](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/event_broker.go#L11)<br><strong>Comment</strong>: <pre>For what's worth, Matt, there was a CR to rename the directory and the package name which was ignored, and eventually abandoned. I'm talking about https://gerrit.hyperledger.org/r/#/c/30136/</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L23](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/event_broker.go#L23)<br><strong>Comment</strong>: <pre>this appears to serialize listeners so should be grouped with listeners and placed before it</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L23](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/event_broker.go#L23)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L34](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/event_broker.go#L34)<br><strong>Comment</strong>: <pre>constructor would be unnecessary if the map were created on registration if nil (with lock held) and the sync map were a value in the struct like sync.Mutex. 

"make the zero value useful"</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L34](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/event_broker.go#L34)<br><strong>Comment</strong>: <pre>I prefer initializing things before start using as opposed to checking nil and initializing in functions</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L44](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/event_broker.go#L44)<br><strong>Comment</strong>: <pre>This is called a "broker" and the method is named "ProcessXXX" but it seems the broker is really an emitter and we're not processing an event but emitting it.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L44](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/event_broker.go#L44)<br><strong>Comment</strong>: <pre>this is not emit of event that is happening in this line. The emit happens at line 62 below. 

The minimal processing that takes places on install of a chaincode is 
- To load the index specs from package (which is happening in this line)
- To check on which channel(s) the chaincode is defined/approved (and hence this event makes those invokable)

and finally emit the event for those channels.

Since the processing is so minimal (like predicate based filtering in a broker), I kept the name EventBroker. But I am not married to this name and am open to change if you have a better suggestion.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L59](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/event_broker.go#L59)<br><strong>Comment</strong>: <pre>I'm not sure this field is guaranteed to be unique for every package</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L59](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/event_broker.go#L59)<br><strong>Comment</strong>: <pre>In fact, this field is meaningless in new lifecycle. So, I just used this to populate this for the time being. Finally, this will be gone with the removal of lscc.

Later, I noticed `name:version` being used for this field elsewhere https://github.com/hyperledger/fabric/blob/892d4e6e86c59c375d33e8d9483925870a5462c2/core/chaincode/lifecycle/deployedcc_infoprovider.go#L101

I can use the same here. wdyt?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L59](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/event_broker.go#L59)<br><strong>Comment</strong>: <pre>It depends on what the listeners are doing with this piece of information. If nothing, then we should just leave it blank (and/or remove it). If it's used and uniqueness is required, then the PackageID field of the InstallInfo struct seems better suited. That said, if you think that name:version is appropriate, sure, let's go with it.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L59](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/event_broker.go#L59)<br><strong>Comment</strong>: <pre>As I mentioned before, this is just a space filler for now and client does not uses this. However, changes this to PackageID for better showing similarity with legacy code.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L59](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/event_broker.go#L59)<br><strong>Comment</strong>: <pre>Thanks! Done</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L82](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/event_broker.go#L82)<br><strong>Comment</strong>: <pre>please use Debugw if debug is needed since you're dumping key/value pairs</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L82](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/event_broker.go#L82)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L137](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/event_broker.go#L137)<br><strong>Comment</strong>: <pre>we're logging the error message but not the stack or details. Is that what we want?</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L137](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/event_broker.go#L137)<br><strong>Comment</strong>: <pre>Good catch - thx.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L163](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/event_broker.go#L163)<br><strong>Comment</strong>: <pre>invoke --> invokable, right?</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L163](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/event_broker.go#L163)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker_test.go#L18](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/event_broker_test.go#L18)<br><strong>Comment</strong>: <pre>dot imports should be used very sparingly. While the template generates a dot import for the package under test, they shouldn't be used.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker_test.go#L18](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/event_broker_test.go#L18)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker_test.go#L50](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/event_broker_test.go#L50)<br><strong>Comment</strong>: <pre>Why aren't there any happy-path assertions based on the top level setup?</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker_test.go#L50](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/event_broker_test.go#L50)<br><strong>Comment</strong>: <pre>look at line 127 (if that's what you mean by happy-path)</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker_test.go#L51](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/event_broker_test.go#L51)<br><strong>Comment</strong>: <pre>This string is not structured as a context.  This string should be a description of the condition.

    When("the foo does the bar")
or
    Context("when the foo does the bar")

This is true of all contexts</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker_test.go#L51](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/event_broker_test.go#L51)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker_test.go#L55](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/event_broker_test.go#L55)<br><strong>Comment</strong>: <pre>should be blank lines between BeforeEach and It. The vertical separation helps with readability.

This true of all of the assertions</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker_test.go#L65](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/event_broker_test.go#L65)<br><strong>Comment</strong>: <pre>why is this setup repeated so frequently? Why isn't it in the top level BeforeEach?</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker_test.go#L65](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/event_broker_test.go#L65)<br><strong>Comment</strong>: <pre>Because this is not set/ set differently for all the scenarios.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker_test.go#L144](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/event_broker_test.go#L144)<br><strong>Comment</strong>: <pre>this is not English: "it calling process approve or define event should invoke listener"

It's also hard to understand what It is because the "it" is the closest describe</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker_test.go#L144](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/event_broker_test.go#L144)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker_test.go#L156](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/event_broker_test.go#L156)<br><strong>Comment</strong>: <pre>does or does not</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker_test.go#L156](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/event_broker_test.go#L156)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker_test.go#L169](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/event_broker_test.go#L169)<br><strong>Comment</strong>: <pre>it does or does not; should is wishy-washy</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker_test.go#L169](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/event_broker_test.go#L169)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker_test.go#L178](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/event_broker_test.go#L178)<br><strong>Comment</strong>: <pre>this is either

  Context("when a listener returns an error")
or
  When("a listener returns an error")

Similar comments elsewhere</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker_test.go#L178](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/event_broker_test.go#L178)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker_test.go#L182](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/event_broker_test.go#L182)<br><strong>Comment</strong>: <pre>it does or does not</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker_test.go#L182](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/chaincode/lifecycle/event_broker_test.go#L182)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/ledger_interface.go#L588](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/ledger/ledger_interface.go#L588)<br><strong>Comment</strong>: <pre>Why are we doin this in a way that we can't evolve? This should accept a value object - a struct with fields. Fields can be added without breaking callers but method signatures like this cannot.

We should try to think about how this stuff evolves.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/ledger_interface.go#L588](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/ledger/ledger_interface.go#L588)<br><strong>Comment</strong>: <pre>It is clearly mentioned in the comment above that this is not a new interface. Listeners already exists for legacy lscc code that implement this function and that we do not want to change much since lscc related code is a throwaway in near future.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/ledger_interface.go#L592](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/ledger/ledger_interface.go#L592)<br><strong>Comment</strong>: <pre>It's really weird to me to have a callback like this with no context. That means there's no way to have a singleton listener that handles multiple events, right?</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/ledger_interface.go#L592](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/ledger/ledger_interface.go#L592)<br><strong>Comment</strong>: <pre>Where is this used? It's not in this package...</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/ledger_interface.go#L592](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/ledger/ledger_interface.go#L592)<br><strong>Comment</strong>: <pre>I had defined the legacy interface in the package ledger/cceventmgmt (which emits events for lscc commits/install). Clearly, I have no reason for this interface not be defined in core/chaincode/lifecycle package (which is the event emitter for new lifecycle). However, that package uses legder package and hence causes a cyclic dependency does not seem easy to fix without major change in the intialization of different components. If you look at the next CR in the stack, you may get some hint.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/ledger_interface.go#L592](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/ledger/ledger_interface.go#L592)<br><strong>Comment</strong>: <pre>Context is implicit here. The events are per block commit / per install. Both block commit and install are serialized so there aren't parallel events.

Some background - This function was added later when service discovery started using this mechanism. Earlier when this was being used for index creation, this callback was not needed.</pre><strong>Commenter</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>CommentLine</strong>: [core/ledger/ledger_interface.go#L612](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/ledger/ledger_interface.go#L612)<br><strong>Comment</strong>: <pre>mocks are like interfaces - they should be generated in the package that uses them.

this package does not use it.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/ledger/ledger_interface.go#L612](https://github.com/hyperledger-gerrit-archive/fabric/blob/856f9b16bc541cfcdae96710dcc0af12ba404600/core/ledger/ledger_interface.go#L612)<br><strong>Comment</strong>: <pre>The above interface is kept here for the reasons explained. I kept the mock near the interface. However, if alone moving the mock is preferred, I am open for that</pre></blockquote><h3>PatchSet Number: 7</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Uploader</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Created</strong>: 5/2/2019, 11:53:54 PM<br><strong>UnmergedRevision</strong>: [cb8e37132f3bccd33931aeeb74d6b365146efea8](https://github.com/hyperledger-gerrit-archive/fabric/commit/cb8e37132f3bccd33931aeeb74d6b365146efea8)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/3/2019, 12:02:26 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/3/2019, 12:02:26 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/3/2019, 12:43:13 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/3/2019, 12:34:05 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Approved</strong>: 5/7/2019, 10:57:24 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Approved</strong>: 5/6/2019, 11:43:52 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/cache_test.go#L713](https://github.com/hyperledger-gerrit-archive/fabric/blob/cb8e37132f3bccd33931aeeb74d6b365146efea8/core/chaincode/lifecycle/cache_test.go#L713)<br><strong>Comment</strong>: <pre>There are scenarios for installing then defining, and defining then installing. How about approving? Don't we need scenarios for approve before defining on channel, and approve after defining on channel?</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/cache_test.go#L713](https://github.com/hyperledger-gerrit-archive/fabric/blob/cb8e37132f3bccd33931aeeb74d6b365146efea8/core/chaincode/lifecycle/cache_test.go#L713)<br><strong>Comment</strong>: <pre>This is a tricky one. From a high level look of the tests in this file, you may get a feel that they are testing the external behavior (since the tests in this file are defined in "lifecycle_test" package). However, that illusion should go away the moment you look at how internal structures are initialized in the first "BeforeEach" in this file. The existing tests in this file are mainly internal unit tests that serve the purpose of code coverage.

While adding these new tests, I was in dilemma whether 
(1) To continue with the practice in this file which would mean that I define EventBroker as an interface and a corresponding mock and just test that the mock receive events upon calling "HandleStateUpdates" and "HandleInstall" while populating other internal structures manually 

(2) Or follow more of a practice of what would be more meaningful for _test file. Which is not possible at the level of cache tests

In the above dilemma, I ended up tilting towards (2) in the style of writing these tests that may have given you that feel. I'll try to fix some descriptions and/or some internal settings that may give you a feel of an approve followed by a define being test.

Meanwhile, any more suggestion/preference for in favor of  (1) or (2) is welcome</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/cache_test.go#L713](https://github.com/hyperledger-gerrit-archive/fabric/blob/cb8e37132f3bccd33931aeeb74d6b365146efea8/core/chaincode/lifecycle/cache_test.go#L713)<br><strong>Comment</strong>: <pre>I think we need a test that does 1) Install, 2) Approve, 3) Define; and another test that does 1) Install, 2) Define, 3) Approve.

Verify that the 2nd step of each test did not call event broker / listener, and that the 3rd step does call event broker / listener (since at that point all three conditions will have been met - installed, approved, defined).

I believe this would require calling HandleStateUpdates() twice per test, once with state updates that look like an Approve, and once with state updates that look like a Define.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/cache_test.go#L713](https://github.com/hyperledger-gerrit-archive/fabric/blob/cb8e37132f3bccd33931aeeb74d6b365146efea8/core/chaincode/lifecycle/cache_test.go#L713)<br><strong>Comment</strong>: <pre>Added tests for all combinations of sequencing of approve/define/install in the latest patch</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L16](https://github.com/hyperledger-gerrit-archive/fabric/blob/cb8e37132f3bccd33931aeeb74d6b365146efea8/core/chaincode/lifecycle/event_broker.go#L16)<br><strong>Comment</strong>: <pre>ChaincodeLifecycleEventListener interface has functions HandleChaincodeDeploy() and ChaincodeDeployDone(), which I do not see implemented in EventBroker here.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L16](https://github.com/hyperledger-gerrit-archive/fabric/blob/cb8e37132f3bccd33931aeeb74d6b365146efea8/core/chaincode/lifecycle/event_broker.go#L16)<br><strong>Comment</strong>: <pre>Because EventBroker is not a ChaincodeLifecycleEventListener. It rather is an enabler for registering a ChaincodeLifecycleEventListener with and invoking functions on those</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L16](https://github.com/hyperledger-gerrit-archive/fabric/blob/cb8e37132f3bccd33931aeeb74d6b365146efea8/core/chaincode/lifecycle/event_broker.go#L16)<br><strong>Comment</strong>: <pre>Right, I came to that understanding when looking at the code. I'm suggesting that the existing comment is misleading. If you add the content of your response here into the comment it will be very clear.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L16](https://github.com/hyperledger-gerrit-archive/fabric/blob/cb8e37132f3bccd33931aeeb74d6b365146efea8/core/chaincode/lifecycle/event_broker.go#L16)<br><strong>Comment</strong>: <pre>Ah, got your confusion now. Fixed the outdated comment</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L44](https://github.com/hyperledger-gerrit-archive/fabric/blob/cb8e37132f3bccd33931aeeb74d6b365146efea8/core/chaincode/lifecycle/event_broker.go#L44)<br><strong>Comment</strong>: <pre>I read the comment that this is not truly an exported function, but still a function comment would be very useful here.

Same for the other 'major' functions below.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L44](https://github.com/hyperledger-gerrit-archive/fabric/blob/cb8e37132f3bccd33931aeeb74d6b365146efea8/core/chaincode/lifecycle/event_broker.go#L44)<br><strong>Comment</strong>: <pre>Sure will do that</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L84](https://github.com/hyperledger-gerrit-archive/fabric/blob/cb8e37132f3bccd33931aeeb74d6b365146efea8/core/chaincode/lifecycle/event_broker.go#L84)<br><strong>Comment</strong>: <pre>In my own end2end trial, I did an approve and then a define (commit). I only saw this debug message upon define (commit), not upon approve. That got me concerned we may be missing the approve event.

I also logged a similar comment in the test file, that we likely need a test for approve then define, vs define then approve.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L84](https://github.com/hyperledger-gerrit-archive/fabric/blob/cb8e37132f3bccd33931aeeb74d6b365146efea8/core/chaincode/lifecycle/event_broker.go#L84)<br><strong>Comment</strong>: <pre>This function gets invoked only when both approve and define are true. The final event will trigger this.</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L84](https://github.com/hyperledger-gerrit-archive/fabric/blob/cb8e37132f3bccd33931aeeb74d6b365146efea8/core/chaincode/lifecycle/event_broker.go#L84)<br><strong>Comment</strong>: <pre>Ok, this was not clear upon initial code review. These types of assumptions would make sense to put into function level comment.</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L84](https://github.com/hyperledger-gerrit-archive/fabric/blob/cb8e37132f3bccd33931aeeb74d6b365146efea8/core/chaincode/lifecycle/event_broker.go#L84)<br><strong>Comment</strong>: <pre>Maybe calling the function ProcessApprovedAndDefinedEvent() would make it more clear that both conditions have to be true before the event is fired.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L84](https://github.com/hyperledger-gerrit-archive/fabric/blob/cb8e37132f3bccd33931aeeb74d6b365146efea8/core/chaincode/lifecycle/event_broker.go#L84)<br><strong>Comment</strong>: <pre>At the level of event broker, the code is more flexible and even if this function is invoked for approve (without define or vice-versa) - things should work fine. This is also reflected in the associated tests. Added comments in the latest patch to clarify this further</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L165](https://github.com/hyperledger-gerrit-archive/fabric/blob/cb8e37132f3bccd33931aeeb74d6b365146efea8/core/chaincode/lifecycle/event_broker.go#L165)<br><strong>Comment</strong>: <pre>Comment would help... does this mean the chaincode is approved AND installed AND defined on the channel?</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/event_broker.go#L165](https://github.com/hyperledger-gerrit-archive/fabric/blob/cb8e37132f3bccd33931aeeb74d6b365146efea8/core/chaincode/lifecycle/event_broker.go#L165)<br><strong>Comment</strong>: <pre>Sure</pre></blockquote><h3>PatchSet Number: 8</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Uploader</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Created</strong>: 5/16/2019, 11:32:13 PM<br><strong>UnmergedRevision</strong>: [e3ea6c52004fefc0eb3507f58794bbf6c6faa02a](https://github.com/hyperledger-gerrit-archive/fabric/commit/e3ea6c52004fefc0eb3507f58794bbf6c6faa02a)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/16/2019, 11:34:31 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 9</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Uploader</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Created</strong>: 5/16/2019, 11:33:27 PM<br><strong>UnmergedRevision</strong>: [7a54e6871823b3a08e951d2e2c6bf94e222659aa](https://github.com/hyperledger-gerrit-archive/fabric/commit/7a54e6871823b3a08e951d2e2c6bf94e222659aa)<br><br></blockquote><h3>PatchSet Number: 10</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Uploader</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Created</strong>: 5/16/2019, 11:46:00 PM<br><strong>UnmergedRevision</strong>: [fe1ba4d6c9f26aba54abda4ab5e7f53c73a86420](https://github.com/hyperledger-gerrit-archive/fabric/commit/fe1ba4d6c9f26aba54abda4ab5e7f53c73a86420)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/16/2019, 11:49:42 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 11</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Uploader</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Created</strong>: 5/16/2019, 11:48:20 PM<br><strong>UnmergedRevision</strong>: [14a779ad77c088dfb5ab675df6291756b7c1023a](https://github.com/hyperledger-gerrit-archive/fabric/commit/14a779ad77c088dfb5ab675df6291756b7c1023a)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/16/2019, 11:55:08 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Will Lahti - wtlahti@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/cache_test.go#L748](https://github.com/hyperledger-gerrit-archive/fabric/blob/14a779ad77c088dfb5ab675df6291756b7c1023a/core/chaincode/lifecycle/cache_test.go#L748)<br><strong>Comment</strong>: <pre>nit: receive

Here and elsewhere in the file.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/lifecycle/cache_test.go#L748](https://github.com/hyperledger-gerrit-archive/fabric/blob/14a779ad77c088dfb5ab675df6291756b7c1023a/core/chaincode/lifecycle/cache_test.go#L748)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 12</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Uploader</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Created</strong>: 5/17/2019, 9:49:34 AM<br><strong>GitHubMergedRevision</strong>: [c79ceef5ec12c04758ba629d08cb678aa9ee7ebf](https://github.com/hyperledger-gerrit-archive/fabric/commit/c79ceef5ec12c04758ba629d08cb678aa9ee7ebf)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/17/2019, 9:54:24 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/17/2019, 9:54:24 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/17/2019, 10:31:36 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/17/2019, 10:23:08 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Approved</strong>: 5/18/2019, 4:43:33 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Approved</strong>: 5/18/2019, 10:39:26 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: David Enyeart<br><strong>Merged</strong>: 5/18/2019, 10:39:28 AM<br><br></blockquote>