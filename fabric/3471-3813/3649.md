<strong>Project</strong>: fabric<br><strong>Branch</strong>: master<br><strong>ID</strong>: 3649<br><strong>Subject</strong>: FAB-1257 Removal of Table API<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 1/4/2017, 10:08:33 AM<br><strong>LastUpdated</strong>: 1/17/2017, 12:09:35 AM<br><strong>CommitMessage</strong>:<br><pre>FAB-1257 Removal of Table API

Removed Table API for the following reasons
 * The v0.5/v0.6 Pseedo-table API does not map well to current or next
   generation Fabric capabilities
 * Project teams have been confused and frustrated with table API
   limitations

Encourage all new chaincode to use JSON-based data structures

Change-Id: I3f01177e98b2dc40d6a00815ad9000132f9d9591
Signed-off-by: senthil <cendhu@gmail.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 1/4/2017, 10:08:33 AM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/4/2017, 10:12:22 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/4618/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/4/2017, 12:28:47 PM<br><strong>Message</strong>: <pre>Patch Set 1: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/4618/ : FAILURE</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 1/5/2017, 4:30:25 AM<br><strong>Message</strong>: <pre>Uploaded patch set 2.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/5/2017, 4:34:00 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/4656/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/5/2017, 5:12:05 AM<br><strong>Message</strong>: <pre>Patch Set 2: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/4656/ : SUCCESS</pre><strong>Reviewer</strong>: Srinivasan Muralidharan - srinivasan.muralidharan99@gmail.com<br><strong>Reviewed</strong>: 1/5/2017, 5:45:14 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Adding victor as he contributed and reworked the table test area with https://gerrit.hyperledger.org/r/#/c/3187.</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 1/6/2017, 2:36:35 PM<br><strong>Message</strong>: <pre>Patch Set 2: Code-Review-1

(2 comments)</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 1/6/2017, 10:00:46 PM<br><strong>Message</strong>: <pre>Patch Set 2:

> (2 comments)

I agree for "1" instead of "/". I added "/" because a commit by Victor Dods (https://gerrit.hyperledger.org/r/#/c/3187/ ) used this.

With respect to createCompositeKey() as utility function: Still the chaincode can use this utility. In V0.6, one of the util function is needed by the chaincode to construct function argument (which is given below):

 import "github.com/hyperledger/fabric/core/util"
 args := util.ToChaincodeArgs(string1, srting2, string3)  //variable number of arguments
 invokeRes, err := stub.InvokeChaincode(chaincodename, args) 

If it still needs to be moved from utility, please let me know.</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 1/7/2017, 11:47:11 AM<br><strong>Message</strong>: <pre>Patch Set 2:

I do think that CreateCompositeKey() should be implemented in the same place as PartialCompositeKeyQuery(), to make it obvious for developers to know that they are used in tandem.</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 1/8/2017, 6:05:43 AM<br><strong>Message</strong>: <pre>Patch Set 2:

> I do think that CreateCompositeKey() should be implemented in the
 > same place as PartialCompositeKeyQuery(), to make it obvious for
 > developers to know that they are used in tandem.

Agreed. Will update.</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 1/9/2017, 4:53:35 AM<br><strong>Message</strong>: <pre>Patch Set 2:

(3 comments)</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 1/9/2017, 8:28:34 AM<br><strong>Message</strong>: <pre>Patch Set 2:

(1 comment)</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 1/9/2017, 9:15:12 AM<br><strong>Message</strong>: <pre>Patch Set 2:

(1 comment)</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 1/9/2017, 10:17:18 AM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/9/2017, 10:20:56 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/4856/</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 1/9/2017, 10:21:02 AM<br><strong>Message</strong>: <pre>Uploaded patch set 4.</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 1/9/2017, 10:22:43 AM<br><strong>Message</strong>: <pre>Patch Set 4:

(1 comment)</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 1/9/2017, 10:23:23 AM<br><strong>Message</strong>: <pre>Uploaded patch set 5.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/9/2017, 10:24:18 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/4857/</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 1/9/2017, 10:24:27 AM<br><strong>Message</strong>: <pre>Patch Set 5:

> (3 comments)

Added the suggested comment.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/9/2017, 10:27:17 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/4858/</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 1/9/2017, 10:28:51 AM<br><strong>Message</strong>: <pre>Patch Set 5:

> (1 comment)

We do have one other problem. The iter returned by PartialCompositeKeyQuery() (from RangeQueryState()) contains keys preceded with length. However, the user would have expected a different key set. 

Do we need to parse the key and remove the length before returning the iter to chaincode?</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/9/2017, 11:00:15 AM<br><strong>Message</strong>: <pre>Patch Set 4: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/4857/ : SUCCESS</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/9/2017, 11:01:18 AM<br><strong>Message</strong>: <pre>Patch Set 5: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/4858/ : FAILURE</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/9/2017, 11:20:42 AM<br><strong>Message</strong>: <pre>Patch Set 3: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/4856/ : FAILURE</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 1/9/2017, 12:03:32 PM<br><strong>Message</strong>: <pre>Patch Set 5:

reverify</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 1/9/2017, 12:05:50 PM<br><strong>Message</strong>: <pre>Patch Set 5: Code-Review+1

As discussed in scrum call, we should enhance this so that the resulting keys are parsable, but that can be done in a subsequent change set.  I will +1 this changeset and I have submitted a reverify in hopes that the next verification will pass.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/9/2017, 12:06:49 PM<br><strong>Message</strong>: <pre>Patch Set 5: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/4865/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/9/2017, 12:48:26 PM<br><strong>Message</strong>: <pre>Patch Set 5: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/4865/ : SUCCESS</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 1/10/2017, 12:38:09 PM<br><strong>Message</strong>: <pre>Uploaded patch set 6.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/10/2017, 12:42:58 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/4943/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/10/2017, 2:17:13 PM<br><strong>Message</strong>: <pre>Patch Set 6: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/4943/ : FAILURE</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 1/11/2017, 12:49:04 AM<br><strong>Message</strong>: <pre>Patch Set 6:

reverify</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/11/2017, 12:53:32 AM<br><strong>Message</strong>: <pre>Patch Set 6: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/4989/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/11/2017, 1:29:48 AM<br><strong>Message</strong>: <pre>Patch Set 6: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/4989/ : SUCCESS</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 1/11/2017, 7:25:00 AM<br><strong>Message</strong>: <pre>Patch Set 6: Code-Review+1</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 1/13/2017, 1:09:55 AM<br><strong>Message</strong>: <pre>Uploaded patch set 7: Patch Set 6 was rebased.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/13/2017, 1:11:34 AM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5105/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/13/2017, 1:46:34 AM<br><strong>Message</strong>: <pre>Patch Set 7: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5105/ : SUCCESS</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 1/14/2017, 8:10:02 AM<br><strong>Message</strong>: <pre>Patch Set 7:

We need to make this move as soon as possible.  Dave / Manish are you good with this changeset?</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 1/14/2017, 8:55:52 AM<br><strong>Message</strong>: <pre>Patch Set 7: Code-Review+1</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 1/14/2017, 9:11:35 AM<br><strong>Message</strong>: <pre>Patch Set 7:

(5 comments)

I'm OK with code changes point of view. But not sure about the deletion of tests/examples without having equivalent ones for the new functions. Shall we wait for Murali's decision on this aspect?</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 1/15/2017, 10:19:42 AM<br><strong>Message</strong>: <pre>Uploaded patch set 8.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/15/2017, 10:22:11 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5199/</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 1/15/2017, 10:22:18 AM<br><strong>Message</strong>: <pre>Patch Set 8:

> (5 comments)
 > 
 > I'm OK with code changes point of view. But not sure about the
 > deletion of tests/examples without having equivalent ones for the
 > new functions. Shall we wait for Murali's decision on this aspect?

Examples can be added via separate change set. Current examples such as "asset_management", "asset_management02" and "asset_management_with_roles" use only one key per table (no composite keys). Hence, we need to remove these example and introduce a new set of examples. Applicable for TableExample.java as well.</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 1/15/2017, 10:28:10 AM<br><strong>Message</strong>: <pre>Patch Set 8:

(4 comments)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/15/2017, 10:59:34 AM<br><strong>Message</strong>: <pre>Patch Set 8: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-x86_64/5199/ : SUCCESS</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 1/15/2017, 1:00:35 PM<br><strong>Message</strong>: <pre>Patch Set 8:

(6 comments)</pre><strong>Reviewer</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Reviewed</strong>: 1/15/2017, 1:32:55 PM<br><strong>Message</strong>: <pre>Patch Set 8:

(3 comments)</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 1/16/2017, 12:02:13 AM<br><strong>Message</strong>: <pre>Patch Set 8: Code-Review+1

I guess, we need to rethink the way we should expose mockstub. As of now, it kind of re-implements the query logic which could easily diverge from actual query processing logic. May be the query code from ledger should be shared for this purpose. Since, this is beyond the scope of this change-set. I guess, we should merge this as is and file a Jira for the above.</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 1/16/2017, 4:49:56 AM<br><strong>Message</strong>: <pre>Patch Set 8:

> I guess, we need to rethink the way we should expose mockstub. As
 > of now, it kind of re-implements the query logic which could easily
 > diverge from actual query processing logic. May be the query code
 > from ledger should be shared for this purpose. Since, this is
 > beyond the scope of this change-set. I guess, we should merge this
 > as is and file a Jira for the above.

Sounds reasonable.  If you have some ideas on how to handle the "mock" please do create a JIRA</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 1/16/2017, 4:50:05 AM<br><strong>Message</strong>: <pre>Patch Set 8: Code-Review+2</pre><strong>Reviewer</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Reviewed</strong>: 1/16/2017, 6:55:19 AM<br><strong>Message</strong>: <pre>Patch Set 8: Code-Review+1

(1 comment)</pre><strong>Reviewer</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>Reviewed</strong>: 1/16/2017, 11:28:28 PM<br><strong>Message</strong>: <pre>Patch Set 8: Code-Review+2</pre><strong>Reviewer</strong>: Gerrit Code Review - gerrit@hyperledger.org<br><strong>Reviewed</strong>: 1/16/2017, 11:28:31 PM<br><strong>Message</strong>: <pre>Change has been successfully merged by Binh Nguyen</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/16/2017, 11:31:23 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-x86_64/771/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/17/2017, 12:09:35 AM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-merge-x86_64/771/ : SUCCESS</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Uploader</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Created</strong>: 1/4/2017, 10:08:33 AM<br><strong>UnmergedRevision</strong>: [df78a24fc5404eaa25bebc8520e70de64679be39](https://github.com/hyperledger-gerrit-archive/fabric/commit/df78a24fc5404eaa25bebc8520e70de64679be39)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/4/2017, 12:28:47 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Uploader</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Created</strong>: 1/5/2017, 4:30:25 AM<br><strong>UnmergedRevision</strong>: [fbdadf864a8ce9425356d92a72759460a3073636](https://github.com/hyperledger-gerrit-archive/fabric/commit/fbdadf864a8ce9425356d92a72759460a3073636)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/5/2017, 5:12:05 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Approved</strong>: 1/6/2017, 2:36:35 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/shim/chaincode.go#L374](https://github.com/hyperledger-gerrit-archive/fabric/blob/fbdadf864a8ce9425356d92a72759460a3073636/core/chaincode/shim/chaincode.go#L374)<br><strong>Comment</strong>: <pre>I would query from "1" to ":" instead of "/" to ":". This will keep the tightest possible range, and is consistent with the old table getRows() impl.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/shim/chaincode.go#L374](https://github.com/hyperledger-gerrit-archive/fabric/blob/fbdadf864a8ce9425356d92a72759460a3073636/core/chaincode/shim/chaincode.go#L374)<br><strong>Comment</strong>: <pre>Senthil - in the Victor Dod's change-set (https://gerrit.hyperledger.org/r/#/c/3187/), he used the range "/" to ":" and always appended a '0' at the end of composite key to handle a special case - someone invoking GetRows API with all the keys. 

Here, in this API, we can add a comment that this API should be used only for 'partial keys' and for full keys always use the 'CreateCompositeKey' API.</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/shim/chaincode.go#L374](https://github.com/hyperledger-gerrit-archive/fabric/blob/fbdadf864a8ce9425356d92a72759460a3073636/core/chaincode/shim/chaincode.go#L374)<br><strong>Comment</strong>: <pre>I thought of a potential issue.  The keys are separated with integer length, and therefore the partial key query from "1" to ":" will typically work.  However how about the scenario where a key has a number in it?  Couldn't this cause a problem.

Consider two keys:
FOO
FOO5

If we wanted to query for all composites starting with key FOO, we would construct a range query from "FOO1" to "FOO:".   However this would also pick up the FOO5 keys, which we did not intend.  I believe this same issue is in 0.6.

This could be resolved the same way we resolve composite chaincode:key, that is, add the null character between the composite keys, instead of an integer length, since it is highly unlikely for a customer key to contain null character.  We'd have to test that key range queries on LevelDB and CouchDB work with null character separators. Or we may want to choose a character that is not already used as the chaincode separator. Thoughts?</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/shim/chaincode.go#L374](https://github.com/hyperledger-gerrit-archive/fabric/blob/fbdadf864a8ce9425356d92a72759460a3073636/core/chaincode/shim/chaincode.go#L374)<br><strong>Comment</strong>: <pre>"However this would also pick up the FOO5 keys" - the prefix for this key would be 4 while for FOO it would be 3. So, it is fine... Though, I am not a fan of string based length encoding but this problem should not occur.</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/shim/chaincode.go#L374](https://github.com/hyperledger-gerrit-archive/fabric/blob/fbdadf864a8ce9425356d92a72759460a3073636/core/chaincode/shim/chaincode.go#L374)<br><strong>Comment</strong>: <pre>Ah, I see.  So the range query will actually be from "3FOO1" to "3FOO:", and therefore we will only pick up FOO key. Got it.</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/shim/chaincode.go#L380](https://github.com/hyperledger-gerrit-archive/fabric/blob/fbdadf864a8ce9425356d92a72759460a3073636/core/chaincode/shim/chaincode.go#L380)<br><strong>Comment</strong>: <pre>I was expecting CreateCompositeKey() to be a chaincode function in here, rather than in a utility, so that chaincode authors can CreateCompositeKey() in one tran when saving a record, and then PartialCompositeKeyQuery() in a later tran to query records.   Although chaincode authors wouldn't have to use CreateCompositeKey(), it is a good practice to ensure that the composite key is constructed in a way that guarantees that the partial key query will work.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/shim/interfaces.go#L73](https://github.com/hyperledger-gerrit-archive/fabric/blob/fbdadf864a8ce9425356d92a72759460a3073636/core/chaincode/shim/interfaces.go#L73)<br><strong>Comment</strong>: <pre>You added a TODO comment to defer comment :-)
I guess, we should not defer the comments at the minimum.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/shim/java/src/main/java/org/hyperledger/java/shim/ChaincodeStub.java#L24](https://github.com/hyperledger-gerrit-archive/fabric/blob/fbdadf864a8ce9425356d92a72759460a3073636/core/chaincode/shim/java/src/main/java/org/hyperledger/java/shim/ChaincodeStub.java#L24)<br><strong>Comment</strong>: <pre>better to delete the commented imports</pre></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Uploader</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Created</strong>: 1/9/2017, 10:17:18 AM<br><strong>UnmergedRevision</strong>: [4f5bfafc717690c08705e81945151bc2a475a628](https://github.com/hyperledger-gerrit-archive/fabric/commit/4f5bfafc717690c08705e81945151bc2a475a628)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/9/2017, 11:20:42 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Uploader</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Created</strong>: 1/9/2017, 10:21:02 AM<br><strong>UnmergedRevision</strong>: [895e7aa9653b0bca471b1244dec65aae9f7ee238](https://github.com/hyperledger-gerrit-archive/fabric/commit/895e7aa9653b0bca471b1244dec65aae9f7ee238)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/9/2017, 11:00:15 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 5</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Uploader</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Created</strong>: 1/9/2017, 10:23:23 AM<br><strong>UnmergedRevision</strong>: [8efce40ab283158e0d4c3554c86bc05fe1ec14f6](https://github.com/hyperledger-gerrit-archive/fabric/commit/8efce40ab283158e0d4c3554c86bc05fe1ec14f6)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/9/2017, 12:48:26 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Approved</strong>: 1/9/2017, 12:05:50 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 6</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Uploader</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Created</strong>: 1/10/2017, 12:38:09 PM<br><strong>UnmergedRevision</strong>: [538f687dceb2e92777cc9154a5afb3763bc301d5](https://github.com/hyperledger-gerrit-archive/fabric/commit/538f687dceb2e92777cc9154a5afb3763bc301d5)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/11/2017, 1:29:48 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Approved</strong>: 1/11/2017, 7:25:00 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 7</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Uploader</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Created</strong>: 1/13/2017, 1:09:55 AM<br><strong>UnmergedRevision</strong>: [7cd77cf5959bd70590be26756c376db1c10ec3f8](https://github.com/hyperledger-gerrit-archive/fabric/commit/7cd77cf5959bd70590be26756c376db1c10ec3f8)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/13/2017, 1:46:34 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Approved</strong>: 1/14/2017, 8:55:52 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/shim/chaincode.go#L346](https://github.com/hyperledger-gerrit-archive/fabric/blob/7cd77cf5959bd70590be26756c376db1c10ec3f8/core/chaincode/shim/chaincode.go#L346)<br><strong>Comment</strong>: <pre>This should work. But is there a reason to choose '0' instead of '1'?</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/shim/chaincode.go#L346](https://github.com/hyperledger-gerrit-archive/fabric/blob/7cd77cf5959bd70590be26756c376db1c10ec3f8/core/chaincode/shim/chaincode.go#L346)<br><strong>Comment</strong>: <pre>No reason. Changed '1' to '0'.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/shim/mockstub.go#L193](https://github.com/hyperledger-gerrit-archive/fabric/blob/7cd77cf5959bd70590be26756c376db1c10ec3f8/core/chaincode/shim/mockstub.go#L193)<br><strong>Comment</strong>: <pre>Is there a reason we do not want to implement this function? If we want to defer, I suggest better to return error (e.g., "not yet implemented") as opposed to returning nil.</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/shim/mockstub.go#L193](https://github.com/hyperledger-gerrit-archive/fabric/blob/7cd77cf5959bd70590be26756c376db1c10ec3f8/core/chaincode/shim/mockstub.go#L193)<br><strong>Comment</strong>: <pre>Implemented the newly added functions in MockStub as well.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/shim/mockstub.go#L197](https://github.com/hyperledger-gerrit-archive/fabric/blob/7cd77cf5959bd70590be26756c376db1c10ec3f8/core/chaincode/shim/mockstub.go#L197)<br><strong>Comment</strong>: <pre>same comment as at line 193</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/shim/mockstub.go#L197](https://github.com/hyperledger-gerrit-archive/fabric/blob/7cd77cf5959bd70590be26756c376db1c10ec3f8/core/chaincode/shim/mockstub.go#L197)<br><strong>Comment</strong>: <pre>Done.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/shim/mockstub.go#L290](https://github.com/hyperledger-gerrit-archive/fabric/blob/7cd77cf5959bd70590be26756c376db1c10ec3f8/core/chaincode/shim/mockstub.go#L290)<br><strong>Comment</strong>: <pre>Senthil, just a suggestion - can we retain the current logic (which appears to be simple enough) with a minor change - in the constructor of this object, you can place the initial `currentValue` to first key equals to or greater than 'startKey' (instead of `stub.Keys.Front()`) and make this condition '=>' instead of '=='. Will it to you and Murali.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/shim/mockstub.go#L312](https://github.com/hyperledger-gerrit-archive/fabric/blob/7cd77cf5959bd70590be26756c376db1c10ec3f8/core/chaincode/shim/mockstub.go#L312)<br><strong>Comment</strong>: <pre>See comment at line 290</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/shim/mockstub_test.go#L134](https://github.com/hyperledger-gerrit-archive/fabric/blob/7cd77cf5959bd70590be26756c376db1c10ec3f8/core/chaincode/shim/mockstub_test.go#L134)<br><strong>Comment</strong>: <pre>Don't we need equivalent tests for the new functions?</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/shim/mockstub_test.go#L134](https://github.com/hyperledger-gerrit-archive/fabric/blob/7cd77cf5959bd70590be26756c376db1c10ec3f8/core/chaincode/shim/mockstub_test.go#L134)<br><strong>Comment</strong>: <pre>Added.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [examples/chaincode/java/TableExample/src/main/java/example/TableExample.java#L1](https://github.com/hyperledger-gerrit-archive/fabric/blob/7cd77cf5959bd70590be26756c376db1c10ec3f8/examples/chaincode/java/TableExample/src/main/java/example/TableExample.java#L1)<br><strong>Comment</strong>: <pre>Don't we want an equivalent example that uses the new functions?</pre></blockquote><h3>PatchSet Number: 8</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Uploader</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>Created</strong>: 1/15/2017, 10:19:42 AM<br><strong>GitHubMergedRevision</strong>: [7b0aef86f061adf20479cd01ea7e44a6d2427939](https://github.com/hyperledger-gerrit-archive/fabric/commit/7b0aef86f061adf20479cd01ea7e44a6d2427939)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/15/2017, 10:59:34 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Binh Nguyen - binh1010010110@gmail.com<br><strong>Approved</strong>: 1/16/2017, 11:28:28 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Binh Nguyen<br><strong>Merged</strong>: 1/16/2017, 11:28:31 PM<br><br><strong>Approver</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Approved</strong>: 1/16/2017, 12:02:13 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Approved</strong>: 1/16/2017, 4:50:05 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>Approved</strong>: 1/16/2017, 6:55:19 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/shim/mockstub.go#L297](https://github.com/hyperledger-gerrit-archive/fabric/blob/7b0aef86f061adf20479cd01ea7e44a6d2427939/core/chaincode/shim/mockstub.go#L297)<br><strong>Comment</strong>: <pre>I guess that you changed the semantics of range. For a key equals to endKey, you would return true while the previous logic would have returned false (which was a semantics matching with range semantics in leveldb)</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/shim/mockstub.go#L297](https://github.com/hyperledger-gerrit-archive/fabric/blob/7b0aef86f061adf20479cd01ea7e44a6d2427939/core/chaincode/shim/mockstub.go#L297)<br><strong>Comment</strong>: <pre>No, I have not changed the semantic. All the following explanation refers to the old code.

Next() would return the key-value pair with key = endKey.  Line 360 (old file) iter.Current = iter.Current.Next() is called (after calling HasNext() but before processing the current value). This would ensure that the key-value with key = endKey is returned from Next(). 

I changed this logic because if the first item in the list is the startKey or greater than the startKey, Next() would skip this key-value pair. 

Further, HasNext() might return true even when no key matches (startKey, endKey) range query.

These are the main reasons for change in HasNext() and Next()</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/shim/mockstub_test.go#L28](https://github.com/hyperledger-gerrit-archive/fabric/blob/7b0aef86f061adf20479cd01ea7e44a6d2427939/core/chaincode/shim/mockstub_test.go#L28)<br><strong>Comment</strong>: <pre>Just leaving a couple of comments. Though these are not something that got added into this change-set.. but still for making a note. May be just a minor Jira item can be opened for now.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/shim/mockstub_test.go#L39](https://github.com/hyperledger-gerrit-archive/fabric/blob/7b0aef86f061adf20479cd01ea7e44a6d2427939/core/chaincode/shim/mockstub_test.go#L39)<br><strong>Comment</strong>: <pre>LevelDB (and earlier rocksDB) semantics are that the last key results are exclusive. So, in this case, the expected results would be "3" only.</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/shim/mockstub_test.go#L39](https://github.com/hyperledger-gerrit-archive/fabric/blob/7b0aef86f061adf20479cd01ea7e44a6d2427939/core/chaincode/shim/mockstub_test.go#L39)<br><strong>Comment</strong>: <pre>I can change both mockstub.go and mockstub_test.go to exclude the endKey/lastKey but the problem is with couchDB as the endKey is inclusive in its range query. 

Should we check core.yaml and perform this operation accordingly?</pre><strong>Commenter</strong>: David Enyeart - enyeart@us.ibm.com<br><strong>CommentLine</strong>: [core/chaincode/shim/mockstub_test.go#L39](https://github.com/hyperledger-gerrit-archive/fabric/blob/7b0aef86f061adf20479cd01ea7e44a6d2427939/core/chaincode/shim/mockstub_test.go#L39)<br><strong>Comment</strong>: <pre>In CouchDB there is an option to make endKey exclusive.  I made that change in https://gerrit.hyperledger.org/r/#/c/3983/ to ensure that leveldb and couchdb are consistent.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/shim/mockstub_test.go#L55](https://github.com/hyperledger-gerrit-archive/fabric/blob/7b0aef86f061adf20479cd01ea7e44a6d2427939/core/chaincode/shim/mockstub_test.go#L55)<br><strong>Comment</strong>: <pre>Better to call `rqi.Next()` again here to verify that the iterator had not got extra results.</pre><strong>Commenter</strong>: Senthilnathan N - cendhu@gmail.com<br><strong>CommentLine</strong>: [core/chaincode/shim/mockstub_test.go#L55](https://github.com/hyperledger-gerrit-archive/fabric/blob/7b0aef86f061adf20479cd01ea7e44a6d2427939/core/chaincode/shim/mockstub_test.go#L55)<br><strong>Comment</strong>: <pre>I will modify the for loop accordingly.</pre></blockquote>