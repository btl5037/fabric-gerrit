<strong>Project</strong>: fabric</br><strong>Branch</strong>: master<br><strong>ID</strong>: 31746<br><strong>Subject</strong>: [FAB-15577] TestInvalidInitialization failing<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Brett Logan - brett.t.logan@ibm.com<br><strong>Assignee</strong>:<strong>Created</strong>: 6/6/2019, 1:10:17 PM<br><strong>LastUpdated</strong>: 6/12/2019, 10:36:18 AM<br><strong>CommitMessage</strong>:<br><pre>[FAB-15577] TestInvalidInitialization failing

Added a return value to the Serialize function on the mock.

Signed-off-by: Brett Logan <Brett.T.Logan@ibm.com>
Change-Id: Ifb3cbaceed2d13fbbe0a858757a846f0ff21fec2
</pre><h1>Comments</h1><strong>Reviewer</strong>: Brett Logan - brett.t.logan@ibm.com<br><strong>Reviewed</strong>: 6/6/2019, 1:10:17 PM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/6/2019, 1:13:26 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/14366/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/6/2019, 1:13:53 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/6/2019, 1:21:03 PM<br><strong>Message</strong>: <pre>Patch Set 1: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/6/2019, 1:21:48 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/14366/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/14366</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/6/2019, 1:23:40 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/9306/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/6/2019, 1:27:32 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12715/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/6/2019, 1:27:54 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/6/2019, 1:39:41 PM<br><strong>Message</strong>: <pre>Patch Set 1: F3-UnitTest-1

Failed</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/6/2019, 1:40:26 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/9306/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/9306

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12715/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/12715</pre><strong>Reviewer</strong>: Brett Logan - brett.t.logan@ibm.com<br><strong>Reviewed</strong>: 6/6/2019, 1:52:41 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Run UnitTest, Run IntegrationTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/6/2019, 1:54:35 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/9307/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/6/2019, 1:55:03 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/6/2019, 1:55:42 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12716/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/6/2019, 1:56:07 PM<br><strong>Message</strong>: <pre>Patch Set 1: -F3-UnitTest

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/6/2019, 2:27:05 PM<br><strong>Message</strong>: <pre>Patch Set 1: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/6/2019, 2:36:53 PM<br><strong>Message</strong>: <pre>Patch Set 1: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/6/2019, 2:37:32 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/9307/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/9307

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12716/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/12716</pre><strong>Reviewer</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Reviewed</strong>: 6/7/2019, 12:17:28 PM<br><strong>Message</strong>: <pre>Patch Set 1: Code-Review+2</pre><strong>Reviewer</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Reviewed</strong>: 6/7/2019, 4:10:24 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Isn't the package global initialization the issue here? Seems odd to me that the first test to run gets to determine if any of the others succeed.

TestChannelConfig fails for the same reason as this test.</pre><strong>Reviewer</strong>: Brett Logan - brett.t.logan@ibm.com<br><strong>Reviewed</strong>: 6/7/2019, 5:05:55 PM<br><strong>Message</strong>: <pre>Patch Set 1:

> Patch Set 1:
> 
> Isn't the package global initialization the issue here? Seems odd to me that the first test to run gets to determine if any of the others succeed.
> 
> TestChannelConfig fails for the same reason as this test.

Yes, the underlying problem is the global configuration. But this test was flawed in the first place, it only happens to pass because of the bad global config when running the suite. If you had fixed the global config first, this test would have then failed. Matt and I also discussed, further down the call stack where it actually checks for a nil value, it should instead not care if the value is nil, and just append regardless.

Long story short, this needed changed to work "as intended" and then the global config needs fixed in a separate issue. And then possible append the nil bytes regardless down the call stack</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 6/7/2019, 5:20:49 PM<br><strong>Message</strong>: <pre>Patch Set 1: Code-Review+2

(1 comment)</pre><strong>Reviewer</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Reviewed</strong>: 6/7/2019, 5:20:52 PM<br><strong>Message</strong>: <pre>Change has been successfully merged by Yacov Manevich</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/7/2019, 5:23:16 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-x86_64/6864/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/7/2019, 5:24:09 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/5550/ (2/2)</pre><strong>Reviewer</strong>: Brett Logan - brett.t.logan@ibm.com<br><strong>Reviewed</strong>: 6/7/2019, 5:46:43 PM<br><strong>Message</strong>: <pre>Patch Set 1:

remerge</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/7/2019, 5:47:29 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/5550/ : ABORTED

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-end-2-end-x86_64/5550

https://jenkins.hyperledger.org/job/fabric-merge-x86_64/6864/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-x86_64/6864</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/7/2019, 5:49:25 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-x86_64/6866/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/7/2019, 5:50:00 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/5552/ (2/2)</pre><strong>Reviewer</strong>: Morgan Bauer - mbauer@us.ibm.com<br><strong>Reviewed</strong>: 6/7/2019, 6:12:39 PM<br><strong>Message</strong>: <pre>Patch Set 1:

> Matt and
 > I also discussed

Discussed where?</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/7/2019, 6:59:53 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-merge-x86_64/6866/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-x86_64/6866

https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/5552/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-end-2-end-x86_64/5552</pre><strong>Reviewer</strong>: Brett Logan - brett.t.logan@ibm.com<br><strong>Reviewed</strong>: 6/12/2019, 10:36:18 AM<br><strong>Message</strong>: <pre>Patch Set 1:

> Patch Set 1:
> 
> > Matt and
>  > I also discussed
> 
> Discussed where?

Matt sits right next to me. We discussed it person, but looking at the downstream effects, that isn't viable, the value being passed through is used to collect the peer identity, and the peer identity cannot be nil, it's a valid check. I've corrected the issue in the other test by returning a proper value, and we just need to correct the global config now</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Brett Logan - Brett.T.Logan@ibm.com<br><strong>Uploader</strong>: Brett Logan - brett.t.logan@ibm.com<br><strong>Created</strong>: 1559841017<br><strong>GitHubRevision</strong>: [3f59b8117abfeb7d4525d031bc61d451d1b02c68](https://github.com/hyperledger/fabric/commit/3f59b8117abfeb7d4525d031bc61d451d1b02c68)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 6/6/2019, 1:21:03 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 6/6/2019, 1:21:03 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 6/6/2019, 2:36:53 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 6/6/2019, 2:27:05 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Yacov Manevich - yacovm@il.ibm.com<br><strong>Approved</strong>: 6/7/2019, 5:20:49 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Yacov Manevich<br><strong>Merged</strong>: 6/7/2019, 5:20:52 PM<br><br><strong>Approver</strong>: Matthew Sykes - sykesmat@us.ibm.com<br><strong>Approved</strong>: 6/7/2019, 12:17:28 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br></blockquote>