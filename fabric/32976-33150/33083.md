<strong>Project</strong>: fabric<br><strong>Branch</strong>: master<br><strong>ID</strong>: 33083<br><strong>Subject</strong>: [FAB-16170] hdr validation for endorser transactions<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Assignee</strong>:<br><strong>Created</strong>: 8/21/2019, 10:34:06 AM<br><strong>LastUpdated</strong>: 11/20/2019, 2:00:56 PM<br><strong>CommitMessage</strong>:<br><pre>[FAB-16170] hdr validation for endorser transactions

Change-Id: I4de6ab9718e562ac433613a102dba8c3943df281
Signed-off-by: Alessandro Sorniotti <ale.linux@sopit.net>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 8/21/2019, 10:34:06 AM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/21/2019, 10:39:34 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/16645/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/21/2019, 10:40:23 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/21/2019, 10:47:35 AM<br><strong>Message</strong>: <pre>Patch Set 1: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/21/2019, 10:48:27 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/16645/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/16645</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/21/2019, 10:51:17 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/14713/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/21/2019, 10:51:56 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/11346/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/21/2019, 10:52:09 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/21/2019, 10:52:49 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/21/2019, 11:17:24 AM<br><strong>Message</strong>: <pre>Patch Set 1: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/21/2019, 12:10:04 PM<br><strong>Message</strong>: <pre>Patch Set 1: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/21/2019, 12:10:55 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/14713/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/14713

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/11346/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/11346</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 8/22/2019, 1:06:11 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(2 comments)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 8/22/2019, 5:23:00 AM<br><strong>Message</strong>: <pre>Uploaded patch set 2.</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 8/22/2019, 5:23:11 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(2 comments)

Thx Jason, see below + new drop</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2019, 5:28:00 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/16683/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2019, 5:28:47 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2019, 5:35:04 AM<br><strong>Message</strong>: <pre>Patch Set 2: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2019, 5:35:50 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/16683/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/16683</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2019, 5:38:24 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/14751/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2019, 5:39:07 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2019, 5:39:11 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/11381/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2019, 5:40:08 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2019, 6:02:12 AM<br><strong>Message</strong>: <pre>Patch Set 2: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2019, 6:57:27 AM<br><strong>Message</strong>: <pre>Patch Set 2: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2019, 6:58:31 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/14751/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/14751

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/11381/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/11381</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 8/22/2019, 2:13:46 PM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2019, 2:17:22 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/16715/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2019, 2:18:05 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2019, 2:25:15 PM<br><strong>Message</strong>: <pre>Patch Set 3: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2019, 2:26:05 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/16715/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/16715</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2019, 2:27:55 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/14768/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2019, 2:28:29 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/11397/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2019, 2:28:44 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2019, 2:29:15 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2019, 2:56:07 PM<br><strong>Message</strong>: <pre>Patch Set 3: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2019, 3:40:28 PM<br><strong>Message</strong>: <pre>Patch Set 3: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2019, 3:41:16 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/14768/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/14768

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/11397/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/11397</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 9/12/2019, 12:36:12 PM<br><strong>Message</strong>: <pre>Uploaded patch set 4.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/12/2019, 12:42:17 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/17135/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/12/2019, 12:43:12 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/12/2019, 12:50:27 PM<br><strong>Message</strong>: <pre>Patch Set 4: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/12/2019, 12:51:28 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/17135/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/17135</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/12/2019, 12:54:02 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/15100/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/12/2019, 12:54:49 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/11737/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/12/2019, 12:54:57 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/12/2019, 12:56:09 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/12/2019, 1:20:06 PM<br><strong>Message</strong>: <pre>Patch Set 4: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/12/2019, 2:22:30 PM<br><strong>Message</strong>: <pre>Patch Set 4: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/12/2019, 2:23:33 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/15100/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/15100

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/11737/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/11737</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 9/17/2019, 12:56:51 AM<br><strong>Message</strong>: <pre>Patch Set 4:

(1 comment)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 9/24/2019, 3:12:19 PM<br><strong>Message</strong>: <pre>Patch Set 5: Patch Set 4 was rebased</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 9/24/2019, 4:03:25 PM<br><strong>Message</strong>: <pre>Patch Set 5:

(1 comment)</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 9/25/2019, 1:45:01 PM<br><strong>Message</strong>: <pre>Patch Set 5:

(1 comment)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 10/7/2019, 4:59:39 AM<br><strong>Message</strong>: <pre>Patch Set 5:

(1 comment)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 10/29/2019, 9:11:15 AM<br><strong>Message</strong>: <pre>Patch Set 6: Patch Set 5 was rebased</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 11/19/2019, 3:27:20 AM<br><strong>Message</strong>: <pre>Patch Set 7: Patch Set 6 was rebased</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 11/20/2019, 12:26:33 PM<br><strong>Message</strong>: <pre>Patch Set 7: Code-Review+2</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 11/20/2019, 1:29:07 PM<br><strong>Message</strong>: <pre>Patch Set 7: Code-Review+2</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 11/20/2019, 1:29:10 PM<br><strong>Message</strong>: <pre>Change has been successfully merged by Manish Sethi</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/20/2019, 1:31:37 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-x86_64/8048/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/20/2019, 1:31:57 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/6761/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/20/2019, 2:00:56 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/6761/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-end-2-end-x86_64/6761

https://jenkins.hyperledger.org/job/fabric-merge-x86_64/8048/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-x86_64/8048</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 8/21/2019, 10:34:06 AM<br><strong>UnmergedRevision</strong>: [35fbd7de0d12b91b1871aad75deb9e06c19728e8](https://github.com/hyperledger-gerrit-archive/fabric/commit/35fbd7de0d12b91b1871aad75deb9e06c19728e8)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/21/2019, 10:47:35 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/21/2019, 10:47:35 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/21/2019, 12:10:04 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/21/2019, 11:17:24 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/tx/endorser/parser.go#L72](https://github.com/hyperledger-gerrit-archive/fabric/blob/35fbd7de0d12b91b1871aad75deb9e06c19728e8/core/tx/endorser/parser.go#L72)<br><strong>Comment</strong>: <pre>Since we're removing this field, let's not check it? :)</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/tx/endorser/parser.go#L72](https://github.com/hyperledger-gerrit-archive/fabric/blob/35fbd7de0d12b91b1871aad75deb9e06c19728e8/core/tx/endorser/parser.go#L72)<br><strong>Comment</strong>: <pre>Removed!

"Farewell, PayloadVisibility, wherever you fare till your eyries receive you at the journey's end!" ;)</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/tx/endorser/parser.go#L93](https://github.com/hyperledger-gerrit-archive/fabric/blob/35fbd7de0d12b91b1871aad75deb9e06c19728e8/core/tx/endorser/parser.go#L93)<br><strong>Comment</strong>: <pre>It's a balance, but in general, I would think it would be nice to split the parsing into two phases, unmarshaling, and validating.

There's clearly a case to be made that for instance, if the header type is wrong, we don't want to fail with an unmarshal error and log that, when we're missing the obvious underlying cause.

Still, I don't see this here.  What about doing what Matt suggested in the endorser stack I've been doing (and what is implemented here: https://gerrit.hyperledger.org/r/c/fabric/+/33097

Basically, unpack your structure, and then hang a separate 'Validate' method off your structure to ensure that all of your inputs are just as you'd like them.

The big benefit I see here, especially with our crazy marshaled sort of structures, is that doing the test for the validation becomes much simpler.  Because you're dealing with already unmarshaled data, you can simply set those fields in your real, then test against them, rather than having to deal with the buried marshaled version.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/tx/endorser/parser.go#L93](https://github.com/hyperledger-gerrit-archive/fabric/blob/35fbd7de0d12b91b1871aad75deb9e06c19728e8/core/tx/endorser/parser.go#L93)<br><strong>Comment</strong>: <pre>Yup, I noticed you took this approach but imho intermingling unmarshalling and validation is the superior approach (provided that we can test it decently - see below), here's why: an attacker should be able to reach as small an attack surface as possible when it feeds us malicious input. In an ideal world we'd have an oracle telling us which input is malicious and then the attack surface would be 0. Clearly this is not possible but we can approximate it by halting the processing of input as soon as we can determine that it is malicious. This speaks in favour of intermingling unmarshal and validate calls in close proximity so we can skip the next unmarshal as soon as the previous one returned malicious input.

Re testing: I did spend a bit of time to make our test cases easy to understand and maintain, and I hope I've achieved this. Take a look at this test for instance

```
		When("there is a bad version", func() {
			BeforeEach(func() {
				chHeader = &common.ChannelHeader{
					ChannelId: "my-channel",
					Version:   35,
				}
			})

			It("returns an error", func() {
				pe, err := endorsertx.New(txenv)
				Expect(err).To(MatchError("invalid version in ChannelHeader. Expected 0, got [35]"))
				Expect(pe).To(BeNil())
			})
		})
```

In the BeforeEach I'm able to override a single field to cause the error scenario, without being burdened by the nested unmarshalling hell. I believe I can continue with this level of clean tests.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/tx/endorser/parser.go#L93](https://github.com/hyperledger-gerrit-archive/fabric/blob/35fbd7de0d12b91b1871aad75deb9e06c19728e8/core/tx/endorser/parser.go#L93)<br><strong>Comment</strong>: <pre>> here's why: an attacker should be able to reach as small an attack surface as possible when it feeds us malicious input. In an ideal world we'd have an oracle telling us which input is malicious and then the attack surface would be 0. Clearly this is not possible but we can approximate it by halting the processing of input as soon as we can determine that it is malicious. 

I really don't see how this is reducing the attack surface in any way.

Essentially we have:

Scheme A

 1a) Unmarshal a
 2a) Unmarshal a.b
 3a) Unmarshal a.b.c
 4a) Validate a
 5a) Validate a.b
 6a) Validate a.b.c

vs.

Scheme B

 1b) Unmarshal a
 2b) Validate a
 3b) Unmarshal a.b
 4b) Validate a.b
 5b) Unmarshal a.b.c
 6b) Validate a.b.c

We may safely assume that the attack is capable of forming a well-formed transaction which passes all unmarshaling and validation checks in both Scheme A and Scheme B.  So, let's claim, that there's some vulnerability that occurs in step 3a/5b.  All an attacker needs to do is satisfy 1b through 4b (which, clearly, the attacker can because the attacker may present a well formed transaction which passes through all steps).

If we were performing signature validation, or some other step which utilized state outside of this message for validation, I see the argument for detecting problems earlier.  However, it seems like we could write up a series of lemmas proving that anything exploitable in Scheme A is also exploitable in Scheme B (ie, the attack surfaces are equal).

Of course, I cannot claim that doing unmarshaling, then validation is any more secure, but I do think it's simpler, and easier to understand, which I suppose I actually will claim is more secure :)

In any event, if you feel strongly enough, I can be convinced to back off of this issue.  Once the code path executes, we're left with a structure that's been unmarshaled and validated, regardless as to how/if those operations were interleaved.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/tx/endorser/parser.go#L93](https://github.com/hyperledger-gerrit-archive/fabric/blob/35fbd7de0d12b91b1871aad75deb9e06c19728e8/core/tx/endorser/parser.go#L93)<br><strong>Comment</strong>: <pre>Parsing/unmarshaling code is notoriously prone to vulnerabilities (granted, that's more likely to happen to unsafe languages, but still). So I prefer scheme B because it's possible that the attacker has to supply invalid input (as in, input that would fail a "validate" check) in order to trigger some hypothetical vulnerability in the subsequent unmarshal code: in this case scheme B would "block" such an attack because the validate check would fail. On the contrary, in scheme A the attacker would get a free pass to visit all unmarshalling functions without any of our safety check code possibly filtering out input that is obviously invalid.

This is all very hypothetical, and it applies more to unsafe languages, but there's still a part of me that wants to err on this side - unless you feel strongly about it ofc.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/tx/endorser/parser.go#L93](https://github.com/hyperledger-gerrit-archive/fabric/blob/35fbd7de0d12b91b1871aad75deb9e06c19728e8/core/tx/endorser/parser.go#L93)<br><strong>Comment</strong>: <pre>As I said, there's strictly nothing wrong with this approach, and I can back down, but I just want to make sure we're understanding eachother here, and that doesn't seem to be the case :)

Parsing/unmarshaling code certainly can be prone to vulnerabilities.  But I'm having trouble following this logic:

> it's possible that the attacker has to supply invalid input (as in, input that would fail a "validate" check) in order to trigger some hypothetical vulnerability in the subsequent unmarshal code

This seems to be discussing a hypothetical scenario, where a primary attack is used to corrupt the output of a first unmarshal, to trigger a secondary attack on the unmarshaling procedure of the nested bytes, but that the primary attack is somehow detectable in the corruption of adjacent values and early checks may therefore thwart the secondary attack.

However, with protobuf, our attacker needs no such cleverness.  Any field value in the proto struct, in particular, any of the byte slices which are parameters to unmarshal, may be set to any arbitrary value, no attack required.  Essentially, the attack surface to each unmarshal function is the set of all bytes (modulo the max size of the message on the wire).  Nothing we do can expands this surface.

Since in either scheme (unmarshal all then validate all, or unmarshal then validate each), the range of possible inputs to each unmarshal is the same (arbitrary), I fail to see how even hypothetically/theoretically one scheme is more secure than the other.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/tx/endorser/parser.go#L93](https://github.com/hyperledger-gerrit-archive/fabric/blob/35fbd7de0d12b91b1871aad75deb9e06c19728e8/core/tx/endorser/parser.go#L93)<br><strong>Comment</strong>: <pre>It is true that our ability to validate before unmarshalling is somewhat limited in our case with our choice of marshalling scheme. But think about it in general terms: it is entirely possible that there is a vulnerability in some unmarshalling code U that could be made unreachable by placing some adequate validation code V before that. So the sequence V1, U1, ..., Vn, Un is superior to U1, ..., Un, V1, ..., Vn from this perspective</pre></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 8/22/2019, 5:23:00 AM<br><strong>UnmergedRevision</strong>: [fc2af7b83d0a227165c18ff15129feee26d1466a](https://github.com/hyperledger-gerrit-archive/fabric/commit/fc2af7b83d0a227165c18ff15129feee26d1466a)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/22/2019, 5:35:04 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/22/2019, 5:35:04 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/22/2019, 6:57:27 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/22/2019, 6:02:12 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 8/22/2019, 2:13:46 PM<br><strong>UnmergedRevision</strong>: [15afeff85c59a05fc9404f75d30fab7673af5bac](https://github.com/hyperledger-gerrit-archive/fabric/commit/15afeff85c59a05fc9404f75d30fab7673af5bac)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/22/2019, 2:25:15 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/22/2019, 2:25:15 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/22/2019, 3:40:28 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/22/2019, 2:56:07 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 9/12/2019, 12:36:12 PM<br><strong>UnmergedRevision</strong>: [1d76779e11f60d1b4fffa0faf40b176be0567ae9](https://github.com/hyperledger-gerrit-archive/fabric/commit/1d76779e11f60d1b4fffa0faf40b176be0567ae9)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/12/2019, 12:50:27 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/12/2019, 12:50:27 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/12/2019, 2:22:30 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/12/2019, 1:20:06 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 5</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 9/24/2019, 3:12:19 PM<br><strong>UnmergedRevision</strong>: [d2cad4ab1fd78fab640fcde27f372ff58e62eb79](https://github.com/hyperledger-gerrit-archive/fabric/commit/d2cad4ab1fd78fab640fcde27f372ff58e62eb79)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/12/2019, 12:50:27 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/12/2019, 12:50:27 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/12/2019, 2:22:30 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/12/2019, 1:20:06 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 6</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 10/29/2019, 9:11:15 AM<br><strong>UnmergedRevision</strong>: [db7f53c2760061068a725ae47a0a95372de953d3](https://github.com/hyperledger-gerrit-archive/fabric/commit/db7f53c2760061068a725ae47a0a95372de953d3)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/12/2019, 12:50:27 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/12/2019, 12:50:27 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/12/2019, 2:22:30 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/12/2019, 1:20:06 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 7</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 11/19/2019, 3:27:20 AM<br><strong>GitHubMergedRevision</strong>: [20dbb4abccdce91fa8e5a67fe71e4046b57a72de](https://github.com/hyperledger-gerrit-archive/fabric/commit/20dbb4abccdce91fa8e5a67fe71e4046b57a72de)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/12/2019, 12:50:27 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/12/2019, 12:50:27 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/12/2019, 2:22:30 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/12/2019, 1:20:06 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Approved</strong>: 11/20/2019, 12:26:33 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Approved</strong>: 11/20/2019, 1:29:07 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Manish Sethi<br><strong>Merged</strong>: 11/20/2019, 1:29:10 PM<br><br></blockquote>