<strong>Project</strong>: fabric<br><strong>Branch</strong>: master<br><strong>ID</strong>: 33051<br><strong>Subject</strong>: [FAB-16169] protobuf parser for endorser transaction<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Assignee</strong>:<br><strong>Created</strong>: 8/20/2019, 2:29:13 PM<br><strong>LastUpdated</strong>: 10/7/2019, 9:39:14 AM<br><strong>CommitMessage</strong>:<br><pre>[FAB-16169] protobuf parser for endorser transaction

Change-Id: I66b1700632c8d71d2dbc685800801bce651746ba
Signed-off-by: Alessandro Sorniotti <ale.linux@sopit.net>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 8/20/2019, 2:29:13 PM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/20/2019, 2:35:05 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/16580/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/20/2019, 2:35:46 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/20/2019, 2:43:23 PM<br><strong>Message</strong>: <pre>Patch Set 1: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/20/2019, 2:44:18 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/16580/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/16580</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/20/2019, 2:45:50 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/14667/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/20/2019, 2:46:22 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/20/2019, 2:46:43 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/11294/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/20/2019, 2:47:14 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/20/2019, 3:07:39 PM<br><strong>Message</strong>: <pre>Patch Set 1: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/20/2019, 3:58:58 PM<br><strong>Message</strong>: <pre>Patch Set 1: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/20/2019, 3:59:47 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/14667/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/14667

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/11294/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/11294</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 8/22/2019, 12:59:23 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(1 comment)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 8/22/2019, 4:53:15 AM<br><strong>Message</strong>: <pre>Uploaded patch set 2.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2019, 4:53:25 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/16682/</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 8/22/2019, 4:53:57 AM<br><strong>Message</strong>: <pre>Patch Set 2:

(1 comment)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2019, 4:54:04 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2019, 5:01:02 AM<br><strong>Message</strong>: <pre>Patch Set 2: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2019, 5:01:51 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/16682/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/16682</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2019, 5:03:33 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/14750/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2019, 5:04:18 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2019, 5:04:28 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/11380/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2019, 5:05:21 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2019, 5:28:26 AM<br><strong>Message</strong>: <pre>Patch Set 2: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2019, 6:20:15 AM<br><strong>Message</strong>: <pre>Patch Set 2: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2019, 6:21:05 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/14750/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/14750

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/11380/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/11380</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 8/22/2019, 2:11:30 PM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2019, 2:16:19 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/16714/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2019, 2:17:09 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2019, 2:24:05 PM<br><strong>Message</strong>: <pre>Patch Set 3: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2019, 2:24:54 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/16714/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/16714</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2019, 2:27:13 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/14767/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2019, 2:27:34 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/11396/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2019, 2:27:58 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2019, 2:28:18 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2019, 2:51:33 PM<br><strong>Message</strong>: <pre>Patch Set 3: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2019, 3:44:27 PM<br><strong>Message</strong>: <pre>Patch Set 3: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 8/22/2019, 3:45:23 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/14767/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/14767

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/11396/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/11396</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 9/3/2019, 6:38:18 AM<br><strong>Message</strong>: <pre>Patch Set 3:

(3 comments)</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 9/3/2019, 3:42:52 PM<br><strong>Message</strong>: <pre>Patch Set 3: Code-Review-1

(10 comments)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 9/12/2019, 12:13:09 PM<br><strong>Message</strong>: <pre>Uploaded patch set 4.</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 9/12/2019, 12:13:45 PM<br><strong>Message</strong>: <pre>Patch Set 3:

(13 comments)

Thx Jason and Gari, see below + new patch</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/12/2019, 12:19:02 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/17134/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/12/2019, 12:19:58 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Starting verify build</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/12/2019, 12:27:01 PM<br><strong>Message</strong>: <pre>Patch Set 4: F2-DocBuild+1 F1-VerifyBuild+1

Succeeded, Run IntegrationTest, Run UnitTest</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/12/2019, 12:27:52 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-build-checks-x86_64/17134/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-build-checks-x86_64/17134</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/12/2019, 12:30:22 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/15099/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/12/2019, 12:31:10 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Starting unit tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/12/2019, 12:31:18 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/11736/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/12/2019, 12:32:06 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Starting Integration tests</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/12/2019, 12:51:51 PM<br><strong>Message</strong>: <pre>Patch Set 4: F3-UnitTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/12/2019, 1:44:23 PM<br><strong>Message</strong>: <pre>Patch Set 4: F3-IntegrationTest+1

Succeeded</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/12/2019, 1:45:11 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/15099/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-unit-tests-x86_64/15099

https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/11736/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-verify-integration-tests-x86_64/11736</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 9/13/2019, 1:48:47 AM<br><strong>Message</strong>: <pre>Patch Set 4:

(6 comments)

Sorry for my delinquency in getting back to this review, a few more comments.</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 9/13/2019, 4:11:07 AM<br><strong>Message</strong>: <pre>Patch Set 4:

(5 comments)

Thanks Jason, see below + at the top of the stack</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 9/13/2019, 12:17:26 PM<br><strong>Message</strong>: <pre>Patch Set 4:

(4 comments)</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 9/23/2019, 11:32:26 AM<br><strong>Message</strong>: <pre>Patch Set 4:

(1 comment)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 9/24/2019, 3:12:09 PM<br><strong>Message</strong>: <pre>Patch Set 5: Patch Set 4 was rebased</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 9/24/2019, 3:14:44 PM<br><strong>Message</strong>: <pre>Patch Set 5:

(3 comments)</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 9/24/2019, 3:54:57 PM<br><strong>Message</strong>: <pre>Patch Set 5:

(1 comment)</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 9/25/2019, 2:09:13 PM<br><strong>Message</strong>: <pre>Patch Set 5:

(3 comments)

See details below, but if you're okay with the overall structure, I'm fine to merge.  However, there's one point you'd said had been fixed which I'm not seeing, could you address first?</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 9/26/2019, 10:19:25 AM<br><strong>Message</strong>: <pre>Patch Set 5:

(2 comments)</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 9/26/2019, 10:21:51 AM<br><strong>Message</strong>: <pre>Patch Set 5: Code-Review+2</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 9/26/2019, 10:52:13 AM<br><strong>Message</strong>: <pre>Patch Set 5:

(1 comment)</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 9/26/2019, 12:00:49 PM<br><strong>Message</strong>: <pre>Patch Set 5:

(1 comment)</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 9/30/2019, 9:32:42 PM<br><strong>Message</strong>: <pre>Patch Set 5:

(1 comment)

Ale, before I review this further - a basic question</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 9/30/2019, 10:53:26 PM<br><strong>Message</strong>: <pre>Patch Set 5:

(1 comment)</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 9/30/2019, 11:03:20 PM<br><strong>Message</strong>: <pre>Patch Set 5:

(1 comment)</pre><strong>Reviewer</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Reviewed</strong>: 10/1/2019, 9:45:32 AM<br><strong>Message</strong>: <pre>Patch Set 5:

(1 comment)</pre><strong>Reviewer</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>Reviewed</strong>: 10/1/2019, 10:50:05 AM<br><strong>Message</strong>: <pre>Patch Set 5:

(1 comment)</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 10/3/2019, 4:32:16 AM<br><strong>Message</strong>: <pre>Patch Set 5: Code-Review+2</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 10/7/2019, 4:32:09 AM<br><strong>Message</strong>: <pre>Change has been successfully merged by Alessandro Sorniotti</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/7/2019, 4:35:39 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-x86_64/7806/ (1/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/7/2019, 4:36:10 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/6507/ (2/2)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 10/7/2019, 4:57:10 AM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-merge-end-2-end-x86_64/6507/ : FAILURE (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-end-2-end-x86_64/6507

https://jenkins.hyperledger.org/job/fabric-merge-x86_64/7806/ : SUCCESS (skipped)

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-merge-x86_64/7806</pre><strong>Reviewer</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Reviewed</strong>: 10/7/2019, 9:39:14 AM<br><strong>Message</strong>: <pre>Patch Set 5:

(1 comment)

Sorry, I wrote the response but forgot to post..</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 8/20/2019, 2:29:13 PM<br><strong>UnmergedRevision</strong>: [6534292504fd1c69743575f258dfaa09f102c261](https://github.com/hyperledger-gerrit-archive/fabric/commit/6534292504fd1c69743575f258dfaa09f102c261)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/20/2019, 2:43:23 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/20/2019, 2:43:23 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/20/2019, 3:58:58 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/20/2019, 3:07:39 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/tx/endorser/parser.go#L26](https://github.com/hyperledger-gerrit-archive/fabric/blob/6534292504fd1c69743575f258dfaa09f102c261/core/tx/endorser/parser.go#L26)<br><strong>Comment</strong>: <pre>Why are we leaving the proto representations here? Is there an advantage?

I would think that what you really want is to create struct fields corresponding to the below methods, and then simply set them with the value of those methods.  What's the benefit to retaining the original message?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/tx/endorser/parser.go#L26](https://github.com/hyperledger-gerrit-archive/fabric/blob/6534292504fd1c69743575f258dfaa09f102c261/core/tx/endorser/parser.go#L26)<br><strong>Comment</strong>: <pre>Good idea - thx! Done</pre></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 8/22/2019, 4:53:15 AM<br><strong>UnmergedRevision</strong>: [abeefa63b24dae74d6dd0d4313fc39ba58e431c6](https://github.com/hyperledger-gerrit-archive/fabric/commit/abeefa63b24dae74d6dd0d4313fc39ba58e431c6)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/22/2019, 5:01:02 AM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/22/2019, 5:01:02 AM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/22/2019, 6:20:15 AM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/22/2019, 5:28:26 AM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 8/22/2019, 2:11:30 PM<br><strong>UnmergedRevision</strong>: [934557ad27abe94cbe99e726480e0c7dbb30f76d](https://github.com/hyperledger-gerrit-archive/fabric/commit/934557ad27abe94cbe99e726480e0c7dbb30f76d)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/22/2019, 2:24:05 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/22/2019, 2:24:05 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/22/2019, 3:44:27 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 8/22/2019, 2:51:33 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Approved</strong>: 9/3/2019, 3:42:52 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>CommentLine</strong>: [core/tx/endorser/parser.go#L12](https://github.com/hyperledger-gerrit-archive/fabric/blob/934557ad27abe94cbe99e726480e0c7dbb30f76d/core/tx/endorser/parser.go#L12)<br><strong>Comment</strong>: <pre>Do you really need to use this package?  Seems like we are just simply wrapping calls to proto.Unmarshal</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/tx/endorser/parser.go#L12](https://github.com/hyperledger-gerrit-archive/fabric/blob/934557ad27abe94cbe99e726480e0c7dbb30f76d/core/tx/endorser/parser.go#L12)<br><strong>Comment</strong>: <pre>Yup - the rationale is that this

https://gerrit.hyperledger.org/r/#/c/fabric/+/32947/5/protoutil/unmarshalers.go

introduced a common set of unmarshalers with similar structure and clear API contract/failure model.</pre><strong>Commenter</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>CommentLine</strong>: [core/tx/endorser/parser.go#L17](https://github.com/hyperledger-gerrit-archive/fabric/blob/934557ad27abe94cbe99e726480e0c7dbb30f76d/core/tx/endorser/parser.go#L17)<br><strong>Comment</strong>: <pre>can't we just call this "EndorserTx"?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/tx/endorser/parser.go#L17](https://github.com/hyperledger-gerrit-archive/fabric/blob/934557ad27abe94cbe99e726480e0c7dbb30f76d/core/tx/endorser/parser.go#L17)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/tx/endorser/parser.go#L25](https://github.com/hyperledger-gerrit-archive/fabric/blob/934557ad27abe94cbe99e726480e0c7dbb30f76d/core/tx/endorser/parser.go#L25)<br><strong>Comment</strong>: <pre>Why are none of these exported?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/tx/endorser/parser.go#L25](https://github.com/hyperledger-gerrit-archive/fabric/blob/934557ad27abe94cbe99e726480e0c7dbb30f76d/core/tx/endorser/parser.go#L25)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>CommentLine</strong>: [core/tx/endorser/parser.go#L31](https://github.com/hyperledger-gerrit-archive/fabric/blob/934557ad27abe94cbe99e726480e0c7dbb30f76d/core/tx/endorser/parser.go#L31)<br><strong>Comment</strong>: <pre>These should be named "NewEndorserTx" or "NewParsedEndorserTx" (depending on my comment for naming the struct</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/tx/endorser/parser.go#L31](https://github.com/hyperledger-gerrit-archive/fabric/blob/934557ad27abe94cbe99e726480e0c7dbb30f76d/core/tx/endorser/parser.go#L31)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/tx/endorser/parser.go#L157](https://github.com/hyperledger-gerrit-archive/fabric/blob/934557ad27abe94cbe99e726480e0c7dbb30f76d/core/tx/endorser/parser.go#L157)<br><strong>Comment</strong>: <pre>These fields should be exported rather than sticking accessors around them.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/tx/endorser/parser.go#L157](https://github.com/hyperledger-gerrit-archive/fabric/blob/934557ad27abe94cbe99e726480e0c7dbb30f76d/core/tx/endorser/parser.go#L157)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/tx/endorser/parser_test.go#L19](https://github.com/hyperledger-gerrit-archive/fabric/blob/934557ad27abe94cbe99e726480e0c7dbb30f76d/core/tx/endorser/parser_test.go#L19)<br><strong>Comment</strong>: <pre>I have this tendency too, but no need to nest two describes like this if there are no other tests, we can just make this top level.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/tx/endorser/parser_test.go#L19](https://github.com/hyperledger-gerrit-archive/fabric/blob/934557ad27abe94cbe99e726480e0c7dbb30f76d/core/tx/endorser/parser_test.go#L19)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/tx/endorser/parser_test.go#L30](https://github.com/hyperledger-gerrit-archive/fabric/blob/934557ad27abe94cbe99e726480e0c7dbb30f76d/core/tx/endorser/parser_test.go#L30)<br><strong>Comment</strong>: <pre>This is a no-op, ginkgo promises the value of each of those vars will be the zero value at each invocation.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/tx/endorser/parser_test.go#L30](https://github.com/hyperledger-gerrit-archive/fabric/blob/934557ad27abe94cbe99e726480e0c7dbb30f76d/core/tx/endorser/parser_test.go#L30)<br><strong>Comment</strong>: <pre>You'd think so, but no - apparently if you don't reset them the value set by a previous invocation is used (or at least that's what empirical evidence shows - if I comment these lines, tests fail because these values are not nil).</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/tx/endorser/parser_test.go#L33](https://github.com/hyperledger-gerrit-archive/fabric/blob/934557ad27abe94cbe99e726480e0c7dbb30f76d/core/tx/endorser/parser_test.go#L33)<br><strong>Comment</strong>: <pre>I'm not strictly opposed to using a function here, though if this is the only place it's referenced, you could just inline it.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/tx/endorser/parser_test.go#L33](https://github.com/hyperledger-gerrit-archive/fabric/blob/934557ad27abe94cbe99e726480e0c7dbb30f76d/core/tx/endorser/parser_test.go#L33)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/tx/endorser/parser_test.go#L36](https://github.com/hyperledger-gerrit-archive/fabric/blob/934557ad27abe94cbe99e726480e0c7dbb30f76d/core/tx/endorser/parser_test.go#L36)<br><strong>Comment</strong>: <pre>No need to enumerate a 'When' for the green path.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/tx/endorser/parser_test.go#L36](https://github.com/hyperledger-gerrit-archive/fabric/blob/934557ad27abe94cbe99e726480e0c7dbb30f76d/core/tx/endorser/parser_test.go#L36)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/tx/endorser/parser_test.go#L40](https://github.com/hyperledger-gerrit-archive/fabric/blob/934557ad27abe94cbe99e726480e0c7dbb30f76d/core/tx/endorser/parser_test.go#L40)<br><strong>Comment</strong>: <pre>Why not simply do a:

 Expect(pe).To(Equal(&endorser.ParsedEndorserTx{
    ...
 }

?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/tx/endorser/parser_test.go#L40](https://github.com/hyperledger-gerrit-archive/fabric/blob/934557ad27abe94cbe99e726480e0c7dbb30f76d/core/tx/endorser/parser_test.go#L40)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/tx/endorser/parser_test.go#L54](https://github.com/hyperledger-gerrit-archive/fabric/blob/934557ad27abe94cbe99e726480e0c7dbb30f76d/core/tx/endorser/parser_test.go#L54)<br><strong>Comment</strong>: <pre>This is a constant, so better to simply check against a literal constant, than to re-compute.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/tx/endorser/parser_test.go#L54](https://github.com/hyperledger-gerrit-archive/fabric/blob/934557ad27abe94cbe99e726480e0c7dbb30f76d/core/tx/endorser/parser_test.go#L54)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/tx/endorser/parser_test.go#L77](https://github.com/hyperledger-gerrit-archive/fabric/blob/934557ad27abe94cbe99e726480e0c7dbb30f76d/core/tx/endorser/parser_test.go#L77)<br><strong>Comment</strong>: <pre>This is unnecessary and should be omitted.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/tx/endorser/parser_test.go#L77](https://github.com/hyperledger-gerrit-archive/fabric/blob/934557ad27abe94cbe99e726480e0c7dbb30f76d/core/tx/endorser/parser_test.go#L77)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/tx/endorser/parser_test.go#L83](https://github.com/hyperledger-gerrit-archive/fabric/blob/934557ad27abe94cbe99e726480e0c7dbb30f76d/core/tx/endorser/parser_test.go#L83)<br><strong>Comment</strong>: <pre>No need to assert on nil here, the behavior when an error is usually not specified.  (same goes for the rest of the error case tests).</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/tx/endorser/parser_test.go#L83](https://github.com/hyperledger-gerrit-archive/fabric/blob/934557ad27abe94cbe99e726480e0c7dbb30f76d/core/tx/endorser/parser_test.go#L83)<br><strong>Comment</strong>: <pre>I'm going to go ahead and leave them as they are for the following reasons: 
1) by contract we indeed do not guarantee anything about the first return value when the second is not nil;
2) that said, if that value is not nil in presence of an error, somebody has likely messed something up and I'd be happy to see tests fail.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/tx/endorser/parser_test.go#L83](https://github.com/hyperledger-gerrit-archive/fabric/blob/934557ad27abe94cbe99e726480e0c7dbb30f76d/core/tx/endorser/parser_test.go#L83)<br><strong>Comment</strong>: <pre>I don't feel that strongly about this, but, to me, the whole point of ginkgo and 'behavioral' tests is that you're asserting the contract of your code.  In general, you should be able to refactor, and generally test many different implementations successfully with the same test suite.  So, asserting something which is not part of our contract still feels wrong to me.</pre></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 9/12/2019, 12:13:09 PM<br><strong>UnmergedRevision</strong>: [5ebf2b3235f5a0b316db18018311f735da23848f](https://github.com/hyperledger-gerrit-archive/fabric/commit/5ebf2b3235f5a0b316db18018311f735da23848f)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/12/2019, 12:27:01 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/12/2019, 12:27:01 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/12/2019, 1:44:23 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/12/2019, 12:51:51 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/tx/endorser/parser.go#L48](https://github.com/hyperledger-gerrit-archive/fabric/blob/5ebf2b3235f5a0b316db18018311f735da23848f/core/tx/endorser/parser.go#L48)<br><strong>Comment</strong>: <pre>I'm not sure what we ended up doing in the tx processor factory stuff, but I thought we also checked for zero length there.

For me, this check makes more sense here, though from a strict proto perspective, nothing prevents a proto from marshaling to be zero length.  Still, this is probably a better error message to catch than to return "only one transaction action is supported, 0 were present".</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/tx/endorser/parser.go#L48](https://github.com/hyperledger-gerrit-archive/fabric/blob/5ebf2b3235f5a0b316db18018311f735da23848f/core/tx/endorser/parser.go#L48)<br><strong>Comment</strong>: <pre>The pattern I've been following is that before every call to unmarshal, I check the byte slice not to have zero length. The rationale is that the unmarshal won't err out and will return a non-nil struct pointer with zero values everywhere in that case. True, checks for individual fields will later lead us to err out anyway, but I find it much cleaner to point out to the real issue - none of these byte slices are supposed to have zero length anyway.

Re to your other point: it is possible that we repeat this check also in the factory code, but the primary goal is input validation - minimisation of these checks is a secondary goal, especially in light of the fact that it's basically for free.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/tx/endorser/parser.go#L48](https://github.com/hyperledger-gerrit-archive/fabric/blob/5ebf2b3235f5a0b316db18018311f735da23848f/core/tx/endorser/parser.go#L48)<br><strong>Comment</strong>: <pre>Yes, in the endorser tx processor, I like these checks much better.  I'm a little more skeptical of them in the higher level code, especially since we'll be defending against them in the processor as well.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/tx/endorser/parser.go#L63](https://github.com/hyperledger-gerrit-archive/fabric/blob/5ebf2b3235f5a0b316db18018311f735da23848f/core/tx/endorser/parser.go#L63)<br><strong>Comment</strong>: <pre>Looks like this is not covered by test.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/tx/endorser/parser.go#L63](https://github.com/hyperledger-gerrit-archive/fabric/blob/5ebf2b3235f5a0b316db18018311f735da23848f/core/tx/endorser/parser.go#L63)<br><strong>Comment</strong>: <pre>ah yeah - it's one of those cases that's hard to test given the joy and marvel that is protobuf parsing code.. I'll add a test at the top of the stack. thx</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/tx/endorser/parser.go#L63](https://github.com/hyperledger-gerrit-archive/fabric/blob/5ebf2b3235f5a0b316db18018311f735da23848f/core/tx/endorser/parser.go#L63)<br><strong>Comment</strong>: <pre>So, it turns out that it's a bug in the proto code, it's currently impossible to create a repeated field with a nil element. There's a bug report here https://github.com/golang/protobuf/issues/307. At this stage it's unclear to me whether the repeated field with nil element is forbidden by the proto marshaling scheme or whether it's just this version of the go marshaller that won't produce it, but it may still be produced manually or by some other marshalling code. For this reason I'm leaving the check pending further investigation. I've created FAB-16199 to track the work required to either add a test case or remove the check</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/tx/endorser/parser.go#L63](https://github.com/hyperledger-gerrit-archive/fabric/blob/5ebf2b3235f5a0b316db18018311f735da23848f/core/tx/endorser/parser.go#L63)<br><strong>Comment</strong>: <pre>Thanks for the thorough explanation!</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/tx/endorser/parser.go#L84](https://github.com/hyperledger-gerrit-archive/fabric/blob/5ebf2b3235f5a0b316db18018311f735da23848f/core/tx/endorser/parser.go#L84)<br><strong>Comment</strong>: <pre>Such an extreme nit that I almost didn't post it, I don't really mind this long line, but it's odd that you split a similar one into multi-line above (line 39) but not here.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/tx/endorser/parser.go#L84](https://github.com/hyperledger-gerrit-archive/fabric/blob/5ebf2b3235f5a0b316db18018311f735da23848f/core/tx/endorser/parser.go#L84)<br><strong>Comment</strong>: <pre>nope, good point, and I like my 80-columns vim session not to wrap around anyway! ;) Done at the top of the stack</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/tx/endorser/parser.go#L115](https://github.com/hyperledger-gerrit-archive/fabric/blob/5ebf2b3235f5a0b316db18018311f735da23848f/core/tx/endorser/parser.go#L115)<br><strong>Comment</strong>: <pre>Having just looked at this, on the endorsement side, the name field in the header extension is what must be set.  The chaincode invocation spec does not even need to contain a ChaincodeSpec, it's only referenced for the args.

Calling this the "CcID" is a little disingenuous to me.  It's the chaincode name, nothing more.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/tx/endorser/parser.go#L115](https://github.com/hyperledger-gerrit-archive/fabric/blob/5ebf2b3235f5a0b316db18018311f735da23848f/core/tx/endorser/parser.go#L115)<br><strong>Comment</strong>: <pre>Ah, that's what you settled on? I was not so secretly hoping we could get rid of the header extension altogether and obtain the cc name from the CIS in the args.. thoughts?

To your other point: renamed to ccname.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/tx/endorser/parser.go#L115](https://github.com/hyperledger-gerrit-archive/fabric/blob/5ebf2b3235f5a0b316db18018311f735da23848f/core/tx/endorser/parser.go#L115)<br><strong>Comment</strong>: <pre>"settled on" implies I made a decision :).  That's simply how the endorser code works and what it checks.  During the refactor I made every attempt not to change any existing behavior.  You can see from this test: https://github.com/hyperledger/fabric/blob/00433d7ca4914ce5230f87d376beb2ede078f816/core/endorser/endorser_test.go#L176-L205 that a valid proposal must include the chaincode name in the chaincode header extension.  Everything else in the extension is ignored.  The proposal must contain the args in the invocation spec, everything else in the invocation spec is ignored.

I'd love to get rid of all these other fields entirely, but, we must consider validating old chains.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/tx/endorser/parser.go#L115](https://github.com/hyperledger-gerrit-archive/fabric/blob/5ebf2b3235f5a0b316db18018311f735da23848f/core/tx/endorser/parser.go#L115)<br><strong>Comment</strong>: <pre>understood... but, but... in theory we could be a little more aggressive in what we change in the endorser code, because it's only a matter of what client SDK code we support. And on the validator/committer side, we can be equally aggressive because we'll have a capability to protect us... wdyt?</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/tx/endorser/parser_test.go#L26](https://github.com/hyperledger-gerrit-archive/fabric/blob/5ebf2b3235f5a0b316db18018311f735da23848f/core/tx/endorser/parser_test.go#L26)<br><strong>Comment</strong>: <pre>I'm confused why these are `*protomsgs` and not `[]byte`.  You could still use a nil check, and set them to []byte{} if you wanted something non-nil but empty.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/tx/endorser/parser_test.go#L26](https://github.com/hyperledger-gerrit-archive/fabric/blob/5ebf2b3235f5a0b316db18018311f735da23848f/core/tx/endorser/parser_test.go#L26)<br><strong>Comment</strong>: <pre>Done - good catch</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/tx/endorser/parser_test.go#L26](https://github.com/hyperledger-gerrit-archive/fabric/blob/5ebf2b3235f5a0b316db18018311f735da23848f/core/tx/endorser/parser_test.go#L26)<br><strong>Comment</strong>: <pre>This doesn't seem done to me?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/tx/endorser/parser_test.go#L26](https://github.com/hyperledger-gerrit-archive/fabric/blob/5ebf2b3235f5a0b316db18018311f735da23848f/core/tx/endorser/parser_test.go#L26)<br><strong>Comment</strong>: <pre>Oh, see here https://gerrit.hyperledger.org/r/#/c/fabric/+/33513/2</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/tx/endorser/parser_test.go#L30](https://github.com/hyperledger-gerrit-archive/fabric/blob/5ebf2b3235f5a0b316db18018311f735da23848f/core/tx/endorser/parser_test.go#L30)<br><strong>Comment</strong>: <pre>In general our very nested, very opaque message format makes these tests awkward, but this still feels very awkward to me.

Could we instead do function pointers, which are setin this BeforeEach to the default, and then overriden in the BeforeEach of the individual tests?</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/tx/endorser/parser_test.go#L30](https://github.com/hyperledger-gerrit-archive/fabric/blob/5ebf2b3235f5a0b316db18018311f735da23848f/core/tx/endorser/parser_test.go#L30)<br><strong>Comment</strong>: <pre>Why is this awkward? What exactly are you referring to? If you refer to 
 - the use of BeforeEach, it seems like we're using it for the purpose it was designed, execute something before every test to reset variables that are shared between tests to an initial value
 - the way we exercise corner cases: I'm probably partial to it but it seems already very clean to me: each test overrides exactly one field before the proto message is built and marshaled. Someone who wants to know what has changed can just follow the code path in the "good case" and compare it to whichever test they want to inspect/understand.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/tx/endorser/parser_test.go#L30](https://github.com/hyperledger-gerrit-archive/fabric/blob/5ebf2b3235f5a0b316db18018311f735da23848f/core/tx/endorser/parser_test.go#L30)<br><strong>Comment</strong>: <pre>To me, idiomatic ginkgo should initialize all of the green path bits in the BeforeEach, and, override those green path bits in the individual contexts.  If I see 'hdrExtBytes = nil` in the BeforeEach, then I expect we're expecting that value to be nil in the green path.

As a rule, the "JustBeforeEach" pattern is something that's discouraged, and if necessary, should be kept as simple as possible.

I'm willing to let this one go, because with our absurd depth of opaque messages, there  really is no elegant way to do this, but this still strikes me as awkward.

https://github.com/hyperledger/fabric/blob/00433d7ca4914ce5230f87d376beb2ede078f816/core/endorser/msgvalidation_test.go#L26-L154

This is the way I chose to implement it for the proposal validation test.  Personally, I like the approach in that test better than what has been taken here, but, I'll not argue for a moment that the approach in msgvalidation_test.go is elegant.</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/tx/endorser/parser_test.go#L30](https://github.com/hyperledger-gerrit-archive/fabric/blob/5ebf2b3235f5a0b316db18018311f735da23848f/core/tx/endorser/parser_test.go#L30)<br><strong>Comment</strong>: <pre>As I've thought more about this.  If we want to go with this pattern instead of the function pointer approach, I'm thinking the cleanest way would be to get rid of the var section, un-inline the function from the JustBeforeEach back to a normal function, and invoke it in the BeforeEach of each test.  At the very least it's much more clear to the reader what's happening in each test, rather than using vars to pass parameters to a function.  It doesn't really use any of the Ginkgo shared setup... but, really, the current scheme doesn't either.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/tx/endorser/parser_test.go#L30](https://github.com/hyperledger-gerrit-archive/fabric/blob/5ebf2b3235f5a0b316db18018311f735da23848f/core/tx/endorser/parser_test.go#L30)<br><strong>Comment</strong>: <pre>> If I see 'hdrExtBytes = nil` in the BeforeEach, then I expect we're expecting that value to be nil in the green path

that's exactly the case

> As a rule, the "JustBeforeEach" pattern is something that's discouraged, and if necessary, should be kept as simple as possible

I did a little bit of reading in the source code, ginkgo docs and http://onsi.github.io/ginkgo/#separating_creation_and_configuration_ and I didn't see any reference about JustBeforeEach being discouraged. I did read a warning about nesting JustBeforeEach's, which I'm not doing. Otoh I saw an example under "Separating Creation and Configuration" which looked a lot like my code.

> idiomatic ginkgo
:) let's not lose sight of what we're trying to do here: "idiomaticity" is not the endgame here imho. If we have relatively decent test code which provides good coverage, we can call it a win.

All this to say that I wouldn't change this code without a good reason for it (unless you strongly feel that I should change it).</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/tx/endorser/parser_test.go#L30](https://github.com/hyperledger-gerrit-archive/fabric/blob/5ebf2b3235f5a0b316db18018311f735da23848f/core/tx/endorser/parser_test.go#L30)<br><strong>Comment</strong>: <pre>> > If I see 'hdrExtBytes = nil` in the BeforeEach, then I expect we're expecting that value to be nil in the green path
> that's exactly the case

Well, no, hdrExtBytes is set to 'nil' in your configuration, which means  that the header extension bytes are actually set to a default value via the JustBeforeEach.  The distinction is rather important, to use an contrived and egregious example one could write:

 BeforeEach(func() {
   a = 3
 })

 JustBeforeEach(func() {
   if a < 4 {
       a = 0
   } else {
       a = 9
   }
 })

Here, I expect the value of 'a' to be '3', because I set it in my BeforeEach, but, then the JustBeforeEach mutates it in an unexpected way.`Of course, it is more natural to fall-back to a default value when the value is zero, but it's still in a way unexpected.

> and I didn't see any reference about JustBeforeEach being discouraged. I did read a warning about nesting JustBeforeEach's, which I'm not doing

This was actually experientially from Matt.  To poorly paraphrase "When I first learned about 'JustBeforeEach' I thought it was the coolest thing, and I used it everywhere.  Later, I regretted almost every place I did."

> :) let's not lose sight of what we're trying to do here: "idiomaticity" is not the endgame here imho. If we have relatively decent test code which provides good coverage, we can call it a win.

So, I would say the endgame is test code which provides meaningful coverage and is maintainable.  Things which are idiomatic, are by definition "using, containing, or denoting expressions that are natural to a native speaker."  More specifically, that the next developer who comes behind you needs to (without great mental effort) be able understand and extend these tests.

In general, most of our existing test suites do not fit this bill, and it causes us problems.  Frequently, when working in a new area of code, I find via a combination of poor quality tests and cryptic setup ( MockInitPeer anyone? ), it's far better use of time to rewrite the test suite from scratch than to try to understand or extend it.

> All this to say that I wouldn't change this code without a good reason for it (unless you strongly feel that I should change it).

I still think the green path reads oddly, but, the rest of the cases read fairly naturally, so I'm okay with it as is.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/tx/endorser/parser_test.go#L30](https://github.com/hyperledger-gerrit-archive/fabric/blob/5ebf2b3235f5a0b316db18018311f735da23848f/core/tx/endorser/parser_test.go#L30)<br><strong>Comment</strong>: <pre>I think I have an idea how to improve this - let me try (see top of the stack in a bit)</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/tx/endorser/parser_test.go#L30](https://github.com/hyperledger-gerrit-archive/fabric/blob/5ebf2b3235f5a0b316db18018311f735da23848f/core/tx/endorser/parser_test.go#L30)<br><strong>Comment</strong>: <pre>so, how do you like this approach? https://gerrit.hyperledger.org/r/#/c/fabric/+/33779/

I've tried to separate the good path from the bad, define the overrides (and renamed them) only in the bad. WDYT?</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/tx/endorser/parser_test.go#L30](https://github.com/hyperledger-gerrit-archive/fabric/blob/5ebf2b3235f5a0b316db18018311f735da23848f/core/tx/endorser/parser_test.go#L30)<br><strong>Comment</strong>: <pre>+1 this is more clear to me.</pre></blockquote><h3>PatchSet Number: 5</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Uploader</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>Created</strong>: 9/24/2019, 3:12:09 PM<br><strong>GitHubMergedRevision</strong>: [460aa49fb5afc740bb2b9e577c48da24df4eb85a](https://github.com/hyperledger-gerrit-archive/fabric/commit/460aa49fb5afc740bb2b9e577c48da24df4eb85a)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/12/2019, 12:27:01 PM<br><strong>Type</strong>: F1-VerifyBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/12/2019, 12:27:01 PM<br><strong>Type</strong>: F2-DocBuild<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/12/2019, 1:44:23 PM<br><strong>Type</strong>: F3-IntegrationTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/12/2019, 12:51:51 PM<br><strong>Type</strong>: F3-UnitTest<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>Approved</strong>: 9/26/2019, 10:21:51 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Alessandro Sorniotti<br><strong>Merged</strong>: 10/7/2019, 4:32:09 AM<br><br><strong>Approver</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Approved</strong>: 10/3/2019, 4:32:16 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/tx/endorser/parser.go#L36](https://github.com/hyperledger-gerrit-archive/fabric/blob/460aa49fb5afc740bb2b9e577c48da24df4eb85a/core/tx/endorser/parser.go#L36)<br><strong>Comment</strong>: <pre>I guess that we decided to return the errors of type "tx.InvalidErr" with the applicable code - as we do here https://github.com/hyperledger/fabric/blob/d55d2008425d4f90243848b782f85e71aa8c19e2/core/tx/processor_factory.go#L56

Did you miss out on this?</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/tx/endorser/parser.go#L36](https://github.com/hyperledger-gerrit-archive/fabric/blob/460aa49fb5afc740bb2b9e577c48da24df4eb85a/core/tx/endorser/parser.go#L36)<br><strong>Comment</strong>: <pre>This isn't invoked directly by the transaction processor factory.  There's room to wrap/embed this error in a tx.InvalidErr before returning when this is actually wired through.  Any error returned by this function should be treated as an invalid tx, there is no such thing as a transient error here.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/tx/endorser/parser.go#L36](https://github.com/hyperledger-gerrit-archive/fabric/blob/460aa49fb5afc740bb2b9e577c48da24df4eb85a/core/tx/endorser/parser.go#L36)<br><strong>Comment</strong>: <pre>Yes, I had similar assumption when I looked at this but that would mean that we going to use the same code for all the errors. For instance, there are different codes for different situation in the current codes (e.g., TxValidationCode_BAD_HEADER_EXTENSION is used for line 42).

I am fine if we simply want to get rid of all the fine-grained codes and simply use a course level BAD_ENVELOPE but did not want to leave that to my assumption... is this what you are suggesting?</pre><strong>Commenter</strong>: Jason Yellick - jyellick@us.ibm.com<br><strong>CommentLine</strong>: [core/tx/endorser/parser.go#L36](https://github.com/hyperledger-gerrit-archive/fabric/blob/460aa49fb5afc740bb2b9e577c48da24df4eb85a/core/tx/endorser/parser.go#L36)<br><strong>Comment</strong>: <pre>Yes.  What do we think is the value of the fine grained error codes? Practically, the tx was assembled in a well formed way, or not.  It was validly endorsed, or not.  It has read conflicts, or not.  I'm not sure what other codes a user reasonably needs?

I think it's worth remembering that if this is a normal, valid endorser tx, the header etc. has already undergone these checks before endorsement, so the user would get these errors at a much earlier phase.  Trying to help a user debug via commit error codes seems like the wrong approach regardless.</pre><strong>Commenter</strong>: Manish Sethi - manish.sethi@gmail.com<br><strong>CommentLine</strong>: [core/tx/endorser/parser.go#L36](https://github.com/hyperledger-gerrit-archive/fabric/blob/460aa49fb5afc740bb2b9e577c48da24df4eb85a/core/tx/endorser/parser.go#L36)<br><strong>Comment</strong>: <pre>Yes, I am good with that as this simplifies the overall code. However, there is already committed code that uses some of these codes and we will need to fix that.

If we go with this approach we can further simplify these things a bit differently (especially from the point of view of writing a TxProcessor). We can simply remove the need of "tx.InvalidErr" from all the functions other than "Process" as every other function simply work on the envelope and any error will result into BAD_ENVELOPE by the block processor automatically.

I'll let Ale also speak his opinion and if he is also onboard, we can simplify things here.</pre><strong>Commenter</strong>: Alessandro Sorniotti - ale.linux@sopit.net<br><strong>CommentLine</strong>: [core/tx/endorser/parser.go#L36](https://github.com/hyperledger-gerrit-archive/fabric/blob/460aa49fb5afc740bb2b9e577c48da24df4eb85a/core/tx/endorser/parser.go#L36)<br><strong>Comment</strong>: <pre>I too don't see much value in finer grained tx err codes: in fact, they are prone to induce forks if ever someone decides to change something or even just reorder checks. I would go with a generic invalidation message - errors will anyway be logged.</pre></blockquote>