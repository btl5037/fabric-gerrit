<strong>Project</strong>: fabric-test<br><strong>Branch</strong>: master<br><strong>ID</strong>: 13603<br><strong>Subject</strong>: [FAB-6211] Behave: support for chaincode languages<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Ratnakar Asara - asara.ratnakar@gmail.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 9/19/2017, 9:43:11 AM<br><strong>LastUpdated</strong>: 9/20/2017, 10:35:00 AM<br><strong>CommitMessage</strong>:<br><pre>[FAB-6211] Behave: support for chaincode languages

In the Behave framework, added support for chaincode languages
(added a flag --lang).This will help in testing various chaincodes written
 in other than go language (At the moment it is nodejs)

Also added a smoke test to test chaincode written in golang
 and nodejs.We can add java chaincode once the support is enabled in fabric

Change-Id: I38fd00112def1faa09306448016d0fa8a57b1cc9
Signed-off-by: ratnakar <asara.ratnakar@gmail.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Ratnakar Asara - asara.ratnakar@gmail.com<br><strong>Reviewed</strong>: 9/19/2017, 9:43:11 AM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Adnan C - adnan.choudhury@itpeoplecorp.com<br><strong>Reviewed</strong>: 9/19/2017, 9:56:27 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(3 comments)

Mostly LGTM, coupl eof commets</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/19/2017, 10:13:11 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/47/</pre><strong>Reviewer</strong>: Ratnakar Asara - asara.ratnakar@gmail.com<br><strong>Reviewed</strong>: 9/19/2017, 10:30:10 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(3 comments)

Thankyou for the comments Adnan.
please find my comments inline</pre><strong>Reviewer</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>Reviewed</strong>: 9/19/2017, 10:36:32 AM<br><strong>Message</strong>: <pre>Patch Set 1: Code-Review+1

(2 comments)</pre><strong>Reviewer</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>Reviewed</strong>: 9/19/2017, 10:38:16 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(1 comment)</pre><strong>Reviewer</strong>: Adnan C - adnan.choudhury@itpeoplecorp.com<br><strong>Reviewed</strong>: 9/19/2017, 10:42:09 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(2 comments)</pre><strong>Reviewer</strong>: Ratnakar Asara - asara.ratnakar@gmail.com<br><strong>Reviewed</strong>: 9/19/2017, 10:52:36 AM<br><strong>Message</strong>: <pre>Uploaded patch set 2.</pre><strong>Reviewer</strong>: Ratnakar Asara - asara.ratnakar@gmail.com<br><strong>Reviewed</strong>: 9/19/2017, 10:53:05 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(1 comment)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/19/2017, 10:53:41 AM<br><strong>Message</strong>: <pre>Patch Set 1: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/47/ : ABORTED

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/47/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-test-verify-x86_64/47</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/19/2017, 10:54:09 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/49/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/19/2017, 11:52:41 AM<br><strong>Message</strong>: <pre>Patch Set 2: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/49/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-test-verify-x86_64/49</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 9/19/2017, 12:14:51 PM<br><strong>Message</strong>: <pre>Patch Set 2: Code-Review-1

(5 comments)</pre><strong>Reviewer</strong>: Ratnakar Asara - asara.ratnakar@gmail.com<br><strong>Reviewed</strong>: 9/19/2017, 2:24:58 PM<br><strong>Message</strong>: <pre>Patch Set 2:

(5 comments)</pre><strong>Reviewer</strong>: Ratnakar Asara - asara.ratnakar@gmail.com<br><strong>Reviewed</strong>: 9/19/2017, 3:01:24 PM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/19/2017, 3:05:47 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/55/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/19/2017, 4:00:58 PM<br><strong>Message</strong>: <pre>Patch Set 3: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/55/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-test-verify-x86_64/55</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 9/19/2017, 5:44:54 PM<br><strong>Message</strong>: <pre>Patch Set 3: Code-Review-1

(1 comment)

Adnan feels the same about this. Is there a reason you removed the chanincode name (example02) from the name of the file?</pre><strong>Reviewer</strong>: Ratnakar Asara - asara.ratnakar@gmail.com<br><strong>Reviewed</strong>: 9/19/2017, 9:10:25 PM<br><strong>Message</strong>: <pre>Patch Set 3:

(1 comment)</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 9/19/2017, 10:00:21 PM<br><strong>Message</strong>: <pre>Patch Set 3: Code-Review+1</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 9/20/2017, 9:50:37 AM<br><strong>Message</strong>: <pre>Patch Set 3: Verified+1</pre><strong>Reviewer</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>Reviewed</strong>: 9/20/2017, 10:34:57 AM<br><strong>Message</strong>: <pre>Patch Set 3: Code-Review+2</pre><strong>Reviewer</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>Reviewed</strong>: 9/20/2017, 10:35:00 AM<br><strong>Message</strong>: <pre>Change has been successfully merged by Latitia Haskins</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ratnakar Asara - asara.ratnakar@gmail.com<br><strong>Uploader</strong>: Ratnakar Asara - asara.ratnakar@gmail.com<br><strong>Created</strong>: 9/19/2017, 9:43:11 AM<br><strong>UnmergedRevision</strong>: [b6fbb59d194f0f9fe1e52882cee6e5a73c1a082f](https://github.com/hyperledger-gerrit-archive/fabric-test/commit/b6fbb59d194f0f9fe1e52882cee6e5a73c1a082f)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/19/2017, 10:53:41 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>Approved</strong>: 9/19/2017, 10:36:32 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>CommentLine</strong>: [feature/chaincodes.feature#L335](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/b6fbb59d194f0f9fe1e52882cee6e5a73c1a082f/feature/chaincodes.feature#L335)<br><strong>Comment</strong>: <pre>Thank you!</pre><strong>Commenter</strong>: Adnan C - adnan.choudhury@itpeoplecorp.com<br><strong>CommentLine</strong>: [feature/chaincodes.feature#L340](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/b6fbb59d194f0f9fe1e52882cee6e5a73c1a082f/feature/chaincodes.feature#L340)<br><strong>Comment</strong>: <pre>Should this be part of a statement, or maybe the language should be inferred from the file extension? The statement as-is implies that there may be more than one chaincode available in the path and we are choosing one of them based on language.</pre><strong>Commenter</strong>: Ratnakar Asara - asara.ratnakar@gmail.com<br><strong>CommentLine</strong>: [feature/chaincodes.feature#L340](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/b6fbb59d194f0f9fe1e52882cee6e5a73c1a082f/feature/chaincodes.feature#L340)<br><strong>Comment</strong>: <pre>It would be very tricky to figure out the language based on the file extension. language is one of the option which Fabric deploy (install & Instantiate supports) and we are supporting the same option in our behave framework.

This comment makes me write little more description:
For Go language, The source is variable in $GOPATH/src + path
where as for node language, the source is available at the path specified</pre><strong>Commenter</strong>: Adnan C - adnan.choudhury@itpeoplecorp.com<br><strong>CommentLine</strong>: [feature/chaincodes.feature#L340](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/b6fbb59d194f0f9fe1e52882cee6e5a73c1a082f/feature/chaincodes.feature#L340)<br><strong>Comment</strong>: <pre>Agreed.</pre><strong>Commenter</strong>: Adnan C - adnan.choudhury@itpeoplecorp.com<br><strong>CommentLine</strong>: [feature/chaincodes.feature#L351](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/b6fbb59d194f0f9fe1e52882cee6e5a73c1a082f/feature/chaincodes.feature#L351)<br><strong>Comment</strong>: <pre>Probably should be "Go"</pre><strong>Commenter</strong>: Ratnakar Asara - asara.ratnakar@gmail.com<br><strong>CommentLine</strong>: [feature/chaincodes.feature#L351](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/b6fbb59d194f0f9fe1e52882cee6e5a73c1a082f/feature/chaincodes.feature#L351)<br><strong>Comment</strong>: <pre>this defined in Fabric and it is GOLANG
https://github.com/hyperledger/fabric/blob/release/protos/peer/chaincode.proto#L64</pre><strong>Commenter</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>CommentLine</strong>: [feature/chaincodes.feature#L351](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/b6fbb59d194f0f9fe1e52882cee6e5a73c1a082f/feature/chaincodes.feature#L351)<br><strong>Comment</strong>: <pre>"GOLANG" is the language that is used by default.</pre><strong>Commenter</strong>: Adnan C - adnan.choudhury@itpeoplecorp.com<br><strong>CommentLine</strong>: [feature/chaincodes.feature#L352](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/b6fbb59d194f0f9fe1e52882cee6e5a73c1a082f/feature/chaincodes.feature#L352)<br><strong>Comment</strong>: <pre>same.</pre><strong>Commenter</strong>: Ratnakar Asara - asara.ratnakar@gmail.com<br><strong>CommentLine</strong>: [feature/chaincodes.feature#L352](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/b6fbb59d194f0f9fe1e52882cee6e5a73c1a082f/feature/chaincodes.feature#L352)<br><strong>Comment</strong>: <pre>same as above</pre><strong>Commenter</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>CommentLine</strong>: [feature/chaincodes.feature#L353](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/b6fbb59d194f0f9fe1e52882cee6e5a73c1a082f/feature/chaincodes.feature#L353)<br><strong>Comment</strong>: <pre>Let's make in all caps to be consistent.</pre><strong>Commenter</strong>: Adnan C - adnan.choudhury@itpeoplecorp.com<br><strong>CommentLine</strong>: [feature/chaincodes.feature#L353](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/b6fbb59d194f0f9fe1e52882cee6e5a73c1a082f/feature/chaincodes.feature#L353)<br><strong>Comment</strong>: <pre>Agreed.</pre><strong>Commenter</strong>: Ratnakar Asara - asara.ratnakar@gmail.com<br><strong>CommentLine</strong>: [feature/chaincodes.feature#L353](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/b6fbb59d194f0f9fe1e52882cee6e5a73c1a082f/feature/chaincodes.feature#L353)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ratnakar Asara - asara.ratnakar@gmail.com<br><strong>Uploader</strong>: Ratnakar Asara - asara.ratnakar@gmail.com<br><strong>Created</strong>: 9/19/2017, 10:52:36 AM<br><strong>UnmergedRevision</strong>: [d1435e0a386f35a8f1939d5c26576c177dd55563](https://github.com/hyperledger-gerrit-archive/fabric-test/commit/d1435e0a386f35a8f1939d5c26576c177dd55563)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/19/2017, 11:52:41 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Approved</strong>: 9/19/2017, 12:14:51 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [/COMMIT_MSG#L9](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/d1435e0a386f35a8f1939d5c26576c177dd55563//COMMIT_MSG#L9)<br><strong>Comment</strong>: <pre>spelling typo</pre><strong>Commenter</strong>: Ratnakar Asara - asara.ratnakar@gmail.com<br><strong>CommentLine</strong>: [/COMMIT_MSG#L9](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/d1435e0a386f35a8f1939d5c26576c177dd55563//COMMIT_MSG#L9)<br><strong>Comment</strong>: <pre>will takecare of this in next patch</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [/COMMIT_MSG#L13](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/d1435e0a386f35a8f1939d5c26576c177dd55563//COMMIT_MSG#L13)<br><strong>Comment</strong>: <pre>delete word. we did not add a new test suite, just a test.</pre><strong>Commenter</strong>: Ratnakar Asara - asara.ratnakar@gmail.com<br><strong>CommentLine</strong>: [/COMMIT_MSG#L13](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/d1435e0a386f35a8f1939d5c26576c177dd55563//COMMIT_MSG#L13)<br><strong>Comment</strong>: <pre>will takecare of this in next patch</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [feature/chaincode/node/example02/chaincode.js#L0](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/d1435e0a386f35a8f1939d5c26576c177dd55563/feature/chaincode/node/example02/chaincode.js#L0)<br><strong>Comment</strong>: <pre>I really really really really hesitate to bring this up, but I wonder if we should put these files for this node version inside fabric repository at fabric/examples/chaincode/node/example02/, alongside the directories fabric/examples/chaincode/go/ and fabric/examples/chaincode/java/.

Or possibly move those here inside fabric/test/chaincode/.</pre><strong>Commenter</strong>: Ratnakar Asara - asara.ratnakar@gmail.com<br><strong>CommentLine</strong>: [feature/chaincode/node/example02/chaincode.js#L0](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/d1435e0a386f35a8f1939d5c26576c177dd55563/feature/chaincode/node/example02/chaincode.js#L0)<br><strong>Comment</strong>: <pre>Jim Zhang has agreed  to maintain this chaincode under fabric-test repository.If we wanted to add a sample or change the existing byfn to use node chaincode we can move to fabric-samples at later point</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [feature/chaincodes.feature#L336](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/d1435e0a386f35a8f1939d5c26576c177dd55563/feature/chaincodes.feature#L336)<br><strong>Comment</strong>: <pre>This test really only executes the default (example02) chaincode, because the chaincode arguments lists and query response values are embedded as part of the test rather than parameters. Let's change this word to "example02 chaincode". And reconsider if we need to provide a pathname at all.

If we want to be able to use this to test other chaincodes, as indicated by the fact that you are allowing people to supply a pathname, then the test should provide other parameters (init_args, query1_args, invoke_args, query2_args). Moreover, we should probably also make parameters of the confirmation values of the query responses (in this example02 case, that means the 1000, 990, etc). But I think might make this testcase grow too complicated. So how about instead we let people create a copy of this testcase for each different chaincode.</pre><strong>Commenter</strong>: Ratnakar Asara - asara.ratnakar@gmail.com<br><strong>CommentLine</strong>: [feature/chaincodes.feature#L336](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/d1435e0a386f35a8f1939d5c26576c177dd55563/feature/chaincodes.feature#L336)<br><strong>Comment</strong>: <pre>I will change it to example02</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [feature/steps/endorser_impl.py#L69](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/d1435e0a386f35a8f1939d5c26576c177dd55563/feature/steps/endorser_impl.py#L69)<br><strong>Comment</strong>: <pre>missing a space here. does that matter?</pre><strong>Commenter</strong>: Ratnakar Asara - asara.ratnakar@gmail.com<br><strong>CommentLine</strong>: [feature/steps/endorser_impl.py#L69](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/d1435e0a386f35a8f1939d5c26576c177dd55563/feature/steps/endorser_impl.py#L69)<br><strong>Comment</strong>: <pre>it doesn't. however i shall format it.</pre></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ratnakar Asara - asara.ratnakar@gmail.com<br><strong>Uploader</strong>: Ratnakar Asara - asara.ratnakar@gmail.com<br><strong>Created</strong>: 9/19/2017, 3:01:24 PM<br><strong>GitHubMergedRevision</strong>: [b92a555ffb238923d21d0e410a15a199e26f2955](https://github.com/hyperledger-gerrit-archive/fabric-test/commit/b92a555ffb238923d21d0e410a15a199e26f2955)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/19/2017, 4:00:58 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Approved</strong>: 9/19/2017, 10:00:21 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Approved</strong>: 9/20/2017, 9:50:37 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>Approved</strong>: 9/20/2017, 10:34:57 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Latitia Haskins<br><strong>Merged</strong>: 9/20/2017, 10:35:00 AM<br><br><h2>Comments</h2><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [chaincodes/example02/node/chaincode.js#L0](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/b92a555ffb238923d21d0e410a15a199e26f2955/chaincodes/example02/node/chaincode.js#L0)<br><strong>Comment</strong>: <pre>Can we please rename this to chaincode_example02.js?
Similar to ../fabric/examples/chaincode/go/chaincode_example02/chaincode_example02.go</pre><strong>Commenter</strong>: Ratnakar Asara - asara.ratnakar@gmail.com<br><strong>CommentLine</strong>: [chaincodes/example02/node/chaincode.js#L0](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/b92a555ffb238923d21d0e410a15a199e26f2955/chaincodes/example02/node/chaincode.js#L0)<br><strong>Comment</strong>: <pre>I haven't named this to chaincode_example02.js in the first place , because it doesn't accept any name other than chaincode.js (at the moment).

I think we should come out of golang cc world when we are dealing with nodejs cc. node cc works slightly different from the way golang cc.
Golang chaincode looks for file with main method while compiling, where as it is not in node chaincode.

BTW, I ran the code by changing the file name to chaincode_example02.js and here is the error message.
For your reference:
https://gist.github.com/asararatnakar/fcb35d72f2bb46eed861f1111b8ab69e#file-error-log</pre></blockquote>