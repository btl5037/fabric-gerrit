<strong>Project</strong>: fabric-test<br><strong>Branch</strong>: master<br><strong>ID</strong>: 13611<br><strong>Subject</strong>: [FAB-4770] - Test taking down all (3) kafka<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Nishi Nidamarty - 2016Nishi@GMail.Com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 9/19/2017, 1:07:47 PM<br><strong>LastUpdated</strong>: 9/22/2017, 6:10:50 PM<br><strong>CommitMessage</strong>:<br><pre>[FAB-4770] - Test taking down all (3) kafka

brokers in the RF set, and bringing them back in LIFO order

In this test scenario where we disconnect fails

Change-Id: Ib57560e46d5e1e63ee54425658e89e40135848f1
Signed-off-by: nishi.nidamarty <nishi.nidamarty@itpeoplecorp.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Nishi Nidamarty - 2016Nishi@GMail.Com<br><strong>Reviewed</strong>: 9/19/2017, 1:07:47 PM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Nishi Nidamarty - 2016Nishi@GMail.Com<br><strong>Reviewed</strong>: 9/19/2017, 1:08:32 PM<br><strong>Message</strong>: <pre>Patch Set 2: Commit message was updated.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/19/2017, 1:10:13 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/51/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/19/2017, 2:07:05 PM<br><strong>Message</strong>: <pre>Patch Set 2: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/51/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/51/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-test-verify-x86_64/51</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 9/19/2017, 3:27:22 PM<br><strong>Message</strong>: <pre>Patch Set 2: Code-Review-1

(3 comments)</pre><strong>Reviewer</strong>: Nishi Nidamarty - 2016Nishi@GMail.Com<br><strong>Reviewed</strong>: 9/19/2017, 4:26:49 PM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/19/2017, 4:31:26 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/56/</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 9/19/2017, 5:04:09 PM<br><strong>Message</strong>: <pre>Patch Set 2:

(5 comments)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/19/2017, 5:15:20 PM<br><strong>Message</strong>: <pre>Patch Set 3: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/56/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-test-verify-x86_64/56</pre><strong>Reviewer</strong>: Nishi Nidamarty - 2016Nishi@GMail.Com<br><strong>Reviewed</strong>: 9/19/2017, 5:51:18 PM<br><strong>Message</strong>: <pre>Uploaded patch set 4.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/19/2017, 5:54:00 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/57/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/19/2017, 6:33:48 PM<br><strong>Message</strong>: <pre>Patch Set 4: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/57/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-test-verify-x86_64/57</pre><strong>Reviewer</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>Reviewed</strong>: 9/19/2017, 6:59:28 PM<br><strong>Message</strong>: <pre>Patch Set 4: Code-Review-1

(10 comments)</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 9/19/2017, 9:41:18 PM<br><strong>Message</strong>: <pre>Patch Set 4: Code-Review-1

(6 comments)</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 9/20/2017, 11:15:28 AM<br><strong>Message</strong>: <pre>Patch Set 4:

(1 comment)</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 9/20/2017, 3:18:26 PM<br><strong>Message</strong>: <pre>Patch Set 4: -Code-Review

I found this on the kafka doc page https://godoc.org/github.com/Shopify/sarama#Config
I believe this means the orderer must wait at least 30 secs (default) for the Config.Net.WriteTimeout value to fire, before triggering a timeout failure in the orderer (when orderer sends a transaction to the kafka). And I don't know - but maybe that that means the orderer should delay up to 30+ secs before responding to a client for a transaction request with a SERVICE_UNAVAILABLE failure (such as when we disconnect a kafkabroker and then try to send an invoke).

type Config struct {
    // Net is the namespace for network-level properties used by the Broker, and
    // shared by the Client/Producer/Consumer.
    Net struct {
        // How many outstanding requests a connection is allowed to have before
        // sending on it blocks (default 5).
        MaxOpenRequests int

        // All three of the below configurations are similar to the
        // `socket.timeout.ms` setting in JVM kafka. All of them default
        // to 30 seconds.
        DialTimeout  time.Duration // How long to wait for the initial connection.
        ReadTimeout  time.Duration // How long to wait for a response.
        WriteTimeout time.Duration // How long to wait for a transmit.

        TLS struct {
            // Whether or not to use TLS when connecting to the broker
            // (defaults to false).
            Enable bool
            // The TLS configuration to use for secure connections if
            // enabled (defaults to nil).
            Config *tls.Config
        }
 ...</pre><strong>Reviewer</strong>: Nishi Nidamarty - 2016Nishi@GMail.Com<br><strong>Reviewed</strong>: 9/20/2017, 4:22:53 PM<br><strong>Message</strong>: <pre>Uploaded patch set 5.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/20/2017, 4:26:39 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/64/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/20/2017, 5:09:58 PM<br><strong>Message</strong>: <pre>Patch Set 5: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/64/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-test-verify-x86_64/64</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 9/20/2017, 8:15:41 PM<br><strong>Message</strong>: <pre>Patch Set 5: Code-Review-1

(11 comments)

Getting closer to done; the basic test steps seem to be nearly done; I provided only some minor comments and cleanup for that.
Please go through these AND previous comments; there are a couple that could be addressed (or at least should be discussed).
I ran your test; it took 30 minutes, and it passed for stop and disconnect, but failed for pause. If anyone gets different results, then (once the cleanup is done) we could probably merge this, and collect logs from the test so we can create a bug.</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 9/20/2017, 8:39:15 PM<br><strong>Message</strong>: <pre>Patch Set 5: Verified-1

Updating my testing status:
I previously reported running the test with these results:
stop - pass
pause - fail
discon - pass
I just finished running it again, with these results (opposite!):
stop - fail
pause - pass
discon - fail</pre><strong>Reviewer</strong>: Nishi Nidamarty - 2016Nishi@GMail.Com<br><strong>Reviewed</strong>: 9/22/2017, 3:55:01 PM<br><strong>Message</strong>: <pre>Uploaded patch set 6.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/22/2017, 3:58:41 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/78/</pre><strong>Reviewer</strong>: Nishi Nidamarty - 2016Nishi@GMail.Com<br><strong>Reviewed</strong>: 9/22/2017, 4:09:24 PM<br><strong>Message</strong>: <pre>Uploaded patch set 7.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/22/2017, 4:10:38 PM<br><strong>Message</strong>: <pre>Patch Set 6: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/78/ : ABORTED

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/78/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-test-verify-x86_64/78</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/22/2017, 4:13:48 PM<br><strong>Message</strong>: <pre>Patch Set 7:

Build Started https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/80/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/22/2017, 4:57:57 PM<br><strong>Message</strong>: <pre>Patch Set 7: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/80/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-test-verify-x86_64/80</pre><strong>Reviewer</strong>: Nishi Nidamarty - 2016Nishi@GMail.Com<br><strong>Reviewed</strong>: 9/22/2017, 5:26:06 PM<br><strong>Message</strong>: <pre>Uploaded patch set 8.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/22/2017, 5:29:18 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/81/</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 9/22/2017, 5:44:46 PM<br><strong>Message</strong>: <pre>Patch Set 7: Verified+1 Code-Review+2

Test FAB-4770 passes for stop/start, occasionally fails for pause/unpause, and usually fails for disconnect; we should create a bug for that - after we merge this test, so designers will be able to run the test to in order to easily reproduce the issue and get logs.</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 9/22/2017, 5:45:40 PM<br><strong>Message</strong>: <pre>Patch Set 8: Verified+1 Code-Review+2</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 9/22/2017, 5:49:19 PM<br><strong>Message</strong>: <pre>Change has been successfully merged by Scott Zwierzynski</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/22/2017, 5:53:23 PM<br><strong>Message</strong>: <pre>Patch Set 8:

Build Started https://jenkins.hyperledger.org/job/fabric-test-merge-x86_64/18/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/22/2017, 6:10:50 PM<br><strong>Message</strong>: <pre>Patch Set 8: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/81/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-1/fabric-test-verify-x86_64/81</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Nishi Nidamarty - 2016Nishi@GMail.Com<br><strong>Uploader</strong>: Nishi Nidamarty - 2016Nishi@GMail.Com<br><strong>Created</strong>: 9/19/2017, 1:07:47 PM<br><strong>UnmergedRevision</strong>: [d3e7e662526b575d61715b198d034152a17ea0ec](https://github.com/hyperledger-gerrit-archive/fabric-test/commit/d3e7e662526b575d61715b198d034152a17ea0ec)<br><br></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: NO_CODE_CHANGE<br><strong>Author</strong>: Nishi Nidamarty - 2016Nishi@GMail.Com<br><strong>Uploader</strong>: Nishi Nidamarty - 2016Nishi@GMail.Com<br><strong>Created</strong>: 9/19/2017, 1:08:32 PM<br><strong>UnmergedRevision</strong>: [474e7edd6ac1b5a42eb2c14800352cc9ca00e7f4](https://github.com/hyperledger-gerrit-archive/fabric-test/commit/474e7edd6ac1b5a42eb2c14800352cc9ca00e7f4)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/19/2017, 2:07:05 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Approved</strong>: 9/19/2017, 3:27:22 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [feature/orderer.feature#L197](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/474e7edd6ac1b5a42eb2c14800352cc9ca00e7f4/feature/orderer.feature#L197)<br><strong>Comment</strong>: <pre>This is a nit, but it is bothersome; "is" requires a past verb tense instead of the present-tense verbs needed for the docker commands. How about rewording like this:

the topic partition leader <takeDownType>s
(stop / pause / disconnect )
the topic partition leader stops
the topic partition leader pauses
the topic partition leader disconnects</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [feature/steps/orderer_impl.py#L78](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/474e7edd6ac1b5a42eb2c14800352cc9ca00e7f4/feature/steps/orderer_impl.py#L78)<br><strong>Comment</strong>: <pre>we need to call bringdown_impl instead of directly calling the stop function here.</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [feature/steps/orderer_impl.py#L86](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/474e7edd6ac1b5a42eb2c14800352cc9ca00e7f4/feature/steps/orderer_impl.py#L86)<br><strong>Comment</strong>: <pre>I think we can delete this, and just save the prevLeader (which we just stopped) in the context for later.</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [feature/steps/orderer_impl.py#L112](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/474e7edd6ac1b5a42eb2c14800352cc9ca00e7f4/feature/steps/orderer_impl.py#L112)<br><strong>Comment</strong>: <pre>need to call bringup_impl (and pass parameters) instead of calling start every time.</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [feature/steps/orderer_impl.py#L130](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/474e7edd6ac1b5a42eb2c14800352cc9ca00e7f4/feature/steps/orderer_impl.py#L130)<br><strong>Comment</strong>: <pre>can we make this a parameter {expectedCount}, to make the function more useful? the user could pass in the number to compare to length of the list of the kafka brokers.</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [feature/steps/orderer_impl.py#L132](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/474e7edd6ac1b5a42eb2c14800352cc9ca00e7f4/feature/steps/orderer_impl.py#L132)<br><strong>Comment</strong>: <pre>isr_list length does not match expected number of brokers {expectedCount}</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [feature/steps/orderer_impl.py#L134](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/474e7edd6ac1b5a42eb2c14800352cc9ca00e7f4/feature/steps/orderer_impl.py#L134)<br><strong>Comment</strong>: <pre>We do not need to recalculate the leader, but we DO need to query kafkabroker for the latest actual isr_list, and check if the "previous" leader has been removed from the current isr_list (latest view of a running broker). 
The backend needs to know the brokers that it did not yet stop, and ask one of those for the current isr_list. Does it?</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [feature/steps/orderer_impl.py#L138](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/474e7edd6ac1b5a42eb2c14800352cc9ca00e7f4/feature/steps/orderer_impl.py#L138)<br><strong>Comment</strong>: <pre>before we check logs, we can recalculate the isr list, and make sure the prevLeader is not in it.
And we may need a way to identify the NUMBER of TIMES the log appears (using the grep -c)</pre></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Nishi Nidamarty - 2016Nishi@GMail.Com<br><strong>Uploader</strong>: Nishi Nidamarty - 2016Nishi@GMail.Com<br><strong>Created</strong>: 9/19/2017, 4:26:49 PM<br><strong>UnmergedRevision</strong>: [954ed10723718dae712240ab6c3d44faca45c6e8](https://github.com/hyperledger-gerrit-archive/fabric-test/commit/954ed10723718dae712240ab6c3d44faca45c6e8)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/19/2017, 5:15:20 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Nishi Nidamarty - 2016Nishi@GMail.Com<br><strong>Uploader</strong>: Nishi Nidamarty - 2016Nishi@GMail.Com<br><strong>Created</strong>: 9/19/2017, 5:51:18 PM<br><strong>UnmergedRevision</strong>: [b91a99b75a5ce3bffa39a773f58364afa68ba608](https://github.com/hyperledger-gerrit-archive/fabric-test/commit/b91a99b75a5ce3bffa39a773f58364afa68ba608)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/19/2017, 6:33:48 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>Approved</strong>: 9/19/2017, 6:59:28 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [feature/orderer.feature#L197](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/b91a99b75a5ce3bffa39a773f58364afa68ba608/feature/orderer.feature#L197)<br><strong>Comment</strong>: <pre>how about using this way, so it reads better (uses the verb that docker uses, from the list):
When we <takeDownType> the topic partition leader</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [feature/orderer.feature#L198](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/b91a99b75a5ce3bffa39a773f58364afa68ba608/feature/orderer.feature#L198)<br><strong>Comment</strong>: <pre>We need to understand the timers for disconnect and other things in the kafka brokers, so we know how long to specify to wait.</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [feature/orderer.feature#L220](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/b91a99b75a5ce3bffa39a773f58364afa68ba608/feature/orderer.feature#L220)<br><strong>Comment</strong>: <pre>Maybe we should delete this and add a comment that we cannot confirm the broker is down and cannot confirm the ISR set is empty - because it will not work, because there is no kafkabroker available to display a log about its neighbor broker going down or to tell us the size of the isr_set.</pre><strong>Commenter</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>CommentLine</strong>: [feature/orderer.feature#L229](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/b91a99b75a5ce3bffa39a773f58364afa68ba608/feature/orderer.feature#L229)<br><strong>Comment</strong>: <pre>Remove extra white spaces.</pre><strong>Commenter</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>CommentLine</strong>: [feature/orderer.feature#L250](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/b91a99b75a5ce3bffa39a773f58364afa68ba608/feature/orderer.feature#L250)<br><strong>Comment</strong>: <pre>Replace tabs with spaces.</pre><strong>Commenter</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>CommentLine</strong>: [feature/steps/orderer_impl.py#L81](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/b91a99b75a5ce3bffa39a773f58364afa68ba608/feature/steps/orderer_impl.py#L81)<br><strong>Comment</strong>: <pre>Where are you using this and why? You can check in the context.stopped_broker list to see if the broker is in that list or not.</pre><strong>Commenter</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>CommentLine</strong>: [feature/steps/orderer_impl.py#L109](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/b91a99b75a5ce3bffa39a773f58364afa68ba608/feature/steps/orderer_impl.py#L109)<br><strong>Comment</strong>: <pre>Why would this not use the orderer that you designated?</pre><strong>Commenter</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>CommentLine</strong>: [feature/steps/orderer_impl.py#L128](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/b91a99b75a5ce3bffa39a773f58364afa68ba608/feature/steps/orderer_impl.py#L128)<br><strong>Comment</strong>: <pre>This should be configurable. What if I want to verify that the list contains more than 1 broker?</pre><strong>Commenter</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>CommentLine</strong>: [feature/steps/orderer_impl.py#L128](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/b91a99b75a5ce3bffa39a773f58364afa68ba608/feature/steps/orderer_impl.py#L128)<br><strong>Comment</strong>: <pre>This should probably say "ensure kafka ISR set contains <count> brokers"</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [feature/steps/orderer_impl.py#L128](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/b91a99b75a5ce3bffa39a773f58364afa68ba608/feature/steps/orderer_impl.py#L128)<br><strong>Comment</strong>: <pre>Agreed. Nishi and I discussed this too.</pre><strong>Commenter</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>CommentLine</strong>: [feature/steps/orderer_impl.py#L134](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/b91a99b75a5ce3bffa39a773f58364afa68ba608/feature/steps/orderer_impl.py#L134)<br><strong>Comment</strong>: <pre>Remove</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [feature/steps/orderer_impl.py#L140](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/b91a99b75a5ce3bffa39a773f58364afa68ba608/feature/steps/orderer_impl.py#L140)<br><strong>Comment</strong>: <pre>I think this is the only place that requires the isr_list. Should we create a new function to obtain it, and use it here, so we can avoid having getKafkaTopic return the isr_list for all cases?</pre><strong>Commenter</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>CommentLine</strong>: [feature/steps/orderer_impl.py#L142](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/b91a99b75a5ce3bffa39a773f58364afa68ba608/feature/steps/orderer_impl.py#L142)<br><strong>Comment</strong>: <pre>This can be checked by verifying that the brokers in the stopped_broker list are not in the isr_set.</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [feature/steps/orderer_impl.py#L142](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/b91a99b75a5ce3bffa39a773f58364afa68ba608/feature/steps/orderer_impl.py#L142)<br><strong>Comment</strong>: <pre>Is checking one broker enough? Does the fact that one broker knows the new ISR set necessarily mean all brokers are aware? Thinking about a disconnect scenario. But maybe what we really need to do is check the ISR set FROM EACH BROKER, to confirm that all of them believe the prevLeader (or the entire stopped_broker_list) is no longer part of isr_set. Can we do that? In that case, we know the next invoke would work (if len(isr_set) >= min_isr) or else we know the next invoke should fail (SERVICE_UNAVAILABLE).</pre><strong>Commenter</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>CommentLine</strong>: [feature/steps/orderer_impl.py#L145](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/b91a99b75a5ce3bffa39a773f58364afa68ba608/feature/steps/orderer_impl.py#L145)<br><strong>Comment</strong>: <pre>I don't think this is good enough. You need to check that a specific broker was stopped. I think you should look for the other string that designates a specific broker.</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [feature/steps/orderer_impl.py#L145](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/b91a99b75a5ce3bffa39a773f58364afa68ba608/feature/steps/orderer_impl.py#L145)<br><strong>Comment</strong>: <pre>Nishi and I also discussed this was inadequate, and I have a couple ideas how to improve it. Your idea is fine, but I am not sure what other log string can be used. Hopefully there actually is one that works.</pre><strong>Commenter</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>CommentLine</strong>: [feature/steps/orderer_impl.py#L206](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/b91a99b75a5ce3bffa39a773f58364afa68ba608/feature/steps/orderer_impl.py#L206)<br><strong>Comment</strong>: <pre>Remove this. You should be using the is_in_log method that is in common_util</pre></blockquote><h3>PatchSet Number: 5</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Nishi Nidamarty - 2016Nishi@GMail.Com<br><strong>Uploader</strong>: Nishi Nidamarty - 2016Nishi@GMail.Com<br><strong>Created</strong>: 9/20/2017, 4:22:53 PM<br><strong>UnmergedRevision</strong>: [07b615e021caafe4344696c0915bf458ed7ce883](https://github.com/hyperledger-gerrit-archive/fabric-test/commit/07b615e021caafe4344696c0915bf458ed7ce883)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/20/2017, 5:09:58 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Approved</strong>: 9/20/2017, 8:15:41 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Approved</strong>: 9/20/2017, 8:39:15 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [feature/orderer.feature#L197](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/07b615e021caafe4344696c0915bf458ed7ce883/feature/orderer.feature#L197)<br><strong>Comment</strong>: <pre>suggest insert 3 words:
... the current kafka topic partition leader</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [feature/orderer.feature#L210](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/07b615e021caafe4344696c0915bf458ed7ce883/feature/orderer.feature#L210)<br><strong>Comment</strong>: <pre>Can we simplify this way?
    And I wait "65" seconds
    Then the broker is reported as down
    And ensure kafka ISR set contains <count> brokers</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [feature/orderer.feature#L211](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/07b615e021caafe4344696c0915bf458ed7ce883/feature/orderer.feature#L211)<br><strong>Comment</strong>: <pre>delete line. There should be no reason to wait here - unless the 60 secs above was not long enough for the brokers to timeout (default is 30 secs) and to reelect a new leader (not sure how long that takes, but maybe we should allow 30-60 secs) - in which case we should just increase the 60 sec timer above.</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [feature/orderer.feature#L214](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/07b615e021caafe4344696c0915bf458ed7ce883/feature/orderer.feature#L214)<br><strong>Comment</strong>: <pre>how does skipping the examination of the error response make the test more reliable? Please explain, or remove this part of the comment. Nevertheless, commenting out the line does allow the test to proceed and show the results of the query, to prove the invoke went through because we get to see that the query responds with 970. So I am OK with leaving it commented out - at least for now.</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [feature/orderer.feature#L221](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/07b615e021caafe4344696c0915bf458ed7ce883/feature/orderer.feature#L221)<br><strong>Comment</strong>: <pre>we can delete line. we will never be able to do this, or ensure the isrset contains zero brokers. If you want, you could add a comment saying there are no brokers available for querying for the information.</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [feature/orderer.feature#L225](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/07b615e021caafe4344696c0915bf458ed7ce883/feature/orderer.feature#L225)<br><strong>Comment</strong>: <pre>I think we should remove the comment.</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [feature/steps/orderer_impl.py#L65](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/07b615e021caafe4344696c0915bf458ed7ce883/feature/steps/orderer_impl.py#L65)<br><strong>Comment</strong>: <pre>I {takeDownType} the current kafka topic partition leader on {orderer}</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [feature/steps/orderer_impl.py#L84](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/07b615e021caafe4344696c0915bf458ed7ce883/feature/steps/orderer_impl.py#L84)<br><strong>Comment</strong>: <pre>insert "kafka"</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [feature/steps/orderer_impl.py#L88](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/07b615e021caafe4344696c0915bf458ed7ce883/feature/steps/orderer_impl.py#L88)<br><strong>Comment</strong>: <pre>the current kafka topic partition leader</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [feature/steps/orderer_impl.py#L107](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/07b615e021caafe4344696c0915bf458ed7ce883/feature/steps/orderer_impl.py#L107)<br><strong>Comment</strong>: <pre>restructure similar to line 84 (the shorter version of this:

I <bringUpType> a former kafka topic partition leader for {orderer}</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [feature/steps/orderer_impl.py#L208](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/07b615e021caafe4344696c0915bf458ed7ce883/feature/steps/orderer_impl.py#L208)<br><strong>Comment</strong>: <pre>why don't you call the is_in_log() defined in common_util, instead of defining it again here?</pre></blockquote><h3>PatchSet Number: 6</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Nishi Nidamarty - 2016Nishi@GMail.Com<br><strong>Uploader</strong>: Nishi Nidamarty - 2016Nishi@GMail.Com<br><strong>Created</strong>: 9/22/2017, 3:55:01 PM<br><strong>UnmergedRevision</strong>: [8564355398c571bde0ef94abed1001f8f5b23cf5](https://github.com/hyperledger-gerrit-archive/fabric-test/commit/8564355398c571bde0ef94abed1001f8f5b23cf5)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/22/2017, 4:10:38 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 7</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Nishi Nidamarty - 2016Nishi@GMail.Com<br><strong>Uploader</strong>: Nishi Nidamarty - 2016Nishi@GMail.Com<br><strong>Created</strong>: 9/22/2017, 4:09:24 PM<br><strong>UnmergedRevision</strong>: [ccb61d7f580e1d8e687915d00185e674d42b76f0](https://github.com/hyperledger-gerrit-archive/fabric-test/commit/ccb61d7f580e1d8e687915d00185e674d42b76f0)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/22/2017, 4:57:57 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Approved</strong>: 9/22/2017, 5:44:46 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Approved</strong>: 9/22/2017, 5:44:46 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 8</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Nishi Nidamarty - 2016Nishi@GMail.Com<br><strong>Uploader</strong>: Nishi Nidamarty - 2016Nishi@GMail.Com<br><strong>Created</strong>: 9/22/2017, 5:26:06 PM<br><strong>GitHubMergedRevision</strong>: [ce67d7fcb3b1833850477216b730fa3c6fa4829f](https://github.com/hyperledger-gerrit-archive/fabric-test/commit/ce67d7fcb3b1833850477216b730fa3c6fa4829f)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/22/2017, 6:10:50 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Approved</strong>: 9/22/2017, 5:45:40 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Scott Zwierzynski<br><strong>Merged</strong>: 9/22/2017, 5:49:19 PM<br><br><strong>Approver</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Approved</strong>: 9/22/2017, 5:45:40 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote>