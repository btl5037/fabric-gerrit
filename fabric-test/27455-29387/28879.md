<strong>Project</strong>: fabric-test<br><strong>Branch</strong>: master<br><strong>ID</strong>: 28879<br><strong>Subject</strong>: FABCI-47 CI Pipeline changes<br><strong>Status</strong>: ABANDONED<br><strong>Owner</strong>: Sambhav Nidamarty - sambhavdutt@gmail.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 1/21/2019, 11:15:14 PM<br><strong>LastUpdated</strong>: 2/28/2019, 11:14:03 AM<br><strong>CommitMessage</strong>:<br><pre>FABCI-47 CI Pipeline changes

This patch creates CI jenkins pipeline configuration
for both verify and merge jobs. The CI configuration
should use the patchset dependencies in verify job
and clone the repository in merge job.

Change-Id: I6d852f31ca527598dba42f61e36eb093be4fb642
Signed-off-by: sam <sambhavdutt@gmail.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Sambhav Nidamarty - sambhavdutt@gmail.com<br><strong>Reviewed</strong>: 1/21/2019, 11:15:14 PM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/22/2019, 10:31:36 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/2484/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/22/2019, 11:22:24 AM<br><strong>Message</strong>: <pre>Patch Set 1: Code-Review-1

Build Unstable 

https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/2484/ : UNSTABLE

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-test-verify-x86_64/2484</pre><strong>Reviewer</strong>: Sambhav Nidamarty - sambhavdutt@gmail.com<br><strong>Reviewed</strong>: 1/22/2019, 2:53:50 PM<br><strong>Message</strong>: <pre>Uploaded patch set 2.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/22/2019, 2:59:03 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/2487/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/22/2019, 3:42:50 PM<br><strong>Message</strong>: <pre>Patch Set 2: Code-Review-1

Build Unstable 

https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/2487/ : UNSTABLE

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-test-verify-x86_64/2487</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 1/22/2019, 6:52:46 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Does this replace Ramesh's CR https://gerrit.hyperledger.org/r/#/c/28382/ ?</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 1/22/2019, 7:39:08 PM<br><strong>Message</strong>: <pre>Patch Set 2: Code-Review-1

(8 comments)</pre><strong>Reviewer</strong>: Ramesh Babu Thoomu - rameshbabu.thoomu@gmail.com<br><strong>Reviewed</strong>: 1/22/2019, 9:55:59 PM<br><strong>Message</strong>: <pre>Patch Set 2:

(2 comments)</pre><strong>Reviewer</strong>: Sambhav Nidamarty - sambhavdutt@gmail.com<br><strong>Reviewed</strong>: 2/28/2019, 11:14:03 AM<br><strong>Message</strong>: <pre>Abandoned</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Sambhav Nidamarty - sambhavdutt@gmail.com<br><strong>Uploader</strong>: Sambhav Nidamarty - sambhavdutt@gmail.com<br><strong>Created</strong>: 1/21/2019, 11:15:14 PM<br><strong>UnmergedRevision</strong>: [9078c334131fdd75a5c20794ca6438870ec8cb4b](https://github.com/hyperledger-gerrit-archive/fabric-test/commit/9078c334131fdd75a5c20794ca6438870ec8cb4b)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/22/2019, 11:22:24 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Sambhav Nidamarty - sambhavdutt@gmail.com<br><strong>Uploader</strong>: Sambhav Nidamarty - sambhavdutt@gmail.com<br><strong>Created</strong>: 1/22/2019, 2:53:50 PM<br><strong>UnmergedRevision</strong>: [e5858fdd989aef686edf028cfd7439d043725169](https://github.com/hyperledger-gerrit-archive/fabric-test/commit/e5858fdd989aef686edf028cfd7439d043725169)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/22/2019, 3:42:50 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Approved</strong>: 1/22/2019, 7:39:08 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [Jenkinsfile#L67](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/e5858fdd989aef686edf028cfd7439d043725169/Jenkinsfile#L67)<br><strong>Comment</strong>: <pre>Rebase to see new target "pre-req" in the Makefile.
And then we can change these to 

make pre-req

and I think we can remove "fabric" from this line; Latitia recently has added fabric to all the targets that need it.</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [scripts/Jenkins_Scripts/JenkinsenvScript.sh#L1](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/e5858fdd989aef686edf028cfd7439d043725169/scripts/Jenkins_Scripts/JenkinsenvScript.sh#L1)<br><strong>Comment</strong>: <pre>a little birdie is telling me that we should use sh instead of bash. Could you try that instead, and make sure the commands in this script will all work on ubuntu, alpine, and the macbooks running osx?</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [scripts/Jenkins_Scripts/JenkinsenvScript.sh#L17](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/e5858fdd989aef686edf028cfd7439d043725169/scripts/Jenkins_Scripts/JenkinsenvScript.sh#L17)<br><strong>Comment</strong>: <pre>we should have a default clause for every case statement; here it should capture any other values for $1 and print them as unknown or unsupported. And maybe even error out and return non-zero.</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [scripts/Jenkins_Scripts/JenkinsenvScript.sh#L25](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/e5858fdd989aef686edf028cfd7439d043725169/scripts/Jenkins_Scripts/JenkinsenvScript.sh#L25)<br><strong>Comment</strong>: <pre>can we indent these lines?</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [scripts/Jenkins_Scripts/JenkinsenvScript.sh#L34](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/e5858fdd989aef686edf028cfd7439d043725169/scripts/Jenkins_Scripts/JenkinsenvScript.sh#L34)<br><strong>Comment</strong>: <pre>indent</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [scripts/Jenkins_Scripts/JenkinsenvScript.sh#L40](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/e5858fdd989aef686edf028cfd7439d043725169/scripts/Jenkins_Scripts/JenkinsenvScript.sh#L40)<br><strong>Comment</strong>: <pre>Yikes. Although this might work, today, it will be messy to maintain. First, at a minimum, how about if we define something like
KEEPNUMS=0.4.1[34]
or
KEEPNUMS=(0.4.13|0.4.14)
and then use $(KEEPNUMS} here in this line in all 5 places.

Secondly, better yet, if we also defined something like
KEEPIMAGENAMES=(baseimage|baseos|couchdb|zoo|kafka)
KEEPNUMS=(0.4.13|0.4.14)
then we could simplify to something like this:

  for i in $(docker images | grep -vE ".*${KEEPIMAGENAMES}.*${KEEPNUMS}" |  grep -v "REPOSITORY" | awk '{print $1":" $2}'); do

Lastly: I hate to see these version numbers hardcoded here. How do we determine which image numbers to keep? Maybe KEEPNUMS could be set (globally in this script) to some parameter value that is passed inby the caller?</pre><strong>Commenter</strong>: Ramesh Babu Thoomu - rameshbabu.thoomu@gmail.com<br><strong>CommentLine</strong>: [scripts/Jenkins_Scripts/JenkinsenvScript.sh#L40](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/e5858fdd989aef686edf028cfd7439d043725169/scripts/Jenkins_Scripts/JenkinsenvScript.sh#L40)<br><strong>Comment</strong>: <pre>We have to maintain these versions in Makefile and then simply call that valirable here or I am ok to keep these versions in Jenkinsfile.</pre><strong>Commenter</strong>: Ramesh Babu Thoomu - rameshbabu.thoomu@gmail.com<br><strong>CommentLine</strong>: [scripts/Jenkins_Scripts/JenkinsenvScript.sh#L46](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/e5858fdd989aef686edf028cfd7439d043725169/scripts/Jenkins_Scripts/JenkinsenvScript.sh#L46)<br><strong>Comment</strong>: <pre>Delete this</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [scripts/Jenkins_Scripts/JenkinsenvScript.sh#L54](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/e5858fdd989aef686edf028cfd7439d043725169/scripts/Jenkins_Scripts/JenkinsenvScript.sh#L54)<br><strong>Comment</strong>: <pre>indent.</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [scripts/Jenkins_Scripts/JenkinsenvScript.sh#L72](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/e5858fdd989aef686edf028cfd7439d043725169/scripts/Jenkins_Scripts/JenkinsenvScript.sh#L72)<br><strong>Comment</strong>: <pre>insert blank line</pre></blockquote>