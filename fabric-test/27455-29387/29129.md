<strong>Project</strong>: fabric-test<br><strong>Branch</strong>: master<br><strong>ID</strong>: 29129<br><strong>Subject</strong>: [FAB-13810] PTE raft testcase<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 2/4/2019, 1:33:30 PM<br><strong>LastUpdated</strong>: 2/19/2019, 2:55:24 PM<br><strong>CommitMessage</strong>:<br><pre>[FAB-13810] PTE raft testcase

This CR includes FAB-12513: PTE CI utils

Change-Id: Ib4c6902f26c3ab935d5ca6634b4a1fa5b75855b5
Signed-off-by: Dongming <dongming@ibm.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Reviewed</strong>: 2/4/2019, 1:33:30 PM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/4/2019, 1:38:44 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/2506/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/4/2019, 2:18:23 PM<br><strong>Message</strong>: <pre>Patch Set 1: Code-Review-1

Build Unstable 

https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/2506/ : UNSTABLE

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-test-verify-x86_64/2506</pre><strong>Reviewer</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Reviewed</strong>: 2/4/2019, 4:52:56 PM<br><strong>Message</strong>: <pre>Uploaded patch set 2.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/4/2019, 4:56:34 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/2507/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/4/2019, 5:34:57 PM<br><strong>Message</strong>: <pre>Patch Set 2: Code-Review-1

Build Unstable 

https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/2507/ : UNSTABLE

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-test-verify-x86_64/2507</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 2/5/2019, 12:20:34 PM<br><strong>Message</strong>: <pre>Patch Set 2: Code-Review-1

(2 comments)</pre><strong>Reviewer</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Reviewed</strong>: 2/5/2019, 1:06:40 PM<br><strong>Message</strong>: <pre>Patch Set 2:

(2 comments)</pre><strong>Reviewer</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Reviewed</strong>: 2/5/2019, 4:29:54 PM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/5/2019, 4:34:52 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/2511/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/5/2019, 4:44:12 PM<br><strong>Message</strong>: <pre>Patch Set 3: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/2511/ : FAILURE

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-test-verify-x86_64/2511</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 2/6/2019, 12:22:36 PM<br><strong>Message</strong>: <pre>Patch Set 3:

(5 comments)

I think we can clean up the CIpteReport handling for these scale tests now.</pre><strong>Reviewer</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Reviewed</strong>: 2/7/2019, 1:59:19 PM<br><strong>Message</strong>: <pre>Uploaded patch set 4.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/7/2019, 2:03:21 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/2523/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/7/2019, 2:44:43 PM<br><strong>Message</strong>: <pre>Patch Set 4: Code-Review-1

Build Unstable 

https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/2523/ : UNSTABLE

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-test-verify-x86_64/2523</pre><strong>Reviewer</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Reviewed</strong>: 2/12/2019, 2:41:59 PM<br><strong>Message</strong>: <pre>Uploaded patch set 5.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/12/2019, 2:46:43 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/2541/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/12/2019, 3:30:34 PM<br><strong>Message</strong>: <pre>Patch Set 5: Code-Review-1

Build Unstable 

https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/2541/ : UNSTABLE

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-test-verify-x86_64/2541</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 2/19/2019, 2:10:37 PM<br><strong>Message</strong>: <pre>Patch Set 5: Verified+1 Code-Review+2</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 2/19/2019, 2:10:41 PM<br><strong>Message</strong>: <pre>Patch Set 6: Patch Set 5 was rebased</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 2/19/2019, 2:10:46 PM<br><strong>Message</strong>: <pre>Change has been successfully merged by Scott Zwierzynski</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/19/2019, 2:53:35 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Unstable 

https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/2569/ : UNSTABLE

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-test-verify-x86_64/2569</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 2/19/2019, 2:55:24 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Unstable 

https://jenkins.hyperledger.org/job/fabric-test-merge-x86_64/596/ : UNSTABLE

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-test-merge-x86_64/596</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Uploader</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Created</strong>: 2/4/2019, 1:33:30 PM<br><strong>UnmergedRevision</strong>: [00eeb201fcdf8ffda27b3e09c3149cf98f094a79](https://github.com/hyperledger-gerrit-archive/fabric-test/commit/00eeb201fcdf8ffda27b3e09c3149cf98f094a79)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/4/2019, 2:18:23 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Uploader</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Created</strong>: 2/4/2019, 4:52:56 PM<br><strong>UnmergedRevision</strong>: [778916367c7e4efc1c05e7ead75346716c4b5104](https://github.com/hyperledger-gerrit-archive/fabric-test/commit/778916367c7e4efc1c05e7ead75346716c4b5104)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/4/2019, 5:34:57 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Approved</strong>: 2/5/2019, 12:20:34 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/CITest/scenarios/FAB-13641.sh#L38](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/778916367c7e4efc1c05e7ead75346716c4b5104/tools/PTE/CITest/scenarios/FAB-13641.sh#L38)<br><strong>Comment</strong>: <pre>I expected to see much of the rest of this in a function defined in the utils file too. Is there a reason you did not do that ?</pre><strong>Commenter</strong>: Dongming Hwang - dongming@ibm.com<br><strong>CommentLine</strong>: [tools/PTE/CITest/scenarios/FAB-13641.sh#L38](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/778916367c7e4efc1c05e7ead75346716c4b5104/tools/PTE/CITest/scenarios/FAB-13641.sh#L38)<br><strong>Comment</strong>: <pre>the pteReport file is a dependent of myTESTCASE, cso cannot move to CIutils.sh</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/CITest/scenarios/runScaleTraffic.sh#L399](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/778916367c7e4efc1c05e7ead75346716c4b5104/tools/PTE/CITest/scenarios/runScaleTraffic.sh#L399)<br><strong>Comment</strong>: <pre>end</pre><strong>Commenter</strong>: Dongming Hwang - dongming@ibm.com<br><strong>CommentLine</strong>: [tools/PTE/CITest/scenarios/runScaleTraffic.sh#L399](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/778916367c7e4efc1c05e7ead75346716c4b5104/tools/PTE/CITest/scenarios/runScaleTraffic.sh#L399)<br><strong>Comment</strong>: <pre>Do not understand what you mean.</pre></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Uploader</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Created</strong>: 2/5/2019, 4:29:54 PM<br><strong>UnmergedRevision</strong>: [8c0bbed2910f7606b69d53ecc628e4ba2ec27b56](https://github.com/hyperledger-gerrit-archive/fabric-test/commit/8c0bbed2910f7606b69d53ecc628e4ba2ec27b56)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/5/2019, 4:44:12 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/CITest/scenarios/FAB-13641.sh#L19](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/8c0bbed2910f7606b69d53ecc628e4ba2ec27b56/tools/PTE/CITest/scenarios/FAB-13641.sh#L19)<br><strong>Comment</strong>: <pre>this seems generic. should we include the FAB too? e.g.:

"PTEScaleTest_$myLog"

That way, also you might not have to change the name of the CIpteReport file at the end of this script.

And you could move all the logging statements into the function PTEExecLoop().
Or create other functions such as startLogging() and endLogging().
This is where we name the log report, and decide where to put it. I much prefer to do that in a function in PTECIutils, rather than copy that code to many places where it could be edited. We need it to ensure it is consistent for all tests, so the display tool can find all the pteReport files.</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/CITest/scenarios/FAB-13641.sh#L45](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/8c0bbed2910f7606b69d53ecc628e4ba2ec27b56/tools/PTE/CITest/scenarios/FAB-13641.sh#L45)<br><strong>Comment</strong>: <pre>Remove these, and instead we should pass another arg such as myTESTCASE (or probably myLog) to PTEExecLoop. The runScaleTest.sh can do the logging for us already, right?

And then we could remove the "mv" statement in line 52 too.</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/CITest/scenarios/FAB-13641.sh#L54](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/8c0bbed2910f7606b69d53ecc628e4ba2ec27b56/tools/PTE/CITest/scenarios/FAB-13641.sh#L54)<br><strong>Comment</strong>: <pre>I would like to return the value returned by the PTEExecLoop. If we remove line 52, then we should simply delete this line too. Otherwise we should capture the value from executing PTEExecLoop and return that here with the exit statement.</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/CITest/scenarios/PTECIutils.sh#L54](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/8c0bbed2910f7606b69d53ecc628e4ba2ec27b56/tools/PTE/CITest/scenarios/PTECIutils.sh#L54)<br><strong>Comment</strong>: <pre>do you mean to say:

 number of input args</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/CITest/scenarios/PTECIutils.sh#L74](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/8c0bbed2910f7606b69d53ecc628e4ba2ec27b56/tools/PTE/CITest/scenarios/PTECIutils.sh#L74)<br><strong>Comment</strong>: <pre>Inside runScaleTraffic.sh, we already set these variables

 CIpteReport=$LOGDir"/"$TESTCASE"-pteReport.log"
 pteReport=$PTEDir"/pteReport.txt"

and after each test, in runScaleTraffic.sh, we do

        echo "$TESTCASE Channels=$NCHAN Threads=$NTHREAD $invoke" >> $CIpteReport
        cat $pteReport >> $CIpteReport

So those are internal; but you also are setting those in all the different scenarios/FAB testcase scripts, such as the ones that are modified with this changeset. HOWEVER, instead we should pass the testcase name as arg into PTEExecLoop which can handle the logging itself. I don't like having all the different files setting CIpteReport (which is ignored by runScaletraffic.sh).

Similarly, I think this comment may apply to the run_scenarios.sh script architecture too.</pre></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Uploader</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Created</strong>: 2/7/2019, 1:59:19 PM<br><strong>UnmergedRevision</strong>: [da79563f7f3d9cbded75a2fb18fb9e2da526c180](https://github.com/hyperledger-gerrit-archive/fabric-test/commit/da79563f7f3d9cbded75a2fb18fb9e2da526c180)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/7/2019, 2:44:43 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 5</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Uploader</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Created</strong>: 2/12/2019, 2:41:59 PM<br><strong>UnmergedRevision</strong>: [45a3c5e2c4644fbd372a5b56cb8bead02081e1ca](https://github.com/hyperledger-gerrit-archive/fabric-test/commit/45a3c5e2c4644fbd372a5b56cb8bead02081e1ca)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/12/2019, 3:30:34 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Approved</strong>: 2/19/2019, 2:10:37 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Approved</strong>: 2/19/2019, 2:10:37 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 6</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Uploader</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Created</strong>: 2/19/2019, 2:10:41 PM<br><strong>GitHubMergedRevision</strong>: [9a912fc25bc5cbb13f631b23f24623aa2158e4bc](https://github.com/hyperledger-gerrit-archive/fabric-test/commit/9a912fc25bc5cbb13f631b23f24623aa2158e4bc)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 2/12/2019, 3:30:34 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Approved</strong>: 2/19/2019, 2:10:37 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Scott Zwierzynski<br><strong>Merged</strong>: 2/19/2019, 2:10:46 PM<br><br><strong>Approver</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Approved</strong>: 2/19/2019, 2:10:37 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote>