<strong>Project</strong>: fabric-test<br><strong>Branch</strong>: master<br><strong>ID</strong>: 23483<br><strong>Subject</strong>: [FAB-9925] PTE supports service discovery<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 6/21/2018, 5:31:31 PM<br><strong>LastUpdated</strong>: 6/25/2018, 2:41:12 PM<br><strong>CommitMessage</strong>:<br><pre>[FAB-9925] PTE supports service discovery

Change-Id: I7b5869b978afc0d17cf9cb51256b506e8466ea12
Signed-off-by: Dongming <dming@us.ibm.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Reviewed</strong>: 6/21/2018, 5:31:31 PM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/21/2018, 5:36:42 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/1458/</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 6/21/2018, 6:40:29 PM<br><strong>Message</strong>: <pre>Patch Set 1: Code-Review-1

(4 comments)

Mostly I have just a few questions...</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/21/2018, 6:46:56 PM<br><strong>Message</strong>: <pre>Patch Set 1: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/1458/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/1458/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-test-verify-x86_64/1458</pre><strong>Reviewer</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Reviewed</strong>: 6/22/2018, 1:15:16 PM<br><strong>Message</strong>: <pre>Uploaded patch set 2.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/22/2018, 1:17:23 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/1464/</pre><strong>Reviewer</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Reviewed</strong>: 6/22/2018, 1:58:46 PM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/22/2018, 1:59:11 PM<br><strong>Message</strong>: <pre>Patch Set 2: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/1464/ : ABORTED

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/1464/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-test-verify-x86_64/1464</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/22/2018, 2:01:17 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/1465/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/22/2018, 3:40:52 PM<br><strong>Message</strong>: <pre>Patch Set 3: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/1465/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/1465/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-test-verify-x86_64/1465</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 6/23/2018, 12:38:53 PM<br><strong>Message</strong>: <pre>Patch Set 3:

(1 comment)</pre><strong>Reviewer</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Reviewed</strong>: 6/25/2018, 12:05:16 PM<br><strong>Message</strong>: <pre>Uploaded patch set 4.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/25/2018, 12:07:46 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/1469/</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 6/25/2018, 1:23:36 PM<br><strong>Message</strong>: <pre>Patch Set 4: Code-Review-1

(2 comments)</pre><strong>Reviewer</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Reviewed</strong>: 6/25/2018, 1:51:41 PM<br><strong>Message</strong>: <pre>Uploaded patch set 5.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/25/2018, 1:54:46 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/1470/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/25/2018, 1:56:04 PM<br><strong>Message</strong>: <pre>Patch Set 4: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/1469/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/1469/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-test-verify-x86_64/1469</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 6/25/2018, 2:34:49 PM<br><strong>Message</strong>: <pre>Patch Set 5: Verified+1 Code-Review+2</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 6/25/2018, 2:34:56 PM<br><strong>Message</strong>: <pre>Patch Set 6: Patch Set 5 was rebased</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 6/25/2018, 2:35:01 PM<br><strong>Message</strong>: <pre>Change has been successfully merged by Scott Zwierzynski</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/25/2018, 2:37:02 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/1471/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/25/2018, 2:37:46 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-test-merge-x86_64/343/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 6/25/2018, 2:41:12 PM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Failed 

https://jenkins.hyperledger.org/job/fabric-test-merge-x86_64/343/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-test-merge-x86_64/343/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-test-merge-x86_64/343</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Dongming - dming@us.ibm.com<br><strong>Uploader</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Created</strong>: 6/21/2018, 5:31:31 PM<br><strong>UnmergedRevision</strong>: [634bc1d614e64fc4f47beda11f45194bde947375](https://github.com/hyperledger-gerrit-archive/fabric-test/commit/634bc1d614e64fc4f47beda11f45194bde947375)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 6/21/2018, 6:46:56 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Approved</strong>: 6/21/2018, 6:40:29 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/README.md#L875](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/634bc1d614e64fc4f47beda11f45194bde947375/tools/PTE/README.md#L875)<br><strong>Comment</strong>: <pre>Are you sure that there is no way that the PTE can automatically determine whether or not should use localhost behavior? Can we do some docker commands to see if other containers are there, or check a compose file to see if it is present or if it contains a particular setting?

If we keep this as a setting, then the testcases can not be run "as is" in both a personal environment (desktop, or vlaunch) and also a remote network (using cello, or kubernetes, or live network). Will this be a problem? Let's discuss what will be the default setting, and why?</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-execRequest.js#L179](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/634bc1d614e64fc4f47beda11f45194bde947375/tools/PTE/pte-execRequest.js#L179)<br><strong>Comment</strong>: <pre>insert "mutual"</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-execRequest.js#L2545](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/634bc1d614e64fc4f47beda11f45194bde947375/tools/PTE/pte-execRequest.js#L2545)<br><strong>Comment</strong>: <pre>Is this where we should enhance the code to use the value ov "localHost" that the user provided in the discoveryOpt ?</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-execRequest.js#L2550](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/634bc1d614e64fc4f47beda11f45194bde947375/tools/PTE/pte-execRequest.js#L2550)<br><strong>Comment</strong>: <pre>This scares me. Where does IDone get set to 1?
This is just the discovery requests - not the invokes - so can we remove the word "invoke" from the function name?

Will this create lots of things on the stack, if the discovery is NOT done for a long time?

Can we move anything out of this function (such as the channel.initialize()?</pre></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Dongming - dming@us.ibm.com<br><strong>Uploader</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Created</strong>: 6/22/2018, 1:15:16 PM<br><strong>UnmergedRevision</strong>: [038f1dbfa090cd41364c89ad0d1a442bc71390b2](https://github.com/hyperledger-gerrit-archive/fabric-test/commit/038f1dbfa090cd41364c89ad0d1a442bc71390b2)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 6/22/2018, 1:59:11 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Dongming - dming@us.ibm.com<br><strong>Uploader</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Created</strong>: 6/22/2018, 1:58:46 PM<br><strong>UnmergedRevision</strong>: [2571227b0c62280ee51f598b620876f1bbb12f27](https://github.com/hyperledger-gerrit-archive/fabric-test/commit/2571227b0c62280ee51f598b620876f1bbb12f27)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 6/22/2018, 3:40:52 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/README.md#L876](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/2571227b0c62280ee51f598b620876f1bbb12f27/tools/PTE/README.md#L876)<br><strong>Comment</strong>: <pre>We should specify the default. And should we be more precise. e.g. say Docker containers. And you did not specify where the containers are running (on same host, or in a remote host or multiple remote hosts. I am trying to understand all the several combinations possibilities. Which of these are possible, and which require locaHost set to true? Is this right? Is #2 how the CI will do it?

1 - no containers on local host, pte outside container on local host
2 - docker containers on local host, pte outside container on local host (set TRUE)
3 - docker containers on local host, pte in container
4 - docker containers on a single remote host, or multihost, and pte outside container on localhost or remote host (set TRUE)
5 - docker containers on a single remote host, or multihost, and pte in container on local host or remote host

I am still nervous and want to be sure we lay out and review all the usecases before we decide the default and the options.</pre></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Dongming - dming@us.ibm.com<br><strong>Uploader</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Created</strong>: 6/25/2018, 12:05:16 PM<br><strong>UnmergedRevision</strong>: [57f9237f748d122cd794eb926f16287c158b6233](https://github.com/hyperledger-gerrit-archive/fabric-test/commit/57f9237f748d122cd794eb926f16287c158b6233)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 6/25/2018, 1:56:04 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Approved</strong>: 6/25/2018, 1:23:36 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/README.md#L876](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/57f9237f748d122cd794eb926f16287c158b6233/tools/PTE/README.md#L876)<br><strong>Comment</strong>: <pre>Please clarify. does this mean from a different container, or from NOT in a container?

Also, please specify the default value, or specify that it must be specified (no default)?

And add "For CI automation tests or other tests on single host using docker, when sending invokes, set localHost = true and set targetPeers = discovery.</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-execRequest.js#L1294](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/57f9237f748d122cd794eb926f16287c158b6233/tools/PTE/pte-execRequest.js#L1294)<br><strong>Comment</strong>: <pre>no, this is not right. this transType is not a mode, and we want to be able to select a mode too.</pre></blockquote><h3>PatchSet Number: 5</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Dongming - dming@us.ibm.com<br><strong>Uploader</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Created</strong>: 6/25/2018, 1:51:41 PM<br><strong>UnmergedRevision</strong>: [78e6254bdbabc24adbf23741b2bfdde5660dfc53](https://github.com/hyperledger-gerrit-archive/fabric-test/commit/78e6254bdbabc24adbf23741b2bfdde5660dfc53)<br><br><strong>Approver</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Approved</strong>: 6/25/2018, 2:34:49 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Approved</strong>: 6/25/2018, 2:34:49 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 6</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Dongming - dming@us.ibm.com<br><strong>Uploader</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Created</strong>: 6/25/2018, 2:34:56 PM<br><strong>GitHubMergedRevision</strong>: [8ebdc6dc0df8b7f8f9f7838446d7bd299eb321e4](https://github.com/hyperledger-gerrit-archive/fabric-test/commit/8ebdc6dc0df8b7f8f9f7838446d7bd299eb321e4)<br><br><strong>Approver</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Approved</strong>: 6/25/2018, 2:34:49 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Scott Zwierzynski<br><strong>Merged</strong>: 6/25/2018, 2:35:01 PM<br><br><strong>Approver</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Approved</strong>: 6/25/2018, 2:34:49 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote>