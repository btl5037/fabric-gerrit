<strong>Project</strong>: fabric-test<br><strong>Branch</strong>: master<br><strong>ID</strong>: 32474<br><strong>Subject</strong>: [FAB-15671] PTE supports multiple conn profiles<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 7/24/2019, 11:16:34 AM<br><strong>LastUpdated</strong>: 7/30/2019, 10:35:48 AM<br><strong>CommitMessage</strong>:<br><pre>[FAB-15671] PTE supports multiple conn profiles

This CR is to have PTE support multiple connection
profiles

Change-Id: I7a25b0de99a61b221507278490dd868e8142000b
Signed-off-by: Dongming <dongming@ibm.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Reviewed</strong>: 7/24/2019, 11:16:34 AM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 7/24/2019, 11:18:56 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/3133/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 7/24/2019, 11:53:13 AM<br><strong>Message</strong>: <pre>Patch Set 1: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/3133/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-test-verify-x86_64/3133</pre><strong>Reviewer</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Reviewed</strong>: 7/24/2019, 4:11:56 PM<br><strong>Message</strong>: <pre>Uploaded patch set 2.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 7/24/2019, 4:16:47 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/3137/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 7/24/2019, 4:17:21 PM<br><strong>Message</strong>: <pre>Patch Set 2: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/3137/ : FAILURE

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-test-verify-x86_64/3137</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 7/25/2019, 6:41:03 PM<br><strong>Message</strong>: <pre>Patch Set 2: Code-Review-1

(18 comments)</pre><strong>Reviewer</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Reviewed</strong>: 7/26/2019, 1:23:36 PM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Reviewed</strong>: 7/26/2019, 1:23:51 PM<br><strong>Message</strong>: <pre>Patch Set 2:

(17 comments)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 7/26/2019, 1:29:07 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/3144/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 7/26/2019, 2:04:53 PM<br><strong>Message</strong>: <pre>Patch Set 3: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/3144/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-test-verify-x86_64/3144</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 7/26/2019, 6:04:13 PM<br><strong>Message</strong>: <pre>Patch Set 3: Code-Review-1

(13 comments)

Is my understanding correct? Can we have a connprofile for a peer org that contains only the peers in that one org? Or, does every peer org connprofile (even a new org that we add later) need to contain the entire list of orderers too? This is the big question. After this is answered and agreed, we can talk about all the other comments I made before (and now) and discuss your proposed solution.</pre><strong>Reviewer</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Reviewed</strong>: 7/29/2019, 3:58:11 PM<br><strong>Message</strong>: <pre>Uploaded patch set 4.</pre><strong>Reviewer</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Reviewed</strong>: 7/29/2019, 3:58:34 PM<br><strong>Message</strong>: <pre>Patch Set 3:

(5 comments)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 7/29/2019, 4:01:46 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/3160/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 7/29/2019, 4:32:31 PM<br><strong>Message</strong>: <pre>Patch Set 4: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/3160/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-test-verify-x86_64/3160</pre><strong>Reviewer</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Reviewed</strong>: 7/29/2019, 5:42:56 PM<br><strong>Message</strong>: <pre>Uploaded patch set 5.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 7/29/2019, 5:43:06 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/3165/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 7/29/2019, 6:17:07 PM<br><strong>Message</strong>: <pre>Patch Set 5: Code-Review-1

Build Unstable 

https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/3165/ : UNSTABLE

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-test-verify-x86_64/3165</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 7/30/2019, 9:29:07 AM<br><strong>Message</strong>: <pre>Patch Set 5: Code-Review-1

(1 comment)</pre><strong>Reviewer</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Reviewed</strong>: 7/30/2019, 9:36:10 AM<br><strong>Message</strong>: <pre>Uploaded patch set 6.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 7/30/2019, 9:38:40 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/3168/</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 7/30/2019, 10:00:43 AM<br><strong>Message</strong>: <pre>Patch Set 6: Code-Review+2

(1 comment)</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 7/30/2019, 10:01:57 AM<br><strong>Message</strong>: <pre>Patch Set 6: Verified+1</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 7/30/2019, 10:02:02 AM<br><strong>Message</strong>: <pre>Change has been successfully merged by Scott Zwierzynski</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 7/30/2019, 10:03:57 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Started https://jenkins.hyperledger.org/job/fabric-test-merge-x86_64/713/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 7/30/2019, 10:12:52 AM<br><strong>Message</strong>: <pre>Patch Set 6: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/3168/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-test-verify-x86_64/3168</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 7/30/2019, 10:35:48 AM<br><strong>Message</strong>: <pre>Patch Set 6:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-test-merge-x86_64/713/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-test-merge-x86_64/713</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Uploader</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Created</strong>: 7/24/2019, 11:16:34 AM<br><strong>UnmergedRevision</strong>: [05f9253d5dd0f190bca427dbdc77f5b4cc0b38d4](https://github.com/hyperledger-gerrit-archive/fabric-test/commit/05f9253d5dd0f190bca427dbdc77f5b4cc0b38d4)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 7/24/2019, 11:53:13 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Uploader</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Created</strong>: 7/24/2019, 4:11:56 PM<br><strong>UnmergedRevision</strong>: [5d517970b58c82339e7c8f888f5db8a7cde56dc0](https://github.com/hyperledger-gerrit-archive/fabric-test/commit/5d517970b58c82339e7c8f888f5db8a7cde56dc0)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 7/24/2019, 4:17:21 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Approved</strong>: 7/25/2019, 6:41:03 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-execRequest.js#L234](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/5d517970b58c82339e7c8f888f5db8a7cde56dc0/tools/PTE/pte-execRequest.js#L234)<br><strong>Comment</strong>: <pre>insert a check to see if the cpf list is empty. If so then print err msg and exit with nonzero: either the path was bad or it contains no files of type yml/yaml/json. I cannot think of a usecase where pte could do anything without a connprofile.

(We know it will contain "organizations" section, because otherwise findOrgConnProfile would have returned null. But we don't know if it will contain orderers or peers. I guess that is ok not to chack those, because I guess those COULD be empty.)</pre><strong>Commenter</strong>: Dongming Hwang - dongming@ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-execRequest.js#L234](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/5d517970b58c82339e7c8f888f5db8a7cde56dc0/tools/PTE/pte-execRequest.js#L234)<br><strong>Comment</strong>: <pre>add cpf validation in pte-util</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-execRequest.js#L234](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/5d517970b58c82339e7c8f888f5db8a7cde56dc0/tools/PTE/pte-execRequest.js#L234)<br><strong>Comment</strong>: <pre>Done.
That new validate function is good for what is needed here.

But note that function does not solve the rest of the comments.</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-execRequest.js#L589](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/5d517970b58c82339e7c8f888f5db8a7cde56dc0/tools/PTE/pte-execRequest.js#L589)<br><strong>Comment</strong>: <pre>grammar. choose one of:
  cannot find connection profile for org
  did not find connection profile for org
  connection profile not found for org</pre><strong>Commenter</strong>: Dongming Hwang - dongming@ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-execRequest.js#L589](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/5d517970b58c82339e7c8f888f5db8a7cde56dc0/tools/PTE/pte-execRequest.js#L589)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-execRequest.js#L589](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/5d517970b58c82339e7c8f888f5db8a7cde56dc0/tools/PTE/pte-execRequest.js#L589)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-execRequest.js#L594](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/5d517970b58c82339e7c8f888f5db8a7cde56dc0/tools/PTE/pte-execRequest.js#L594)<br><strong>Comment</strong>: <pre>insert check if cpPeersTmp is null/empty, i.e. if no peers in the org, before entering forloop.</pre><strong>Commenter</strong>: Dongming Hwang - dongming@ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-execRequest.js#L594](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/5d517970b58c82339e7c8f888f5db8a7cde56dc0/tools/PTE/pte-execRequest.js#L594)<br><strong>Comment</strong>: <pre>this is resolved by adding check organizations, peers, orderers and certificateAuthority in findOrgConnProfile in pte-util.js</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-execRequest.js#L594](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/5d517970b58c82339e7c8f888f5db8a7cde56dc0/tools/PTE/pte-execRequest.js#L594)<br><strong>Comment</strong>: <pre>Not quite. I agree that check could have been done before getting to this point in the code, but that solution is too heavy handed. We need to check only that there are non-zero number of peers.</pre><strong>Commenter</strong>: Dongming Hwang - dongming@ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-execRequest.js#L594](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/5d517970b58c82339e7c8f888f5db8a7cde56dc0/tools/PTE/pte-execRequest.js#L594)<br><strong>Comment</strong>: <pre>use validateConnProfileProp()</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-execRequest.js#L787](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/5d517970b58c82339e7c8f888f5db8a7cde56dc0/tools/PTE/pte-execRequest.js#L787)<br><strong>Comment</strong>: <pre>And, insert check if cpPeersTmp is null/empty, i.e. if no peers in the org, before entering forloop.</pre><strong>Commenter</strong>: Dongming Hwang - dongming@ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-execRequest.js#L787](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/5d517970b58c82339e7c8f888f5db8a7cde56dc0/tools/PTE/pte-execRequest.js#L787)<br><strong>Comment</strong>: <pre>handled in findOrgConnProfileSubmitter()</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-execRequest.js#L1289](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/5d517970b58c82339e7c8f888f5db8a7cde56dc0/tools/PTE/pte-execRequest.js#L1289)<br><strong>Comment</strong>: <pre>delete word</pre><strong>Commenter</strong>: Dongming Hwang - dongming@ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-execRequest.js#L1289](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/5d517970b58c82339e7c8f888f5db8a7cde56dc0/tools/PTE/pte-execRequest.js#L1289)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-execRequest.js#L1289](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/5d517970b58c82339e7c8f888f5db8a7cde56dc0/tools/PTE/pte-execRequest.js#L1289)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-execRequest.js#L1302](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/5d517970b58c82339e7c8f888f5db8a7cde56dc0/tools/PTE/pte-execRequest.js#L1302)<br><strong>Comment</strong>: <pre>WHY is this lost in the middle of all these function definitions, away from any other global code? Shouldn't we move it to about line 355 ?</pre><strong>Commenter</strong>: Dongming Hwang - dongming@ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-execRequest.js#L1302](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/5d517970b58c82339e7c8f888f5db8a7cde56dc0/tools/PTE/pte-execRequest.js#L1302)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-execRequest.js#L1302](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/5d517970b58c82339e7c8f888f5db8a7cde56dc0/tools/PTE/pte-execRequest.js#L1302)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-execRequest.js#L1314](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/5d517970b58c82339e7c8f888f5db8a7cde56dc0/tools/PTE/pte-execRequest.js#L1314)<br><strong>Comment</strong>: <pre>why are we suddenly using global "org" in this function "execTransMode", when all the other functions take it in as a parameter? Will this be the correct org? Won't we have to send transactions potentially for a list of orgs, potentially in multiple connprofiles? No, wait, this pte-exec is called for every thread, so it uses only one org... OK, seems ok for this to use global "org" value. But, then why all the fuss about passing "org" as a parameter to all the OTHER functions?</pre><strong>Commenter</strong>: Dongming Hwang - dongming@ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-execRequest.js#L1314](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/5d517970b58c82339e7c8f888f5db8a7cde56dc0/tools/PTE/pte-execRequest.js#L1314)<br><strong>Comment</strong>: <pre>there is only one org in each instance of pte-execRequest.js</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-main.js#L0](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/5d517970b58c82339e7c8f888f5db8a7cde56dc0/tools/PTE/pte-main.js#L0)<br><strong>Comment</strong>: <pre>Some same comments apply to this file too, like checking for null cpList or null cpPeers or cpOrderers list, before proceeding into the functions that dereference inside them.</pre><strong>Commenter</strong>: Dongming Hwang - dongming@ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-main.js#L0](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/5d517970b58c82339e7c8f888f5db8a7cde56dc0/tools/PTE/pte-main.js#L0)<br><strong>Comment</strong>: <pre>see validateOrgConnProfile() and findOrgConnProfile()</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-main.js#L110](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/5d517970b58c82339e7c8f888f5db8a7cde56dc0/tools/PTE/pte-main.js#L110)<br><strong>Comment</strong>: <pre>Add a check in this file too for a null cpList, and if so then log it (bad path, or no connprofiles (files with .yaml/.yml/.json extension) in that location) and exit.</pre><strong>Commenter</strong>: Dongming Hwang - dongming@ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-main.js#L110](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/5d517970b58c82339e7c8f888f5db8a7cde56dc0/tools/PTE/pte-main.js#L110)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-main.js#L110](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/5d517970b58c82339e7c8f888f5db8a7cde56dc0/tools/PTE/pte-main.js#L110)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-util.js#L107](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/5d517970b58c82339e7c8f888f5db8a7cde56dc0/tools/PTE/pte-util.js#L107)<br><strong>Comment</strong>: <pre>This seems to look at all files, but just grab the first one that looks like a config file.
Are you assuming we might be given a single directory for this PTE test that contains all the connprofiles (even if from the different orgs) in that single directory, and that each org would provide exactly ONE connprofile file? I *think* this is ok, but we should talk this through with Surya/Nilesh to be sure this assumption is right.</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-util.js#L107](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/5d517970b58c82339e7c8f888f5db8a7cde56dc0/tools/PTE/pte-util.js#L107)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-util.js#L339](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/5d517970b58c82339e7c8f888f5db8a7cde56dc0/tools/PTE/pte-util.js#L339)<br><strong>Comment</strong>: <pre>check if cpOrderers is a null list, then log and return null.</pre><strong>Commenter</strong>: Dongming Hwang - dongming@ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-util.js#L339](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/5d517970b58c82339e7c8f888f5db8a7cde56dc0/tools/PTE/pte-util.js#L339)<br><strong>Comment</strong>: <pre>When this is called, cpf is validated.</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-util.js#L521](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/5d517970b58c82339e7c8f888f5db8a7cde56dc0/tools/PTE/pte-util.js#L521)<br><strong>Comment</strong>: <pre>if (cpPeers is not null && cpPeers.hasOwnProperty(subkey))</pre><strong>Commenter</strong>: Dongming Hwang - dongming@ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-util.js#L521](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/5d517970b58c82339e7c8f888f5db8a7cde56dc0/tools/PTE/pte-util.js#L521)<br><strong>Comment</strong>: <pre>resolved in findOrgConnProfile()</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-util.js#L523](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/5d517970b58c82339e7c8f888f5db8a7cde56dc0/tools/PTE/pte-util.js#L523)<br><strong>Comment</strong>: <pre>else if (cpOrderers is not null && cpOrderers.hasOwnProperty(subkey))</pre><strong>Commenter</strong>: Dongming Hwang - dongming@ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-util.js#L523](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/5d517970b58c82339e7c8f888f5db8a7cde56dc0/tools/PTE/pte-util.js#L523)<br><strong>Comment</strong>: <pre>resolved in findOrgConnProfile()</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-util.js#L529](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/5d517970b58c82339e7c8f888f5db8a7cde56dc0/tools/PTE/pte-util.js#L529)<br><strong>Comment</strong>: <pre>Actually, I am thinking we should have a function for the peers, and a function for the orderers. Or some more parameters here, unless we can be sure the subkey argument is unique across all peers and orderers. Can we?</pre><strong>Commenter</strong>: Dongming Hwang - dongming@ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-util.js#L529](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/5d517970b58c82339e7c8f888f5db8a7cde56dc0/tools/PTE/pte-util.js#L529)<br><strong>Comment</strong>: <pre>this function is to get tls_cert for either a peer or an orderer, It does not seem there is a need to have two functions, one for peer and one for orderer</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-util.js#L531](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/5d517970b58c82339e7c8f888f5db8a7cde56dc0/tools/PTE/pte-util.js#L531)<br><strong>Comment</strong>: <pre>Could there be more than one .tls_cert section in the cpf? Multiple orderers and peers... how do you know this is the one you need? It might even find the cert of a peer when you need one for an orderer. Or find the one for the wrong peer or orderer.

Maybe this code should say typeof(cpPtr[subkey]) instead of typeof(cpf.tls_cert). And the next line too.</pre><strong>Commenter</strong>: Dongming Hwang - dongming@ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-util.js#L531](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/5d517970b58c82339e7c8f888f5db8a7cde56dc0/tools/PTE/pte-util.js#L531)<br><strong>Comment</strong>: <pre>This is the global tls_cert that IBP request in the early days.  If the global tls_cert is not defined, PTE will look for tls_cert for each peer or orderer.</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-util.js#L560](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/5d517970b58c82339e7c8f888f5db8a7cde56dc0/tools/PTE/pte-util.js#L560)<br><strong>Comment</strong>: <pre>lets add a check if non-null orgCA, before line 560.</pre><strong>Commenter</strong>: Dongming Hwang - dongming@ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-util.js#L560](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/5d517970b58c82339e7c8f888f5db8a7cde56dc0/tools/PTE/pte-util.js#L560)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-util.js#L624](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/5d517970b58c82339e7c8f888f5db8a7cde56dc0/tools/PTE/pte-util.js#L624)<br><strong>Comment</strong>: <pre>Add acheck for null cpOrderers list, and if so then log and return. Actually this might be an error. Or, hopefully the calling code will find an orderer in a different org (or skip this org to begin with)...

I suppose it is unlikely the networkspec would contain an ordererOrg without any orderers, but it could be possible - especially when we add the ability to read in each orgname individually rather than "looping" variables for N orderers in M orgs.</pre><strong>Commenter</strong>: Dongming Hwang - dongming@ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-util.js#L624](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/5d517970b58c82339e7c8f888f5db8a7cde56dc0/tools/PTE/pte-util.js#L624)<br><strong>Comment</strong>: <pre>For kafka, the tx can be sent to any orderer, but this may be the case for RAFT.</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-util.js#L624](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/5d517970b58c82339e7c8f888f5db8a7cde56dc0/tools/PTE/pte-util.js#L624)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-util.js#L670](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/5d517970b58c82339e7c8f888f5db8a7cde56dc0/tools/PTE/pte-util.js#L670)<br><strong>Comment</strong>: <pre>check for empty list of peers in this org; if so then log and return.
Hopefully the calling code already checked, and will skip this org and create its threads using a different org...</pre><strong>Commenter</strong>: Dongming Hwang - dongming@ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-util.js#L670](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/5d517970b58c82339e7c8f888f5db8a7cde56dc0/tools/PTE/pte-util.js#L670)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-util.js#L670](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/5d517970b58c82339e7c8f888f5db8a7cde56dc0/tools/PTE/pte-util.js#L670)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Uploader</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Created</strong>: 7/26/2019, 1:23:36 PM<br><strong>UnmergedRevision</strong>: [611b7cb2e618a45a490ed48e644aef9a95b6c644](https://github.com/hyperledger-gerrit-archive/fabric-test/commit/611b7cb2e618a45a490ed48e644aef9a95b6c644)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 7/26/2019, 2:04:53 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Approved</strong>: 7/26/2019, 6:04:13 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-execRequest.js#L0](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/611b7cb2e618a45a490ed48e644aef9a95b6c644/tools/PTE/pte-execRequest.js#L0)<br><strong>Comment</strong>: <pre>Assumption: one org is passed to pte-execRequest. Even if the pte-execRequest code requires that there must be peers in this org, I don't think we can insist that there are orderers in THIS org. I think some traffic on this thread may be sent to different orderers in different orgs, right?</pre><strong>Commenter</strong>: Dongming Hwang - dongming@ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-execRequest.js#L0](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/611b7cb2e618a45a490ed48e644aef9a95b6c644/tools/PTE/pte-execRequest.js#L0)<br><strong>Comment</strong>: <pre>if a connection profile does not contain any orderer, then need to come up logic on how to select orderer in other connection profile
For now, it is required for a connection profile to contain at least one orderer.</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-main.js#L219](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/611b7cb2e618a45a490ed48e644aef9a95b6c644/tools/PTE/pte-main.js#L219)<br><strong>Comment</strong>: <pre>Currently, the problem still exists. That new validate function does not ensure there are any orderers.</pre><strong>Commenter</strong>: Dongming Hwang - dongming@ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-main.js#L219](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/611b7cb2e618a45a490ed48e644aef9a95b6c644/tools/PTE/pte-main.js#L219)<br><strong>Comment</strong>: <pre>validate with validateConnProfileProp().</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-util.js#L106](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/611b7cb2e618a45a490ed48e644aef9a95b6c644/tools/PTE/pte-util.js#L106)<br><strong>Comment</strong>: <pre>This does nothing but ensure there is a connprofile. It could be empty. I don't see how this helps prevent problems in the code. I think you should look down a level at cpf[organizations] to be sure is nonzero length, and make sure one of the following is non-zero length: cpf[peers] and cpf[orderers], cpf[certificateAuthorities]</pre><strong>Commenter</strong>: Dongming Hwang - dongming@ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-util.js#L106](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/611b7cb2e618a45a490ed48e644aef9a95b6c644/tools/PTE/pte-util.js#L106)<br><strong>Comment</strong>: <pre>Use a new function, validateConnProfileProp(), to check property, such as peers, ordereres.</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-util.js#L122](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/611b7cb2e618a45a490ed48e644aef9a95b6c644/tools/PTE/pte-util.js#L122)<br><strong>Comment</strong>: <pre>This means there must be SECTIONS for peers and orderers and CAs, right? What if there are no peers listed in that section of the config file? If you want to use this to solve all my commented findings, then I think you would need to check for non-zero length of each of them too.

However, even if you fix that implementation problem, I feel the logic is not right. What you are doing is requiring every connprofile to have orderers and peers and CAs. This does not seem correct; I don't think we need to require it. That makes sense only if this is a connprofile for an entire network. But it is certainly possible and likely to be only a connprofile for a single org in a network. I was thinking one of the connprofiles might contain only peers. That is why I asked you to validate the non-zero number or orderers when appropriate and the non-zero number of peers when appropriate (but not require both for all connprofiles).</pre><strong>Commenter</strong>: Dongming Hwang - dongming@ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-util.js#L122](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/611b7cb2e618a45a490ed48e644aef9a95b6c644/tools/PTE/pte-util.js#L122)<br><strong>Comment</strong>: <pre>see above function validateConnProfileProp().  Check section only when it is needed.</pre></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Uploader</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Created</strong>: 7/29/2019, 3:58:11 PM<br><strong>UnmergedRevision</strong>: [31e405e8ef83026266fecdbb28d9821d41cbdef8](https://github.com/hyperledger-gerrit-archive/fabric-test/commit/31e405e8ef83026266fecdbb28d9821d41cbdef8)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 7/29/2019, 4:32:31 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 5</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Uploader</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Created</strong>: 7/29/2019, 5:42:56 PM<br><strong>UnmergedRevision</strong>: [c75d40270e8399e3d759c538abedd27583f5fe7c](https://github.com/hyperledger-gerrit-archive/fabric-test/commit/c75d40270e8399e3d759c538abedd27583f5fe7c)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 7/29/2019, 6:17:07 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Approved</strong>: 7/30/2019, 9:29:07 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-execRequest.js#L243](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/c75d40270e8399e3d759c538abedd27583f5fe7c/tools/PTE/pte-execRequest.js#L243)<br><strong>Comment</strong>: <pre>peer</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/pte-execRequest.js#L243](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/c75d40270e8399e3d759c538abedd27583f5fe7c/tools/PTE/pte-execRequest.js#L243)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 6</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Uploader</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Created</strong>: 7/30/2019, 9:36:10 AM<br><strong>GitHubMergedRevision</strong>: [0506a6310537a40490483f42ec018ca9486f1dc3](https://github.com/hyperledger-gerrit-archive/fabric-test/commit/0506a6310537a40490483f42ec018ca9486f1dc3)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 7/30/2019, 10:12:52 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Approved</strong>: 7/30/2019, 10:00:43 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Scott Zwierzynski<br><strong>Merged</strong>: 7/30/2019, 10:02:02 AM<br><br><strong>Approver</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Approved</strong>: 7/30/2019, 10:01:57 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote>