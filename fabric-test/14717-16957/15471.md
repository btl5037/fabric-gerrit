<strong>Project</strong>: fabric-test<br><strong>Branch</strong>: master<br><strong>ID</strong>: 15471<br><strong>Subject</strong>: [FAB-6500] Refactor code for fabric-ca inclusion<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 11/14/2017, 4:00:37 PM<br><strong>LastUpdated</strong>: 11/15/2017, 1:29:51 PM<br><strong>CommitMessage</strong>:<br><pre>[FAB-6500] Refactor code for fabric-ca inclusion

This is some refactor work that is needed as a base for
including the fabric-ca as a possible bootstrap process.

This includes moving the enableTLS call to the
compose utility instead of in the common utility.
Adds a method for retrieving environment variables
from a stated container.
Adds user parameter to the calls.
Adds orderer host names to the docker composition files.

Change-Id: I088edfa6eb2b2d77a2933799d570d5711d947110
Signed-off-by: Latitia M Haskins <latitia.haskins@gmail.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>Reviewed</strong>: 11/14/2017, 4:00:37 PM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/14/2017, 4:00:44 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/490/</pre><strong>Reviewer</strong>: Adnan C - adnan.choudhury@itpeoplecorp.com<br><strong>Reviewed</strong>: 11/14/2017, 5:05:17 PM<br><strong>Message</strong>: <pre>Patch Set 1: Code-Review-1

(5 comments)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/14/2017, 5:20:01 PM<br><strong>Message</strong>: <pre>Patch Set 1: Code-Review-1

Build Unstable 

https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/490/ : UNSTABLE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/490/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-test-verify-x86_64/490</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 11/14/2017, 6:52:20 PM<br><strong>Message</strong>: <pre>Patch Set 1: Code-Review-1

(3 comments)</pre><strong>Reviewer</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>Reviewed</strong>: 11/15/2017, 11:05:01 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(8 comments)</pre><strong>Reviewer</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>Reviewed</strong>: 11/15/2017, 11:05:26 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Oh it didn't pass. That makes me feel better :)</pre><strong>Reviewer</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>Reviewed</strong>: 11/15/2017, 11:06:06 AM<br><strong>Message</strong>: <pre>Uploaded patch set 2.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/15/2017, 11:06:15 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/493/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/15/2017, 11:09:06 AM<br><strong>Message</strong>: <pre>Patch Set 2: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/493/ : FAILURE

No problems were identified. If you know why this problem occurred, please add a suitable Cause for it. ( https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/493/ )

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-test-verify-x86_64/493</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 11/15/2017, 11:31:58 AM<br><strong>Message</strong>: <pre>Patch Set 2: Code-Review+1</pre><strong>Reviewer</strong>: Adnan C - adnan.choudhury@itpeoplecorp.com<br><strong>Reviewed</strong>: 11/15/2017, 11:42:13 AM<br><strong>Message</strong>: <pre>Patch Set 2:

reverify</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/15/2017, 11:42:21 AM<br><strong>Message</strong>: <pre>Patch Set 2: -Verified

Build Started https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/494/</pre><strong>Reviewer</strong>: Adnan C - adnan.choudhury@itpeoplecorp.com<br><strong>Reviewed</strong>: 11/15/2017, 11:49:18 AM<br><strong>Message</strong>: <pre>Patch Set 2: Code-Review+2</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 11/15/2017, 1:01:54 PM<br><strong>Message</strong>: <pre>Patch Set 2: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/494/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-test-verify-x86_64/494</pre><strong>Reviewer</strong>: Adnan C - adnan.choudhury@itpeoplecorp.com<br><strong>Reviewed</strong>: 11/15/2017, 1:29:51 PM<br><strong>Message</strong>: <pre>Change has been successfully merged by Adnan C</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>Uploader</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>Created</strong>: 11/14/2017, 4:00:37 PM<br><strong>UnmergedRevision</strong>: [0f09e82f88b64652cdc2b5d34c3f10e967a1e981](https://github.com/hyperledger-gerrit-archive/fabric-test/commit/0f09e82f88b64652cdc2b5d34c3f10e967a1e981)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 11/14/2017, 5:20:01 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Approved</strong>: 11/14/2017, 6:52:20 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Adnan C - adnan.choudhury@itpeoplecorp.com<br><strong>Approved</strong>: 11/14/2017, 5:05:17 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [feature/docker-compose/docker-compose-base.yml#L33](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/0f09e82f88b64652cdc2b5d34c3f10e967a1e981/feature/docker-compose/docker-compose-base.yml#L33)<br><strong>Comment</strong>: <pre>I am not sure what it is for; but is there a reason we did not also put ORDERER_HOST here? You always use orderer0.</pre><strong>Commenter</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>CommentLine</strong>: [feature/docker-compose/docker-compose-base.yml#L33](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/0f09e82f88b64652cdc2b5d34c3f10e967a1e981/feature/docker-compose/docker-compose-base.yml#L33)<br><strong>Comment</strong>: <pre>The orderer home would be the same for all orderers, the ORDERER_HOST should be different for each orderer.</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [feature/steps/compose_util.py#L21](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/0f09e82f88b64652cdc2b5d34c3f10e967a1e981/feature/steps/compose_util.py#L21)<br><strong>Comment</strong>: <pre>I think you might also need to add this to the .env file.</pre><strong>Commenter</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>CommentLine</strong>: [feature/steps/compose_util.py#L21](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/0f09e82f88b64652cdc2b5d34c3f10e967a1e981/feature/steps/compose_util.py#L21)<br><strong>Comment</strong>: <pre>Oops. I pulled this method from my other branch to help find my regression issue. I'll remove this and include this in the docker compose CR.</pre><strong>Commenter</strong>: Adnan C - adnan.choudhury@itpeoplecorp.com<br><strong>CommentLine</strong>: [feature/steps/compose_util.py#L121](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/0f09e82f88b64652cdc2b5d34c3f10e967a1e981/feature/steps/compose_util.py#L121)<br><strong>Comment</strong>: <pre>maybe add a throw-error here if the container or the key not available? Or maybe return a 'value' with a message 'not found' or similar.</pre><strong>Commenter</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>CommentLine</strong>: [feature/steps/compose_util.py#L121](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/0f09e82f88b64652cdc2b5d34c3f10e967a1e981/feature/steps/compose_util.py#L121)<br><strong>Comment</strong>: <pre>I kinda like returning an empty string if the env var is not present. This is pretty much the same as how it works in a shell env. It wouldn't error out.</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [feature/steps/endorser_impl.py#L17](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/0f09e82f88b64652cdc2b5d34c3f10e967a1e981/feature/steps/endorser_impl.py#L17)<br><strong>Comment</strong>: <pre>Do we have to say 'a user role type of {user} sets up...' ?
(and then, below, we pass the user argument)
(I imagine maybe this is planned in the future so we can try different users or different user roletypes)</pre><strong>Commenter</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>CommentLine</strong>: [feature/steps/endorser_impl.py#L17](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/0f09e82f88b64652cdc2b5d34c3f10e967a1e981/feature/steps/endorser_impl.py#L17)<br><strong>Comment</strong>: <pre>The next CR will add this additional functionality. The table will look like the following:
    Given I enroll the following users using fabric-ca
         | username  |        organization       | password |  role  |
         |   adnan   |     org2.example.com     |  wh@tsup | member |
         |   scott   |     org1.example.com     |  th3r3   | member |
         |  latitia  |     org1.example.com     |  h3ll0   | admin  |
Then you can do the following:
    When a user "latitia" sets up a channel</pre><strong>Commenter</strong>: Adnan C - adnan.choudhury@itpeoplecorp.com<br><strong>CommentLine</strong>: [feature/steps/endorser_impl.py#L23](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/0f09e82f88b64652cdc2b5d34c3f10e967a1e981/feature/steps/endorser_impl.py#L23)<br><strong>Comment</strong>: <pre>Just curious, is this equivalent to 'user'?</pre><strong>Commenter</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>CommentLine</strong>: [feature/steps/endorser_impl.py#L23](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/0f09e82f88b64652cdc2b5d34c3f10e967a1e981/feature/steps/endorser_impl.py#L23)<br><strong>Comment</strong>: <pre>This passes the user that was passed into setup_channel_impl to the user parameter that is needed in the create_channel call, but since there are other parameters that have default values, I will want to explicitly use the parameter name to make sure that the correct parameter gets set. I'll use "username" instead of user for what's passed into setup_channel_impl to try to make this clearer.</pre><strong>Commenter</strong>: Adnan C - adnan.choudhury@itpeoplecorp.com<br><strong>CommentLine</strong>: [feature/steps/endorser_util.py#L120](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/0f09e82f88b64652cdc2b5d34c3f10e967a1e981/feature/steps/endorser_util.py#L120)<br><strong>Comment</strong>: <pre>should this be peersuser?
Same question for subsequent calls.</pre><strong>Commenter</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>CommentLine</strong>: [feature/steps/endorser_util.py#L120](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/0f09e82f88b64652cdc2b5d34c3f10e967a1e981/feature/steps/endorser_util.py#L120)<br><strong>Comment</strong>: <pre>Ah! Good catch... How did this pass the tests?</pre><strong>Commenter</strong>: Adnan C - adnan.choudhury@itpeoplecorp.com<br><strong>CommentLine</strong>: [feature/steps/endorser_util.py#L184](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/0f09e82f88b64652cdc2b5d34c3f10e967a1e981/feature/steps/endorser_util.py#L184)<br><strong>Comment</strong>: <pre>the 'user' is not being used inside?</pre><strong>Commenter</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>CommentLine</strong>: [feature/steps/endorser_util.py#L184](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/0f09e82f88b64652cdc2b5d34c3f10e967a1e981/feature/steps/endorser_util.py#L184)<br><strong>Comment</strong>: <pre>No, at this point, I don't think the tool that Latrell has is actually using a user to implement. I will definitely need to fix this. I was wondering about taking out the ToolInterface since we may not be using it any time soon. Though we may be using it... If we do, we will need to update the inputs and such that are being used - including the ability to pass in the user that should be used when performing these tasks.</pre><strong>Commenter</strong>: Adnan C - adnan.choudhury@itpeoplecorp.com<br><strong>CommentLine</strong>: [feature/steps/orderer_impl.py#L195](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/0f09e82f88b64652cdc2b5d34c3f10e967a1e981/feature/steps/orderer_impl.py#L195)<br><strong>Comment</strong>: <pre>Should this be "was not set to"?</pre><strong>Commenter</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>CommentLine</strong>: [feature/steps/orderer_impl.py#L195](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/0f09e82f88b64652cdc2b5d34c3f10e967a1e981/feature/steps/orderer_impl.py#L195)<br><strong>Comment</strong>: <pre>No, this is listing the value that was on the container. I can add the expected value to the error msg as well.</pre></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>Uploader</strong>: Latitia Haskins - latitia.haskins@gmail.com<br><strong>Created</strong>: 11/15/2017, 11:06:06 AM<br><strong>GitHubMergedRevision</strong>: [67ab554fe8b96bf1c26294a60c816ecc8263eac4](https://github.com/hyperledger-gerrit-archive/fabric-test/commit/67ab554fe8b96bf1c26294a60c816ecc8263eac4)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 11/15/2017, 1:01:54 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Approved</strong>: 11/15/2017, 11:31:58 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Adnan C - adnan.choudhury@itpeoplecorp.com<br><strong>Approved</strong>: 11/15/2017, 11:49:18 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Adnan C<br><strong>Merged</strong>: 11/15/2017, 1:29:51 PM<br><br></blockquote>