<strong>Project</strong>: fabric-test<br><strong>Branch</strong>: master<br><strong>ID</strong>: 30965<br><strong>Subject</strong>: [FAB-15206] PTE run remote scenarios<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 4/16/2019, 2:31:45 PM<br><strong>LastUpdated</strong>: 4/22/2019, 2:53:58 PM<br><strong>CommitMessage</strong>:<br><pre>[FAB-15206] PTE run remote scenarios

This CR is to support PTE execution of scenarios
and calculataion of reports on remote hosts

Change-Id: I40b338e7d4ad537940674d7fc2c9064663a1f052
Signed-off-by: Dongming <dongming@ibm.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Reviewed</strong>: 4/16/2019, 2:31:45 PM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/16/2019, 2:37:30 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/2822/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/16/2019, 3:09:59 PM<br><strong>Message</strong>: <pre>Patch Set 1: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/2822/ : FAILURE

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-test-verify-x86_64/2822</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 4/18/2019, 1:13:14 PM<br><strong>Message</strong>: <pre>Patch Set 1: Code-Review-1

(8 comments)

I critiqued one file. Let's reach agreement there first, and then we can look at the other file.</pre><strong>Reviewer</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Reviewed</strong>: 4/19/2019, 10:24:58 AM<br><strong>Message</strong>: <pre>Uploaded patch set 2.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/19/2019, 10:28:48 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/2834/</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 4/19/2019, 10:45:23 AM<br><strong>Message</strong>: <pre>Patch Set 2: Code-Review-1

(3 comments)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/19/2019, 10:58:08 AM<br><strong>Message</strong>: <pre>Patch Set 2: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/2834/ : FAILURE

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-test-verify-x86_64/2834</pre><strong>Reviewer</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Reviewed</strong>: 4/22/2019, 10:45:06 AM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Reviewed</strong>: 4/22/2019, 10:46:51 AM<br><strong>Message</strong>: <pre>Patch Set 2:

(3 comments)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/22/2019, 10:48:38 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/2838/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/22/2019, 11:20:29 AM<br><strong>Message</strong>: <pre>Patch Set 3: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/2838/ : FAILURE

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-test-verify-x86_64/2838</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 4/22/2019, 2:12:55 PM<br><strong>Message</strong>: <pre>Patch Set 4: Patch Set 3 was rebased</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 4/22/2019, 2:13:01 PM<br><strong>Message</strong>: <pre>Patch Set 4: Verified+1 Code-Review+2</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 4/22/2019, 2:13:03 PM<br><strong>Message</strong>: <pre>Removed Verified-1 by Hyperledger Jobbuilder <jobbuilder@jenkins.hyperledger.org>
</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 4/22/2019, 2:13:05 PM<br><strong>Message</strong>: <pre>Change has been successfully merged by Scott Zwierzynski</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/22/2019, 2:16:32 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/2842/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/22/2019, 2:20:54 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-test-merge-x86_64/643/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/22/2019, 2:53:58 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Unstable 

https://jenkins.hyperledger.org/job/fabric-test-merge-x86_64/643/ : UNSTABLE

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-test-merge-x86_64/643</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Uploader</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Created</strong>: 4/16/2019, 2:31:45 PM<br><strong>UnmergedRevision</strong>: [6c8b3cc9bb3bfbda91b5199c28ac039512ce9500](https://github.com/hyperledger-gerrit-archive/fabric-test/commit/6c8b3cc9bb3bfbda91b5199c28ac039512ce9500)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/16/2019, 3:09:59 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Approved</strong>: 4/18/2019, 1:13:14 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/CITest/scenarios/runRemoteScenarios.sh#L1](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/6c8b3cc9bb3bfbda91b5199c28ac039512ce9500/tools/PTE/CITest/scenarios/runRemoteScenarios.sh#L1)<br><strong>Comment</strong>: <pre>We should exit upon failure, so use something like:
bash -e</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/CITest/scenarios/runRemoteScenarios.sh#L14](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/6c8b3cc9bb3bfbda91b5199c28ac039512ce9500/tools/PTE/CITest/scenarios/runRemoteScenarios.sh#L14)<br><strong>Comment</strong>: <pre>insert lines:

Description:
Execute a task [arg1] simultaneously on a group of remote hosts. The host list may be edited within this file. The task is a bash test script that has been previously installed in each remote host in path $GOPATH/src/github.com/hyperledger/fabric-test/tools/PTE/CITest/scenarios/<task></pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/CITest/scenarios/runRemoteScenarios.sh#L16](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/6c8b3cc9bb3bfbda91b5199c28ac039512ce9500/tools/PTE/CITest/scenarios/runRemoteScenarios.sh#L16)<br><strong>Comment</strong>: <pre>On each remote host, git clone fabric-test under ...</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/CITest/scenarios/runRemoteScenarios.sh#L16](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/6c8b3cc9bb3bfbda91b5199c28ac039512ce9500/tools/PTE/CITest/scenarios/runRemoteScenarios.sh#L16)<br><strong>Comment</strong>: <pre>fabric-test</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/CITest/scenarios/runRemoteScenarios.sh#L17](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/6c8b3cc9bb3bfbda91b5199c28ac039512ce9500/tools/PTE/CITest/scenarios/runRemoteScenarios.sh#L17)<br><strong>Comment</strong>: <pre>On each remote host, create ...</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/CITest/scenarios/runRemoteScenarios.sh#L18](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/6c8b3cc9bb3bfbda91b5199c28ac039512ce9500/tools/PTE/CITest/scenarios/runRemoteScenarios.sh#L18)<br><strong>Comment</strong>: <pre>variables</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/CITest/scenarios/runRemoteScenarios.sh#L44](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/6c8b3cc9bb3bfbda91b5199c28ac039512ce9500/tools/PTE/CITest/scenarios/runRemoteScenarios.sh#L44)<br><strong>Comment</strong>: <pre>I don't think we can put IBM 9.* addresses anywhere in open-source files.</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/CITest/scenarios/runRemoteScenarios.sh#L66](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/6c8b3cc9bb3bfbda91b5199c28ac039512ce9500/tools/PTE/CITest/scenarios/runRemoteScenarios.sh#L66)<br><strong>Comment</strong>: <pre>There is no error handling. What if you cannot ssh into host RHOST3 (maybe because username is wrong). Should we stop trying to login to other hosts? (If we use the "bash -e" in line 1 of this script, we should stop here automatically. And should we also login again to the previous hosts and kill the RTASK we started running there, in RHOST1 and RHOST2? Or is the user expected to do so?</pre></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Uploader</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Created</strong>: 4/19/2019, 10:24:58 AM<br><strong>UnmergedRevision</strong>: [1eed37c534e64133b308711ed38cb59d3628b2f3](https://github.com/hyperledger-gerrit-archive/fabric-test/commit/1eed37c534e64133b308711ed38cb59d3628b2f3)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/19/2019, 10:58:08 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Approved</strong>: 4/19/2019, 10:45:23 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/CITest/scenarios/runRemotePTEReport.sh#L128](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/1eed37c534e64133b308711ed38cb59d3628b2f3/tools/PTE/CITest/scenarios/runRemotePTEReport.sh#L128)<br><strong>Comment</strong>: <pre>I know I asked you to insert exits.... but...  for this script, we are just collecting data. Would it be better here to delete this line, and try to collect data from all the hosts anyways?</pre><strong>Commenter</strong>: Dongming Hwang - dongming@ibm.com<br><strong>CommentLine</strong>: [tools/PTE/CITest/scenarios/runRemotePTEReport.sh#L128](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/1eed37c534e64133b308711ed38cb59d3628b2f3/tools/PTE/CITest/scenarios/runRemotePTEReport.sh#L128)<br><strong>Comment</strong>: <pre>If fail to get a pte report from a remote host, then the overall pte report is inaccurate. We can exit here.</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/CITest/scenarios/runRemotePTEReport.sh#L131](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/1eed37c534e64133b308711ed38cb59d3628b2f3/tools/PTE/CITest/scenarios/runRemotePTEReport.sh#L131)<br><strong>Comment</strong>: <pre>At this point, we could discuss whether it is better to exit (if any failures occurred) or continue anyways.</pre><strong>Commenter</strong>: Dongming Hwang - dongming@ibm.com<br><strong>CommentLine</strong>: [tools/PTE/CITest/scenarios/runRemotePTEReport.sh#L131](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/1eed37c534e64133b308711ed38cb59d3628b2f3/tools/PTE/CITest/scenarios/runRemotePTEReport.sh#L131)<br><strong>Comment</strong>: <pre>see above.</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/CITest/scenarios/runRemoteScenarios.sh#L160](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/1eed37c534e64133b308711ed38cb59d3628b2f3/tools/PTE/CITest/scenarios/runRemoteScenarios.sh#L160)<br><strong>Comment</strong>: <pre>This is where we should figure out a way to send a signal to any of the remotehosts to abort the test. We are giving up on the test, but we may have started the script running on some of the hosts. If you don't know how to do it today, then at least add a comment here
# TODO ...

AND also add a warning to line 157 which will serve as a reminder warning to any users, telling them they need to abort any of those that were already running with the 157 failure occurred.</pre><strong>Commenter</strong>: Dongming Hwang - dongming@ibm.com<br><strong>CommentLine</strong>: [tools/PTE/CITest/scenarios/runRemoteScenarios.sh#L160](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/1eed37c534e64133b308711ed38cb59d3628b2f3/tools/PTE/CITest/scenarios/runRemoteScenarios.sh#L160)<br><strong>Comment</strong>: <pre>done</pre></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Uploader</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Created</strong>: 4/22/2019, 10:45:06 AM<br><strong>UnmergedRevision</strong>: [de93df65a1ece22d99473ae576952b2287a84097](https://github.com/hyperledger-gerrit-archive/fabric-test/commit/de93df65a1ece22d99473ae576952b2287a84097)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/22/2019, 11:20:29 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: TRIVIAL_REBASE<br><strong>Author</strong>: Dongming Hwang - dongming@ibm.com<br><strong>Uploader</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Created</strong>: 4/22/2019, 2:12:55 PM<br><strong>GitHubMergedRevision</strong>: [31d9c5b614cd1198223041dbdc7785447da32652](https://github.com/hyperledger-gerrit-archive/fabric-test/commit/31d9c5b614cd1198223041dbdc7785447da32652)<br><br><strong>Approver</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Approved</strong>: 4/22/2019, 2:13:01 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Scott Zwierzynski<br><strong>Merged</strong>: 4/22/2019, 2:13:05 PM<br><br><strong>Approver</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Approved</strong>: 4/22/2019, 2:13:01 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote>