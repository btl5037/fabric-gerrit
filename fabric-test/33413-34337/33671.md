<strong>Project</strong>: fabric-test<br><strong>Branch</strong>: master<br><strong>ID</strong>: 33671<br><strong>Subject</strong>: FAB-16644 Add kafka to raft migrate system TC<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Ramesh Babu Thoomu - rameshbabu.thoomu@gmail.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 9/23/2019, 1:46:54 PM<br><strong>LastUpdated</strong>: 9/26/2019, 1:04:33 PM<br><strong>CommitMessage</strong>:<br><pre>FAB-16644 Add kafka to raft migrate system TC

This patch adds a new test case to migrate kafka network to
raft. Also it fixes the minor changes in migratetoraft.sh script

Increase the healthcheck time to 15 mins.

FAB-16641 #done

Signed-off-by: rameshthoomu <rameshbabu.thoomu@gmail.com>
Change-Id: I473a7046507df94527262b28fd29175121335d3b
</pre><h1>Comments</h1><strong>Reviewer</strong>: Ramesh Babu Thoomu - rameshbabu.thoomu@gmail.com<br><strong>Reviewed</strong>: 9/23/2019, 1:46:54 PM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/23/2019, 1:51:33 PM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/3683/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/23/2019, 2:21:46 PM<br><strong>Message</strong>: <pre>Patch Set 1: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/3683/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-test-verify-x86_64/3683</pre><strong>Reviewer</strong>: Ramesh Babu Thoomu - rameshbabu.thoomu@gmail.com<br><strong>Reviewed</strong>: 9/23/2019, 3:28:33 PM<br><strong>Message</strong>: <pre>Patch Set 2: Commit message was updated.</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 9/24/2019, 10:42:19 AM<br><strong>Message</strong>: <pre>Patch Set 2: Code-Review-1

(6 comments)</pre><strong>Reviewer</strong>: Ramesh Babu Thoomu - rameshbabu.thoomu@gmail.com<br><strong>Reviewed</strong>: 9/24/2019, 11:30:36 AM<br><strong>Message</strong>: <pre>Patch Set 2:

(6 comments)</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 9/24/2019, 5:18:08 PM<br><strong>Message</strong>: <pre>Patch Set 2:

(3 comments)</pre><strong>Reviewer</strong>: Ramesh Babu Thoomu - rameshbabu.thoomu@gmail.com<br><strong>Reviewed</strong>: 9/26/2019, 10:32:28 AM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/26/2019, 10:34:06 AM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/3714/</pre><strong>Reviewer</strong>: Ramesh Babu Thoomu - rameshbabu.thoomu@gmail.com<br><strong>Reviewed</strong>: 9/26/2019, 10:34:11 AM<br><strong>Message</strong>: <pre>Uploaded patch set 4.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/26/2019, 10:34:13 AM<br><strong>Message</strong>: <pre>Patch Set 3: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/3714/ : ABORTED

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-test-verify-x86_64/3714</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/26/2019, 10:35:56 AM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/3715/</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 9/26/2019, 10:55:25 AM<br><strong>Message</strong>: <pre>Patch Set 4: Code-Review+2</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/26/2019, 11:06:02 AM<br><strong>Message</strong>: <pre>Patch Set 4: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-test-verify-x86_64/3715/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-test-verify-x86_64/3715</pre><strong>Reviewer</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Reviewed</strong>: 9/26/2019, 12:33:38 PM<br><strong>Message</strong>: <pre>Change has been successfully merged by Scott Zwierzynski</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 9/26/2019, 1:04:33 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Successful 

https://jenkins.hyperledger.org/job/fabric-test-merge-x86_64/810/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-test-merge-x86_64/810</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ramesh Babu Thoomu - rameshbabu.thoomu@gmail.com<br><strong>Uploader</strong>: Ramesh Babu Thoomu - rameshbabu.thoomu@gmail.com<br><strong>Created</strong>: 9/23/2019, 1:46:54 PM<br><strong>UnmergedRevision</strong>: [26be0d0dba46d20de0d1542d269e29af33594e63](https://github.com/hyperledger-gerrit-archive/fabric-test/commit/26be0d0dba46d20de0d1542d269e29af33594e63)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/23/2019, 2:21:46 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: NO_CODE_CHANGE<br><strong>Author</strong>: Ramesh Babu Thoomu - rameshbabu.thoomu@gmail.com<br><strong>Uploader</strong>: Ramesh Babu Thoomu - rameshbabu.thoomu@gmail.com<br><strong>Created</strong>: 9/23/2019, 3:28:33 PM<br><strong>UnmergedRevision</strong>: [14b842dd52ac64df3608492db0a4d441c7d227d5](https://github.com/hyperledger-gerrit-archive/fabric-test/commit/14b842dd52ac64df3608492db0a4d441c7d227d5)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/23/2019, 2:21:46 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Approved</strong>: 9/24/2019, 10:42:19 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [regression/systemtest/sysTestSuite_pte.py#L109](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/14b842dd52ac64df3608492db0a4d441c7d227d5/regression/systemtest/sysTestSuite_pte.py#L109)<br><strong>Comment</strong>: <pre>This should be 2 and 2.</pre><strong>Commenter</strong>: Ramesh Babu Thoomu - rameshbabu.thoomu@gmail.com<br><strong>CommentLine</strong>: [regression/systemtest/sysTestSuite_pte.py#L109](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/14b842dd52ac64df3608492db0a4d441c7d227d5/regression/systemtest/sysTestSuite_pte.py#L109)<br><strong>Comment</strong>: <pre>I see test case is failing when I try with 2 tx's with 1 min delay.</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [regression/systemtest/sysTestSuite_pte.py#L220](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/14b842dd52ac64df3608492db0a4d441c7d227d5/regression/systemtest/sysTestSuite_pte.py#L220)<br><strong>Comment</strong>: <pre>insert a comment explaining why we cannot test with 98MB in raft network due to slow disk speeds used for the CI k8s cluster lengthen the WAL disk write times, which can lead to a raft orderer term change, leader election, and dropped transaction</pre><strong>Commenter</strong>: Ramesh Babu Thoomu - rameshbabu.thoomu@gmail.com<br><strong>CommentLine</strong>: [regression/systemtest/sysTestSuite_pte.py#L220](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/14b842dd52ac64df3608492db0a4d441c7d227d5/regression/systemtest/sysTestSuite_pte.py#L220)<br><strong>Comment</strong>: <pre>Sure will update.</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/CITest/k8s_testsuite/networkSpecFiles/kafka_couchdb_tls.yaml#L107](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/14b842dd52ac64df3608492db0a4d441c7d227d5/tools/PTE/CITest/k8s_testsuite/networkSpecFiles/kafka_couchdb_tls.yaml#L107)<br><strong>Comment</strong>: <pre>I thought this had to be selected when the hosts were allocated in bluemix.

Please explain to me why we do not do this in all 3 networkspec files. Why are we setting this gold package only in one of them?</pre><strong>Commenter</strong>: Ramesh Babu Thoomu - rameshbabu.thoomu@gmail.com<br><strong>CommentLine</strong>: [tools/PTE/CITest/k8s_testsuite/networkSpecFiles/kafka_couchdb_tls.yaml#L107](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/14b842dd52ac64df3608492db0a4d441c7d227d5/tools/PTE/CITest/k8s_testsuite/networkSpecFiles/kafka_couchdb_tls.yaml#L107)<br><strong>Comment</strong>: <pre>I have to enable data persistence in all three networks as we are planned to run large payload tests.</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/CITest/k8s_testsuite/networkSpecFiles/kafka_couchdb_tls.yaml#L107](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/14b842dd52ac64df3608492db0a4d441c7d227d5/tools/PTE/CITest/k8s_testsuite/networkSpecFiles/kafka_couchdb_tls.yaml#L107)<br><strong>Comment</strong>: <pre>Not sure how this is related to data persistence, and not sure why you need data persistence now, because we are not doing restarts - unless you are expecting the peer to crash and we need to be able to see the panic traceback.

In any case, it is ok if you want to enable persistence, because we will need it anyways when we add restarts to the raft network and this network too.</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/PTE/CITest/k8s_testsuite/scripts/operator.sh#L229](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/14b842dd52ac64df3608492db0a4d441c7d227d5/tools/PTE/CITest/k8s_testsuite/scripts/operator.sh#L229)<br><strong>Comment</strong>: <pre>can we do 2 TX ? maybe increase the freq too.</pre><strong>Commenter</strong>: Ramesh Babu Thoomu - rameshbabu.thoomu@gmail.com<br><strong>CommentLine</strong>: [tools/PTE/CITest/k8s_testsuite/scripts/operator.sh#L229](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/14b842dd52ac64df3608492db0a4d441c7d227d5/tools/PTE/CITest/k8s_testsuite/scripts/operator.sh#L229)<br><strong>Comment</strong>: <pre>Yes I can try this with 2 but have to test.</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/operator/launcher/k8s/health.go#L43](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/14b842dd52ac64df3608492db0a4d441c7d227d5/tools/operator/launcher/k8s/health.go#L43)<br><strong>Comment</strong>: <pre>let's use %d for this, and use a variable for both this and the counter limit (15) in the next line.</pre><strong>Commenter</strong>: Ramesh Babu Thoomu - rameshbabu.thoomu@gmail.com<br><strong>CommentLine</strong>: [tools/operator/launcher/k8s/health.go#L43](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/14b842dd52ac64df3608492db0a4d441c7d227d5/tools/operator/launcher/k8s/health.go#L43)<br><strong>Comment</strong>: <pre>sure will update this to 15. To use %d, I have to update this line to fmt. Do you want me to update this?</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/operator/launcher/k8s/health.go#L43](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/14b842dd52ac64df3608492db0a4d441c7d227d5/tools/operator/launcher/k8s/health.go#L43)<br><strong>Comment</strong>: <pre>yes because it does not match 15. Define a variable in this code, so we won't need to remember to modify this the next time we change the counter limit from 15 to whatever.</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/operator/scripts/migrateToRaft.sh#L49](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/14b842dd52ac64df3608492db0a4d441c7d227d5/tools/operator/scripts/migrateToRaft.sh#L49)<br><strong>Comment</strong>: <pre>this seems wrong. do we need another one or two ../ ?</pre><strong>Commenter</strong>: Ramesh Babu Thoomu - rameshbabu.thoomu@gmail.com<br><strong>CommentLine</strong>: [tools/operator/scripts/migrateToRaft.sh#L49](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/14b842dd52ac64df3608492db0a4d441c7d227d5/tools/operator/scripts/migrateToRaft.sh#L49)<br><strong>Comment</strong>: <pre>This is pointing to the right directory. $PWD is pointing to  "operator" directory.</pre><strong>Commenter</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>CommentLine</strong>: [tools/operator/scripts/migrateToRaft.sh#L49](https://github.com/hyperledger-gerrit-archive/fabric-test/blob/14b842dd52ac64df3608492db0a4d441c7d227d5/tools/operator/scripts/migrateToRaft.sh#L49)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ramesh Babu Thoomu - rameshbabu.thoomu@gmail.com<br><strong>Uploader</strong>: Ramesh Babu Thoomu - rameshbabu.thoomu@gmail.com<br><strong>Created</strong>: 9/26/2019, 10:32:28 AM<br><strong>UnmergedRevision</strong>: [1657c045ae584ef8f0f965440a90b3ea04e9eeda](https://github.com/hyperledger-gerrit-archive/fabric-test/commit/1657c045ae584ef8f0f965440a90b3ea04e9eeda)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/26/2019, 10:34:13 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Ramesh Babu Thoomu - rameshbabu.thoomu@gmail.com<br><strong>Uploader</strong>: Ramesh Babu Thoomu - rameshbabu.thoomu@gmail.com<br><strong>Created</strong>: 9/26/2019, 10:34:11 AM<br><strong>GitHubMergedRevision</strong>: [d0152477644224c7375d366c5250c0d68659e13b](https://github.com/hyperledger-gerrit-archive/fabric-test/commit/d0152477644224c7375d366c5250c0d68659e13b)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 9/26/2019, 11:06:02 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Scott Zwierzynski - scottz@us.ibm.com<br><strong>Approved</strong>: 9/26/2019, 10:55:25 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Scott Zwierzynski<br><strong>Merged</strong>: 9/26/2019, 12:33:38 PM<br><br></blockquote>