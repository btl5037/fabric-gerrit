<strong>Project</strong>: fabric-ca<br><strong>Branch</strong>: master<br><strong>ID</strong>: 7793<br><strong>Subject</strong>: [FAB-3013] Simple load test driver for Fabric CA server<br><strong>Status</strong>: ABANDONED<br><strong>Owner</strong>: AnilKumar Ambati - aambati@hotmail.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 4/6/2017, 10:13:27 AM<br><strong>LastUpdated</strong>: 5/10/2017, 11:29:23 AM<br><strong>CommitMessage</strong>:<br><pre>[FAB-3013] Simple load test driver for Fabric CA server

This simple load test driver provides ability to drive
load against Fabric CA server. It can be customized using
a configuration file. Things like number of clients, number
of requests per client, test sequence each client executes
in each iteration, and etc., can be configured. For more info
please see README.md file.

Change-Id: I9b5e4a52f5f433fa8ea53120014e319c26168842
Signed-off-by: Anil Ambati <aambati@us.ibm.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: AnilKumar Ambati - aambati@hotmail.com<br><strong>Reviewed</strong>: 4/6/2017, 10:13:27 AM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/6/2017, 10:13:36 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-ca-verify-s390x/511/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/6/2017, 10:14:40 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-ca-verify-x86_64/503/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/6/2017, 10:16:40 AM<br><strong>Message</strong>: <pre>Patch Set 1: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-ca-verify-s390x/511/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-ca-verify-x86_64/503/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-ca-verify-ppc64le/507/ : FAILURE</pre><strong>Reviewer</strong>: AnilKumar Ambati - aambati@hotmail.com<br><strong>Reviewed</strong>: 4/6/2017, 10:20:24 AM<br><strong>Message</strong>: <pre>Patch Set 1:

(2 comments)</pre><strong>Reviewer</strong>: Keith Smith - keithsmithlfid@gmail.com<br><strong>Reviewed</strong>: 4/6/2017, 11:42:22 AM<br><strong>Message</strong>: <pre>Patch Set 1: Code-Review-1

(11 comments)</pre><strong>Reviewer</strong>: AnilKumar Ambati - aambati@hotmail.com<br><strong>Reviewed</strong>: 4/17/2017, 12:07:36 AM<br><strong>Message</strong>: <pre>Uploaded patch set 2.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/17/2017, 12:07:44 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-ca-verify-s390x/598/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/17/2017, 12:07:44 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-ca-verify-ppc64le/594/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/17/2017, 12:08:44 AM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-ca-verify-x86_64/590/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/17/2017, 12:21:08 AM<br><strong>Message</strong>: <pre>Patch Set 2: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-ca-verify-s390x/598/ : SUCCESS

https://jenkins.hyperledger.org/job/fabric-ca-verify-x86_64/590/ : SUCCESS

https://jenkins.hyperledger.org/job/fabric-ca-verify-ppc64le/594/ : SUCCESS</pre><strong>Reviewer</strong>: Volodymyr Paprotski - vpaprots@ca.ibm.com<br><strong>Reviewed</strong>: 4/17/2017, 3:33:27 PM<br><strong>Message</strong>: <pre>Patch Set 2:

It would be much much nicer if this used to go bench interface. You inherit a lot of functionality from there, rather then rolling your own (I've thrown together plenty of quick and dirty benchmarks with it, its very convenient. i.e. https://github.com/vpaprots/fabric/blob/bench/bench/bccsp_test.go 
I can run it directly with `go test -run none -bench .` or compile it into executable and run from there.. i.e. `./cardBench -test.bench . -test.count 3` and you get to use all the other go test options, like multiple runs, filtering by test name and so on..)

You already have most of the code there, just a matter of renaming a few functions and changing the runLoad.sh to use go test instead.
Relevant docs:
- https://golang.org/cmd/go/#hdr-Description_of_testing_flags
- https://golang.org/pkg/testing/#hdr-Benchmarks</pre><strong>Reviewer</strong>: AnilKumar Ambati - aambati@hotmail.com<br><strong>Reviewed</strong>: 4/17/2017, 3:37:49 PM<br><strong>Message</strong>: <pre>Patch Set 2:

(7 comments)</pre><strong>Reviewer</strong>: AnilKumar Ambati - aambati@hotmail.com<br><strong>Reviewed</strong>: 4/17/2017, 3:51:33 PM<br><strong>Message</strong>: <pre>Uploaded patch set 3.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/17/2017, 3:51:41 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-ca-verify-ppc64le/603/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/17/2017, 3:52:34 PM<br><strong>Message</strong>: <pre>Patch Set 3:

Build Started https://jenkins.hyperledger.org/job/fabric-ca-verify-x86_64/599/ (3/3)</pre><strong>Reviewer</strong>: AnilKumar Ambati - aambati@hotmail.com<br><strong>Reviewed</strong>: 4/17/2017, 3:53:11 PM<br><strong>Message</strong>: <pre>Uploaded patch set 4.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/17/2017, 3:53:21 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-ca-verify-ppc64le/604/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/17/2017, 3:55:54 PM<br><strong>Message</strong>: <pre>Patch Set 4:

Build Started https://jenkins.hyperledger.org/job/fabric-ca-verify-x86_64/600/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/17/2017, 4:07:12 PM<br><strong>Message</strong>: <pre>Patch Set 3: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-ca-verify-s390x/607/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-ca-verify-x86_64/599/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-ca-verify-ppc64le/603/ : FAILURE</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 4/17/2017, 4:09:00 PM<br><strong>Message</strong>: <pre>Patch Set 4: Verified-1

Build Failed 

https://jenkins.hyperledger.org/job/fabric-ca-verify-s390x/608/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-ca-verify-ppc64le/604/ : FAILURE

https://jenkins.hyperledger.org/job/fabric-ca-verify-x86_64/600/ : SUCCESS</pre><strong>Reviewer</strong>: Keith Smith - keithsmithlfid@gmail.com<br><strong>Reviewed</strong>: 4/17/2017, 5:13:29 PM<br><strong>Message</strong>: <pre>Patch Set 4: Code-Review-1

(6 comments)</pre><strong>Reviewer</strong>: Volodymyr Paprotski - vpaprots@ca.ibm.com<br><strong>Reviewed</strong>: 4/20/2017, 12:13:48 AM<br><strong>Message</strong>: <pre>Patch Set 4:

(2 comments)</pre><strong>Reviewer</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Reviewed</strong>: 4/20/2017, 6:31:28 AM<br><strong>Message</strong>: <pre>Patch Set 4: Code-Review-2

can we evaluate using the benchmark functionality of go test?</pre><strong>Reviewer</strong>: AnilKumar Ambati - aambati@hotmail.com<br><strong>Reviewed</strong>: 4/20/2017, 3:19:50 PM<br><strong>Message</strong>: <pre>Patch Set 4:

> can we evaluate using the benchmark functionality of go test?

Gari, I will investigate benchmark functionality. Volod also suggested in his previous comment.</pre><strong>Reviewer</strong>: AnilKumar Ambati - aambati@hotmail.com<br><strong>Reviewed</strong>: 5/1/2017, 11:40:43 PM<br><strong>Message</strong>: <pre>Uploaded patch set 5.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/1/2017, 11:40:49 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-ca-verify-s390x/723/ (1/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/1/2017, 11:40:49 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-ca-verify-ppc64le/719/ (2/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/1/2017, 11:43:39 PM<br><strong>Message</strong>: <pre>Patch Set 5:

Build Started https://jenkins.hyperledger.org/job/fabric-ca-verify-x86_64/717/ (3/3)</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 5/2/2017, 12:08:21 AM<br><strong>Message</strong>: <pre>Patch Set 5: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-ca-verify-x86_64/717/ : SUCCESS

https://jenkins.hyperledger.org/job/fabric-ca-verify-ppc64le/719/ : SUCCESS

https://jenkins.hyperledger.org/job/fabric-ca-verify-s390x/723/ : SUCCESS</pre><strong>Reviewer</strong>: AnilKumar Ambati - aambati@hotmail.com<br><strong>Reviewed</strong>: 5/2/2017, 9:17:00 AM<br><strong>Message</strong>: <pre>Patch Set 5:

This is still in WIP...not ready for re-review</pre><strong>Reviewer</strong>: AnilKumar Ambati - aambati@hotmail.com<br><strong>Reviewed</strong>: 5/10/2017, 11:29:23 AM<br><strong>Message</strong>: <pre>Abandoned

will resubmit the change set after 1.0</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Anil Ambati - aambati@us.ibm.com<br><strong>Uploader</strong>: AnilKumar Ambati - aambati@hotmail.com<br><strong>Created</strong>: 4/6/2017, 10:13:27 AM<br><strong>UnmergedRevision</strong>: [0694412191fc1604e62fe984fb18e5f32272cd20](https://github.com/hyperledger-gerrit-archive/fabric-ca/commit/0694412191fc1604e62fe984fb18e5f32272cd20)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/6/2017, 10:16:40 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Keith Smith - keithsmithlfid@gmail.com<br><strong>Approved</strong>: 4/6/2017, 11:42:22 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: AnilKumar Ambati - aambati@hotmail.com<br><strong>CommentLine</strong>: [cmd/fabric-ca-client/enroll.go#L37](https://github.com/hyperledger-gerrit-archive/fabric-ca/blob/0694412191fc1604e62fe984fb18e5f32272cd20/cmd/fabric-ca-client/enroll.go#L37)<br><strong>Comment</strong>: <pre>Needs doc update, if the the change to use word "identity" instead of "user" is approved...similar change is in other files.</pre><strong>Commenter</strong>: Keith Smith - keithsmithlfid@gmail.com<br><strong>CommentLine</strong>: [cmd/fabric-ca-client/enroll.go#L37](https://github.com/hyperledger-gerrit-archive/fabric-ca/blob/0694412191fc1604e62fe984fb18e5f32272cd20/cmd/fabric-ca-client/enroll.go#L37)<br><strong>Comment</strong>: <pre>Yes, pls change to identity for consistency.  But I think profiling and these name changes should be in different change sets.</pre><strong>Commenter</strong>: AnilKumar Ambati - aambati@hotmail.com<br><strong>CommentLine</strong>: [cmd/fabric-ca-client/enroll.go#L37](https://github.com/hyperledger-gerrit-archive/fabric-ca/blob/0694412191fc1604e62fe984fb18e5f32272cd20/cmd/fabric-ca-client/enroll.go#L37)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: AnilKumar Ambati - aambati@hotmail.com<br><strong>CommentLine</strong>: [cmd/fabric-ca-client/main.go#L47](https://github.com/hyperledger-gerrit-archive/fabric-ca/blob/0694412191fc1604e62fe984fb18e5f32272cd20/cmd/fabric-ca-client/main.go#L47)<br><strong>Comment</strong>: <pre>These changes provide ability to create mem/cpu/block profile snapshots of the client.</pre><strong>Commenter</strong>: Keith Smith - keithsmithlfid@gmail.com<br><strong>CommentLine</strong>: [cmd/fabric-ca-client/main.go#L47](https://github.com/hyperledger-gerrit-archive/fabric-ca/blob/0694412191fc1604e62fe984fb18e5f32272cd20/cmd/fabric-ca-client/main.go#L47)<br><strong>Comment</strong>: <pre>1) This code should be invoked only if the "-P" option is specified, so it can't be part of a PreRun.
2) Is it possible to profile cpu and memory in the same run?  I hope so.
3) What is block?</pre><strong>Commenter</strong>: AnilKumar Ambati - aambati@hotmail.com<br><strong>CommentLine</strong>: [cmd/fabric-ca-client/main.go#L47](https://github.com/hyperledger-gerrit-archive/fabric-ca/blob/0694412191fc1604e62fe984fb18e5f32272cd20/cmd/fabric-ca-client/main.go#L47)<br><strong>Comment</strong>: <pre>block profiling is "contention" profiling...i have not found any detailed doc on this, so i am not sure how this works yet. Currently, cpu and memory profiling cannot be done in the same run for the client. But for the server, go tool pprof can be pointed to the profiling port to analyze memory or cpu profile dumps.</pre><strong>Commenter</strong>: Keith Smith - keithsmithlfid@gmail.com<br><strong>CommentLine</strong>: [lib/server.go#L607](https://github.com/hyperledger-gerrit-archive/fabric-ca/blob/0694412191fc1604e62fe984fb18e5f32272cd20/lib/server.go#L607)<br><strong>Comment</strong>: <pre>This port should be configurable, with this being the default.</pre><strong>Commenter</strong>: AnilKumar Ambati - aambati@hotmail.com<br><strong>CommentLine</strong>: [lib/server.go#L607](https://github.com/hyperledger-gerrit-archive/fabric-ca/blob/0694412191fc1604e62fe984fb18e5f32272cd20/lib/server.go#L607)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Keith Smith - keithsmithlfid@gmail.com<br><strong>CommentLine</strong>: [lib/serverconfig.go#L47](https://github.com/hyperledger-gerrit-archive/fabric-ca/blob/0694412191fc1604e62fe984fb18e5f32272cd20/lib/serverconfig.go#L47)<br><strong>Comment</strong>: <pre>You could change this from bool to int to allow configurable port.  I think you should define a "ProfileConfig" object which contains port and type of profiling, assuming we can't enable both CPU and memory profiling at the same time.</pre><strong>Commenter</strong>: AnilKumar Ambati - aambati@hotmail.com<br><strong>CommentLine</strong>: [lib/serverconfig.go#L47](https://github.com/hyperledger-gerrit-archive/fabric-ca/blob/0694412191fc1604e62fe984fb18e5f32272cd20/lib/serverconfig.go#L47)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Keith Smith - keithsmithlfid@gmail.com<br><strong>CommentLine</strong>: [scripts/load/README.md#L5](https://github.com/hyperledger-gerrit-archive/fabric-ca/blob/0694412191fc1604e62fe984fb18e5f32272cd20/scripts/load/README.md#L5)<br><strong>Comment</strong>: <pre>Why are two enrollments needed?
The default is unlimited</pre><strong>Commenter</strong>: AnilKumar Ambati - aambati@hotmail.com<br><strong>CommentLine</strong>: [scripts/load/README.md#L5](https://github.com/hyperledger-gerrit-archive/fabric-ca/blob/0694412191fc1604e62fe984fb18e5f32272cd20/scripts/load/README.md#L5)<br><strong>Comment</strong>: <pre>maxEnrollments need to be at least 2 as reenroll is called for each identity...I was testing in FVT image, i found that Allen set max enrollments to 1 , so i wanted to make it clear that max enrollments need to be at least 2</pre><strong>Commenter</strong>: Keith Smith - keithsmithlfid@gmail.com<br><strong>CommentLine</strong>: [scripts/load/README.md#L6](https://github.com/hyperledger-gerrit-archive/fabric-ca/blob/0694412191fc1604e62fe984fb18e5f32272cd20/scripts/load/README.md#L6)<br><strong>Comment</strong>: <pre>make a note of</pre><strong>Commenter</strong>: AnilKumar Ambati - aambati@hotmail.com<br><strong>CommentLine</strong>: [scripts/load/README.md#L6](https://github.com/hyperledger-gerrit-archive/fabric-ca/blob/0694412191fc1604e62fe984fb18e5f32272cd20/scripts/load/README.md#L6)<br><strong>Comment</strong>: <pre>Done</pre><strong>Commenter</strong>: Keith Smith - keithsmithlfid@gmail.com<br><strong>CommentLine</strong>: [scripts/load/README.md#L10](https://github.com/hyperledger-gerrit-archive/fabric-ca/blob/0694412191fc1604e62fe984fb18e5f32272cd20/scripts/load/README.md#L10)<br><strong>Comment</strong>: <pre>Would like this to be deterministic, to make sure as much as possible that we can reproduce problems that occur</pre><strong>Commenter</strong>: Keith Smith - keithsmithlfid@gmail.com<br><strong>CommentLine</strong>: [scripts/load/main.go#L0](https://github.com/hyperledger-gerrit-archive/fabric-ca/blob/0694412191fc1604e62fe984fb18e5f32272cd20/scripts/load/main.go#L0)<br><strong>Comment</strong>: <pre>I'm torn between:
1) you could just add a "test" command (similar to "enroll" or "register") to the fabric-ca-client. l
2) If another executable, it should be installable with "go get" like the others, so add a directory at "fabric-ca/cmd/fabric-ca-load-tester" or something like that.</pre><strong>Commenter</strong>: Keith Smith - keithsmithlfid@gmail.com<br><strong>CommentLine</strong>: [scripts/load/main.go#L109](https://github.com/hyperledger-gerrit-archive/fabric-ca/blob/0694412191fc1604e62fe984fb18e5f32272cd20/scripts/load/main.go#L109)<br><strong>Comment</strong>: <pre>We don't need to throttle requests.  Let's keep it simple.</pre><strong>Commenter</strong>: Keith Smith - keithsmithlfid@gmail.com<br><strong>CommentLine</strong>: [scripts/load/main.go#L154](https://github.com/hyperledger-gerrit-archive/fabric-ca/blob/0694412191fc1604e62fe984fb18e5f32272cd20/scripts/load/main.go#L154)<br><strong>Comment</strong>: <pre>Don't need to store this</pre><strong>Commenter</strong>: Keith Smith - keithsmithlfid@gmail.com<br><strong>CommentLine</strong>: [scripts/run_tests#L12](https://github.com/hyperledger-gerrit-archive/fabric-ca/blob/0694412191fc1604e62fe984fb18e5f32272cd20/scripts/run_tests#L12)<br><strong>Comment</strong>: <pre>We still want to require test coverage for the load driver itself, so don't want to exclude it I think</pre><strong>Commenter</strong>: AnilKumar Ambati - aambati@hotmail.com<br><strong>CommentLine</strong>: [scripts/run_tests#L12](https://github.com/hyperledger-gerrit-archive/fabric-ca/blob/0694412191fc1604e62fe984fb18e5f32272cd20/scripts/run_tests#L12)<br><strong>Comment</strong>: <pre>ok...you want me to write tests for the load driver? I will look into it</pre></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Anil Ambati - aambati@us.ibm.com<br><strong>Uploader</strong>: AnilKumar Ambati - aambati@hotmail.com<br><strong>Created</strong>: 4/17/2017, 12:07:36 AM<br><strong>UnmergedRevision</strong>: [1f9bb3e2ae318e18a1d68c89d12aeeb93f474590](https://github.com/hyperledger-gerrit-archive/fabric-ca/commit/1f9bb3e2ae318e18a1d68c89d12aeeb93f474590)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/17/2017, 12:21:08 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br></blockquote><h3>PatchSet Number: 3</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Anil Ambati - aambati@us.ibm.com<br><strong>Uploader</strong>: AnilKumar Ambati - aambati@hotmail.com<br><strong>Created</strong>: 4/17/2017, 3:51:33 PM<br><strong>UnmergedRevision</strong>: [5c4ca619843ff28d8264b838d7f332c9640076de](https://github.com/hyperledger-gerrit-archive/fabric-ca/commit/5c4ca619843ff28d8264b838d7f332c9640076de)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/17/2017, 4:07:12 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br></blockquote><h3>PatchSet Number: 4</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Anil Ambati - aambati@us.ibm.com<br><strong>Uploader</strong>: AnilKumar Ambati - aambati@hotmail.com<br><strong>Created</strong>: 4/17/2017, 3:53:11 PM<br><strong>UnmergedRevision</strong>: [3497ec2d2c43fd151e7a7cb0702bcc01d6754af7](https://github.com/hyperledger-gerrit-archive/fabric-ca/commit/3497ec2d2c43fd151e7a7cb0702bcc01d6754af7)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 4/17/2017, 4:09:00 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Keith Smith - keithsmithlfid@gmail.com<br><strong>Approved</strong>: 4/17/2017, 5:13:29 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><strong>Approver</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Approved</strong>: 4/20/2017, 6:31:28 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br><h2>Comments</h2><strong>Commenter</strong>: Volodymyr Paprotski - vpaprots@ca.ibm.com<br><strong>CommentLine</strong>: [test/fabric-ca-load-tester/main.go#L83](https://github.com/hyperledger-gerrit-archive/fabric-ca/blob/3497ec2d2c43fd151e7a7cb0702bcc01d6754af7/test/fabric-ca-load-tester/main.go#L83)<br><strong>Comment</strong>: <pre>which you already do here. Just record and print this seed. And add an option to supply the seed for investigation.</pre><strong>Commenter</strong>: Keith Smith - keithsmithlfid@gmail.com<br><strong>CommentLine</strong>: [test/fabric-ca-load-tester/main.go#L106](https://github.com/hyperledger-gerrit-archive/fabric-ca/blob/3497ec2d2c43fd151e7a7cb0702bcc01d6754af7/test/fabric-ca-load-tester/main.go#L106)<br><strong>Comment</strong>: <pre>I don't know why we would ever want/need to throttle requests.</pre><strong>Commenter</strong>: Keith Smith - keithsmithlfid@gmail.com<br><strong>CommentLine</strong>: [test/fabric-ca-load-tester/main.go#L203](https://github.com/hyperledger-gerrit-archive/fabric-ca/blob/3497ec2d2c43fd151e7a7cb0702bcc01d6754af7/test/fabric-ca-load-tester/main.go#L203)<br><strong>Comment</strong>: <pre>We want to be able to reproduce errors, so we don't want random behavior.  If you want to make it easy to get full test coverage across all types, then you can just iterate thru them.</pre><strong>Commenter</strong>: Volodymyr Paprotski - vpaprots@ca.ibm.com<br><strong>CommentLine</strong>: [test/fabric-ca-load-tester/main.go#L203](https://github.com/hyperledger-gerrit-archive/fabric-ca/blob/3497ec2d2c43fd151e7a7cb0702bcc01d6754af7/test/fabric-ca-load-tester/main.go#L203)<br><strong>Comment</strong>: <pre>Standard way to do this is via pseudo-random numbers. Generate a random seed (tod or some such) and use it to initialize the pseudo-random generator which is then used to generate your test vectors.

Then print the seed as part of running the test as well as provide an option to supply the seed to rerun the test.

This might get complicated if your run is not deterministic (i.e. race conditions due to threads?)</pre><strong>Commenter</strong>: Keith Smith - keithsmithlfid@gmail.com<br><strong>CommentLine</strong>: [test/fabric-ca-load-tester/runLoad.sh#L11](https://github.com/hyperledger-gerrit-archive/fabric-ca/blob/3497ec2d2c43fd151e7a7cb0702bcc01d6754af7/test/fabric-ca-load-tester/runLoad.sh#L11)<br><strong>Comment</strong>: <pre>Let's add a target to the fabric/Makefile to build this.  You should be able to simply cd to the directory and do a "go build" without the -o option or the names of the go files</pre><strong>Commenter</strong>: Keith Smith - keithsmithlfid@gmail.com<br><strong>CommentLine</strong>: [test/fabric-ca-load-tester/testClient.go#L35](https://github.com/hyperledger-gerrit-archive/fabric-ca/blob/3497ec2d2c43fd151e7a7cb0702bcc01d6754af7/test/fabric-ca-load-tester/testClient.go#L35)<br><strong>Comment</strong>: <pre>No need for channels</pre><strong>Commenter</strong>: Keith Smith - keithsmithlfid@gmail.com<br><strong>CommentLine</strong>: [test/fabric-ca-load-tester/testClient.go#L74](https://github.com/hyperledger-gerrit-archive/fabric-ca/blob/3497ec2d2c43fd151e7a7cb0702bcc01d6754af7/test/fabric-ca-load-tester/testClient.go#L74)<br><strong>Comment</strong>: <pre>Pls add an explicit enroll command here</pre><strong>Commenter</strong>: Keith Smith - keithsmithlfid@gmail.com<br><strong>CommentLine</strong>: [test/fabric-ca-load-tester/testConfig.json#L0](https://github.com/hyperledger-gerrit-archive/fabric-ca/blob/3497ec2d2c43fd151e7a7cb0702bcc01d6754af7/test/fabric-ca-load-tester/testConfig.json#L0)<br><strong>Comment</strong>: <pre>Some suggestions:

1) Allow "tcertReq" fields to be specified in a "testSeq->get-tcerts" request, and "revokeReq" fields to be specified in a "testSeq->revoke" request.  This allows more flexibility and is I think easier to understand.

2) Remove fields/sections not used to avoid noise and make it easier to understand.  For example, remove "reqsPerSecond", "caConfigHome"?, and "caClientConfig" (I think this can just be hard-coded for load testing, or make it optional if you want, but is better for the default config that someone looks at is as simple as possible.

3) Use yaml instead of json so you can add comments.</pre></blockquote><h3>PatchSet Number: 5</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Anil Ambati - aambati@us.ibm.com<br><strong>Uploader</strong>: AnilKumar Ambati - aambati@hotmail.com<br><strong>Created</strong>: 5/1/2017, 11:40:43 PM<br><strong>UnmergedRevision</strong>: [9a0a83eab3314f4b998ee97bb9c70a9b35c59f12](https://github.com/hyperledger-gerrit-archive/fabric-ca/commit/9a0a83eab3314f4b998ee97bb9c70a9b35c59f12)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 5/2/2017, 12:08:21 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Gari Singh - gari.r.singh@gmail.com<br><strong>Approved</strong>: 4/20/2017, 6:31:28 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: -1<br><br></blockquote>