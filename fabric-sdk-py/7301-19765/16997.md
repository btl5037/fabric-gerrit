<strong>Project</strong>: fabric-sdk-py<br><strong>Branch</strong>: master<br><strong>ID</strong>: 16997<br><strong>Subject</strong>: [FAB-7819] Fix the CI failure<br><strong>Status</strong>: MERGED<br><strong>Owner</strong>: Baohua Yang - yangbaohua@gmail.com<br><strong>Assignee</strong>:<br><strong>Created</strong>: 1/19/2018, 10:49:19 AM<br><strong>LastUpdated</strong>: 1/21/2018, 9:07:02 PM<br><strong>CommitMessage</strong>:<br><pre>[FAB-7819] Fix the CI failure

CI fails without reporting any error.

After tracking the problem, the root cause is that in the new added
chaincode_install test, the pem file is not read as binary, which caused
grpc channel creation problem and quit.

This patchset fixes the problem and regenerates the protobuf files with
python 3.6.

And refine the code structure and minor update the doc.

TODO: we need to enable the chaincode installation testing with an env
that has channel created and joined already.

Change-Id: I7ff5939b6b13c15e3ccdadd2d2804f8b17cf369c
Signed-off-by: Baohua Yang <yangbaohua@gmail.com>
</pre><h1>Comments</h1><strong>Reviewer</strong>: Baohua Yang - yangbaohua@gmail.com<br><strong>Reviewed</strong>: 1/19/2018, 10:49:19 AM<br><strong>Message</strong>: <pre>Uploaded patch set 1.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/19/2018, 10:54:16 AM<br><strong>Message</strong>: <pre>Patch Set 1:

Build Started https://jenkins.hyperledger.org/job/fabric-sdk-py-verify-x86_64/304/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/19/2018, 11:08:00 AM<br><strong>Message</strong>: <pre>Patch Set 1: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-sdk-py-verify-x86_64/304/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-sdk-py-verify-x86_64/304</pre><strong>Reviewer</strong>: Wang Dong - xdragon007@gmail.com<br><strong>Reviewed</strong>: 1/19/2018, 5:12:15 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(4 comments)</pre><strong>Reviewer</strong>: Baohua Yang - yangbaohua@gmail.com<br><strong>Reviewed</strong>: 1/19/2018, 7:47:44 PM<br><strong>Message</strong>: <pre>Patch Set 1:

(4 comments)

Will fix, thanks!</pre><strong>Reviewer</strong>: Baohua Yang - yangbaohua@gmail.com<br><strong>Reviewed</strong>: 1/19/2018, 8:05:07 PM<br><strong>Message</strong>: <pre>Uploaded patch set 2.</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/19/2018, 8:08:25 PM<br><strong>Message</strong>: <pre>Patch Set 2:

Build Started https://jenkins.hyperledger.org/job/fabric-sdk-py-verify-x86_64/305/</pre><strong>Reviewer</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Reviewed</strong>: 1/19/2018, 8:15:12 PM<br><strong>Message</strong>: <pre>Patch Set 2: Verified+1

Build Successful 

https://jenkins.hyperledger.org/job/fabric-sdk-py-verify-x86_64/305/ : SUCCESS

Logs: https://logs.hyperledger.org/production/vex-yul-hyp-jenkins-3/fabric-sdk-py-verify-x86_64/305</pre><strong>Reviewer</strong>: Wang Dong - xdragon007@gmail.com<br><strong>Reviewed</strong>: 1/20/2018, 3:34:39 AM<br><strong>Message</strong>: <pre>Patch Set 2:

(2 comments)</pre><strong>Reviewer</strong>: Baohua Yang - yangbaohua@gmail.com<br><strong>Reviewed</strong>: 1/20/2018, 6:36:02 AM<br><strong>Message</strong>: <pre>Patch Set 2:

(2 comments)</pre><strong>Reviewer</strong>: Wang Dong - xdragon007@gmail.com<br><strong>Reviewed</strong>: 1/20/2018, 8:45:08 AM<br><strong>Message</strong>: <pre>Patch Set 2: Code-Review+1</pre><strong>Reviewer</strong>: Kai Chen - 281165273@qq.com<br><strong>Reviewed</strong>: 1/21/2018, 7:02:49 AM<br><strong>Message</strong>: <pre>Patch Set 2: Code-Review+2

Let it go first. And  I suggest move send_install_proposal method from Channel to Client object in another patch later</pre><strong>Reviewer</strong>: Baohua Yang - yangbaohua@gmail.com<br><strong>Reviewed</strong>: 1/21/2018, 9:06:59 PM<br><strong>Message</strong>: <pre>Patch Set 2: Code-Review+2

> Let it go first. And  I suggest move send_install_proposal method
 > from Channel to Client object in another patch later

Aha, sure, and welcome to fix.</pre><strong>Reviewer</strong>: Baohua Yang - yangbaohua@gmail.com<br><strong>Reviewed</strong>: 1/21/2018, 9:07:02 PM<br><strong>Message</strong>: <pre>Change has been successfully merged by Baohua Yang</pre><h1>PatchSets</h1><h3>PatchSet Number: 1</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Baohua Yang - yangbaohua@gmail.com<br><strong>Uploader</strong>: Baohua Yang - yangbaohua@gmail.com<br><strong>Created</strong>: 1/19/2018, 10:49:19 AM<br><strong>UnmergedRevision</strong>: [43617af773d48ac292bf0f327abe2d336fac7815](https://github.com/hyperledger-gerrit-archive/fabric-sdk-py/commit/43617af773d48ac292bf0f327abe2d336fac7815)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/19/2018, 11:08:00 AM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Wang Dong - xdragon007@gmail.com<br><strong>CommentLine</strong>: [hfc/fabric/channel/channel.py#L579](https://github.com/hyperledger-gerrit-archive/fabric-sdk-py/blob/43617af773d48ac292bf0f327abe2d336fac7815/hfc/fabric/channel/channel.py#L579)<br><strong>Comment</strong>: <pre>why to initialize this function with this channel name which is just a test channel name?</pre><strong>Commenter</strong>: Baohua Yang - yangbaohua@gmail.com<br><strong>CommentLine</strong>: [hfc/fabric/channel/channel.py#L579](https://github.com/hyperledger-gerrit-archive/fabric-sdk-py/blob/43617af773d48ac292bf0f327abe2d336fac7815/hfc/fabric/channel/channel.py#L579)<br><strong>Comment</strong>: <pre>this is a default value, as user can pass a name here.</pre><strong>Commenter</strong>: Wang Dong - xdragon007@gmail.com<br><strong>CommentLine</strong>: [hfc/fabric/client.py#L325](https://github.com/hyperledger-gerrit-archive/fabric-sdk-py/blob/43617af773d48ac292bf0f327abe2d336fac7815/hfc/fabric/client.py#L325)<br><strong>Comment</strong>: <pre>same here.</pre><strong>Commenter</strong>: Baohua Yang - yangbaohua@gmail.com<br><strong>CommentLine</strong>: [hfc/fabric/client.py#L325](https://github.com/hyperledger-gerrit-archive/fabric-sdk-py/blob/43617af773d48ac292bf0f327abe2d336fac7815/hfc/fabric/client.py#L325)<br><strong>Comment</strong>: <pre>this is the default application channel we are using for the e2e test.</pre><strong>Commenter</strong>: Wang Dong - xdragon007@gmail.com<br><strong>CommentLine</strong>: [hfc/fabric/client.py#L325](https://github.com/hyperledger-gerrit-archive/fabric-sdk-py/blob/43617af773d48ac292bf0f327abe2d336fac7815/hfc/fabric/client.py#L325)<br><strong>Comment</strong>: <pre>emm, from my side, it is a little weird to set the default value in a global function for test. I prefer to not set it here. It is better to read this config from a test config file. Then it will be easy to make some modification later on if necessary.  I think it will be more flexible. what do you think?</pre><strong>Commenter</strong>: Baohua Yang - yangbaohua@gmail.com<br><strong>CommentLine</strong>: [hfc/fabric/client.py#L325](https://github.com/hyperledger-gerrit-archive/fabric-sdk-py/blob/43617af773d48ac292bf0f327abe2d336fac7815/hfc/fabric/client.py#L325)<br><strong>Comment</strong>: <pre>good idea, but be noticed that this part of code is not the test case, but SDK one. Then users need to set the value accordingly.
In those test cases, we can load from config.</pre><strong>Commenter</strong>: Wang Dong - xdragon007@gmail.com<br><strong>CommentLine</strong>: [hfc/fabric/orderer.py#L35](https://github.com/hyperledger-gerrit-archive/fabric-sdk-py/blob/43617af773d48ac292bf0f327abe2d336fac7815/hfc/fabric/orderer.py#L35)<br><strong>Comment</strong>: <pre>I am not sure if this is good here. Because this opts will be overridden  only for TLS enabled, but what if the TLS is disabled, this opts will be passed without any change. This will be error potentially.</pre><strong>Commenter</strong>: Baohua Yang - yangbaohua@gmail.com<br><strong>CommentLine</strong>: [hfc/fabric/orderer.py#L35](https://github.com/hyperledger-gerrit-archive/fabric-sdk-py/blob/43617af773d48ac292bf0f327abe2d336fac7815/hfc/fabric/orderer.py#L35)<br><strong>Comment</strong>: <pre>right.
i will disable the default value.</pre><strong>Commenter</strong>: Wang Dong - xdragon007@gmail.com<br><strong>CommentLine</strong>: [hfc/util/channel.py#L35](https://github.com/hyperledger-gerrit-archive/fabric-sdk-py/blob/43617af773d48ac292bf0f327abe2d336fac7815/hfc/util/channel.py#L35)<br><strong>Comment</strong>: <pre>no close for this open? Use with clause will not have this trouble.</pre><strong>Commenter</strong>: Baohua Yang - yangbaohua@gmail.com<br><strong>CommentLine</strong>: [hfc/util/channel.py#L35](https://github.com/hyperledger-gerrit-archive/fabric-sdk-py/blob/43617af773d48ac292bf0f327abe2d336fac7815/hfc/util/channel.py#L35)<br><strong>Comment</strong>: <pre>Done</pre></blockquote><h3>PatchSet Number: 2</h3><blockquote><strong>Type</strong>: REWORK<br><strong>Author</strong>: Baohua Yang - yangbaohua@gmail.com<br><strong>Uploader</strong>: Baohua Yang - yangbaohua@gmail.com<br><strong>Created</strong>: 1/19/2018, 8:05:07 PM<br><strong>GitHubMergedRevision</strong>: [2823d4a2c6ac9fe21f7f3780253b8e8ab5a2c1e4](https://github.com/hyperledger-gerrit-archive/fabric-sdk-py/commit/2823d4a2c6ac9fe21f7f3780253b8e8ab5a2c1e4)<br><br><strong>Approver</strong>: Hyperledger Jobbuilder - jobbuilder@jenkins.hyperledger.org<br><strong>Approved</strong>: 1/19/2018, 8:15:12 PM<br><strong>Type</strong>: Verified<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Kai Chen - 281165273@qq.com<br><strong>Approved</strong>: 1/21/2018, 7:02:49 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>Approver</strong>: Baohua Yang - yangbaohua@gmail.com<br><strong>Approved</strong>: 1/21/2018, 9:06:59 PM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><strong>MergedBy</strong>: Baohua Yang<br><strong>Merged</strong>: 1/21/2018, 9:07:02 PM<br><br><strong>Approver</strong>: Wang Dong - xdragon007@gmail.com<br><strong>Approved</strong>: 1/20/2018, 8:45:08 AM<br><strong>Type</strong>: Code-Review<br><strong>Value</strong>: 1<br><br><h2>Comments</h2><strong>Commenter</strong>: Wang Dong - xdragon007@gmail.com<br><strong>CommentLine</strong>: [tox.ini#L3](https://github.com/hyperledger-gerrit-archive/fabric-sdk-py/blob/2823d4a2c6ac9fe21f7f3780253b8e8ab5a2c1e4/tox.ini#L3)<br><strong>Comment</strong>: <pre>when I install python3 from Mac, it just installed python36 by default. So I guess py35 and py30 are out of date? I am not sure what is the situation in CI. Please consider this. And shall we support python36?</pre><strong>Commenter</strong>: Baohua Yang - yangbaohua@gmail.com<br><strong>CommentLine</strong>: [tox.ini#L3](https://github.com/hyperledger-gerrit-archive/fabric-sdk-py/blob/2823d4a2c6ac9fe21f7f3780253b8e8ab5a2c1e4/tox.ini#L3)<br><strong>Comment</strong>: <pre>tox will try to use those near the target version if not installed.
e.g., if u have 3.6, and it will take 3.6 as py35 env.</pre></blockquote>